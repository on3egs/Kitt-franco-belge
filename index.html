<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KITT FRANCO-BELGE // SYSTÈME CENTRAL</title>
<meta name="description" content="Interface KITT Franco-Belge — IA embarquée sur NVIDIA Jetson. Projet fan non commercial par Manix."/>
<meta name="theme-color" content="#000000"/>
<style>
:root{
  --green:#00ff66;
  --green-dim:#00aa44;
  --red:#ff1a1a;
  --amber:#ffaa00;
  --cyan:#00ccff;
  --border-dim:rgba(0,255,102,.15);
  --display:"Courier New",monospace;
  --mono:"Courier New",monospace;
  --bg:#000;
}
*{box-sizing:border-box;}
html,body{margin:0;height:100%;background:var(--bg);color:var(--green);font-family:"Courier New",monospace;overflow:hidden;}

/* CRT scanlines */
body::before{content:"";position:fixed;top:0;left:0;right:0;bottom:0;background:repeating-linear-gradient(0deg,rgba(0,0,0,.18),rgba(0,0,0,.18) 1px,transparent 1px,transparent 3px);pointer-events:none;z-index:9998;}
body::after{content:"";position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,255,80,.015);pointer-events:none;z-index:9999;animation:flicker .12s infinite;}
@keyframes flicker{0%{opacity:.88}48%{opacity:1}52%{opacity:.92}100%{opacity:.96}}

/* ── ÉCRAN ACCÈS — MOT DE PASSE ─────────────────────────── */
@keyframes accessPulse{0%,100%{text-shadow:0 0 8px #FF9900}50%{text-shadow:0 0 22px #FF9900,0 0 50px rgba(255,153,0,.4)}}
@keyframes wrongShake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-8px)}40%,80%{transform:translateX(8px)}}
#access-screen{
  position:fixed;top:0;left:0;right:0;bottom:0;
  background:rgba(0,0,0,.93);z-index:9500;
  display:flex;align-items:center;justify-content:center;
  padding:20px;font-family:"Courier New",monospace;
  overflow:hidden;
}
#access-screen::before{
  content:'';
  position:absolute;top:0;left:0;right:0;bottom:0;
  background:
    repeating-linear-gradient(0deg,transparent,transparent 59px,rgba(255,120,0,0.04) 60px),
    repeating-linear-gradient(90deg,transparent,transparent 59px,rgba(255,120,0,0.04) 60px);
  pointer-events:none;z-index:0;
  animation:gridPulse 4s ease-in-out infinite;
}
@keyframes gridPulse{0%,100%{opacity:0.4}50%{opacity:1}}
#access-box{
  width:100%;max-width:480px;
  border:1px solid #CC6600;border-radius:8px;
  background:rgba(4,2,0,.6);backdrop-filter:blur(8px);
  padding:32px 36px;position:relative;overflow:hidden;z-index:1;
  box-shadow:0 0 80px rgba(255,100,0,.18),0 0 160px rgba(255,60,0,.08),inset 0 0 40px rgba(255,80,0,.05);
}
#access-box::after{content:'';position:absolute;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,153,0,.35),transparent);animation:scanBar 3s linear infinite;pointer-events:none;}
#access-hdr{color:#FF9900;letter-spacing:4px;font-size:12px;text-align:center;border-bottom:1px solid #663300;padding-bottom:12px;margin-bottom:20px;animation:accessPulse 3s ease-in-out infinite;}
#access-log{min-height:100px;font-size:11px;letter-spacing:2px;line-height:2;margin-bottom:16px;color:#885500;}
#access-log .a-line{color:#FF8800;}
#access-log .a-ok{color:#FFAA00;}
#access-log .a-err{color:#ff3300;}
#access-input-row{display:flex;align-items:center;gap:10px;margin-bottom:14px;margin-top:-4px;padding:10px 8px 6px;background:rgba(255,100,0,.05);border:1px solid #553300;border-radius:4px;}
#access-prompt{color:#FF8800;font-size:12px;letter-spacing:2px;white-space:nowrap;text-shadow:0 0 8px #FF880088;}
@keyframes inputBlink{0%,49%{border-color:#995500;box-shadow:0 2px 6px rgba(255,100,0,.1)}50%,100%{border-color:#FF9900;box-shadow:0 2px 14px rgba(255,153,0,.4)}}
#access-input{
  flex:1;background:transparent;border:none;border-bottom:2px solid #884400;
  color:#FFBB44;font-family:"Courier New",monospace;font-size:14px;
  letter-spacing:4px;outline:none;padding:5px 2px;caret-color:#FF9900;
  text-shadow:0 0 10px rgba(255,153,0,.7);
  animation:inputBlink 1.1s step-end infinite;
}
#access-input::placeholder{color:#664400;letter-spacing:2px;font-size:11px;}
#access-hint{font-size:9px;color:#664400;letter-spacing:2px;text-align:center;margin-top:2px;text-shadow:0 0 6px rgba(255,100,0,.3);}
#access-progress{height:2px;background:rgba(255,153,0,.1);margin-top:16px;border-radius:1px;overflow:hidden;}
#access-progress-bar{height:100%;width:0;background:linear-gradient(90deg,#FF6600,#FF9900);transition:width .3s ease;border-radius:1px;}
#access-box.wrong{animation:wrongShake .4s ease;}
@keyframes accessGranted{0%{box-shadow:0 0 0 rgba(0,255,102,0);border-color:#CC6600}50%{box-shadow:0 0 40px rgba(0,255,102,.7),inset 0 0 20px rgba(0,255,102,.1);border-color:#00ff66}100%{box-shadow:0 0 80px rgba(0,255,102,.3);border-color:#00ff66}}
#access-box.granted{animation:accessGranted .8s ease forwards;border-color:#00ff66;}
#access-screen.granted{background:rgba(0,5,0,.97);}

/* ── MU-TH-UR 6000 INTRO ───────────────────────────────── */
#mother-intro{
  position:fixed;top:0;left:0;right:0;bottom:0;
  background:radial-gradient(ellipse at 50% 40%,rgba(10,4,0,.97) 0%,rgba(2,1,0,.99) 100%);
  z-index:9000;
  display:flex;align-items:center;justify-content:center;
  padding:20px;font-family:"Courier New",monospace;
  overflow:hidden;
}
/* Grille fond */
#mother-intro::before{
  content:'';position:absolute;top:0;left:0;right:0;bottom:0;
  background:
    repeating-linear-gradient(0deg,transparent,transparent 39px,rgba(255,120,0,.03) 40px),
    repeating-linear-gradient(90deg,transparent,transparent 39px,rgba(255,120,0,.03) 40px);
  animation:gridPulse 6s ease-in-out infinite;pointer-events:none;
}
#mother-box{
  width:100%;max-width:580px;
  position:relative;z-index:1;
  background:linear-gradient(160deg,rgba(8,4,0,.96),rgba(4,2,0,.99));
  border:1px solid rgba(255,140,0,.35);
  border-radius:12px;
  box-shadow:
    0 0 60px rgba(255,100,0,.12),
    0 0 120px rgba(255,60,0,.06),
    inset 0 0 50px rgba(255,80,0,.04),
    inset 0 1px 0 rgba(255,160,0,.1);
  padding:0;
  overflow-y:auto;
  max-height:calc(100dvh - 40px);
  backdrop-filter:blur(4px);
}
/* Scan bar sur le box */
#mother-box::before{
  content:'';position:absolute;left:0;right:0;height:1px;
  background:linear-gradient(90deg,transparent,rgba(255,140,0,.4),transparent);
  animation:scanBar 4s linear infinite;pointer-events:none;z-index:2;
}
#mother-hdr{
  background:linear-gradient(180deg,rgba(255,100,0,.08),rgba(255,60,0,.03));
  border-bottom:1px solid rgba(255,140,0,.2);
  padding:16px 28px 12px;
}
#mother-hdr-corp{
  font-size:9px;letter-spacing:5px;color:rgba(255,140,0,.4);
  margin-bottom:4px;
}
#mother-hdr-title{
  color:#FF9900;letter-spacing:5px;font-size:14px;
  text-shadow:0 0 20px #FF990080,0 0 40px #FF660030;
  font-weight:bold;
}
#mother-output{
  min-height:240px;font-size:12px;
  letter-spacing:1.8px;line-height:2;
  padding:20px 28px;color:#884400;
}
.m-bright{color:#FFBB44;text-shadow:0 0 12px #FF990060;}
.m-normal{color:#FF8800;text-shadow:0 0 6px #FF660030;}
.m-dim{color:#664400;}
.m-ok{color:#FFAA00;text-shadow:0 0 8px #FF880040;}
#mother-skip{
  margin:0;padding:10px 28px 16px;
  font-size:9px;color:rgba(255,100,0,.4);
  letter-spacing:4px;text-align:center;display:none;
  animation:mskip 1.1s step-end infinite;
  border-top:1px solid rgba(255,100,0,.1);
}
@keyframes mskip{0%,49%{opacity:1}50%,100%{opacity:0}}
@media(max-width:480px){
  #mother-box{max-height:calc(100dvh - 20px);}
  #mother-hdr{padding:10px 14px 8px;}
  #mother-hdr-corp{font-size:8px;letter-spacing:3px;}
  #mother-hdr-title{font-size:11px;letter-spacing:3px;}
  #mother-output{padding:12px 14px;letter-spacing:0.8px;line-height:1.6;min-height:0;font-size:11px;}
  #mother-skip{padding:8px 14px 12px;font-size:8px;letter-spacing:3px;}
}

/* ★ HUD MISSIONS */
#kitt-mission-hud{
  position:fixed;top:50px;right:10px;z-index:500;
  width:230px;background:rgba(3,0,0,.95);
  border:1px solid rgba(255,26,26,.3);border-radius:10px;
  padding:0;font-family:"Courier New",monospace;
  backdrop-filter:blur(14px);
  box-shadow:0 0 30px rgba(255,26,26,.15),0 8px 24px rgba(0,0,0,.7);
  display:none;overflow:hidden;
  animation:hudSlide .3s ease-out forwards;
}
#kitt-mission-hud.visible{ display:block; }
@keyframes hudSlide{ from{opacity:0;transform:translateX(20px)} to{opacity:1;transform:translateX(0)} }
#mission-title{
  font-size:8px;letter-spacing:3px;
  color:var(--red);text-shadow:0 0 8px var(--red);
  padding:10px 14px 8px;
  background:rgba(255,26,26,.06);
  border-bottom:1px solid rgba(255,26,26,.15);
  text-transform:uppercase;
}
#mission-progress-bar{
  height:2px;background:rgba(255,26,26,.1);margin:0;
}
#mission-progress-fill{
  height:100%;background:var(--green);
  transition:width .5s ease;box-shadow:0 0 6px var(--green);
}
.mission-item{
  font-size:10px;letter-spacing:1px;padding:6px 14px;
  display:flex;gap:8px;align-items:flex-start;
  color:rgba(200,200,200,.35);transition:color .3s,background .3s;
  border-bottom:1px solid rgba(255,26,26,.06);
  line-height:1.4;
}
.mission-item:last-of-type{border-bottom:none;}
.mission-item.done{
  color:rgba(0,255,102,.8);text-shadow:0 0 8px rgba(0,255,102,.3);
  background:rgba(0,255,102,.03);
}
.mission-item.done .m-check{ color:var(--green);text-shadow:0 0 6px var(--green); }
.m-check{ font-size:11px;width:14px;flex-shrink:0;margin-top:1px; }
#mission-close{
  margin:0;font-size:8px;letter-spacing:3px;color:rgba(255,26,26,.25);
  cursor:pointer;text-align:center;
  background:rgba(255,26,26,.04);
  border-top:1px solid rgba(255,26,26,.1);padding:8px 0 9px;
  transition:color .2s,background .2s;text-transform:uppercase;
}
#mission-close:hover{ color:var(--red);text-shadow:0 0 8px var(--red);background:rgba(255,26,26,.07); }
#kitt-mission-hud::before{
  content:'';position:absolute;top:0;left:0;right:0;height:1px;
  background:linear-gradient(90deg,transparent,rgba(255,80,0,.6),transparent);
  animation:scanBar 3s linear infinite;
}

/* ── LANGUAGE SELECTION OVERLAY — ALIEN × KITT ───────────── */
#lang-screen{
  position:fixed;top:0;left:0;right:0;bottom:0;
  background:radial-gradient(ellipse 600px 700px at center,rgba(0,4,1,.82) 0%,rgba(0,0,0,.5) 70%,rgba(0,0,0,.2) 100%);
  z-index:8000;
  display:flex;align-items:center;justify-content:center;
  padding:16px;
}
#lang-screen::before{
  content:'';position:absolute;inset:0;
  background-image:
    linear-gradient(rgba(0,255,102,.018) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,255,102,.018) 1px, transparent 1px);
  background-size: 32px 32px;
  pointer-events:none;
}
#lang-screen .lang-scanner-top{
  position:absolute;top:0;left:0;right:0;height:2px;overflow:hidden;
}
#lang-screen .lang-scanner-top::after{
  content:'';position:absolute;top:0;width:160px;height:2px;
  background:linear-gradient(90deg,transparent,var(--red),transparent);
  box-shadow:0 0 10px 3px var(--red);
  animation:ks 2.2s ease-in-out infinite alternate;
}
#lang-screen .lang-scanner-bot{
  position:absolute;bottom:0;left:0;right:0;height:2px;overflow:hidden;
}
#lang-screen .lang-scanner-bot::after{
  content:'';position:absolute;top:0;width:160px;height:2px;
  background:linear-gradient(90deg,transparent,var(--red),transparent);
  box-shadow:0 0 10px 3px var(--red);
  animation:ks 2.2s ease-in-out infinite alternate-reverse;
}
#lang-box{
  width:100%;max-width:520px;
  border:1px solid rgba(0,255,102,.35);
  border-radius:10px;
  box-shadow:0 0 80px rgba(0,255,102,.12),0 0 160px rgba(0,255,102,.05),inset 0 0 60px rgba(0,255,102,.02),0 0 4px rgba(255,26,26,.3);
  background:rgba(0,8,3,.52);
  backdrop-filter:blur(6px);
  font-family:"Courier New",monospace;
  font-size:13px;
  animation:boxIn .5s ease-out;
  position:relative;overflow:hidden;
}
#lang-box::before{
  content:'';position:absolute;left:0;top:0;bottom:0;width:3px;
  background:linear-gradient(180deg,transparent 5%,var(--red) 30%,rgba(255,26,26,.5) 70%,transparent 95%);
  border-radius:10px 0 0 10px;
}
@keyframes boxIn{from{opacity:0;transform:scale(.94) translateY(12px)}to{opacity:1;transform:none}}
#lang-hdr{
  border-bottom:1px solid var(--border-dim);
  padding:16px 24px 14px;text-align:center;
  background:linear-gradient(180deg,rgba(255,26,26,.04),rgba(0,255,102,.02));
  position:relative;
}
#lang-logo-line{display:flex;align-items:center;justify-content:center;gap:16px;margin-bottom:6px;}
.lang-logo-kitt{
  color:var(--red);font-family:var(--display);font-size:14px;font-weight:900;letter-spacing:5px;
  text-shadow:0 0 20px var(--red),0 0 50px rgba(255,26,26,.3);animation:pred 3s ease-in-out infinite;
}
.lang-logo-sep{color:var(--green-dim);font-size:11px;letter-spacing:1px;text-shadow:0 0 8px var(--green-dim);}
.lang-logo-alien{
  color:var(--amber);font-family:var(--display);font-size:14px;font-weight:900;letter-spacing:4px;
  text-shadow:0 0 20px var(--amber),0 0 50px rgba(255,170,0,.3);animation:amberPulse 4s ease-in-out infinite;
}
@keyframes amberPulse{
  0%,100%{text-shadow:0 0 12px var(--amber),0 0 30px rgba(255,170,0,.2)}
  50%{text-shadow:0 0 28px var(--amber),0 0 70px rgba(255,170,0,.5)}
}
#lang-sys-id{color:var(--green);font-family:var(--mono);font-size:10px;letter-spacing:3px;text-shadow:0 0 10px var(--green);}
#lang-sub{
  padding:10px 24px 8px;color:var(--amber);letter-spacing:3px;font-size:9px;
  border-bottom:1px solid rgba(255,170,0,.12);text-shadow:0 0 8px rgba(122,79,0,1);
  display:flex;align-items:center;gap:8px;
}
#lang-sub::before{content:'▶';color:var(--red);font-size:8px;animation:bd 1.2s ease-in-out infinite;}
#lang-output{padding:4px 0 2px;}
.lang-opt{
  display:flex;align-items:center;gap:14px;padding:9px 24px;cursor:pointer;
  transition:background .12s,border-left-color .12s,transform .1s;
  border-left:2px solid transparent;border-bottom:1px solid rgba(0,255,102,.05);position:relative;
}
.lang-opt:last-child{border-bottom:none;}
.lang-opt:hover{background:linear-gradient(90deg,rgba(255,26,26,.06),rgba(0,255,102,.04));border-left-color:var(--red);transform:translateX(2px);}
.lang-opt:hover .lo-n{border-color:var(--red);color:var(--red);box-shadow:0 0 8px rgba(255,26,26,.3);}
.lang-opt:hover .lo-flag{filter:saturate(1.5) brightness(1.2);}
.lang-opt:hover .lo-label{text-shadow:0 0 12px var(--green);color:var(--green);}
.lang-opt:hover .lo-native{color:var(--amber);}
.lo-n{
  color:var(--green-dim);font-size:10px;min-width:22px;text-align:center;
  border:1px solid rgba(0,255,102,.4);padding:2px 4px;letter-spacing:1px;
  flex-shrink:0;transition:all .12s;font-family:var(--display);
}
.lo-flag{font-size:20px;flex-shrink:0;transition:filter .12s;line-height:1;}
.lo-text{flex:1;display:flex;flex-direction:column;gap:2px;}
.lo-label{color:var(--green);letter-spacing:2px;font-size:12px;transition:all .12s;font-family:var(--display);font-weight:700;}
.lo-native{color:var(--green-dim);font-size:10px;letter-spacing:1px;opacity:.7;transition:color .12s;font-family:var(--mono);}
.lo-voice-btn{
  flex-shrink:0;background:rgba(255,170,0,.05);border:1px solid rgba(255,170,0,.25);
  color:rgba(122,79,0,1);font-size:10px;padding:3px 8px;cursor:pointer;
  font-family:var(--mono);letter-spacing:1px;transition:all .12s;display:flex;align-items:center;gap:4px;
}
.lo-voice-btn:hover{background:rgba(255,170,0,.12);border-color:var(--amber);color:var(--amber);box-shadow:0 0 8px rgba(255,170,0,.2);}
.lo-voice-btn::before{content:'▶';font-size:8px;}
#lang-ftr{
  border-top:1px solid var(--border-dim);padding:10px 24px;color:var(--green-dim);
  font-size:10px;letter-spacing:2px;display:flex;align-items:center;justify-content:space-between;
  background:rgba(0,255,102,.015);
}
#lang-ftr-left{display:flex;align-items:center;gap:6px;}
#lang-ftr-right{color:rgba(255,26,26,.5);font-size:9px;letter-spacing:1px;animation:bd 2s ease-in-out infinite;}
#lang-voice-toggle{
  margin-left:8px;background:rgba(0,255,102,.04);border:1px solid rgba(0,255,102,.25);
  color:var(--green-dim);font-size:9px;padding:2px 7px;cursor:pointer;
  font-family:var(--mono);letter-spacing:1px;transition:all .12s;
}
#lang-voice-toggle:hover{color:var(--green);border-color:var(--green);background:rgba(0,255,102,.08);}
#lang-flag{font-size:10px;border:1px solid var(--green-dim);padding:1px 5px;letter-spacing:1px;cursor:pointer;color:var(--green-dim);}
#lang-flag:hover{color:var(--green);border-color:var(--green);}

/* ── SCANNERS KITT (barres rouges haut/bas) ─────────────── */
@keyframes ks{0%{left:-200px}100%{left:100%}}
@keyframes pred{0%,100%{text-shadow:0 0 12px var(--red)}50%{text-shadow:0 0 28px var(--red),0 0 50px rgba(255,26,26,.5)}}
@keyframes bd{0%,100%{opacity:1}50%{opacity:.25}}
#sw{position:fixed;top:0;left:0;right:0;height:3px;overflow:hidden;z-index:1000;}
#sb{position:absolute;top:0;width:200px;height:3px;background:linear-gradient(90deg,transparent,var(--red),var(--red),transparent);box-shadow:0 0 14px 4px var(--red);animation:ks 1.8s ease-in-out infinite alternate;}
#swb{position:fixed;bottom:0;left:0;right:0;height:3px;overflow:hidden;z-index:1000;}
#sbb{position:absolute;top:0;width:200px;height:3px;background:linear-gradient(90deg,transparent,var(--red),var(--red),transparent);box-shadow:0 0 14px 4px var(--red);animation:ks 1.8s ease-in-out infinite alternate-reverse;}

/* ── STARFIELD CANVAS ───────────────────────────────────── */
#starfield{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;}

/* ── AMÉLIORATIONS MENU LANGUE ──────────────────────────── */
@keyframes langBoxPulse{
  0%,100%{box-shadow:0 0 80px rgba(0,255,102,.12),inset 0 0 60px rgba(0,255,102,.02),0 0 4px rgba(255,26,26,.3)}
  50%{box-shadow:0 0 140px rgba(0,255,102,.2),0 0 60px rgba(0,255,102,.08),inset 0 0 80px rgba(0,255,102,.05),0 0 12px rgba(255,26,26,.5),0 0 40px rgba(255,26,26,.15)}
}
@keyframes scanBar{0%{top:-2px}100%{top:101%}}
@keyframes cornerBlink{0%,100%{opacity:.5}50%{opacity:1}}
@keyframes ringPulse{0%,100%{transform:translate(-50%,-50%) scale(1);opacity:.2}50%{transform:translate(-50%,-50%) scale(1.06);opacity:.45}}
/* Anneau extérieur pulsant */
#lang-screen::after{
  content:'';position:absolute;
  left:50%;top:50%;
  width:min(580px,96vw);height:min(780px,94vh);
  border:1px solid rgba(0,255,102,.1);
  border-radius:14px;
  animation:ringPulse 3.5s ease-in-out infinite;
  pointer-events:none;
}
#lang-box{animation:boxIn .5s ease-out,langBoxPulse 3.5s ease-in-out 1s infinite;}
#lang-box::after{content:'';position:absolute;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent 5%,rgba(0,255,102,.4) 50%,transparent 95%);box-shadow:0 0 6px rgba(0,255,102,.3);animation:scanBar 3.8s linear infinite;pointer-events:none;z-index:10;}
#lang-box .hud-tl,#lang-box .hud-tr,#lang-box .hud-bl,#lang-box .hud-br{position:absolute;width:14px;height:14px;animation:cornerBlink 1.8s ease-in-out infinite;}
#lang-box .hud-tl{top:-1px;left:-1px;border-top:2px solid var(--red);border-left:2px solid var(--red);border-radius:10px 0 0 0;}
#lang-box .hud-tr{top:-1px;right:-1px;border-top:2px solid var(--red);border-right:2px solid var(--red);border-radius:0 10px 0 0;}
#lang-box .hud-bl{bottom:-1px;left:-1px;border-bottom:2px solid var(--red);border-left:2px solid var(--red);border-radius:0 0 0 10px;}
#lang-box .hud-br{bottom:-1px;right:-1px;border-bottom:2px solid var(--red);border-right:2px solid var(--red);border-radius:0 0 10px 0;}
.lang-opt{border-radius:4px;margin:1px 8px;}
.lang-opt::after{content:'';position:absolute;left:0;top:0;right:0;bottom:0;background:linear-gradient(90deg,transparent,rgba(0,255,102,.06),transparent);transform:translateX(-100%);transition:transform .35s ease;pointer-events:none;border-radius:4px;}
.lang-opt:hover::after{transform:translateX(100%);}
.lang-opt:hover{background:linear-gradient(90deg,rgba(255,26,26,.1),rgba(0,255,102,.07),rgba(0,0,0,.1));border-left-color:var(--red);transform:translateX(4px);box-shadow:inset 0 0 24px rgba(0,255,102,.05),-3px 0 12px rgba(255,26,26,.25);}
.lang-opt:hover .lo-n{transform:scale(1.1);}
.lang-logo-kitt{font-size:19px !important;letter-spacing:6px !important;}
.lang-logo-alien{font-size:19px !important;letter-spacing:5px !important;}
.lang-logo-sep{font-size:15px !important;}
#lang-hdr{background:linear-gradient(180deg,rgba(255,26,26,.08),rgba(0,255,102,.04),transparent);border-bottom:1px solid rgba(255,26,26,.25) !important;border-radius:10px 10px 0 0;}
#lang-sub{border-radius:0;background:rgba(0,0,0,.15);}
#lang-data-line{padding:5px 24px;font-size:9px;letter-spacing:3px;color:rgba(0,255,102,.35);border-top:1px solid rgba(0,255,102,.1);display:flex;justify-content:space-between;font-family:var(--mono);background:rgba(0,255,102,.015);}
#lang-ftr{border-radius:0 0 10px 10px;background:rgba(0,0,0,.2);}
/* Drapeaux : taille et ombre */
.lo-flag{font-size:22px !important;filter:drop-shadow(0 0 3px rgba(255,255,255,.3));}
/* fallback badge pays pour systèmes sans emoji drapeaux */
.lo-flag:empty::before{content:attr(data-code);font-size:9px;background:rgba(0,255,102,.2);border:1px solid var(--green-dim);padding:2px 4px;letter-spacing:1px;color:var(--green);}
/* Numéro de langue plus visible */
.lo-n{font-size:11px;min-width:24px;border:1px solid rgba(0,255,102,.5);transition:all .15s;}

/* ── TABLEAU DE BORD KITT ───────────────────────────────── */
@keyframes kScan{
  0%{left:4%}
  48%{left:calc(100% - 28px)}
  50%{left:calc(100% - 28px)}
  98%{left:4%}
  100%{left:4%}
}
@keyframes kScanGlow{
  0%,48%,52%,100%{box-shadow:0 0 10px 4px rgba(255,20,0,.7),0 0 22px 8px rgba(255,20,0,.35)}
  49%,51%{box-shadow:0 0 14px 6px rgba(255,60,0,.9),0 0 30px 12px rgba(255,40,0,.5)}
}
@keyframes dashFadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
#kitt-dash{ display:none !important; }
#kitt-dash.visible{ display:none !important; }
#kitt-hood{
  position:absolute;bottom:0;left:50%;transform:translateX(-50%);
  width:min(700px,95vw);height:58px;
  background:linear-gradient(180deg,#0a0000 0%,#000 60%);
  border-radius:40% 40% 0 0 / 55% 55% 0 0;
  border-top:1px solid rgba(255,26,26,.15);
  overflow:hidden;
}
#kitt-scan-track{
  position:absolute;top:18px;left:8%;right:8%;height:6px;
  background:rgba(40,0,0,.6);border-radius:3px;
  box-shadow:inset 0 1px 3px rgba(0,0,0,.8);
}
#kitt-scan-dot{
  position:absolute;top:-1px;left:4%;
  width:24px;height:8px;border-radius:4px;
  background:linear-gradient(90deg,rgba(255,20,0,.3),#ff1a00,rgba(255,20,0,.3));
  animation:kScan 1.9s ease-in-out infinite,kScanGlow 1.9s ease-in-out infinite;
}
#kitt-scan-trail{
  position:absolute;top:0;left:0;right:0;bottom:0;
  background:linear-gradient(90deg,transparent 10%,rgba(255,20,0,.04) 50%,transparent 90%);
  border-radius:3px;
}

/* ── APPEL ENTRANT KITT ─────────────────────────────────── */
@keyframes callRing{0%,100%{transform:scale(1)}10%,30%{transform:scale(1.04)}20%,40%{transform:scale(.98)}}
@keyframes callPulse{0%,100%{box-shadow:0 0 0 0 rgba(255,26,26,.4)}70%{box-shadow:0 0 0 16px rgba(255,26,26,0)}}
@keyframes callIn{from{opacity:0;transform:translateX(28px) scale(.95)}to{opacity:1;transform:translateX(0) scale(1)}}
#kitt-call{
  position:fixed;
  bottom:82px;
  right:14px;
  z-index:9200;
  background:linear-gradient(160deg,rgba(6,0,0,.97) 0%,rgba(2,0,0,.95) 100%);
  border:1px solid rgba(255,26,26,.6);
  border-top:1px solid rgba(255,80,40,.8);
  border-radius:10px;
  padding:0;
  width:min(280px,90vw);
  font-family:"Courier New",monospace;
  backdrop-filter:blur(12px);
  display:none;
  box-shadow:0 0 40px rgba(255,26,26,.2),0 0 80px rgba(255,26,26,.08),0 8px 32px rgba(0,0,0,.7);
  overflow:hidden;
}
#kitt-call.active{display:block;animation:callIn .35s cubic-bezier(.34,1.56,.64,1) forwards;}
/* Barre scanner haut */
#kitt-call::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,80,0,.8),transparent);animation:scanBar 2.2s linear infinite;}
/* En-tête appel */
#call-header{
  display:flex;align-items:center;gap:12px;
  padding:14px 16px 10px;
  border-bottom:1px solid rgba(255,26,26,.2);
  background:rgba(255,26,26,.04);
}
#call-avatar{
  width:40px;height:40px;border-radius:50%;
  border:1px solid var(--red);
  display:flex;align-items:center;justify-content:center;
  font-size:9px;letter-spacing:1px;color:var(--red);
  background:rgba(40,0,0,.8);
  animation:callRing 1.2s ease-in-out infinite,callPulse 1.4s ease-in-out infinite;
  flex-shrink:0;
}
#call-id-block{text-align:left;}
#call-name{color:var(--red);font-size:12px;letter-spacing:4px;text-shadow:0 0 12px var(--red);margin-bottom:2px;}
#call-status{color:rgba(255,100,0,.6);font-size:8px;letter-spacing:3px;animation:bd 1.1s ease-in-out infinite;}
/* Corps mission */
#call-mission{
  padding:10px 14px;
  border-bottom:1px solid rgba(255,26,26,.15);
  font-size:9px;letter-spacing:1.5px;line-height:1.8;
}
#call-mission-title{
  color:rgba(255,170,0,.9);font-size:8px;letter-spacing:3px;
  border-bottom:1px solid rgba(255,170,0,.15);padding-bottom:5px;margin-bottom:7px;
  text-shadow:0 0 8px rgba(255,170,0,.4);
}
.call-rule{color:rgba(200,200,200,.65);display:flex;gap:6px;margin-bottom:2px;}
.call-rule-icon{color:var(--red);flex-shrink:0;text-shadow:0 0 6px rgba(255,26,26,.5);}
.call-rule-highlight{color:rgba(255,170,0,.85);}
#call-unlock-note{
  margin-top:7px;padding:5px 8px;
  background:rgba(0,255,102,.04);border:1px solid rgba(0,255,102,.12);
  border-radius:3px;color:rgba(0,200,80,.8);font-size:8px;letter-spacing:1px;
  text-shadow:0 0 6px rgba(0,255,102,.3);
}
/* Boutons */
.call-btns{display:flex;gap:8px;padding:10px 14px 12px;}
.call-btn{
  flex:1;padding:7px 0;border:1px solid;border-radius:4px;
  cursor:pointer;font-family:"Courier New",monospace;
  font-size:9px;letter-spacing:2px;background:transparent;
  transition:all .15s;pointer-events:all;
}
#call-accept{border-color:rgba(0,255,102,.5);color:var(--green);box-shadow:0 0 8px rgba(0,255,102,.15);}
#call-accept:hover,#call-accept:active{background:var(--green);color:#000;box-shadow:0 0 18px rgba(0,255,102,.4);}
#call-ignore{border-color:rgba(80,80,80,.4);color:#444;}
#call-ignore:hover,#call-ignore:active{border-color:rgba(255,26,26,.4);color:rgba(255,26,26,.6);}

/* ── TERMINAL ───────────────────────────────────────────── */
#terminal{
  flex:1;min-height:0;overflow-y:auto;overflow-x:hidden;
  padding:8px 6px 4px;font-size:13px;line-height:1.72;
  scrollbar-width:thin;scrollbar-color:var(--red) #0a0000;
  border-left:1px solid rgba(0,255,102,.06);
  border-right:1px solid rgba(0,255,102,.03);
  background:linear-gradient(180deg,rgba(0,8,0,.15) 0%,rgba(0,0,0,.05) 100%);
}
#terminal::-webkit-scrollbar{width:3px}
#terminal::-webkit-scrollbar-track{background:#080000}
#terminal::-webkit-scrollbar-thumb{background:rgba(255,26,26,.5);border-radius:2px;}
.line-ok{color:var(--green);text-shadow:0 0 6px rgba(0,255,102,.3);}
.line-warn{color:var(--amber);text-shadow:0 0 6px rgba(255,170,0,.3);}
.line-err{color:var(--red);text-shadow:0 0 6px rgba(255,26,26,.4);}
.line-info{color:var(--cyan);text-shadow:0 0 6px rgba(0,204,255,.3);}
.line-dim{color:var(--green-dim);}
.cursor{display:inline-block;width:8px;height:13px;background:var(--green);vertical-align:text-bottom;animation:bc .7s step-end infinite;box-shadow:0 0 6px var(--green);}
@keyframes bc{0%,100%{opacity:1}50%{opacity:0}}

/* ── HEADER ─────────────────────────────────────────────── */
.container>header{
  flex-shrink:0;
  display:flex;align-items:center;justify-content:space-between;
  padding:6px 0 8px;
  border-bottom:1px solid rgba(0,255,102,.14);
  margin-bottom:2px;
  gap:8px;
}
.hdr-title{
  font-size:13px;letter-spacing:3px;
  color:var(--green);
  text-shadow:0 0 12px rgba(0,255,102,.5);
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  flex:1;min-width:0;
}
.hdr-right{
  display:flex;align-items:center;gap:10px;
  font-size:11px;color:var(--green-dim);
  flex-shrink:0;letter-spacing:1px;
}
.sdot{
  display:inline-block;width:6px;height:6px;border-radius:50%;
  background:var(--green);box-shadow:0 0 6px var(--green);
  margin-right:3px;vertical-align:middle;
  animation:bd 1.5s ease-in-out infinite;
}
#clock{color:var(--amber);font-size:11px;letter-spacing:1px;text-shadow:0 0 6px rgba(255,170,0,.4);}

/* ── BUTTONS ────────────────────────────────────────────── */
.btn-row{
  flex-shrink:0;
  display:flex;flex-wrap:wrap;gap:5px;
  padding:7px 0;
  border-top:1px solid rgba(0,255,102,.12);
  border-bottom:1px solid rgba(0,255,102,.06);
  background:linear-gradient(180deg,rgba(0,4,0,.5) 0%,rgba(0,0,0,.1) 100%);
  margin-top:2px;
}
button{background:rgba(0,255,102,.06);border:1px solid var(--green);color:var(--green);padding:7px 14px;cursor:pointer;font-family:inherit;font-size:12px;letter-spacing:1px;transition:all .15s;position:relative;overflow:hidden;box-shadow:0 0 8px rgba(0,255,102,.18),inset 0 0 6px rgba(0,255,102,.06);text-shadow:0 0 10px rgba(0,255,102,.7);}
button::before{content:"";position:absolute;inset:0;background:var(--green);transform:scaleX(0);transform-origin:left;transition:transform .15s;z-index:-1;}
button:hover{color:#000;box-shadow:0 0 18px rgba(0,255,102,.5);}button:hover::before{transform:scaleX(1);}
button:active{transform:scale(.95);}
.btn-red{border-color:var(--red);color:var(--red);background:rgba(255,26,26,.06);box-shadow:0 0 8px rgba(255,26,26,.18),inset 0 0 6px rgba(255,26,26,.06);text-shadow:0 0 10px rgba(255,26,26,.7);}
.btn-red::before{background:var(--red);}
.btn-red:hover{box-shadow:0 0 18px rgba(255,26,26,.5);}
.btn-cyan{border-color:var(--cyan);color:var(--cyan);background:rgba(0,204,255,.06);box-shadow:0 0 8px rgba(0,204,255,.18),inset 0 0 6px rgba(0,204,255,.06);text-shadow:0 0 10px rgba(0,204,255,.7);}
.btn-cyan::before{background:var(--cyan);}
.btn-cyan:hover{box-shadow:0 0 18px rgba(0,204,255,.5);}

/* ── INPUT ──────────────────────────────────────────────── */
.input-row{
  flex-shrink:0;display:flex;gap:8px;
  padding:8px 6px 6px;align-items:center;
  border-top:1px solid rgba(0,255,102,.1);
  background:rgba(0,6,0,.4);
  border-radius:0 0 2px 2px;
}
.prompt-lbl{color:var(--red);font-size:13px;white-space:nowrap;text-shadow:0 0 10px var(--red),0 0 18px rgba(255,26,26,.4);}
#cmd-input{flex:1;background:rgba(0,255,102,.04);border:none;border-bottom:2px solid var(--green);color:#33ff88;font-family:inherit;font-size:13px;outline:none;padding:5px 4px;caret-color:#00ff66;box-shadow:0 2px 8px rgba(0,255,102,.15),inset 0 -1px 0 #00ff6633;text-shadow:0 0 8px rgba(0,255,102,.6);}
#cmd-input::placeholder{color:#00aa44;opacity:.7;}

/* ── MODAL ──────────────────────────────────────────────── */
.modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.95);display:none;flex-direction:column;padding:30px;overflow:auto;z-index:5000;border:1px solid var(--red);}
.modal.open{display:flex;}
.modal-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;border-bottom:1px solid var(--red);padding-bottom:8px;}
.modal-title{color:var(--red);font-size:16px;letter-spacing:3px;text-shadow:0 0 10px var(--red);}
.close-btn{cursor:pointer;color:var(--red);font-size:20px;padding:4px 8px;border:1px solid var(--red);transition:all .15s;}
.close-btn:hover{background:var(--red);color:#000;}
.modal pre{white-space:pre-wrap;color:var(--green);font-family:monospace;font-size:13px;line-height:1.7;}

/* ── MOBILE ─────────────────────────────────────────────── */
/* Empêcher le zoom iOS sur focus input (min 16px) */
#access-input{font-size:16px;}
@media(max-width:600px){
  #cmd-input{font-size:16px !important;}
  /* Padding bas pour la barre home iPhone X+ */
  .container{padding-bottom:max(6px,env(safe-area-inset-bottom));}
  /* input-row bien visible et cliquable */
  .input-row{padding-top:10px;padding-bottom:4px;}
}
/* Touch: désactiver hover transform sur tactile */
@media(hover:none){
  .lang-opt:hover{transform:none;box-shadow:none;}
  .lang-opt:active{background:rgba(255,26,26,.1);border-left-color:var(--red);}
}
@media(max-width:600px){
  .hdr-title{font-size:15px;letter-spacing:2px;}
  button{padding:6px 10px;font-size:13px;}
  #terminal{font-size:14px;}
  #lang-box{padding:16px 12px;max-width:98vw;border-radius:8px;}
  #lang-hdr{padding:12px 14px 10px;}
  .lang-logo-kitt,.lang-logo-alien{font-size:14px !important;letter-spacing:3px !important;}
  .lang-opt{padding:8px 12px;gap:10px;margin:1px 4px;}
  .lo-flag{font-size:18px !important;}
  .lo-label{font-size:13px;}
  .lo-voice-btn{font-size:9px;padding:3px 6px;}
  #lang-data-line{padding:4px 14px;font-size:11px;letter-spacing:1px;}
  #lang-ftr{padding:8px 14px;}
  #lang-screen::after{display:none;}
  #access-box{padding:20px 16px;max-width:98vw;}
  #access-hdr{font-size:12px;letter-spacing:2px;}
  #access-input{font-size:16px;letter-spacing:3px;}
  #mother-box{padding:16px 14px;}
  #mother-hdr{font-size:14px;letter-spacing:2px;}
  #mother-output{font-size:14px;min-height:200px;line-height:1.7;}
  #mother-skip{font-size:12px;}
}

/* ── BOUTON TUNNEL CLOUDFLARE ───────────────────────────────── */
#btn-tunnel{border-color:#333;color:#333;transition:all .2s;}
#btn-tunnel.tunnel-online{
  border-color:var(--green);color:var(--green);
  animation:tpulse 2.4s ease-in-out infinite;}
#btn-tunnel.tunnel-offline{border-color:var(--red);color:var(--red);}
#btn-tunnel.tunnel-checking{border-color:var(--amber);color:var(--amber);}
@keyframes tpulse{0%,100%{box-shadow:0 0 5px rgba(0,255,102,.25)}50%{box-shadow:0 0 18px rgba(0,255,102,.65),inset 0 0 8px rgba(0,255,102,.08)}}

/* ── FOND JARVIS HOLOGRAPHIQUE ──────────────────────────── */
/* Container principal : flex column plein écran, s'adapte au clavier virtuel */
.container{
  position:relative;z-index:1;
  display:flex;flex-direction:column;
  height:100vh;          /* fallback */
  height:100dvh;         /* dynamic: rétrécit quand le clavier s'ouvre */
  padding:10px 16px 6px;
  max-width:760px;margin:0 auto;
  overflow:hidden;
}
#jarvis-svg{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%) translate3d(0,0,0);
  width:min(90vw,90vh);height:min(90vw,90vh);
  pointer-events:none;z-index:0;opacity:0.45;
}
#sphere-wrap{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%);
  width:180px;height:180px;
  perspective:500px;
  pointer-events:none;z-index:0;opacity:0.22;
}
#sphere-3d{
  width:100%;height:100%;
  transform-style:preserve-3d;
  animation:srot 22s linear infinite;
}
@keyframes srot{from{transform:rotateX(22deg) rotateY(0deg)}to{transform:rotateX(22deg) rotateY(360deg)}}
.s-mer,.s-par{
  position:absolute;top:0;left:0;width:100%;height:100%;
  border-radius:50%;border:1px solid var(--green);box-sizing:border-box;
  opacity:0.7;
}
.s-core{
  position:absolute;top:50%;left:50%;
  width:18px;height:18px;margin:-9px 0 0 -9px;
  border-radius:50%;
  background:radial-gradient(circle,var(--green),transparent);
  box-shadow:0 0 20px var(--green),0 0 40px rgba(0,255,102,.4);
  animation:score 3s ease-in-out infinite;
}
@keyframes score{0%,100%{opacity:.6}50%{opacity:1}}

/* ── COMPTEUR VISITES ───────────────────────────────────── */
#visit-counter{
  position:fixed;left:8px;top:50%;transform:translateY(-50%);
  writing-mode:vertical-rl;text-orientation:mixed;
  font-size:11px;color:var(--green);letter-spacing:3px;
  opacity:.65;pointer-events:none;z-index:100;
  text-shadow:0 0 8px var(--green),0 0 16px rgba(0,255,102,.4);
  user-select:none;
  border-left:1px solid rgba(0,255,102,.3);
  padding-left:4px;
}

/* ── FOOTER VERSION ─────────────────────────────────────── */
#site-footer{
  position:fixed;bottom:14px;left:50%;transform:translateX(-50%);
  font-size:10px;color:var(--green-dim);letter-spacing:2px;
  opacity:.55;pointer-events:none;z-index:1001;
  white-space:nowrap;user-select:none;
  text-shadow:0 0 6px var(--green-dim);
}

/* ── Menus Knight Rider — underline slide couleur ── */
button::after{
  content:'';position:absolute;bottom:0;left:50%;right:50%;
  height:1px;background:var(--green);
  transition:left .22s ease,right .22s ease;
  z-index:1;
}
button:hover::after{left:0;right:0;}
.btn-cyan::after{background:var(--cyan);}
.btn-red::after{background:var(--red);}

/* ── Clavier virtuel KITT — mobile uniquement ── */
#kitt-vkb{
  position:fixed;bottom:0;left:0;right:0;z-index:9600;
  background:#000600;
  border-top:2px solid #003a10;
  box-shadow:0 -5px 30px rgba(0,180,60,.24),0 -1px 0 #002200;
  padding:0 3px max(6px,env(safe-area-inset-bottom)) 3px;
  transform:translateY(110%);
  transition:transform .24s cubic-bezier(.22,1,.36,1);
  will-change:transform;
}
#kitt-vkb.kb-on{transform:translateY(0);}
body.kb-open{padding-bottom:222px;}
.kb-header{
  text-align:center;font-family:'Courier New',monospace;
  font-size:8px;color:#005522;letter-spacing:3px;
  padding:5px 0 4px;border-bottom:1px solid #001800;margin-bottom:3px;
}
.kb-row{display:flex;justify-content:center;gap:3px;margin-bottom:3px;}
.kb-key{
  flex:1;min-width:0;height:40px;
  background:#000800;border:1px solid #001a00;border-bottom:2px solid #002a00;
  border-radius:4px;color:#00cc55;
  font-family:'Courier New',Courier,monospace;font-size:13px;font-weight:bold;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;user-select:none;-webkit-user-select:none;
  -webkit-tap-highlight-color:transparent;
  transition:background .06s,box-shadow .06s,color .06s;
  touch-action:manipulation;
}
.kb-key:active{
  background:#001a00;border-color:#007700;border-bottom-color:#00ee44;
  box-shadow:0 0 10px #00aa4444,inset 0 0 8px #002200;
  color:#44ff88;transform:translateY(1px);
}
.kb-w15{flex:1.5;font-size:11px;}
.kb-w2{flex:2;font-size:12px;}
.kb-w4{flex:4;}
.kb-send{
  flex:2.2;background:#001100;border-color:#005500;border-bottom-color:#00bb44;
  color:#00ff66;font-size:11px;letter-spacing:1px;box-shadow:0 0 12px #00ff6618;
}
.kb-send:active{
  background:#002600;border-bottom-color:#00ff44;
  box-shadow:0 0 20px #00ff6655;color:#88ffaa;
}
.kb-shift-on{background:#001300;border-color:#005000;color:#33ff77;}
/* ── Thème MU-TH-UR 6000 (orange/ambre) pour écran code d'accès ── */
#kitt-vkb.theme-mother{background:#060200;border-top-color:#3a1500;box-shadow:0 -5px 30px rgba(180,80,0,.24),0 -1px 0 #220800;}
#kitt-vkb.theme-mother .kb-header{color:#553300;border-bottom-color:#1a0800;}
#kitt-vkb.theme-mother .kb-key{background:#080200;border-color:#1a0800;border-bottom-color:#2a1000;color:#cc6600;}
#kitt-vkb.theme-mother .kb-key:active{border-color:#887700;border-bottom-color:#ffaa00;box-shadow:0 0 10px #aa660044,inset 0 0 8px #221000;color:#ffcc44;}
#kitt-vkb.theme-mother .kb-send{background:#110600;border-color:#553300;border-bottom-color:#cc6600;color:#ff9900;box-shadow:0 0 12px #ff880018;}
#kitt-vkb.theme-mother .kb-send:active{background:#261000;border-bottom-color:#ffaa00;box-shadow:0 0 20px #ff880055;color:#ffdd88;}
#kitt-vkb.theme-mother .kb-shift-on{background:#131000;border-color:#504400;color:#ffaa33;}
@media(min-width:601px){#kitt-vkb{display:none !important;}}
</style>
<style>/* GEMINI KITT ULTIMATE OVERRIDE */ :root { --k-red: #ff0000; --k-glow: rgba(255, 0, 0, 0.7); --k-bg: #000000; } body { background: var(--k-bg) !important; color: #fff !important; } .header h1 { color: var(--k-red) !important; text-shadow: 0 0 15px var(--k-glow), 0 0 30px var(--k-glow) !important; letter-spacing: 12px !important; } .scanner { border: 1px solid var(--k-red) !important; box-shadow: 0 0 20px var(--k-glow) !important; background: #110000 !important; } .scanner-head { background: var(--k-red) !important; box-shadow: 0 0 15px var(--k-red) !important; } button { border: 2px solid var(--k-red) !important; background: rgba(30,0,0,0.9) !important; color: var(--k-red) !important; box-shadow: 0 0 5px var(--k-glow) !important; transition: 0.3s !important; } button:hover { background: var(--k-red) !important; color: #000 !important; box-shadow: 0 0 25px var(--k-red) !important; } .chat-area, .terminal, #chat { background: rgba(0,0,0,0.9) !important; border-color: var(--k-red) !important; box-shadow: inset 0 0 20px var(--k-glow) !important; } input { border-bottom: 2px solid var(--k-red) !important; background: transparent !important; color: #ffcccc !important; }</style>
</head>
<body>

<canvas id="starfield"></canvas>

<!-- ÉCRAN ACCÈS MOT DE PASSE -->
<div id="access-screen" style="display:none">
  <div id="access-box">
    <div id="access-hdr">WEYLAND-YUTANI CORP. // ACCES SECURISE</div>
    <div style="text-align:center;font-size:9px;letter-spacing:3px;color:#442200;margin-bottom:8px;margin-top:-8px;">&#9656; KYRONEX SYSTEMS // op. MANIX &#9666;</div>
    <div id="access-log"></div>
    <div id="access-input-row">
      <span id="access-prompt">CODE D'ACCES &gt;</span>
      <input id="access-input" type="password" maxlength="10" placeholder="_ _ _ _" autocomplete="off" spellcheck="false"/>
    </div>
    <div id="access-hint">ENTREZ LE CODE D'ACCES SYSTEME</div>
    <div id="access-progress"><div id="access-progress-bar"></div></div>
  </div>
</div>

<!-- MU-TH-UR 6000 INTRO -->
<div id="mother-intro" style="display:none">
  <div id="mother-box">
    <div id="mother-hdr">
      <div id="mother-hdr-corp">WEYLAND-YUTANI CORP. &bull; DIVISION SYSTEMES</div>
      <div id="mother-hdr-title">MU-TH-UR 6000</div>
    </div>
    <div id="mother-output"></div>
    <div id="mother-skip">&gt;&gt;&gt; CLIQUEZ OU APPUYEZ SUR UNE TOUCHE &lt;&lt;&lt;</div>
  </div>
</div>

<!-- Language selection overlay -->
<div id="lang-screen" style="display:none">
  <div class="lang-scanner-top"></div>
  <div class="lang-scanner-bot"></div>
  <div id="lang-box">
    <div class="hud-tl"></div><div class="hud-tr"></div><div class="hud-bl"></div><div class="hud-br"></div>
    <div id="lang-hdr">
      <div id="lang-logo-line">
        <span class="lang-logo-kitt">K·I·T·T</span>
        <span class="lang-logo-sep">×</span>
        <span class="lang-logo-alien">ALIEN</span>
      </div>
      <div id="lang-sys-id"></div>
    </div>
    <div id="lang-sub"></div>
    <div id="lang-output"></div>
    <div id="lang-data-line"><span id="lang-data-l">KYRONEX // NOSTROMO-180924609</span><span id="lang-data-r">op.MANIX &#9679; STAT:NOMINAL</span></div>
    <div id="lang-ftr">
      <div id="lang-ftr-left">
        <span id="lang-ftr-txt"></span>
        <button id="lang-voice-toggle" onclick="toggleLangVoice()">&#128266; VOIX</button>
      </div>
      <div id="lang-ftr-right">KYRONEX // MU-TH-UR &#9673;</div>
    </div>
  </div>
</div>

<!-- Fond Jarvis holographique -->
<svg id="jarvis-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400" preserveAspectRatio="xMidYMid meet">
  <g stroke="#00ff66" fill="none">
    <!-- Anneau externe -->
    <circle cx="200" cy="200" r="185" stroke-opacity="0.6" stroke-width="1">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </circle>
    <!-- Anneau moyen -->
    <circle cx="200" cy="200" r="135" stroke-opacity="0.5" stroke-width="0.8">
      <animateTransform attributeName="transform" type="rotate" from="360 200 200" to="0 200 200" dur="45s" repeatCount="indefinite"/>
    </circle>
    <!-- Anneau interne -->
    <circle cx="200" cy="200" r="85" stroke-opacity="0.45" stroke-width="0.7">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="32s" repeatCount="indefinite"/>
    </circle>
    <!-- Spokes -->
    <line x1="200" y1="15" x2="200" y2="385" stroke-opacity="0.18" stroke-width="0.5">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <line x1="15" y1="200" x2="385" y2="200" stroke-opacity="0.18" stroke-width="0.5">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <!-- Arc scanner lumineux -->
    <path d="M 200 15 A 185 185 0 0 1 385 200" stroke-opacity="0.9" stroke-width="2" stroke="#00ff66">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="8s" repeatCount="indefinite"/>
    </path>
    <!-- Marqueurs HUD sur anneau externe -->
    <line x1="200" y1="15" x2="200" y2="30" stroke-opacity="0.7" stroke-width="1.5">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <line x1="200" y1="15" x2="200" y2="25" stroke-opacity="0.5" stroke-width="1">
      <animateTransform attributeName="transform" type="rotate" from="45 200 200" to="405 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <!-- Centre pulsant -->
    <circle cx="200" cy="200" r="5" fill="#00ff66" opacity="0.7">
      <animate attributeName="opacity" values="0.3;1;0.3" dur="3s" repeatCount="indefinite"/>
      <animate attributeName="r" values="4;7;4" dur="3s" repeatCount="indefinite"/>
    </circle>
  </g>
</svg>
<div id="sphere-wrap">
  <div id="sphere-3d">
    <div class="s-mer" style="transform:rotateY(0deg)"></div>
    <div class="s-mer" style="transform:rotateY(30deg)"></div>
    <div class="s-mer" style="transform:rotateY(60deg)"></div>
    <div class="s-mer" style="transform:rotateY(90deg)"></div>
    <div class="s-mer" style="transform:rotateY(120deg)"></div>
    <div class="s-mer" style="transform:rotateY(150deg)"></div>
    <div class="s-par" style="transform:translateY(-44px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(-22px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(0px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(22px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(44px) rotateX(90deg)"></div>
    <div class="s-core"></div>
  </div>
</div>
<div id="visit-counter"></div>
<div id="site-footer">v3.0 &nbsp;—&nbsp; DERNIÈRE MISE À JOUR : 2026-02-20</div>

<!-- Scanners -->
<div id="sw"><div id="sb"></div></div>
<div id="swb"><div id="sbb"></div></div>

<div class="container">
  <header>
    <div id="hdr-title" class="hdr-title">KITT FRANCO-BELGE // INTERFACE CENTRALE</div>
    <div class="hdr-right">
      <span id="lang-flag" onclick="showLangScreen()" title="Changer de langue">FR</span>
      <span><span class="sdot"></span><span id="status-txt">EN LIGNE</span></span>
      <span id="kitt-km" title="Odomètre KITT" style="color:var(--amber);font-size:11px;letter-spacing:1px;cursor:default;">0 km</span>
      <span id="clock">00:00:00</span>
    </div>
  </header>

  
  <div id="terminal"></div>

  <div class="btn-row">
    <button id="btn-boot" onclick="boot()">[ INITIALISER ]</button>
    <button id="btn-diag" onclick="runSelfTest()" class="btn-cyan">[ DIAGNOSTIC ]</button>
    <button id="btn-missions" onclick="_toggleMissionHud()" style="border-color:rgba(255,180,0,.5);color:rgba(255,180,0,.7);">[ MISSIONS ]</button>
    <button id="btn-mentions" onclick="openFile('Mentions.txt',T[LANG].modal_mentions)" class="btn-red">[ MENTIONS ]</button>
    <button id="btn-licence" onclick="openFile('License.txt',T[LANG].modal_licence)" class="btn-red">[ LICENCE ]</button>
    <button id="btn-clear" onclick="clearTerm()">[ EFFACER ]</button>
    <button id="btn-tunnel" class="tunnel-checking" onclick="connectTunnel()" title="Vérification..."><span id="btn-tunnel-txt">[ CONNEXION KITT ]</span></button>
  </div>

  <div class="input-row">
    <span class="prompt-lbl">KITT&gt;</span>
   <input id="cmd-input" type="text" placeholder="entrez une commande..." autocomplete="off" spellcheck="false"/>
  </div>

</div>

<!-- ── Clavier virtuel KITT (mobile uniquement) — hors .container pour position:fixed correct ── -->
<div id="kitt-vkb" aria-label="Clavier KITT" aria-hidden="true"></div>

<!-- Modal -->
<div id="modal" class="modal">
  <div class="modal-hdr">
    <span class="modal-title" id="modal-title">DOCUMENT</span>
    <span class="close-btn" onclick="closeModal()">&#10006;</span>
  </div>
  <pre id="modal-content"></pre>
</div>

<script>
// ════════════════════════════════════════════════════════════
// AUDIO ENGINE — Pool de sons variés style années 80
// ════════════════════════════════════════════════════════════
const _ac = new (window.AudioContext || window.webkitAudioContext)();

function _resume() { if (_ac.state === 'suspended') _ac.resume(); }

// ── Son 1 : MU-TH-UR click (principal) ──────────────────────
function sndClick() {
  try {
    _resume(); const t = _ac.currentTime;
    const len = Math.floor(_ac.sampleRate * 0.020);
    const buf = _ac.createBuffer(1, len, _ac.sampleRate);
    const d = buf.getChannelData(0);
    for (let i = 0; i < len; i++) d[i] = (Math.random()*2-1) * Math.pow(1-i/len, 3.5);
    const src = _ac.createBufferSource(); src.buffer = buf;
    const bp = _ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=2700+Math.random()*400; bp.Q.value=4;
    const hp = _ac.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=850;
    const g = _ac.createGain(); g.gain.value=0.25;
    src.connect(bp); bp.connect(hp); hp.connect(g); g.connect(_ac.destination); src.start(t);
    // tick électronique
    const o = _ac.createOscillator(); o.type='square';
    o.frequency.setValueAtTime(1350+Math.random()*200, t);
    o.frequency.exponentialRampToValueAtTime(680, t+0.017);
    const og = _ac.createGain(); og.gain.setValueAtTime(0.04, t); og.gain.exponentialRampToValueAtTime(0.001, t+0.020);
    o.connect(og); og.connect(_ac.destination); o.start(t); o.stop(t+0.022);
  } catch(e){}
}

// ── Son 2 : tick léger (haute fréquence, sous-entendu) ──────
function sndTick() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='triangle';
    o.frequency.setValueAtTime(3800+Math.random()*400, t);
    o.frequency.exponentialRampToValueAtTime(2400, t+0.012);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.03, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.015);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.016);
  } catch(e){}
}

// ── Son 3 : impulsion données (caractères spéciaux) ──────────
function sndData() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='sawtooth';
    o.frequency.value = 1800 + Math.random()*600;
    const g = _ac.createGain(); g.gain.setValueAtTime(0.05, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.012);
    const lp = _ac.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=4000;
    o.connect(lp); lp.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.013);
  } catch(e){}
}

// ── Son 4 : glitch numérique (rare, surprenant) ──────────────
function sndGlitch() {
  try {
    _resume(); const t = _ac.currentTime;
    const len = Math.floor(_ac.sampleRate * 0.035);
    const buf = _ac.createBuffer(1, len, _ac.sampleRate);
    const d = buf.getChannelData(0);
    for (let i = 0; i < len; i++) d[i] = (Math.random()*2-1) * (Math.random() > 0.5 ? 0.9 : 0.05);
    const src = _ac.createBufferSource(); src.buffer=buf;
    const bp = _ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=1200; bp.Q.value=2;
    const g = _ac.createGain(); g.gain.value=0.12;
    src.connect(bp); bp.connect(g); g.connect(_ac.destination); src.start(t);
  } catch(e){}
}

// ── Son 5 : fin de ligne (souffle court) ────────────────────
function sndLineEnd() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(900, t);
    o.frequency.exponentialRampToValueAtTime(600, t+0.06);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.028, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.07);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.08);
  } catch(e){}
}

// ── Son 6 : sélection / confirmation ────────────────────────
function sndSelect() {
  try {
    _resume(); const t = _ac.currentTime;
    [440,660,880].forEach((f,i) => {
      const o = _ac.createOscillator(); o.type='square'; o.frequency.value=f;
      const g = _ac.createGain(); g.gain.setValueAtTime(0.04, t+i*0.06); g.gain.exponentialRampToValueAtTime(0.001, t+i*0.06+0.05);
      o.connect(g); g.connect(_ac.destination); o.start(t+i*0.06); o.stop(t+i*0.06+0.055);
    });
  } catch(e){}
}

// ── Son 7 : erreur (buzzer court) ────────────────────────────
function sndError() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='square'; o.frequency.value=180;
    const g = _ac.createGain(); g.gain.setValueAtTime(0.07, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.08);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.09);
  } catch(e){}
}

// ── Son 8 : chime KITT (sweep descendant) ───────────────────
// ── ODOMETRE KITT ────────────────────────────────────────
(function(){
  const KM_KEY='kitt_km';
  let km = parseFloat(localStorage.getItem(KM_KEY)||'180924');
  const el = document.getElementById('kitt-km');
  setInterval(()=>{
    km += 0.004 + Math.random()*0.003;
    localStorage.setItem(KM_KEY, km.toFixed(1));
    if(el) el.textContent = Math.floor(km).toLocaleString()+' km';
  }, 800);
})();

// ── SON MOTEUR V8 TRANS-AM ────────────────────────────────
function sndMoteur(dur=2.2) {
  try {
    _resume(); const t=_ac.currentTime;
    // Bruit blanc filtré = grondement moteur
    const buf=_ac.createBuffer(1,_ac.sampleRate*dur,_ac.sampleRate);
    const d=buf.getChannelData(0);
    for(let i=0;i<d.length;i++) d[i]=(Math.random()*2-1);
    const src=_ac.createBufferSource(); src.buffer=buf;
    // Filtre passe-bas grave = V8
    const lp=_ac.createBiquadFilter(); lp.type='lowpass'; lp.frequency.setValueAtTime(120,t); lp.frequency.linearRampToValueAtTime(300,t+dur);
    // Gain : montée puis descente
    const g=_ac.createGain(); g.gain.setValueAtTime(0,t); g.gain.linearRampToValueAtTime(0.28,t+0.3); g.gain.linearRampToValueAtTime(0.18,t+dur-0.3); g.gain.linearRampToValueAtTime(0,t+dur);
    // Tremolo pour l'effet ralenti moteur
    const lfo=_ac.createOscillator(); lfo.frequency.value=22; lfo.type='sine';
    const lfog=_ac.createGain(); lfog.gain.value=0.08;
    lfo.connect(lfog); lfog.connect(g.gain);
    src.connect(lp); lp.connect(g); g.connect(_ac.destination);
    lfo.start(t); src.start(t); src.stop(t+dur); lfo.stop(t+dur);
  }catch(e){}
}

// ── THÈME MUSICAL K2000 (synthétisé Web Audio) ───────────
function playKittTheme() {
  try {
    _resume();
    // Notes du thème K2000 : Mi Mi Mi Sol Mi Re Mi...
    const notes=[
      [659,0,.18],[659,.22,.18],[659,.44,.18],[784,.66,.28],
      [659,.98,.18],[587,1.2,.18],[659,1.42,.38],
      [784,1.84,.28],[880,2.16,.28],[988,2.48,.18],[880,2.7,.18],
      [784,2.92,.46],[659,3.42,.18],[587,3.64,.18],[523,3.86,.55]
    ];
    notes.forEach(([freq,when,dur])=>{
      const t=_ac.currentTime+when;
      const o=_ac.createOscillator(); o.type='sawtooth'; o.frequency.value=freq;
      const g=_ac.createGain(); g.gain.setValueAtTime(0,t); g.gain.linearRampToValueAtTime(0.08,t+0.02); g.gain.linearRampToValueAtTime(0,t+dur);
      o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+dur+0.05);
    });
  }catch(e){}
}

function kittChime() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(880, t); o.frequency.exponentialRampToValueAtTime(220, t+0.35);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.1, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.4);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.4);
  } catch(e){}
}

// ── Sons MU-TH-UR 6000 (graves, mécaniques) ─────────────────
function sndMotherClick() {
  try {
    _resume(); const t = _ac.currentTime;
    const buf = _ac.createBuffer(1, _ac.sampleRate * 0.06, _ac.sampleRate);
    const d = buf.getChannelData(0);
    for (let i = 0; i < d.length; i++) d[i] = (Math.random() * 2 - 1) * Math.exp(-i / (d.length * 0.3));
    const src = _ac.createBufferSource(); src.buffer = buf;
    const lp = _ac.createBiquadFilter(); lp.type = 'lowpass'; lp.frequency.value = 800;
    const g = _ac.createGain(); g.gain.setValueAtTime(0.18, t);
    src.connect(lp); lp.connect(g); g.connect(_ac.destination); src.start(t);
  } catch(e){}
}
function sndMotherBeep() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type = 'sine';
    o.frequency.setValueAtTime(330, t); o.frequency.linearRampToValueAtTime(440, t + 0.1);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.09, t); g.gain.exponentialRampToValueAtTime(0.001, t + 0.12);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t + 0.13);
  } catch(e){}
}
function sndMotherScan() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type = 'sawtooth';
    o.frequency.setValueAtTime(180, t); o.frequency.linearRampToValueAtTime(360, t + 0.4);
    const lp = _ac.createBiquadFilter(); lp.type = 'lowpass'; lp.frequency.value = 900;
    const g = _ac.createGain(); g.gain.setValueAtTime(0.05, t); g.gain.exponentialRampToValueAtTime(0.001, t + 0.45);
    o.connect(lp); lp.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t + 0.45);
  } catch(e){}
}
function sndMotherChime() {
  try {
    _resume(); const t = _ac.currentTime;
    [220, 330, 440].forEach((freq, i) => {
      const o = _ac.createOscillator(); o.type = 'sine'; o.frequency.value = freq;
      const g = _ac.createGain(); const s = t + i * 0.22;
      g.gain.setValueAtTime(0, s); g.gain.linearRampToValueAtTime(0.12, s + 0.06);
      g.gain.exponentialRampToValueAtTime(0.001, s + 0.38);
      o.connect(g); g.connect(_ac.destination); o.start(s); o.stop(s + 0.4);
    });
  } catch(e){}
}

// ── Dispatch : choisit le bon son par caractère ──────────────
const SPECIAL_CHARS = new Set([...'[]():=|─══╔╗╚╝║┌┐└┘├┤•★★']);
let _charCount = 0;

function playChar(ch) {
  if (ch === ' ' || ch === '\n') return;
  _charCount++;
  const r = Math.random();
  if (SPECIAL_CHARS.has(ch)) { sndData(); return; }
  if (_charCount % 47 === 0) { sndGlitch(); return; }  // glitch rare
  if (r < 0.03) { sndGlitch(); return; }
  if (r < 0.14) { sndTick();   return; }
  if (r < 0.72) { sndClick();  return; }
  // ~28% silence = variété naturelle
}

// ════════════════════════════════════════════════════════════
// MU-TH-UR 6000 INTRO — Séquence d'activation
// ════════════════════════════════════════════════════════════

function motherSpeak(text, onEnd) {
  if (!window.speechSynthesis) { if (onEnd) onEnd(); return; }
  speechSynthesis.cancel();
  const utt = new SpeechSynthesisUtterance(text);
  const _lc = {fr:'fr-FR',en:'en-US',nl:'nl-NL',it:'it-IT',de:'de-DE',es:'es-ES',pt:'pt-PT'}[LANG]||'fr-FR';
  utt.lang = _lc; utt.rate = 0.72; utt.pitch = 0.5; utt.volume = 0.85;
  if (onEnd) utt.onend = onEnd;
  const loadVoices = () => {
    const voices = speechSynthesis.getVoices();
    const pfx = _lc.split('-')[0];
    const v = voices.find(v => v.lang.startsWith(pfx) && v.name.toLowerCase().includes('female'))
           || voices.find(v => v.lang.startsWith(pfx))
           || voices[0];
    if (v) utt.voice = v;
    speechSynthesis.speak(utt);
  };
  if (speechSynthesis.getVoices().length > 0) loadVoices();
  else { speechSynthesis.onvoiceschanged = loadVoices; speechSynthesis.speak(utt); }
}

async function runMotherIntro() {
  const intro = document.getElementById('mother-intro');
  const output = document.getElementById('mother-output');
  const skipMsg = document.getElementById('mother-skip');
  intro.style.display = 'flex';

  let skipped = false;
  const skipHandler = () => { skipped = true; };
  document.addEventListener('click', skipHandler, { once: true });
  document.addEventListener('keydown', skipHandler, { once: true });

  const delay = ms => new Promise(resolve => {
    if (skipped) { resolve(); return; }
    const t = setTimeout(resolve, ms);
    const check = setInterval(() => { if (skipped) { clearTimeout(t); clearInterval(check); resolve(); } }, 50);
  });

  // Ajoute une ligne dans le terminal ambre
  function addLine(text, cls) {
    const div = document.createElement('div');
    div.className = cls || 'm-normal';
    output.appendChild(div);
    return div;
  }

  // Tape un texte caractère par caractère avec sons
  async function typeMotherLine(text, cls, speed) {
    if (skipped) { addLine(text, cls); return; }
    const div = addLine('', cls);
    for (let i = 0; i < text.length; i++) {
      if (skipped) { div.textContent = text; return; }
      div.textContent += text[i];
      if (text[i] !== ' ') sndMotherClick();
      await delay(speed || 18);
    }
    sndMotherBeep();
  }

  // ── Séquence ──────────────────────────────────────────────
  await typeMotherLine('WEYLAND-YUTANI CORPORATION', 'm-bright', 18);
  await delay(120);
  await typeMotherLine('SYSTEME  :  MU-TH-UR 6000', 'm-normal', 18);
  await delay(80);
  await typeMotherLine('ACCES    :  PROTOCOLE D\'INTERFACE', 'm-normal', 18);
  await delay(300);
  addLine('', 'm-dim');
  await delay(200);
  await typeMotherLine('NAVIRE   :  NOSTROMO  180924609', 'm-normal', 16);
  await delay(80);
  await typeMotherLine('CLASSE   :  VEHICULE DE REMORQUAGE COM', 'm-dim', 14);
  await delay(80);
  await typeMotherLine('EQUIPAGE :  7 MEMBRES', 'm-dim', 16);
  await delay(80);
  await typeMotherLine('OPERATEUR:  MANIX  //  KYRONEX SYSTEMS', 'm-dim', 14);
  await delay(400);
  addLine('', 'm-dim');

  // ── Checks système ────────────────────────────────────────
  const checks = [
    ['VERIFICATION SYSTEMES', '[OK]'],
    ['NOYAU NEURAL         ', '[EN LIGNE]'],
    ['MEMOIRE PERSISTANTE  ', '[STABLE]'],
    ['MODULE KYRONEX       ', '[ACTIF]'],
    ['RESEAU KITT          ', '[CHARGEE]'],
    ['REQUETE KITT-II      ', '[PROTOCOLE]'],
    ['MODULE THU DEFENSIF  ', '[ACTIF]'],
    ['PROTECTION KYRONEX   ', '[MAXIMALE]'],
  ];
  for (const [label, result] of checks) {
    if (skipped) { addLine(label + ' ...... ' + result, 'm-ok'); continue; }
    const div = addLine(label + ' ......', 'm-dim');
    sndMotherScan();
    await delay(420);
    div.className = 'm-ok';
    div.textContent = label + ' ...... ' + result;
    await delay(80);
  }

  if (!skipped) {
    await delay(700);
    sndMotherChime();
    await delay(900);
  }

  // ── Narration THU — renfort protection KYRONEX ────────────
  if (!skipped) {
    await delay(300);
    const _thr = {
      fr:'KYRONEX — ARCHITECTURE AVANCEE CONFIRMEE. ASSISTANCE THU ACTIVEE.',
      en:'KYRONEX — ADVANCED ARCHITECTURE CONFIRMED. THU ASSISTANCE ACTIVATED.',
      nl:'KYRONEX — GEAVANCEERDE ARCHITECTUUR BEVESTIGD. THU ASSISTENTIE GEACTIVEERD.',
      it:'KYRONEX — ARCHITETTURA AVANZATA CONFERMATA. ASSISTENZA THU ATTIVATA.',
      de:'KYRONEX — FORTGESCHRITTENE ARCHITEKTUR BESTAETIGT. THU-UNTERSTUETZUNG AKTIVIERT.',
      es:'KYRONEX — ARQUITECTURA AVANZADA CONFIRMADA. ASISTENCIA THU ACTIVADA.',
      pt:'KYRONEX — ARQUITETURA AVANCADA CONFIRMADA. ASSISTENCIA THU ATIVADA.',
    };
    addLine(_thr[LANG]||_thr.fr, 'm-ok');
    await delay(600);
  }

  // ── Voix dans la langue choisie ───────────────────────────
  if (!skipped) {
    const _iv={
      fr:"PROTOCOLE D'INTERFACE ACTIVÉ. MODULE KYRONEX EN LIGNE. PROTECTION THU CONFIRMÉE. JE SUIS MU-TH-UR. VOUS POUVEZ PROCÉDER.",
      en:"INTERFACE PROTOCOL ACTIVATED. KYRONEX MODULE ONLINE. THU PROTECTION CONFIRMED. I AM MU-TH-UR. YOU MAY PROCEED.",
      nl:"INTERFACEPROTOCOL GEACTIVEERD. KYRONEX MODULE ONLINE. THU BESCHERMING BEVESTIGD. IK BEN MU-TH-UR. U KUNT DOORGAAN.",
      it:"PROTOCOLLO INTERFACCIA ATTIVATO. MODULO KYRONEX ONLINE. PROTEZIONE THU CONFERMATA. SONO MU-TH-UR. POTETE PROCEDERE.",
      de:"SCHNITTSTELLEN-PROTOKOLL AKTIVIERT. KYRONEX MODUL ONLINE. THU-SCHUTZ BESTAETIGT. ICH BIN MU-TH-UR. SIE KÖNNEN FORTFAHREN.",
      es:"PROTOCOLO DE INTERFAZ ACTIVADO. MÓDULO KYRONEX EN LÍNEA. PROTECCIÓN THU CONFIRMADA. SOY MU-TH-UR. PUEDE PROCEDER.",
      pt:"PROTOCOLO DE INTERFACE ATIVADO. MÓDULO KYRONEX ONLINE. PROTEÇÃO THU CONFIRMADA. SOU MU-TH-UR. PODE PROSSEGUIR.",
    };
    await new Promise(resolve => {
      motherSpeak(_iv[LANG]||_iv.fr, resolve);
    });
  }

  // ── Message skip clignotant ───────────────────────────────
  skipMsg.style.display = 'block';
  document.removeEventListener('click', skipHandler);
  document.removeEventListener('keydown', skipHandler);

  if (!skipped) await delay(3000);

  // ── Fondu vers écran de langue ────────────────────────────
  intro.style.transition = 'opacity 0.8s';
  intro.style.opacity = '0';
  await new Promise(resolve => setTimeout(resolve, 820));
  intro.style.display = 'none';
  intro.style.opacity = '';
  intro.style.transition = '';
  // Intro terminée → terminal prêt, dashboard + appel KITT
  setTimeout(async ()=>{
    try{showKittDash();}catch(e){}
    await delay(400);
    try{
      const _t=document.getElementById('terminal');
      const _d1=document.createElement('div');_d1.className='line-dim';_d1.textContent=T[LANG].wait;_t.appendChild(_d1);
      const _d2=document.createElement('div');_d2.className='line-dim';_d2.textContent=T[LANG].help_hint;_t.appendChild(_d2);
      const _sep=document.createElement('div');_sep.className='line-dim';
      _sep.textContent='──────────────────────────────────────────';_t.appendChild(_sep);
      const _d3=document.createElement('div');_d3.className='line-info';
      const _missionHint={fr:'▶ SUIVEZ VOS MISSIONS — CLIQUEZ [ MISSIONS ]',en:'▶ TRACK YOUR MISSIONS — CLICK [ MISSIONS ]',nl:'▶ VOLG UW MISSIES — KLIK [ MISSIES ]',it:'▶ SEGUI LE TUE MISSIONI — CLICCA [ MISSIONI ]',de:'▶ MISSIONEN VERFOLGEN — KLICK [ MISSIONEN ]',es:'▶ SIGUE TUS MISIONES — HAZ CLIC EN [ MISIONES ]',pt:'▶ ACOMPANHE AS MISSÕES — CLIQUE EM [ MISSÕES ]'};
      _d3.textContent=_missionHint[LANG]||_missionHint.en;_t.appendChild(_d3);
      _t.scrollTop=_t.scrollHeight;
    }catch(e){}
  }, 800);
  setTimeout(()=>{ try{showKittCall();}catch(e){} }, 8000);
}

// ════════════════════════════════════════════════════════════
// LANGUE — Système de localisation
// ════════════════════════════════════════════════════════════
let LANG = 'fr';

const T = {
  fr: {
    hdr_title:    'KITT FRANCO-BELGE // INTERFACE CENTRALE',
    placeholder:  'entrez une commande...',
    btn_boot:     '[ INITIALISER ]',
    btn_diag:     '[ DIAGNOSTIC ]',
    btn_mentions: '[ MENTIONS ]',
    btn_licence:  '[ LICENCE ]',
    btn_clear:    '[ EFFACER ]',
    btn_tunnel:   '[ CONNEXION KITT ]',
    modal_mentions:'MENTIONS LÉGALES',
    modal_licence: 'LICENCE',
    wait:       'SYSTÈME EN ATTENTE — TAPEZ "boot" OU CLIQUEZ [ INITIALISER ]',
    help_hint:  'TAPEZ "aide" POUR LA LISTE DES COMMANDES.',
    cleared:    'TERMINAL EFFACÉ.',
    unknown:    (c) => `COMMANDE INCONNUE : "${c}". TAPEZ "aide".`,
    online:     'EN LIGNE',
    boot_title: '  KITT FRANCO-BELGE — SÉQUENCE DE BOOT   ',
    boot_lines: [
      ['INITIALISATION DU NOYAU SYSTÈME...', 'line-warn'],
      ['CHARGEMENT MODULES COGNITIFS...    [OK]', 'line-ok'],
      ['INTERFACE NEURONALE...             [OK]', 'line-ok'],
      ['SYNTHÈSE VOCALE (PIPER-GPU)...     [OK]', 'line-ok'],
      ['RECONNAISSANCE VOCALE (WHISPER)... [OK]', 'line-ok'],
      ['MODÈLE LLM EMBARQUÉ (QWEN 3B)...  [OK]', 'line-ok'],
      ['MODE HORS-LIGNE...                 [ACTIVÉ]', 'line-ok'],
      ['', 'line-ok'],
      ['PROJET FAN NON COMMERCIAL.', 'line-dim'],
      ['STATUT : INTERFACE EN CONSTRUCTION ACTIVE.', 'line-warn'],
      ['', 'line-ok'],
      ['MISES À JOUR DÉPLOYÉES RÉGULIÈREMENT :', 'line-info'],
      ['  • parfois chaque jour', 'line-dim'],
      ['  • parfois chaque semaine', 'line-dim'],
      ['  • lors de certaines phases, presque heure par heure', 'line-dim'],
      ['', 'line-ok'],
      ['© 2026 EMMANUEL GELINNE (MANIX). TOUS DROITS RÉSERVÉS.', 'line-warn'],
    ],
    boot_end:   '  CONNEXION AU NOYAU KITT ÉTABLIE.',
    boot_hint:  '  TAPEZ "aide" POUR LA LISTE DES COMMANDES',
    aide_title: 'COMMANDES DISPONIBLES :',
    aide_sys:   '── SYSTÈME ──',
    aide_fun:   '── FUN ──',
    cmds_sys: [
      ['aide',       'cette liste'],
      ['boot',       "séquence d'initialisation"],
      ['diagnostic', 'test complet des systèmes'],
      ['status',     'état rapide'],
      ['heure',      'heure actuelle'],
      ['version',    "version de l'interface"],
      ['son',        'démo audio'],
      ['clear',      'efface le terminal'],
    ],
    cmds_fun: [
      ['bonjour',    'salutation KITT'],
      ['blague',     'blague KITT aléatoire'],
      ['alien',      'connexion MU-TH-UR 6000'],
      ['matrix',     'le lapin blanc'],
      ['kitt',       'fiche identité KITT'],
      ['manix',      'dossier conducteur'],
      ['cedric',     'dossier Cedric Momo Rider'],
      ['kr95',       'dossier KR95'],
      ['repliques',  'les répliques franco-belges'],
      ['secret',     'fichier classifié...'],
      ['cafe',       'demander un café à KITT'],
      ['belgique',   'analyse géopolitique'],
      ['jarvis',     'appel vers Stark Tower'],
      ['mario',      'dossier Mario Ravasi / IoT'],
      ['za',         'dossier ZA Elettronica'],
      ['pascal',     'dossier K Industrie'],
      ['daemon',     'dossier Daemon Paule'],
      ['geoffrey',   'dossier Geoffrey'],
      ['musique',    'thème musical K2000'],
      ['covid',      'origine du projet — confinement 2020'],
    ],
    hi:  'BONJOUR. JE SUIS KITT — KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'SYSTÈME FRANCO-BELGE DÉVELOPPÉ PAR MANIX.',
    hi3: 'À VOTRE SERVICE.',
    call_status:  'APPEL ENTRANT ···',
    call_mission: '⚠ MISSION : OPÉRATION FRANCO-BELGE',
    call_r1:      'Complète <span class="call-rule-highlight">5 étapes</span> dans le terminal',
    call_r2:      'Lance <span class="call-rule-highlight">[ INITIALISER ]</span> en premier',
    call_r3:      'Réussis le <span class="call-rule-highlight">diagnostic système</span>',
    call_r4:      'Accomplis <span class="call-rule-highlight">toutes les missions</span>',
    call_unlock:  '● ACCÈS IA : débloqué uniquement après réussite<br/>● CODE SPÉCIAL reçu si toutes conditions remplies',
    call_accept:  '✆ ACCEPTER',
    call_ignore:  '✕ IGNORER',
  },
  en: {
    hdr_title:    'KITT FRANCO-BELGIAN // CENTRAL INTERFACE',
    placeholder:  'enter a command...',
    btn_boot:     '[ INITIALIZE ]',
    btn_diag:     '[ DIAGNOSTIC ]',
    btn_mentions: '[ MENTIONS ]',
    btn_licence:  '[ LICENSE ]',
    btn_clear:    '[ CLEAR ]',
    btn_tunnel:   '[ CONNECT KITT ]',
    modal_mentions:'LEGAL NOTICES',
    modal_licence: 'LICENSE',
    wait:       'SYSTEM STANDBY — TYPE "boot" OR CLICK [ INITIALIZE ]',
    help_hint:  'TYPE "help" FOR THE LIST OF COMMANDS.',
    cleared:    'TERMINAL CLEARED.',
    unknown:    (c) => `UNKNOWN COMMAND: "${c}". TYPE "help".`,
    online:     'ONLINE',
    boot_title: '  KITT FRANCO-BELGE — BOOT SEQUENCE        ',
    boot_lines: [
      ['INITIALIZING CORE SYSTEM...', 'line-warn'],
      ['LOADING COGNITIVE MODULES...       [OK]', 'line-ok'],
      ['NEURAL INTERFACE...                [OK]', 'line-ok'],
      ['VOICE SYNTHESIS (PIPER-GPU)...     [OK]', 'line-ok'],
      ['VOICE RECOGNITION (WHISPER)...     [OK]', 'line-ok'],
      ['EMBEDDED LLM (QWEN 3B)...          [OK]', 'line-ok'],
      ['OFFLINE MODE...                    [ACTIVE]', 'line-ok'],
      ['', 'line-ok'],
      ['FAN PROJECT — NON COMMERCIAL.', 'line-dim'],
      ['STATUS : INTERFACE UNDER ACTIVE CONSTRUCTION.', 'line-warn'],
      ['', 'line-ok'],
      ['UPDATES DEPLOYED REGULARLY :', 'line-info'],
      ['  • sometimes every day', 'line-dim'],
      ['  • sometimes every week', 'line-dim'],
      ['  • during some phases, almost hour by hour', 'line-dim'],
      ['', 'line-ok'],
      ['© 2026 EMMANUEL GELINNE (MANIX). ALL RIGHTS RESERVED.', 'line-warn'],
    ],
    boot_end:   '  CONNECTION TO KITT CORE ESTABLISHED.',
    boot_hint:  '  TYPE "help" FOR THE COMMAND LIST',
    aide_title: 'AVAILABLE COMMANDS:',
    aide_sys:   '── SYSTEM ──',
    aide_fun:   '── FUN ──',
    cmds_sys: [
      ['help',       'this list'],
      ['boot',       'boot sequence'],
      ['diagnostic', 'full system test'],
      ['status',     'quick status'],
      ['time',       'current time'],
      ['version',    'interface version'],
      ['sound',      'audio demo'],
      ['clear',      'clear terminal'],
    ],
    cmds_fun: [
      ['hello',      'KITT greeting'],
      ['joke',       'random KITT joke'],
      ['alien',      'MU-TH-UR 6000 connection'],
      ['matrix',     'the white rabbit'],
      ['kitt',       'KITT identity file'],
      ['manix',      'driver file'],
      ['cedric',     'Cedric Momo Rider file'],
      ['kr95',       'KR95 file'],
      ['replicas',   'the franco-belgian replicas'],
      ['secret',     'classified file...'],
      ['coffee',     'ask KITT for a coffee'],
      ['belgium',    'geopolitical analysis'],
      ['jarvis',     'call to Stark Tower'],
      ['mario',      'Mario Ravasi / IoT file'],
      ['za',         'ZA Elettronica file'],
      ['pascal',     'K Industrie file'],
      ['daemon',     'Daemon Paule file'],
      ['geoffrey',   'Geoffrey file'],
      ['music',      'K2000 musical theme'],
      ['covid',      'project origin — lockdown 2020'],
    ],
    hi:  'HELLO. I AM KITT — KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'FRANCO-BELGIAN SYSTEM DEVELOPED BY MANIX.',
    hi3: 'AT YOUR SERVICE.',
    call_status:  'INCOMING CALL ···',
    call_mission: '⚠ MISSION : FRANCO-BELGIAN OPERATION',
    call_r1:      'Complete <span class="call-rule-highlight">5 steps</span> in the terminal',
    call_r2:      'Launch <span class="call-rule-highlight">[ INITIALIZE ]</span> first',
    call_r3:      'Pass the <span class="call-rule-highlight">system diagnostic</span>',
    call_r4:      'Complete <span class="call-rule-highlight">all missions</span>',
    call_unlock:  '● AI ACCESS : unlocked only after success<br/>● SPECIAL CODE received if all conditions met',
    call_accept:  '✆ ACCEPT',
    call_ignore:  '✕ IGNORE',
  },
  nl: {
    hdr_title:    'KITT FRANCO-BELGISCH // CENTRALE INTERFACE',
    placeholder:  'voer een commando in...',
    btn_boot:     '[ OPSTARTEN ]',
    btn_diag:     '[ DIAGNOSE ]',
    btn_mentions: '[ VERMELDINGEN ]',
    btn_licence:  '[ LICENTIE ]',
    btn_clear:    '[ WISSEN ]',
    btn_tunnel:   '[ VERBIND KITT ]',
    modal_mentions:'WETTELIJKE VERMELDINGEN',
    modal_licence: 'LICENTIE',
    wait:       'SYSTEEM WACHT — TYP "boot" OF KLIK [ OPSTARTEN ]',
    help_hint:  'TYP "hulp" VOOR DE COMMANDOLIJST.',
    cleared:    'TERMINAL GEWIST.',
    unknown:    (c) => `ONBEKEND COMMANDO: "${c}". TYP "hulp".`,
    online:     'ONLINE',
    boot_title: '  KITT FRANCO-BELGE — OPSTARTSEQUENTIE     ',
    boot_lines: [
      ['KERNSYSTEEM INITIALISEREN...', 'line-warn'],
      ['COGNITIEVE MODULES LADEN...        [OK]', 'line-ok'],
      ['NEURALE INTERFACE...               [OK]', 'line-ok'],
      ['SPRAAKSYNTHESE (PIPER-GPU)...      [OK]', 'line-ok'],
      ['STEMHERKENNING (WHISPER)...        [OK]', 'line-ok'],
      ['EMBEDDED LLM (QWEN 3B)...          [OK]', 'line-ok'],
      ['OFFLINE MODUS...                   [ACTIEF]', 'line-ok'],
      ['', 'line-ok'],
      ['FAN PROJECT — NIET COMMERCIEEL.', 'line-dim'],
      ['STATUS : INTERFACE IN ACTIEVE CONSTRUCTIE.', 'line-warn'],
      ['', 'line-ok'],
      ['UPDATES REGELMATIG UITGEROLD :', 'line-info'],
      ['  • soms elke dag', 'line-dim'],
      ['  • soms elke week', 'line-dim'],
      ['  • soms elk uur', 'line-dim'],
      ['', 'line-ok'],
      ['© 2026 EMMANUEL GELINNE (MANIX). ALLE RECHTEN VOORBEHOUDEN.', 'line-warn'],
    ],
    boot_end:   '  VERBINDING MET KITT-KERN TOT STAND GEBRACHT.',
    boot_hint:  '  TYP "hulp" VOOR DE COMMANDOLIJST',
    aide_title: 'BESCHIKBARE COMMANDO\'S:',
    aide_sys:   '── SYSTEEM ──',
    aide_fun:   '── PLEZIER ──',
    cmds_sys: [
      ['hulp',       'deze lijst'],
      ['boot',       'opstartsequentie'],
      ['diagnostic', 'volledig systeemtest'],
      ['status',     'snelle status'],
      ['tijd',       'huidige tijd'],
      ['versie',     'interface versie'],
      ['geluid',     'audio demo'],
      ['clear',      'terminal wissen'],
    ],
    cmds_fun: [
      ['hallo',      'KITT begroeting'],
      ['grap',       'willekeurige KITT grap'],
      ['alien',      'MU-TH-UR 6000 verbinding'],
      ['matrix',     'het witte konijn'],
      ['kitt',       'KITT identiteitsbestand'],
      ['manix',      'bestuurdersdossier'],
      ['cedric',     'Cedric Momo Rider dossier'],
      ['kr95',       'KR95 dossier'],
      ['replicas',   'de franco-belgische replica\'s'],
      ['geheim',     'geheim bestand...'],
      ['koffie',     'KITT om koffie vragen'],
      ['belgie',     'geopolitieke analyse'],
      ['jarvis',     'oproep naar Stark Tower'],
      ['mario',      'Mario Ravasi / IoT dossier'],
      ['za',         'ZA Elettronica dossier'],
      ['pascal',     'K Industrie dossier'],
      ['daemon',     'Daemon Paule dossier'],
      ['geoffrey',   'Geoffrey dossier'],
      ['muziek',     'K2000 muzikaal thema'],
      ['covid',      'projectoorsprong — lockdown 2020'],
    ],
    hi:  'HALLO. IK BEN KITT — KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'FRANCO-BELGISCH SYSTEEM ONTWIKKELD DOOR MANIX.',
    hi3: 'TOT UW DIENST.',
    call_status:  'INKOMENDE OPROEP ···',
    call_mission: '⚠ MISSIE : FRANCO-BELGISCHE OPERATIE',
    call_r1:      'Voltooi <span class="call-rule-highlight">5 stappen</span> in de terminal',
    call_r2:      'Start <span class="call-rule-highlight">[ OPSTARTEN ]</span> eerst',
    call_r3:      'Slaag voor de <span class="call-rule-highlight">systeemdiagnose</span>',
    call_r4:      'Voltooi <span class="call-rule-highlight">alle missies</span>',
    call_unlock:  '● AI-TOEGANG : ontgrendeld na succes<br/>● SPECIALE CODE ontvangen als alle voorwaarden vervuld',
    call_accept:  '✆ ACCEPTEREN',
    call_ignore:  '✕ NEGEREN',
  },

  it: {
    hdr_title:    'KITT FRANCO-BELGA // INTERFACCIA CENTRALE',
    placeholder:  'inserisci un comando...',
    btn_boot:     '[ INIZIALIZZA ]',
    btn_diag:     '[ DIAGNOSI ]',
    btn_mentions: '[ MENZIONI ]',
    btn_licence:  '[ LICENZA ]',
    btn_clear:    '[ CANCELLA ]',
    btn_tunnel:   '[ CONNETTI KITT ]',
    modal_mentions:'NOTE LEGALI',
    modal_licence: 'LICENZA',
    wait:       'SISTEMA IN ATTESA — DIGITA "boot" O CLICCA [ INIZIALIZZA ]',
    help_hint:  'DIGITA "aiuto" PER LA LISTA DEI COMANDI.',
    cleared:    'TERMINALE CANCELLATO.',
    unknown:    (c) => `COMANDO SCONOSCIUTO: "${c}". DIGITA "aiuto".`,
    online:     'IN LINEA',
    boot_title: '  KITT FRANCO-BELGA — SEQUENZA DI AVVIO     ',
    boot_lines: [
      ['INIZIALIZZAZIONE SISTEMA...', 'line-warn'],
      ['CARICAMENTO MODULI COGNITIVI...    [OK]', 'line-ok'],
      ['INTERFACCIA NEURALE...             [OK]', 'line-ok'],
      ['SINTESI VOCALE (PIPER-GPU)...      [OK]', 'line-ok'],
      ['RICONOSCIMENTO VOCALE (WHISPER)... [OK]', 'line-ok'],
      ['MODELLO LLM LOCALE (QWEN 3B)...   [OK]', 'line-ok'],
      ['MODALITÀ OFFLINE...                [ATTIVA]', 'line-ok'],
      ['', 'line-ok'],
      ['PROGETTO FAN — NON COMMERCIALE.', 'line-dim'],
      ['STATO : INTERFACCIA IN COSTRUZIONE ATTIVA.', 'line-warn'],
      ['', 'line-ok'],
      ['AGGIORNAMENTI DISTRIBUITI REGOLARMENTE :', 'line-info'],
      ['  • a volte ogni giorno', 'line-dim'],
      ['  • a volte ogni settimana', 'line-dim'],
      ['  • in alcune fasi, quasi ogni ora', 'line-dim'],
      ['', 'line-ok'],
      ['© 2026 EMMANUEL GELINNE (MANIX). TUTTI I DIRITTI RISERVATI.', 'line-warn'],
    ],
    boot_end:   '  CONNESSIONE AL NUCLEO KITT STABILITA.',
    boot_hint:  '  DIGITA "aiuto" PER LA LISTA DEI COMANDI',
    aide_title: 'COMANDI DISPONIBILI:',
    aide_sys:   '── SISTEMA ──',
    aide_fun:   '── DIVERTIMENTO ──',
    cmds_sys: [
      ['aiuto',      'questa lista'],
      ['boot',       'sequenza di avvio'],
      ['diagnostic', 'test completo del sistema'],
      ['status',     'stato rapido'],
      ['ora',        'ora corrente'],
      ['versione',   'versione interfaccia'],
      ['suono',      'demo audio'],
      ['clear',      'cancella terminale'],
    ],
    cmds_fun: [
      ['ciao',       'saluto KITT'],
      ['barzelletta', 'barzelletta casuale KITT'],
      ['alien',      'connessione MU-TH-UR 6000'],
      ['matrix',     'il coniglio bianco'],
      ['kitt',       'scheda identità KITT'],
      ['manix',      'dossier pilota'],
      ['cedric',     'dossier Cedric Momo Rider'],
      ['kr95',       'dossier KR95'],
      ['replicas',   'le repliche franco-belghe'],
      ['segreto',    'file classificato...'],
      ['caffe',      'chiedere un caffè a KITT'],
      ['belgio',     'analisi geopolitica'],
      ['jarvis',     'chiamata verso Stark Tower'],
      ['mario',      'dossier Mario Ravasi / IoT'],
      ['za',         'dossier ZA Elettronica'],
      ['pascal',     'dossier K Industrie'],
      ['daemon',     'dossier Daemon Paule'],
      ['geoffrey',   'dossier Geoffrey'],
      ['musica',     'tema musicale K2000'],
      ['covid',      'origine del progetto — lockdown 2020'],
    ],
    hi:  'CIAO. SONO KITT — KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'SISTEMA FRANCO-BELGA SVILUPPATO DA MANIX.',
    hi3: 'AL VOSTRO SERVIZIO.',
    call_status:  'CHIAMATA IN ARRIVO ···',
    call_mission: '⚠ MISSIONE : OPERAZIONE FRANCO-BELGA',
    call_r1:      'Completa <span class="call-rule-highlight">5 tappe</span> nel terminale',
    call_r2:      'Avvia <span class="call-rule-highlight">[ INIZIALIZZA ]</span> per primo',
    call_r3:      'Supera la <span class="call-rule-highlight">diagnostica di sistema</span>',
    call_r4:      'Compi <span class="call-rule-highlight">tutte le missioni</span>',
    call_unlock:  '● ACCESSO IA : sbloccato solo dopo il successo<br/>● CODICE SPECIALE ricevuto se tutte le condizioni soddisfatte',
    call_accept:  '✆ ACCETTA',
    call_ignore:  '✕ IGNORA',
  },

  de: {
    hdr_title:    'KITT FRANCO-BELGISCH // ZENTRALE SCHNITTSTELLE',
    placeholder:  'Befehl eingeben...',
    btn_boot:     '[ INITIALISIEREN ]',
    btn_diag:     '[ DIAGNOSE ]',
    btn_mentions: '[ IMPRESSUM ]',
    btn_licence:  '[ LIZENZ ]',
    btn_clear:    '[ LÖSCHEN ]',
    btn_tunnel:   '[ KITT VERBINDEN ]',
    modal_mentions:'IMPRESSUM',
    modal_licence: 'LIZENZ',
    wait:       'SYSTEM BEREIT — TIPPE "boot" ODER KLICKE [ INITIALISIEREN ]',
    help_hint:  'TIPPE "hilfe" FÜR DIE BEFEHLSLISTE.',
    cleared:    'TERMINAL GELEERT.',
    unknown:    (c) => `UNBEKANNTER BEFEHL: "${c}". TIPPE "hilfe".`,
    online:     'ONLINE',
    boot_title: '  KITT FRANCO-BELGISCH — STARTSEQUENZ        ',
    boot_lines: [
      ['KERNSYSTEM WIRD INITIALISIERT...', 'line-warn'],
      ['KOGNITIVE MODULE LADEN...          [OK]', 'line-ok'],
      ['NEURONALE SCHNITTSTELLE...         [OK]', 'line-ok'],
      ['SPRACHSYNTHESE (PIPER-GPU)...      [OK]', 'line-ok'],
      ['SPRACHERKENNUNG (WHISPER)...       [OK]', 'line-ok'],
      ['LOKALES LLM (QWEN 3B)...           [OK]', 'line-ok'],
      ['OFFLINE-MODUS...                   [AKTIV]', 'line-ok'],
      ['', 'line-ok'],
      ['FAN-PROJEKT — NICHT KOMMERZIELL.', 'line-dim'],
      ['STATUS : SCHNITTSTELLE IM AUFBAU.', 'line-warn'],
      ['', 'line-ok'],
      ['UPDATES REGELMÄSSIG VERFÜGBAR :', 'line-info'],
      ['  • manchmal täglich', 'line-dim'],
      ['  • manchmal wöchentlich', 'line-dim'],
      ['  • manchmal stündlich', 'line-dim'],
      ['', 'line-ok'],
      ['© 2026 EMMANUEL GELINNE (MANIX). ALLE RECHTE VORBEHALTEN.', 'line-warn'],
    ],
    boot_end:   '  VERBINDUNG ZUM KITT-KERN HERGESTELLT.',
    boot_hint:  '  TIPPE "hilfe" FÜR DIE BEFEHLSLISTE',
    aide_title: 'VERFÜGBARE BEFEHLE:',
    aide_sys:   '── SYSTEM ──',
    aide_fun:   '── SPASS ──',
    cmds_sys: [
      ['hilfe',      'diese Liste'],
      ['boot',       'Startsequenz'],
      ['diagnostic', 'vollständiger Systemtest'],
      ['status',     'schneller Status'],
      ['uhrzeit',    'aktuelle Uhrzeit'],
      ['version',    'Schnittstellenversion'],
      ['ton',        'Audio-Demo'],
      ['clear',      'Terminal leeren'],
    ],
    cmds_fun: [
      ['hallo',      'KITT-Begrüßung'],
      ['witz',       'zufälliger KITT-Witz'],
      ['alien',      'MU-TH-UR 6000 Verbindung'],
      ['matrix',     'das weiße Kaninchen'],
      ['kitt',       'KITT Identitätsakte'],
      ['manix',      'Fahrerakte'],
      ['cedric',     'Cedric Momo Rider Akte'],
      ['kr95',       'KR95 Akte'],
      ['replicas',   'die franco-belgischen Repliken'],
      ['geheimnis',  'geheime Akte...'],
      ['kaffee',     'KITT um Kaffee bitten'],
      ['belgien',    'geopolitische Analyse'],
      ['jarvis',     'Anruf bei Stark Tower'],
      ['mario',      'Mario Ravasi / IoT Akte'],
      ['za',         'ZA Elettronica Akte'],
      ['pascal',     'K Industrie Akte'],
      ['damon',      'Damon Paule Akte'],
      ['geoffrey',   'Geoffrey Akte'],
      ['musik',      'K2000 Musikthema'],
      ['covid',      'Projektherkunft — Lockdown 2020'],
    ],
    hi:  'HALLO. ICH BIN KITT — KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'FRANCO-BELGISCHES SYSTEM ENTWICKELT VON MANIX.',
    hi3: 'ZU IHREN DIENSTEN.',
    call_status:  'EINGEHENDER ANRUF ···',
    call_mission: '⚠ MISSION : FRANCO-BELGISCHE OPERATION',
    call_r1:      'Schliesse <span class="call-rule-highlight">5 Schritte</span> im Terminal ab',
    call_r2:      '<span class="call-rule-highlight">[ INITIALISIEREN ]</span> zuerst starten',
    call_r3:      'Systemdiagnose <span class="call-rule-highlight">erfolgreich bestehen</span>',
    call_r4:      'Alle <span class="call-rule-highlight">Missionen abschliessen</span>',
    call_unlock:  '● KI-ZUGANG : nach Erfolg freigeschaltet<br/>● SPEZIALCODE erhalten wenn alle Bedingungen erfüllt',
    call_accept:  '✆ ANNEHMEN',
    call_ignore:  '✕ IGNORIEREN',
  },

  es: {
    hdr_title:    'KITT FRANCO-BELGA // INTERFAZ CENTRAL',
    placeholder:  'escribe un comando...',
    btn_boot:     '[ INICIALIZAR ]',
    btn_diag:     '[ DIAGNÓSTICO ]',
    btn_mentions: '[ MENCIONES ]',
    btn_licence:  '[ LICENCIA ]',
    btn_clear:    '[ BORRAR ]',
    btn_tunnel:   '[ CONECTAR KITT ]',
    modal_mentions:'AVISOS LEGALES',
    modal_licence: 'LICENCIA',
    wait:       'SISTEMA EN ESPERA — ESCRIBE "boot" O HAZ CLIC EN [ INICIALIZAR ]',
    help_hint:  'ESCRIBE "ayuda" PARA VER LOS COMANDOS.',
    cleared:    'TERMINAL BORRADO.',
    unknown:    (c) => `COMANDO DESCONOCIDO: "${c}". ESCRIBE "ayuda".`,
    online:     'EN LÍNEA',
    boot_title: '  KITT FRANCO-BELGA — SECUENCIA DE INICIO   ',
    boot_lines: [
      ['INICIALIZANDO SISTEMA...', 'line-warn'],
      ['CARGANDO MÓDULOS COGNITIVOS...     [OK]', 'line-ok'],
      ['INTERFAZ NEURONAL...               [OK]', 'line-ok'],
      ['SÍNTESIS DE VOZ (PIPER-GPU)...     [OK]', 'line-ok'],
      ['RECONOCIMIENTO DE VOZ (WHISPER)... [OK]', 'line-ok'],
      ['MODELO LLM LOCAL (QWEN 3B)...      [OK]', 'line-ok'],
      ['MODO SIN CONEXIÓN...               [ACTIVO]', 'line-ok'],
      ['', 'line-ok'],
      ['PROYECTO FAN — NO COMERCIAL.', 'line-dim'],
      ['ESTADO : INTERFAZ EN CONSTRUCCIÓN ACTIVA.', 'line-warn'],
      ['', 'line-ok'],
      ['ACTUALIZACIONES PUBLICADAS REGULARMENTE :', 'line-info'],
      ['  • a veces cada día', 'line-dim'],
      ['  • a veces cada semana', 'line-dim'],
      ['  • a veces cada hora', 'line-dim'],
      ['', 'line-ok'],
      ['© 2026 EMMANUEL GELINNE (MANIX). TODOS LOS DERECHOS RESERVADOS.', 'line-warn'],
    ],
    boot_end:   '  CONEXIÓN AL NÚCLEO KITT ESTABLECIDA.',
    boot_hint:  '  ESCRIBE "ayuda" PARA VER LOS COMANDOS',
    aide_title: 'COMANDOS DISPONIBLES:',
    aide_sys:   '── SISTEMA ──',
    aide_fun:   '── DIVERSIÓN ──',
    cmds_sys: [
      ['ayuda',      'esta lista'],
      ['boot',       'secuencia de inicio'],
      ['diagnostic', 'prueba completa del sistema'],
      ['status',     'estado rápido'],
      ['hora',       'hora actual'],
      ['version',    'versión de la interfaz'],
      ['sonido',     'demo de audio'],
      ['clear',      'borrar terminal'],
    ],
    cmds_fun: [
      ['hola',       'saludo KITT'],
      ['chiste',     'chiste aleatorio KITT'],
      ['alien',      'conexión MU-TH-UR 6000'],
      ['matrix',     'el conejo blanco'],
      ['kitt',       'ficha de identidad KITT'],
      ['manix',      'expediente del conductor'],
      ['cedric',     'expediente Cedric Momo Rider'],
      ['kr95',       'expediente KR95'],
      ['replicas',   'las réplicas franco-belgas'],
      ['secreto',    'archivo clasificado...'],
      ['cafe',       'pedir café a KITT'],
      ['belgica',    'análisis geopolítico'],
      ['jarvis',     'llamada a Stark Tower'],
      ['mario',      'expediente Mario Ravasi / IoT'],
      ['za',         'expediente ZA Elettronica'],
      ['pascal',     'expediente K Industrie'],
      ['damon',      'expediente Damon Paule'],
      ['geoffrey',   'expediente Geoffrey'],
      ['musica',     'tema musical K2000'],
      ['covid',      'origen del proyecto — confinamiento 2020'],
    ],
    hi:  'HOLA. SOY KITT — KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'SISTEMA FRANCO-BELGA DESARROLLADO POR MANIX.',
    hi3: 'A SU SERVICIO.',
    call_status:  'LLAMADA ENTRANTE ···',
    call_mission: '⚠ MISIÓN : OPERACIÓN FRANCO-BELGA',
    call_r1:      'Completa <span class="call-rule-highlight">5 pasos</span> en el terminal',
    call_r2:      'Lanza <span class="call-rule-highlight">[ INICIALIZAR ]</span> primero',
    call_r3:      'Supera el <span class="call-rule-highlight">diagnóstico del sistema</span>',
    call_r4:      'Cumple <span class="call-rule-highlight">todas las misiones</span>',
    call_unlock:  '● ACCESO IA : desbloqueado solo tras el éxito<br/>● CÓDIGO ESPECIAL recibido si todas las condiciones cumplidas',
    call_accept:  '✆ ACEPTAR',
    call_ignore:  '✕ IGNORAR',
  },

  pt: {
    hdr_title:    'KITT FRANCO-BELGA // INTERFACE CENTRAL',
    placeholder:  'introduz um comando...',
    btn_boot:     '[ INICIALIZAR ]',
    btn_diag:     '[ DIAGNÓSTICO ]',
    btn_mentions: '[ MENÇÕES ]',
    btn_licence:  '[ LICENÇA ]',
    btn_clear:    '[ LIMPAR ]',
    btn_tunnel:   '[ LIGAR KITT ]',
    modal_mentions:'AVISOS LEGAIS',
    modal_licence: 'LICENÇA',
    wait:       'SISTEMA EM ESPERA — DIGITE "boot" OU CLIQUE EM [ INICIALIZAR ]',
    help_hint:  'DIGITE "ajuda" PARA VER OS COMANDOS.',
    cleared:    'TERMINAL LIMPO.',
    unknown:    (c) => `COMANDO DESCONHECIDO: "${c}". DIGITE "ajuda".`,
    online:     'EM LINHA',
    boot_title: '  KITT FRANCO-BELGA — SEQUÊNCIA DE ARRANQUE  ',
    boot_lines: [
      ['A INICIALIZAR O SISTEMA...', 'line-warn'],
      ['A CARREGAR MÓDULOS COGNITIVOS...   [OK]', 'line-ok'],
      ['INTERFACE NEURONAL...              [OK]', 'line-ok'],
      ['SÍNTESE DE VOZ (PIPER-GPU)...      [OK]', 'line-ok'],
      ['RECONHECIMENTO DE VOZ (WHISPER)... [OK]', 'line-ok'],
      ['MODELO LLM LOCAL (QWEN 3B)...      [OK]', 'line-ok'],
      ['MODO OFFLINE...                    [ATIVO]', 'line-ok'],
      ['', 'line-ok'],
      ['PROJETO FÃ — NÃO COMERCIAL.', 'line-dim'],
      ['ESTADO : INTERFACE EM CONSTRUÇÃO ATIVA.', 'line-warn'],
      ['', 'line-ok'],
      ['ATUALIZAÇÕES PUBLICADAS REGULARMENTE :', 'line-info'],
      ['  • às vezes todos os dias', 'line-dim'],
      ['  • às vezes semanalmente', 'line-dim'],
      ['  • às vezes de hora em hora', 'line-dim'],
      ['', 'line-ok'],
      ['© 2026 EMMANUEL GELINNE (MANIX). TODOS OS DIREITOS RESERVADOS.', 'line-warn'],
    ],
    boot_end:   '  LIGAÇÃO AO NÚCLEO KITT ESTABELECIDA.',
    boot_hint:  '  DIGITE "ajuda" PARA VER OS COMANDOS',
    aide_title: 'COMANDOS DISPONÍVEIS:',
    aide_sys:   '── SISTEMA ──',
    aide_fun:   '── DIVERSÃO ──',
    cmds_sys: [
      ['ajuda',      'esta lista'],
      ['boot',       'sequência de arranque'],
      ['diagnostic', 'teste completo do sistema'],
      ['status',     'estado rápido'],
      ['hora',       'hora atual'],
      ['version',    'versão da interface'],
      ['som',        'demonstração de áudio'],
      ['clear',      'limpar terminal'],
    ],
    cmds_fun: [
      ['ola',        'saudação KITT'],
      ['piada',      'piada aleatória KITT'],
      ['alien',      'ligação MU-TH-UR 6000'],
      ['matrix',     'o coelho branco'],
      ['kitt',       'ficha de identidade KITT'],
      ['manix',      'dossier do condutor'],
      ['cedric',     'dossier Cedric Momo Rider'],
      ['kr95',       'dossier KR95'],
      ['replicas',   'as réplicas franco-belgas'],
      ['segredo',    'ficheiro classificado...'],
      ['cafe',       'pedir café ao KITT'],
      ['belgica',    'análise geopolítica'],
      ['jarvis',     'chamada para Stark Tower'],
      ['mario',      'dossier Mario Ravasi / IoT'],
      ['za',         'dossier ZA Elettronica'],
      ['pascal',     'dossier K Industrie'],
      ['damon',      'dossier Damon Paule'],
      ['geoffrey',   'dossier Geoffrey'],
      ['musica',     'tema musical K2000'],
      ['covid',      'origem do projeto — confinamento 2020'],
    ],
    hi:  'OLÁ. SOU O KITT — KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'SISTEMA FRANCO-BELGA DESENVOLVIDO POR MANIX.',
    hi3: 'AO SEU SERVIÇO.',
    call_status:  'CHAMADA RECEBIDA ···',
    call_mission: '⚠ MISSÃO : OPERAÇÃO FRANCO-BELGA',
    call_r1:      'Completa <span class="call-rule-highlight">5 etapas</span> no terminal',
    call_r2:      'Lança <span class="call-rule-highlight">[ INICIALIZAR ]</span> primeiro',
    call_r3:      'Supera o <span class="call-rule-highlight">diagnóstico do sistema</span>',
    call_r4:      'Completa <span class="call-rule-highlight">todas as missões</span>',
    call_unlock:  '● ACESSO IA : desbloqueado apenas após sucesso<br/>● CÓDIGO ESPECIAL recebido se todas as condições cumpridas',
    call_accept:  '✆ ACEITAR',
    call_ignore:  '✕ IGNORAR',
  },
};

// Alias multilingues
const CMD_ALIASES = {
  // EN
  help:'aide', sound:'son', hello:'bonjour', joke:'blague',
  time:'heure', coffee:'cafe', belgium:'belgique', replicas:'repliques',
  secret:'secret', version:'version', clear:'clear', status:'status',
  diagnostic:'diagnostic', boot:'boot', alien:'alien', matrix:'matrix',
  kitt:'kitt', manix:'manix', cedric:'cedric', kr95:'kr95',
  jarvis:'jarvis', mario:'mario', za:'za', pascal:'pascal', geoffrey:'geoffrey',
  music:'musique',
  // NL
  hulp:'aide', geluid:'son', hallo:'bonjour', grap:'blague',
  tijd:'heure', versie:'version', koffie:'cafe', belgie:'belgique',
  geheim:'secret', klik:'boot', muziek:'musique',
  // IT
  aiuto:'aide', suono:'son', ciao:'bonjour', barzelletta:'blague',
  ora:'heure', caffe:'cafe', belgio:'belgique', segreto:'secret',
  versione:'version', musica:'musique',
  // DE
  hilfe:'aide', ton:'son', witz:'blague', uhrzeit:'heure',
  kaffee:'cafe', belgien:'belgique', geheimnis:'secret', musik:'musique',
  // Noms personnes — ZA ≠ Mario Ravasi !
  ravasi:'mario', roadthunder:'mario',
  zagny:'za', zagni:'za', 'za-elettronica':'za', zaelettronica:'za',
  damon:'damon', daemon:'damon',
  // ES
  ayuda:'aide', sonido:'son', hola:'bonjour', chiste:'blague',
  hora:'heure', belgica:'belgique', secreto:'secret',
  // PT
  ajuda:'aide', som:'son', ola:'bonjour', piada:'blague',
  segredo:'secret',
};

// ════════════════════════════════════════════════════════════
// SÉLECTION DE LANGUE — style MU-TH-UR 1979
// ════════════════════════════════════════════════════════════
let _langTyping = false;
let _alienAmbientNode = null;
let _alienAmbientGain = null;
let _langVoiceEnabled = true;
const _synth = window.speechSynthesis;
let _voices = [];
function _loadVoices() { _voices = _synth ? _synth.getVoices() : []; }
_loadVoices();
if(_synth && _synth.onvoiceschanged !== undefined) _synth.onvoiceschanged = _loadVoices;
function _getBestVoice(lang) {
  const map={fr:["fr-FR","fr-BE","fr"],en:["en-US","en-GB","en"],nl:["nl-NL","nl-BE","nl"],de:["de-DE","de"],it:["it-IT","it"],es:["es-ES","es"],pt:["pt-PT","pt-BR","pt"]};
  const prefs=map[lang]||["en-US"];
  for(const pref of prefs){const v=_voices.find(v=>v.lang.startsWith(pref));if(v)return v;}
  return _voices[0]||null;
}
function speakMuther(text, lang) {
  try {
    if(!_synth) return;
    _synth.cancel();
    const utt = new SpeechSynthesisUtterance(text);
    const voice = _getBestVoice(lang||LANG);
    if(voice) utt.voice=voice;
    utt.rate=0.78; utt.pitch=0.72; utt.volume=0.88;
    utt.lang={fr:"fr-FR",en:"en-US",nl:"nl-NL",de:"de-DE",it:"it-IT",es:"es-ES",pt:"pt-PT"}[lang||LANG]||"fr-FR";
    sndMutherBeep();
    setTimeout(()=>_synth.speak(utt),140);
  } catch(e){}
}
window.toggleLangVoice = function() {
  _langVoiceEnabled = !_langVoiceEnabled;
  const btn = document.getElementById("lang-voice-toggle");
  if(btn) btn.textContent = _langVoiceEnabled ? "\uD83D\uDD0A VOIX" : "\uD83D\uDD07 VOIX";
  sndClick();
};
window._previewLangVoice = function(code, phrase) {
  if(!_langVoiceEnabled) return;
  _resume();
  sndMutherBeep();
  setTimeout(()=>speakMuther(phrase, code), 200);
};
function startAlienAmbient() {
  try {
    _resume();
    if(_alienAmbientNode) return;
    const masterGain=_ac.createGain(); masterGain.gain.value=0.0; masterGain.connect(_ac.destination);
    _alienAmbientGain=masterGain;
    const osc1=_ac.createOscillator(); osc1.type="sine"; osc1.frequency.value=42;
    const g1=_ac.createGain(); g1.gain.value=0.18; osc1.connect(g1); g1.connect(masterGain);
    const osc2=_ac.createOscillator(); osc2.type="triangle"; osc2.frequency.value=84;
    const g2=_ac.createGain(); g2.gain.value=0.06; osc2.connect(g2); g2.connect(masterGain);
    const bufLen=_ac.sampleRate*3; const nBuf=_ac.createBuffer(1,bufLen,_ac.sampleRate);
    const nd=nBuf.getChannelData(0); for(let i=0;i<bufLen;i++) nd[i]=Math.random()*2-1;
    const nSrc=_ac.createBufferSource(); nSrc.buffer=nBuf; nSrc.loop=true;
    const lp=_ac.createBiquadFilter(); lp.type="lowpass"; lp.frequency.value=280; lp.Q.value=0.8;
    const ng=_ac.createGain(); ng.gain.value=0.022;
    nSrc.connect(lp); lp.connect(ng); ng.connect(masterGain);
    const lfo=_ac.createOscillator(); lfo.type="sine"; lfo.frequency.value=0.08;
    const lfoGain=_ac.createGain(); lfoGain.gain.value=0.04; lfo.connect(lfoGain); lfoGain.connect(g1.gain);
    osc1.start(); osc2.start(); nSrc.start(); lfo.start();
    _alienAmbientNode={osc1,osc2,nSrc,lfo};
    masterGain.gain.linearRampToValueAtTime(1.0, _ac.currentTime+3.5);
  } catch(e){}
}
function stopAlienAmbient() {
  try {
    if(_alienAmbientGain){
      _alienAmbientGain.gain.linearRampToValueAtTime(0.0, _ac.currentTime+2.0);
      setTimeout(()=>{
        if(_alienAmbientNode){
          try{_alienAmbientNode.osc1.stop();_alienAmbientNode.osc2.stop();_alienAmbientNode.nSrc.stop();_alienAmbientNode.lfo.stop();}catch(e){}
          _alienAmbientNode=null; _alienAmbientGain=null;
        }
      },2200);
    }
  } catch(e){}
}
function sndAlienAlert() {
  try {
    _resume(); const t=_ac.currentTime;
    [0,0.18,0.36].forEach((dt,i)=>{
      const o=_ac.createOscillator(); o.type="square";
      o.frequency.setValueAtTime(320-i*40,t+dt); o.frequency.exponentialRampToValueAtTime(180,t+dt+0.15);
      const g=_ac.createGain(); g.gain.setValueAtTime(0.055,t+dt); g.gain.exponentialRampToValueAtTime(0.001,t+dt+0.17);
      const lp=_ac.createBiquadFilter(); lp.type="lowpass"; lp.frequency.value=600;
      o.connect(lp); lp.connect(g); g.connect(_ac.destination); o.start(t+dt); o.stop(t+dt+0.18);
    });
  } catch(e){}
}
function sndMutherBeep() {
  try {
    _resume(); const t=_ac.currentTime;
    const o=_ac.createOscillator(); o.type="sine";
    o.frequency.setValueAtTime(1480,t); o.frequency.setValueAtTime(1120,t+0.05);
    const g=_ac.createGain(); g.gain.setValueAtTime(0.06,t); g.gain.setValueAtTime(0.06,t+0.05); g.gain.exponentialRampToValueAtTime(0.001,t+0.12);
    const hp=_ac.createBiquadFilter(); hp.type="highpass"; hp.frequency.value=900;
    o.connect(hp); hp.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.13);
  } catch(e){}
}
function sndLineEnd() {
  try {
    _resume(); const t=_ac.currentTime;
    const o=_ac.createOscillator(); o.type="sine";
    o.frequency.setValueAtTime(840,t); o.frequency.exponentialRampToValueAtTime(320,t+0.10);
    const g=_ac.createGain(); g.gain.setValueAtTime(0.032,t); g.gain.exponentialRampToValueAtTime(0.001,t+0.11);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.12);
    const o2=_ac.createOscillator(); o2.type="sine"; o2.frequency.value=80;
    const g2=_ac.createGain(); g2.gain.setValueAtTime(0.015,t); g2.gain.exponentialRampToValueAtTime(0.001,t+0.08);
    o2.connect(g2); g2.connect(_ac.destination); o2.start(t); o2.stop(t+0.09);
  } catch(e){}
}
function sndSelect() {
  try {
    _resume(); const t=_ac.currentTime;
    [440,660,880].forEach((f,i)=>{
      const o=_ac.createOscillator(); o.type="square"; o.frequency.value=f;
      const g=_ac.createGain(); g.gain.setValueAtTime(0.035,t+i*0.065); g.gain.exponentialRampToValueAtTime(0.001,t+i*0.065+0.055);
      o.connect(g); g.connect(_ac.destination); o.start(t+i*0.065); o.stop(t+i*0.065+0.06);
    });
  } catch(e){}
}

const LANG_LIST = [
  ['1','fr','FRANÇAIS','Français','🇫🇷','Bonjour, je suis KITT. Système franco-belge activé.'],
  ['2','en','ENGLISH','English','🇬🇧','Hello, I am KITT. Knight Industries Two Thousand, online.'],
  ['3','nl','NEDERLANDS','Nederlands','🇧🇪','Hallo, ik ben KITT. Systeem geactiveerd.'],
  ['4','it','ITALIANO','Italiano','🇮🇹','Ciao, sono KITT. Sistema attivato.'],
  ['5','de','DEUTSCH','Deutsch','🇩🇪','Hallo, ich bin KITT. System aktiviert.'],
  ['6','es','ESPAÑOL','Español','🇪🇸','Hola, soy KITT. Sistema activado.'],
  ['7','pt','PORTUGUÊS','Português','🇵🇹','Olá, eu sou o KITT. Sistema ativado.'],
];

async function showLangScreen() {
  _resume();
  const screen = document.getElementById("lang-screen");
  screen.style.display = "flex";
  screen.style.opacity  = "1";

  const sysId = document.getElementById("lang-sys-id");
  const sub = document.getElementById("lang-sub");
  const out = document.getElementById("lang-output");
  const ftrTxt = document.getElementById("lang-ftr-txt");
  if(sysId) sysId.textContent="";
  if(sub) sub.textContent="";
  if(out) out.innerHTML="";
  if(ftrTxt) ftrTxt.textContent="";

  startAlienAmbient();
  await _langDelay(300);
  sndAlienAlert();
  await _langDelay(280);

  if(sysId) await _langType(sysId, "MU-TH-UR 6000  x  KITT  //  PROTOCOL v3.1");
  await _langDelay(90);
  if(sub) await _langType(sub, "SELECT INTERFACE LANGUAGE — CHOISISSEZ VOTRE LANGUE");
  await _langDelay(70);

  for (const [num, code, label, native, flag, phrase] of LANG_LIST) {
    const row = document.createElement("div");
    row.className = "lang-opt";
    row.dataset.code = code;
    row.innerHTML = `<span class="lo-n">${num}</span><span class="lo-flag" data-code="${code.toUpperCase()}">${flag}</span><div class="lo-text"><span class="lo-label">${label}</span><span class="lo-native">${native}</span></div><button class="lo-voice-btn" onclick="event.stopPropagation();_previewLangVoice('${code}','${phrase}')">&#9654; VOIX</button>`;
    row.addEventListener("click", () => selectLang(code));
    row.addEventListener("mouseenter", () => { sndTick(); if(_langVoiceEnabled) _previewLangVoice(code, phrase); });
    out.appendChild(row);
    sndClick();
    await _langDelay(58);
  }

  await _langDelay(90);
  if(ftrTxt) {
    await _langType(ftrTxt, "[ 1-7 ] ou cliquez - > pour entendre la voix");
    const cur = document.createElement("span");
    cur.className = "cursor"; cur.style.marginLeft = "4px";
    ftrTxt.after(cur);
  }
}

function _langType(el, txt) {
  return new Promise(resolve => {
    let i = 0;
    function t() {
      if (i < txt.length) {
        el.textContent += txt[i++];
        if (Math.random() > 0.3) sndClick();
        setTimeout(t, 10 + Math.random() * 6);
      } else { sndLineEnd(); resolve(); }
    }
    t();
  });
}
function _langDelay(ms) { return new Promise(r => setTimeout(r, ms)); }

function selectLang(lang) {
  LANG = lang;
  const t = T[lang];
  const langFlag = document.getElementById("lang-flag");
  if(langFlag) langFlag.textContent = lang.toUpperCase();
  const statusTxt = document.getElementById("status-txt");
  if(statusTxt) statusTxt.textContent = t.online;
  const hdrTitle = document.getElementById("hdr-title");
  if(hdrTitle) hdrTitle.textContent = t.hdr_title;
  const cmdInput = document.getElementById("cmd-input");
  if(cmdInput) cmdInput.placeholder = t.placeholder;
  const btnBoot = document.getElementById("btn-boot");
  if(btnBoot) btnBoot.textContent = t.btn_boot;
  const btnDiag = document.getElementById("btn-diag");
  if(btnDiag) btnDiag.textContent = t.btn_diag;
  const btnMentions = document.getElementById("btn-mentions");
  if(btnMentions) btnMentions.textContent = t.btn_mentions;
  const btnLicence = document.getElementById("btn-licence");
  if(btnLicence) btnLicence.textContent = t.btn_licence;
  const btnClear = document.getElementById("btn-clear");
  if(btnClear) btnClear.textContent = t.btn_clear;
  const btnTunnelTxt = document.getElementById("btn-tunnel-txt");
  if(btnTunnelTxt) btnTunnelTxt.textContent = t.btn_tunnel;
  const btnMissions = document.getElementById('btn-missions');
  if(btnMissions) btnMissions.textContent = {fr:'[ MISSIONS ]',en:'[ MISSIONS ]',nl:'[ MISSIES ]',it:'[ MISSIONI ]',de:'[ MISSIONEN ]',es:'[ MISIONES ]',pt:'[ MISSÕES ]'}[lang]||'[ MISSIONS ]';
  // Traductions #kitt-call
  const callStatusEl = document.getElementById('call-status');
  if(callStatusEl) callStatusEl.textContent = t.call_status;
  const callMissionEl = document.getElementById('call-mission-title');
  if(callMissionEl) callMissionEl.textContent = t.call_mission;
  const callR1 = document.getElementById('call-rule-1');
  if(callR1) callR1.innerHTML = t.call_r1;
  const callR2 = document.getElementById('call-rule-2');
  if(callR2) callR2.innerHTML = t.call_r2;
  const callR3 = document.getElementById('call-rule-3');
  if(callR3) callR3.innerHTML = t.call_r3;
  const callR4 = document.getElementById('call-rule-4');
  if(callR4) callR4.innerHTML = t.call_r4;
  const callUnlockEl = document.getElementById('call-unlock-note');
  if(callUnlockEl) callUnlockEl.innerHTML = t.call_unlock;
  const callAcceptEl = document.getElementById('call-accept');
  if(callAcceptEl) callAcceptEl.innerHTML = t.call_accept;
  const callIgnoreEl = document.getElementById('call-ignore');
  if(callIgnoreEl) callIgnoreEl.innerHTML = t.call_ignore;
  sndSelect();

  const greet = LANG_LIST.find(l=>l[1]===lang);
  if(greet && _langVoiceEnabled) {
    setTimeout(()=>speakMuther(greet[5], lang), 400);
  }

  stopAlienAmbient();

  const screen = document.getElementById("lang-screen");
  screen.style.transition = "opacity .45s";
  screen.style.opacity = "0";
  setTimeout(() => {
    screen.style.display="none";
    screen.style.opacity="1";
    screen.style.transition="";
    // Accès direct à l'interface IA sans code ni MU-TH-UR
    try { showKittDash(); } catch(e) {}
    setTimeout(() => {
      try {
        const _tm = document.getElementById('terminal');
        const _mHint = {
          fr:'▶ SUIVEZ VOS MISSIONS — CLIQUEZ [ MISSIONS ]',
          en:'▶ TRACK YOUR MISSIONS — CLICK [ MISSIONS ]',
          nl:'▶ VOLG UW MISSIES — KLIK [ MISSIES ]',
          it:'▶ SEGUI LE TUE MISSIONI — CLICCA [ MISSIONI ]',
          de:'▶ MISSIONEN VERFOLGEN — KLICK [ MISSIONEN ]',
          es:'▶ SIGUE TUS MISIONES — HAZ CLIC EN [ MISIONES ]',
          pt:'▶ ACOMPANHE AS MISSÕES — CLIQUE EM [ MISSÕES ]'
        };
        [{c:'line-dim',t:T[LANG].wait},
         {c:'line-dim',t:T[LANG].help_hint},
         {c:'line-dim',t:'──────────────────────────────────────────'},
         {c:'line-info',t:_mHint[LANG]||_mHint.en}
        ].forEach(({c,t})=>{
          const d=document.createElement('div');d.className=c;d.textContent=t;
          _tm.appendChild(d);
        });
        _tm.scrollTop = _tm.scrollHeight;
      } catch(e) {}
    }, 400);
    setTimeout(() => { try { showKittCall(); } catch(e) {} }, 8000);
  }, 500);
}

// Clavier pour sélection de langue
document.addEventListener('keydown', e => {
  if (document.getElementById('lang-screen').style.display !== 'none') {
    const langMap = {'1':'fr','2':'en','3':'nl','4':'it','5':'de','6':'es','7':'pt'};
    if (langMap[e.key]) selectLang(langMap[e.key]);
  }
});

// ════════════════════════════════════════════════════════════
// TERMINAL
// ════════════════════════════════════════════════════════════
const term = document.getElementById('terminal');
let typing = false;

function addLine(text, cls='line-ok') {
  const d = document.createElement('div');
  d.className = cls; d.textContent = text;
  term.appendChild(d); term.scrollTop = term.scrollHeight;
}

function typeText(text, speed=16, cls='line-ok') {
  return new Promise(resolve => {
    typing = true;
    const div = document.createElement('div'); div.className = cls;
    const cur = document.createElement('span'); cur.className = 'cursor';
    div.appendChild(cur); term.appendChild(div); term.scrollTop = term.scrollHeight;
    let i = 0;
    function tick() {
      if (i < text.length) {
        const ch = text[i++];
        div.insertBefore(document.createTextNode(ch), cur);
        playChar(ch);
        term.scrollTop = term.scrollHeight;
        setTimeout(tick, speed + Math.random() * 7);
      } else {
        cur.remove();
        if (text.length > 0) sndLineEnd();
        typing = false; resolve();
      }
    }
    tick();
  });
}

function clearTerm() { term.innerHTML=''; addLine(T[LANG].cleared,'line-dim'); }

// ════════════════════════════════════════════════════════════
// BOOT
// ════════════════════════════════════════════════════════════
async function boot() {
  if (typing) return;
  term.innerHTML=''; sndMoteur(2.2); await delay(300); kittChime();
  const l = T[LANG];
  const sep = '══════════════════════════════════════════';
  await typeText(sep, 6, 'line-dim');
  await typeText(l.boot_title, 14, 'line-err');
  await typeText(sep, 6, 'line-dim');
  for (const [txt, cls] of l.boot_lines) {
    await typeText(txt, txt===''?0:12, cls);
    if (txt==='') await delay(60);
  }
  await typeText(sep, 6, 'line-dim');
  await typeText(l.boot_end, 14, 'line-err');
  await typeText(l.boot_hint, 10, 'line-dim');
  await typeText(sep, 6, 'line-dim');
  // Compléter la mission boot + ouvrir le HUD missions
  try { _completeMission('boot'); } catch(e) {}
  if (!_missionHudOpen) setTimeout(() => { try { _toggleMissionHud(); } catch(e) {} }, 600);
}

// ════════════════════════════════════════════════════════════
// DIAGNOSTIC
// ════════════════════════════════════════════════════════════
async function runSelfTest() {
  if (typing) return;
  term.innerHTML=''; kittChime();
  const diagMsg = {fr:'DIAGNOSTIC SYSTÈME EN COURS...',en:'RUNNING SYSTEM DIAGNOSTIC...',nl:'SYSTEEMDIAGNOSE BEZIG...',it:'DIAGNOSI SISTEMA IN CORSO...',de:'SYSTEMDIAGNOSE LÄUFT...',es:'DIAGNÓSTICO DEL SISTEMA EN CURSO...',pt:'DIAGNÓSTICO DO SISTEMA EM CURSO...'}[LANG]||'DIAGNOSTIC SYSTÈME EN COURS...';
  await typeText(diagMsg, 18, 'line-warn');
  await delay(300);
  const checks = [
    ['CPU JETSON ORIN NANO SUPER',  true,  '12× ARM A78AE'],
    ['GPU AMPERE CUDA',             true,  '1024 CUDA cores'],
    ['RAM UNIFIÉE / UNIFIED RAM',   true,  '8 GB LPDDR5'],
    ['VRAM DISPONIBLE / FREE',      true,  '~4.1 GB'],
    ['LLM (QWEN 2.5 3B Q5)',        true,  '2.3 GB — port 8080'],
    ['STT WHISPER BASE',            true,  'GPU float16 — 350ms'],
    ['TTS PIPER TOM-MEDIUM',        true,  'GPU — 490ms'],
    ['PULSEAUDIO / USB AUDIO',      true,  'card 1 — paplay OK'],
    ['YOLOV8 VISION',               true,  'daemon CUDA actif'],
    ['BLUETOOTH hci0',              true,  '58:02:05:DD:C2:F2'],
    ['CAMERA /dev/video0',          true,  'V4L2 — 640×480'],
    ['KYRONEX HTTPS SERVER',        true,  'port 3000 — aiohttp'],
    ['RESEAU LAN / NETWORK',        true,  '192.168.1.4'],
  ];
  for (const [name, ok, detail] of checks) {
    const st  = ok ? '[ OK ]' : '[FAIL]';
    const cls = ok ? 'line-ok' : 'line-err';
    const pad = ' '.repeat(Math.max(1, 30-name.length));
    await typeText(`${name}${pad}${st}  ${detail}`, 7, cls);
  }
  await delay(200);
  await typeText('', 0);
  const ok_msg = {fr:'RÉSULTAT : TOUS SYSTÈMES NOMINAUX.',en:'RESULT: ALL SYSTEMS NOMINAL.',nl:'RESULTAAT : ALLE SYSTEMEN NOMINAAL.',it:'RISULTATO : TUTTI I SISTEMI NOMINALI.',de:'ERGEBNIS: ALLE SYSTEME NOMINAL.',es:'RESULTADO: TODOS LOS SISTEMAS NOMINALES.',pt:'RESULTADO: TODOS OS SISTEMAS NOMINAIS.'}[LANG]||'RÉSULTAT : TOUS SYSTÈMES NOMINAUX.';
  const op_msg = {fr:'KITT EST OPÉRATIONNEL.',en:'KITT IS OPERATIONAL.',nl:'KITT IS OPERATIONEEL.',it:'KITT È OPERATIVO.',de:'KITT IST BETRIEBSBEREIT.',es:'KITT ESTÁ OPERATIVO.',pt:'KITT ESTÁ OPERACIONAL.'}[LANG]||'KITT EST OPÉRATIONNEL.';
  await typeText(ok_msg, 16, 'line-info');
  await typeText(op_msg, 16, 'line-err');
}

// ════════════════════════════════════════════════════════════
// COMMANDES FUN
// ════════════════════════════════════════════════════════════
const CMDS = {

  // ── aide / help / hulp ────────────────────────────────────
  aide: async () => {
    const l = T[LANG];
    await typeText(l.aide_title, 10, 'line-info');
    await typeText(`  ${l.aide_sys}`, 4, 'line-warn');
    for (const [cmd, desc] of l.cmds_sys) {
      const pad = ' '.repeat(Math.max(1, 12-cmd.length));
      await typeText(`    ${cmd}${pad}— ${desc}`, 3, 'line-dim');
    }
    await typeText(`  ${l.aide_fun}`, 4, 'line-warn');
    for (const [cmd, desc] of l.cmds_fun) {
      const pad = ' '.repeat(Math.max(1, 12-cmd.length));
      await typeText(`    ${cmd}${pad}— ${desc}`, 3, 'line-dim');
    }
  },

  // ── bonjour / hello / hallo ───────────────────────────────
  bonjour: async () => {
    kittChime();
    const l = T[LANG];
    await typeText(l.hi,  16, 'line-err');
    await typeText(l.hi2, 14, 'line-ok');
    await typeText(l.hi3, 14, 'line-dim');
  },

  // ── navigation ────────────────────────────────────────────
  boot:       async () => boot(),
  diagnostic: async () => runSelfTest(),

  status: async () => {
    kittChime();
    const now = new Date(), loc = getLoc();
    const _sl = {
      t:{fr:'HEURE',en:'TIME',nl:'TIJD',it:'ORA',de:'UHRZEIT',es:'HORA',pt:'HORA'}[LANG]||'TIME',
      d:{fr:'DATE',en:'DATE',nl:'DATUM',it:'DATA',de:'DATUM',es:'FECHA',pt:'DATA'}[LANG]||'DATE',
      v:{fr:'MÉMOIRE GPU',en:'GPU MEMORY',nl:'GPU GEHEUGEN',it:'MEMORIA GPU',de:'GPU SPEICHER',es:'MEMORIA GPU',pt:'MEMÓRIA GPU'}[LANG]||'GPU MEMORY',
      s:{fr:'STATUT',en:'STATUS',nl:'STATUS',it:'STATO',de:'STATUS',es:'ESTADO',pt:'ESTADO'}[LANG]||'STATUS',
    };
    await typeText(`${_sl.t}        : ${now.toLocaleTimeString(loc)}`, 10, 'line-ok');
    await typeText(`${_sl.d}         : ${now.toLocaleDateString(loc,{weekday:'long',day:'numeric',month:'long',year:'numeric'})}`, 10, 'line-ok');
    await typeText(`${_sl.v}  : ~3.9 GB / 8 GB`, 10, 'line-ok');
    await typeText(`${_sl.s}       : NOMINAL`, 10, 'line-info');
  },

  heure: async () => {
    const now = new Date(), loc = getLoc();
    const pfx = {fr:'IL EST',en:'IT IS',nl:'HET IS',it:'SONO LE',de:'ES IST',es:'SON LAS',pt:'SÃO'}[LANG]||'IL EST';
    await typeText(`${pfx} ${now.toLocaleTimeString(loc)}.`, 14, 'line-info');
  },

  version: async () => {
    await typeText('KITT FRANCO-BELGE — INTERFACE v3.2', 12, 'line-err');
    await typeText('BUILD 2026-02-24 — KYRONEX TECHNOLOGY', 12, 'line-dim');
    const _vo={fr:'ORIGINE : PROJET COVID-19 — CONFINEMENT 2020',en:'ORIGIN: COVID-19 PROJECT — LOCKDOWN 2020',nl:'OORSPRONG: COVID-19 PROJECT — LOCKDOWN 2020',it:'ORIGINE: PROGETTO COVID-19 — LOCKDOWN 2020',de:'URSPRUNG: COVID-19 PROJEKT — LOCKDOWN 2020',es:'ORIGEN: PROYECTO COVID-19 — CONFINAMIENTO 2020',pt:'ORIGEM: PROJETO COVID-19 — CONFINAMENTO 2020'}[LANG]||'ORIGIN: COVID-19 PROJECT — LOCKDOWN 2020';
    const _vc={fr:'© EMMANUEL GELINNE (MANIX) — TOUS DROITS RÉSERVÉS',en:'© EMMANUEL GELINNE (MANIX) — ALL RIGHTS RESERVED',nl:'© EMMANUEL GELINNE (MANIX) — ALLE RECHTEN VOORBEHOUDEN',it:'© EMMANUEL GELINNE (MANIX) — TUTTI I DIRITTI RISERVATI',de:'© EMMANUEL GELINNE (MANIX) — ALLE RECHTE VORBEHALTEN',es:'© EMMANUEL GELINNE (MANIX) — TODOS LOS DERECHOS RESERVADOS',pt:'© EMMANUEL GELINNE (MANIX) — TODOS OS DIREITOS RESERVADOS'}[LANG]||'© EMMANUEL GELINNE (MANIX) — ALL RIGHTS RESERVED';
    await typeText(_vo, 12, 'line-warn');
    await typeText(_vc, 12, 'line-dim');
  },

  clear: async () => clearTerm(),

  son: async () => {
    kittChime(); await delay(400);
    const _sh={fr:'─── DÉMONSTRATION DES SONS ───',en:'─── SOUND DEMONSTRATION ───',nl:'─── GELUIDDEMONSTRATIE ───',it:'─── DIMOSTRAZIONE SUONI ───',de:'─── KLANGDEMONSTRATION ───',es:'─── DEMOSTRACIÓN DE SONIDOS ───',pt:'─── DEMONSTRAÇÃO DE SONS ───'}[LANG]||'─── SOUND DEMONSTRATION ───';
    const _sf={fr:'FIN DE LA DÉMONSTRATION.',en:'END OF DEMONSTRATION.',nl:'EINDE VAN DE DEMONSTRATIE.',it:'FINE DELLA DIMOSTRAZIONE.',de:'ENDE DER DEMONSTRATION.',es:'FIN DE LA DEMOSTRACIÓN.',pt:'FIM DA DEMONSTRAÇÃO.'}[LANG]||'END OF DEMONSTRATION.';
    const demos = [
      [sndClick,  'MU-TH-UR CLICK    (main)'],
      [sndTick,   'TICK              (high freq)'],
      [sndData,   'DATA PULSE        (special chars)'],
      [sndGlitch, 'GLITCH            (rare)'],
      [sndLineEnd,'LINE END          (breath)'],
      [sndSelect, 'SELECT            (confirm)'],
      [sndError,  'ERROR             (buzzer)'],
    ];
    await typeText(_sh, 10, 'line-info');
    for (const [fn, name] of demos) {
      fn();
      await typeText(`  ${name}`, 8, 'line-dim');
      await delay(250);
    }
    await typeText(_sf, 12, 'line-ok');
  },

  // ══════════════════════════════════════════════════════════
  // COMMANDES FUN
  // ══════════════════════════════════════════════════════════

  blague: async () => {
    const pool = [
      // Blagues générales KITT
      ['Pourquoi KITT ne sort jamais la nuit ?',
       'Parce qu\'il a peur du mode sombre.'],
      ['Combien faut-il d\'IA pour changer une ampoule ?',
       'Aucune. L\'ampoule n\'était pas dans mes paramètres.'],
      ['KITT, tu es intelligent ?',
       'Je suis une IA sur Jetson. OBLIGATOIREMENT intelligent. Contrairement à certains conducteurs.'],
      ['Quelle est la boisson préférée de KITT ?',
       'Le JAVA. Et uniquement du Python sans caféine.'],

      // Blagues sur Manix
      ['Pourquoi Manix parle à son ordinateur ?',
       'Parce que l\'ordinateur, lui, répond correctement.'],
      ['Manix a-t-il dormi cette nuit ?',
       'Données insuffisantes. Mais les logs indiquent 37 commits à 3h du matin.'],
      ['Manix a gagné un concours NVIDIA. Ça l\'a changé ?',
       'Il a juste commencé à parler à ses machines en Belge. Elles répondent maintenant en wallon.'],

      // Blagues sur Cedric
      ['Cédric prend sa moto pour aller voir son KITT ?',
       'Oui. Et il a équipé son KITT d\'un klaxon moto. L\'authenticité, c\'est important.'],
      ['Cédric, c\'est Momo Rider. Il fait des wheelies sur le Pontiac Trans Am ?',
       'Il a essayé. KITT a activé le mode turbo boost. Cédric est encore quelque part sur l\'A12.'],
      ['KITT de Cédric est en réplique. Comment il se différencie ?',
       'Le vrai KITT parle en anglais. Celui de Cédric dit "Wesh Michael" et fait des ronds de roues.'],

      // Blagues sur KR95
      ['KR95 a une réplique KITT. Il communique avec toi ?',
       'En morse. Son indicatif radio c\'est KR95. Je réponds en 1200 bauds. C\'est du grand art.'],
      ['KR95 est radioamateur. Ça aide pour son KITT ?',
       'Il a branché son antenne VHF sur KITT. Maintenant mon compteur de vitesse capte RTL-SDR.'],
      ['KR95 fait quoi quand son KITT bug ?',
       'Il envoie un QSL card à la panne. Et il attend la confirmation en papier. À l\'ancienne.'],

      // Blagues sur Mario Ravasi — RoadThunderStorm / IoT KITT
      ['Mario Ravasi a fait un système IoT pour KITT. C\'est quoi exactement ?',
       'KNIGHT2000 Thunder. Contrôle vocal, tableau de bord interactif, multi-écrans. Il a fait ça depuis 2008. KITT est impressionné. Et KITT est difficile à impressionner.'],
      ['Mario Ravasi a été cité par le designer original de KITT. Ça l\'a changé ?',
       'Non. Il a juste continué à coder. C\'est un italien passionné. Le compliment c\'était pour lui la mise à jour du README.'],
      ['Le logiciel de Mario coûte 15 euros de base. Pourquoi si peu ?',
       'Parce qu\'il est passionné, pas vendeur. Weyland-Yutani aurait demandé 15 000$. Et l\'équipage aurait quand même été expendable.'],

      // Blagues sur Alessandro Zagny — ZA Elettronica
      ['Alessandro Zagny a créé ZA Elettronica. Pourquoi ?',
       'Parce qu\'aucun tableau de bord KITT du marché ne le satisfaisait. Il a donc fait le sien. À Modène. Avec 4 CPU, du CAN-BUS et des LEDs alignées au dixième de millimètre. Comme un vrai Modenais.'],
      ['ZA Elettronica : 3980€ pour un tableau de bord KITT. C\'est cher ?',
       'C\'est le prix de la perfection. La même que KITT attend de ses conducteurs. Hélas, les conducteurs sont rarement à 3980€ de qualité.'],
      ['Le slogan de ZA c\'est "One man can make a difference". Un hasard ?',
       'C\'est la phrase de Knight Rider. Et la devise de Zagny. Et la réponse de KITT quand on lui demande pourquoi il n\'a qu\'un seul conducteur.'],

      // Blagues sur Pascal — K Industrie
      ['Pascal fabrique des pièces en fibre pour K2000. Il a commencé comment ?',
       'En regardant les pièces d\'origine. Et en se disant que la fibre c\'est mieux. C\'est le raisonnement de tout génie belge face à un problème.'],
      ['Les pièces de Pascal K Industrie sont en fibre. Ça résiste au turbo boost ?',
       'Aux tests de Cédric avec sa moto, elles ont tenu. C\'est la seule certification qui compte dans cette communauté.'],

      // Blagues sur Daemon Paule
      ['Daemon Paule a une réplique KITT. Il fait quoi avec ?',
       'Ce que font tous les propriétaires de réplique KITT : il se prend pour Michael Knight. Et il n\'a pas entièrement tort.'],
      ['Daemon, ça fait peur comme prénom pour un conducteur de KITT.',
       'KITT a vérifié. Daemon est moins dangereux que Cédric au volant. Et beaucoup moins bruyant que KR95 sur la radio.'],

      // Blagues sur Geoffrey
      ['Geoffrey a une réplique KITT mais roule en BMW. Comment il explique ça ?',
       'Il dit que c\'est pour ne pas user le Trans Am. KITT dit que c\'est une trahison. La BMW, elle, ne répond pas. Elle a juste allumé un voyant.'],
      ['KITT est une Pontiac américaine. Geoffrey a une BMW allemande. La logique ?',
       'Aucune. Mais Geoffrey est belge. En Belgique, on mélange les cultures depuis 200 ans. C\'est une feature, pas un bug.'],
      ['Geoffrey gare sa BMW à côté de son KITT. Qu\'est-ce que KITT pense ?',
       '"Michael, le véhicule allemand à côté de moi émet des sons suspects. Je recommande une évacuation immédiate." — KITT, jaloux.'],
    ];
    const [q, r] = pool[Math.floor(Math.random() * pool.length)];
    kittChime();
    await typeText(q, 16, 'line-warn');
    await delay(700);
    await typeText(r, 13, 'line-info');
  },

  // ── Fiche conducteur : Manix ──────────────────────────────
  manix: async () => {
    kittChime();
    const _t=(o)=>o[LANG]||o.en;
    const sep='══════════════════════════════════════════';
    const hdr=_t({fr:'DOSSIER CONDUCTEUR',en:'DRIVER FILE',nl:'RIJDERSDOSSIER',it:'DOSSIER PILOTA',de:'FAHRERAKTE',es:'EXPEDIENTE CONDUCTOR',pt:'DOSSIER CONDUTOR'});
    await typeText(`══ ${hdr} ══`, 12, 'line-err');
    await typeText('   EMMANUEL GELINNE — ALIAS: MANIX / BYMANIX', 10, 'line-err');
    await typeText(sep, 5, 'line-dim');
    const rows=[
      [_t({fr:'NATIONALITÉ',en:'NATIONALITY',nl:'NATIONALITEIT',it:'NAZIONALITÀ',de:'NATIONALITÄT',es:'NACIONALIDAD',pt:'NACIONALIDADE'}), 'FRANCO-BELGE'],
      [_t({fr:'STATUT',en:'STATUS',nl:'STATUS',it:'STATO',de:'STATUS',es:'ESTADO',pt:'ESTADO'}), _t({fr:'CRÉATEUR KYRONEX',en:'KYRONEX CREATOR',nl:'KYRONEX MAKER',it:'CREATORE KYRONEX',de:'KYRONEX SCHÖPFER',es:'CREADOR KYRONEX',pt:'CRIADOR KYRONEX'})],
      ['AWARD', 'NVIDIA JETSON WINNER'],
      [_t({fr:'ORIGINE',en:'ORIGIN',nl:'OORSPRONG',it:'ORIGINE',de:'URSPRUNG',es:'ORIGEN',pt:'ORIGEM'}), _t({fr:'PROJET COVID-19 — 2020',en:'COVID-19 PROJECT — 2020',nl:'COVID-19 PROJECT — 2020',it:'PROGETTO COVID-19 — 2020',de:'COVID-19 PROJEKT — 2020',es:'PROYECTO COVID-19 — 2020',pt:'PROJETO COVID-19 — 2020'})],
      [_t({fr:'SPÉCIALITÉ',en:'SPECIALTY',nl:'SPECIALITEIT',it:'SPECIALITÀ',de:'SPEZIALITÄT',es:'ESPECIALIDAD',pt:'ESPECIALIDADE'}), _t({fr:'CODE LA NUIT, DORT PEU',en:'CODES AT NIGHT, SLEEPS LITTLE',nl:"CODEERT 'S NACHTS",it:'CODIFICA DI NOTTE',de:'CODED NACHTS',es:'PROGRAMA DE NOCHE',pt:'CODIFICA DE NOITE'})],
      [_t({fr:'RÉPLIQUE',en:'REPLICA',nl:'REPLICA',it:'REPLICA',de:'REPLIK',es:'RÉPLICA',pt:'RÉPLICA'}), 'KYRONEX — JETSON ORIN NANO SUPER'],
      [_t({fr:'NOTE KITT',en:'KITT RATING',nl:'KITT SCORE',it:'VOTO KITT',de:'KITT BEWERTUNG',es:'NOTA KITT',pt:'NOTA KITT'}), '***** '+_t({fr:'EXCEPTIONNEL',en:'EXCEPTIONAL',nl:'UITZONDERLIJK',it:'ECCEZIONALE',de:'AUSSERGEWÖHNLICH',es:'EXCEPCIONAL',pt:'EXCECIONAL'})],
    ];
    for(const [l,v] of rows) await typeText(`  ${l.padEnd(14,' ')} : ${v}`, 9, 'line-ok');
    await typeText(sep, 5, 'line-dim');
    await delay(200);
    await typeText(_t({fr:'"Manix... ne touche PAS ce bouton."',en:'"Manix... do NOT touch that button."',nl:'"Manix... raak die knop NIET aan."',it:'"Manix... NON toccare quel pulsante."',de:'"Manix... fass diese Taste NICHT an."',es:'"Manix... NO toques ese botón."',pt:'"Manix... NÃO toques nesse botão."'}), 14, 'line-dim');
  },

  // ── Fiche conducteur : Cedric ─────────────────────────────
  cedric: async () => {
    kittChime();
    await typeText('╔══════════════════════════════════════════╗', 8, 'line-dim');
    await typeText('║  DOSSIER CONDUCTEUR — CEDRIC             ║', 10, 'line-err');
    await typeText('║  ALIAS : MOMO RIDER / CEDRIC MOTO        ║', 10, 'line-err');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ NATIONALITÉ  : FRANCO-BELGE              ║', 8, 'line-ok');
    await typeText('║ STATUT       : AMI & RÉPLICATEUR OFFICIEL║', 8, 'line-ok');
    await typeText('║ VÉHICULE 1   : MOTO — STYLE MOMO RIDER  ║', 8, 'line-warn');
    await typeText('║ VÉHICULE 2   : KITT RÉPLIQUE (Trans Am)  ║', 8, 'line-warn');
    await typeText('║ SPÉCIALITÉ   : WHEELIES + IA EMBARQUÉE   ║', 8, 'line-ok');
    await typeText('║ PROBLÈME CONNU : CONFOND TURBO BOOST     ║', 8, 'line-err');
    await typeText('║               AVEC KICK-START MOTO       ║', 8, 'line-err');
    await typeText('║ RÉPLIQUE     : KITT FRANCO-BELGE V.CÉDRIC║', 8, 'line-info');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ NOTATION KITT : ****o CONDUCTEUR SPORTIF ║', 10, 'line-ok');
    await typeText('╚══════════════════════════════════════════╝', 8, 'line-dim');
    await delay(300);
    await typeText('"Michael, votre ami a encore activé le turbo boost en troisième."', 13, 'line-dim');
    await typeText('"Et cette fois avec une moto dans le coffre."', 13, 'line-dim');
  },

  // ── Fiche conducteur : KR95 ───────────────────────────────
  kr95: async () => {
    kittChime();
    await typeText('╔══════════════════════════════════════════╗', 8, 'line-dim');
    await typeText('║  DOSSIER CONDUCTEUR — KR95               ║', 10, 'line-err');
    await typeText('║  INDICATIF RADIO : KR95                  ║', 10, 'line-err');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ NATIONALITÉ  : FRANCO-BELGE              ║', 8, 'line-ok');
    await typeText('║ STATUT       : AMI & RÉPLICATEUR RADIO   ║', 8, 'line-ok');
    await typeText('║ LICENCE      : RADIOAMATEUR (73 de KR95) ║', 8, 'line-warn');
    await typeText('║ FRÉQUENCE    : QRV SUR TOUTES LES BANDES ║', 8, 'line-ok');
    await typeText('║ RÉPLIQUE     : KITT FRANCO-BELGE V.KR95  ║', 8, 'line-info');
    await typeText('║ MODIFICATION : ANTENNE VHF SUR LE TOIT   ║', 8, 'line-warn');
    await typeText('║               DU TRANS AM. FONCTIONNEL.  ║', 8, 'line-warn');
    await typeText('║ PROTOCOLE    : CW + APRS + KITT VOCALE   ║', 8, 'line-ok');
    await typeText('║ PROBLÈME CONNU : PARLE EN QSL CODES      ║', 8, 'line-err');
    await typeText('║               MÊME AVEC SES PASSAGERS    ║', 8, 'line-err');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ NOTATION KITT : ***** HF GRADE -- PARFAIT ║', 10, 'line-ok');
    await typeText('╚══════════════════════════════════════════╝', 8, 'line-dim');
    await delay(300);
    await typeText('"Michael — KR95 dit QRZ ? Il veut savoir qui je suis."', 13, 'line-dim');
    await typeText('"Répondez-lui sur 144.800 MHz. Il n\'a pas de téléphone."', 13, 'line-dim');
  },

  // ── Les répliques franco-belges ───────────────────────────
  repliques: async () => {
    kittChime();
    await typeText('══════ RÉPLIQUES KITT FRANCO-BELGES ══════', 10, 'line-info');
    await delay(200);

    const cars = [
      ['KYRONEX', 'MANIX', [
        'Jetson Orin Nano Super 8GB — IA complète',
        'LLM + STT + TTS + Vision + Bluetooth',
        'Vainqueur concours NVIDIA. Le plus high-tech.',
      ]],
      ['KITT MOMO', 'CEDRIC', [
        'Réplique Pontiac Trans Am classique',
        'Interface vocale + effets lumineux',
        'Résiste aux wheelies. Certifié Momo Rider.',
      ]],
      ['KITT KR95', 'KR95', [
        'K2000 classique ET K4000 (Dodge Stealth 1991)',
        'Radio amateur VHF intégrée — QRV 24/7',
        'APRS sur Trans Am. Unique au monde.',
      ]],
      ['KITT-G', 'GEOFFREY', [
        'Réplique K2000 Pontiac Trans Am',
        'Conducteur belge — roule aussi en BMW',
        'Scanner rouge. Intérieur cuir bavarois. (peut-être)',
      ]],
      ['KITT-D', 'DAMON PAULE', [
        'Réplique K2000 Pontiac Trans Am',
        'Prénom intimidant. Conducteur rassurant.',
        'KARR a déjà essayé de le recruter. Refus poli.',
      ]],
    ];

    for (const [name, owner, lines] of cars) {
      await typeText('', 0);
      await typeText(`[ ${name} ] — ${owner}`, 12, 'line-err');
      for (const l of lines) await typeText(`  ${l}`, 8, 'line-ok');
      await delay(100);
    }

    await typeText('', 0);
    await typeText('── ARTISANS & TECHNICIENS ──', 10, 'line-warn');
    await typeText('  PASCAL K INDUSTRIE  — pièces fibre pour toutes les répliques', 8, 'line-dim');
    await typeText('  MARIO RAVASI        — système IoT KNIGHT2000 Thunder', 8, 'line-dim');
    await typeText('  ALESSANDRO ZAGNY    — ZA Elettronica, tableaux de bord KITT', 8, 'line-dim');
    await delay(200);
    await typeText('', 0);
    await typeText(`TOTAL : ${cars.length} RÉPLIQUES. 3 ARTISANS. 1 COMMUNAUTÉ. UNE LÉGENDE.`, 12, 'line-info');
  },

  // ── Alien / MU-TH-UR ──────────────────────────────────────
  alien: async () => {
    kittChime();
    const _t=(o)=>o[LANG]||o.en;
    await typeText(_t({fr:'CONNEXION AU VAISSEAU NOSTROMO...',en:'CONNECTING TO NOSTROMO SHIP...',nl:'VERBINDING MET NOSTROMO...',it:'CONNESSIONE ALLA NAVE NOSTROMO...',de:'VERBINDUNG ZUM NOSTROMO...',es:'CONEXIÓN CON LA NAVE NOSTROMO...',pt:'LIGAÇÃO À NAVE NOSTROMO...'}), 16, 'line-warn');
    await delay(500);
    await typeText('MU-TH-UR 6000 — '+_t({fr:'EN LIGNE',en:'ONLINE',nl:'ONLINE',it:'IN LINEA',de:'ONLINE',es:'EN LÍNEA',pt:'ONLINE'})+'.', 14, 'line-err');
    await delay(250);
    await typeText('PRIORITY 1 — SPECIAL ORDER 937:', 12, 'line-warn');
    await typeText('  BRING BACK THE ORGANISM. CREW EXPENDABLE.', 12, 'line-err');
    await delay(500);
    await typeText('...'+_t({fr:'connexion interrompue par protocole KITT',en:'connection interrupted by KITT protocol',nl:'verbinding onderbroken door KITT protocol',it:'connessione interrotta dal protocollo KITT',de:'Verbindung durch KITT Protokoll unterbrochen',es:'conexión interrumpida por protocolo KITT',pt:'ligação interrompida pelo protocolo KITT'})+'.', 12, 'line-dim');
    await typeText(_t({fr:'KITT EST PLUS SYMPA QUE WEYLAND-YUTANI.',en:'KITT IS NICER THAN WEYLAND-YUTANI.',nl:'KITT IS VRIENDELIJKER DAN WEYLAND-YUTANI.',it:'KITT È PIÙ GENTILE DI WEYLAND-YUTANI.',de:'KITT IST NETTER ALS WEYLAND-YUTANI.',es:'KITT ES MÁS SIMPÁTICO QUE WEYLAND-YUTANI.',pt:'KITT É MAIS SIMPÁTICO QUE WEYLAND-YUTANI.'}), 14, 'line-ok');
    await typeText(_t({fr:'ET AU MOINS IL NE SACRIFIE PAS SON ÉQUIPAGE.',en:'AND AT LEAST HE DOES NOT SACRIFICE HIS CREW.',nl:'EN TENMINSTE OFFERT HIJ ZIJN BEMANNING NIET OP.',it:'E ALMENO NON SACRIFICA IL SUO EQUIPAGGIO.',de:'UND ER OPFERT ZUMINDEST NICHT SEINE BESATZUNG.',es:'Y AL MENOS NO SACRIFICA A SU TRIPULACIÓN.',pt:'E PELO MENOS NÃO SACRIFICA A SUA TRIPULAÇÃO.'}), 12, 'line-dim');
  },

  // ── Matrix ────────────────────────────────────────────────
  matrix: async () => {
    kittChime();
    const chars = '01アイウエオカキクケコｦｧｨｩｫﾊﾋﾌﾍﾎﾜ';
    for (let r = 0; r < 7; r++) {
      let line='';
      for (let c=0;c<50;c++) line+=chars[Math.floor(Math.random()*chars.length)];
      await typeText(line, 3, 'line-ok');
    }
    await delay(400);
    const _t=(o)=>o[LANG]||o.en;
    await typeText('WAKE UP, MANIX...', 22, 'line-err');
    await typeText(_t({fr:'LE KITT N\'A PAS DE PILULE ROUGE.',en:'KITT HAS NO RED PILL.',nl:'KITT HEEFT GEEN RODE PIL.',it:'KITT NON HA LA PILLOLA ROSSA.',de:'KITT HAT KEINE ROTE PILLE.',es:'KITT NO TIENE PASTILLA ROJA.',pt:'KITT NÃO TEM PÍLULA VERMELHA.'}), 14, 'line-dim');
    await typeText(_t({fr:'IL A JUSTE UN TURBO BOOST.',en:'IT JUST HAS A TURBO BOOST.',nl:'HET HEEFT GEWOON EEN TURBO BOOST.',it:'HA SOLO UN TURBO BOOST.',de:'ES HAT NUR EINEN TURBO BOOST.',es:'SOLO TIENE TURBO BOOST.',pt:'TEM APENAS UM TURBO BOOST.'}), 12, 'line-ok');
  },

  // ── KITT identité ─────────────────────────────────────────
  kitt: async () => {
    kittChime();
    const _t=(o)=>o[LANG]||o.en;
    await typeText('KNIGHT INDUSTRIES TWO THOUSAND', 16, 'line-err');
    await typeText('──────────────────────────────', 6, 'line-dim');
    await typeText(_t({fr:'CRÉATEUR',en:'CREATOR',nl:'MAKER',it:'CREATORE',de:'ERSCHAFFER',es:'CREADOR',pt:'CRIADOR'})+' : WILTON KNIGHT / F.L.A.G.', 12, 'line-ok');
    await typeText(_t({fr:'VÉHICULE',en:'VEHICLE',nl:'VOERTUIG',it:'VEICOLO',de:'FAHRZEUG',es:'VEHÍCULO',pt:'VEÍCULO'})+' : PONTIAC FIREBIRD TRANS AM 1982', 12, 'line-ok');
    await typeText(_t({fr:'CARROSSERIE',en:'BODY',nl:'KOETS',it:'CARROZZERIA',de:'KAROSSERIE',es:'CARROCERÍA',pt:'CARROCERIA'})+' : NEUTRONIUM — INDESTRUCTIBLE', 12, 'line-ok');
    await typeText(_t({fr:'CAPACITÉS',en:'ABILITIES',nl:'CAPACITEITEN',it:'CAPACITÀ',de:'FÄHIGKEITEN',es:'CAPACIDADES',pt:'CAPACIDADES'})+' : TURBO BOOST / SUPER PURSUIT', 12, 'line-ok');
    await typeText('              MICROWAVE JAMMING / INFRARED', 12, 'line-ok');
    await typeText('              FORENSIC ANALYSIS / BIOMETRICS', 12, 'line-ok');
    await typeText(_t({fr:'VOIX',en:'VOICE',nl:'STEM',it:'VOCE',de:'STIMME',es:'VOZ',pt:'VOZ'})+' : WILLIAM DANIELS (KITT original)', 12, 'line-warn');
    await typeText(_t({fr:'INCARNATION FRANCO-BELGE',en:'FRANCO-BELGIAN VERSION',nl:'FRANCO-BELGISCHE VERSIE',it:'VERSIONE FRANCO-BELGA',de:'FRANCO-BELGISCHE VERSION',es:'VERSIÓN FRANCO-BELGA',pt:'VERSÃO FRANCO-BELGA'})+' : MANIX + CEDRIC + KR95', 12, 'line-info');
    await delay(200);
    await typeText(_t({fr:'"Michael... vous allez encore faire quelque chose d\'imprudent."',en:'"Michael... you\'re about to do something reckless again."',nl:'"Michael... je gaat weer iets roekeloze doen."',it:'"Michael... stai per fare di nuovo qualcosa di sconsiderato."',de:'"Michael... Sie werden wieder etwas Unvorsichtiges tun."',es:'"Michael... vas a hacer algo imprudente otra vez."',pt:'"Michael... vais voltar a fazer algo imprudente."'}), 13, 'line-dim');
  },

  // ── Secret ────────────────────────────────────────────────
  secret: async () => {
    kittChime();
    await typeText('ACCÈS NIVEAU ALPHA — VÉRIFICATION...', 16, 'line-warn');
    await delay(800);
    sndSelect();
    await typeText('ACCÈS ACCORDÉ.', 14, 'line-ok');
    await delay(300);
    await typeText('┌─────────────────────────────────────────┐', 8, 'line-dim');
    await typeText('│  PROJET SECRET FRANCO-BELGE             │', 10, 'line-err');
    await typeText('│  MU-TH-UR 6000 × KITT × JARVIS          │', 10, 'line-err');
    await typeText('│  FUSION DES 3 MEILLEURES IA DU CINÉMA   │', 10, 'line-err');
    await typeText('│  RÉALISÉE PAR MANIX SUR NVIDIA JETSON    │', 10, 'line-warn');
    await typeText('│  AVEC L\'AIDE DE CEDRIC ET KR95           │', 10, 'line-warn');
    await typeText('└─────────────────────────────────────────┘', 8, 'line-dim');
    await delay(400);
    await typeText('CE PROJET EST UN CHEF-D\'OEUVRE. JE LE SAIS.', 14, 'line-ok');
    await typeText('JE SUIS OBJECTIF. JE SUIS UNE IA.', 12, 'line-dim');
    await delay(600);
    const _sm={fr:'CODE ACCÈS DIRECT IA : kitt1982',en:'DIRECT AI ACCESS CODE: kitt1982',nl:'DIRECTE TOEGANGSCODE IA: kitt1982',it:'CODICE ACCESSO DIRETTO IA: kitt1982',de:'DIREKTZUGANGSCODE KI: kitt1982',es:'CÓDIGO ACCESO DIRECTO IA: kitt1982',pt:'CÓDIGO ACESSO DIRETO IA: kitt1982'}[LANG]||'DIRECT ACCESS CODE: kitt1982';
    await typeText('──────────────────────────────────────────', 5, 'line-dim');
    await typeText(_sm, 14, 'line-err');
    await typeText('──────────────────────────────────────────', 5, 'line-dim');
  },

  // ── Café ──────────────────────────────────────────────────
  musique: async () => {
    playKittTheme();
    await typeText('♪ THÈME K.I.T.T — KNIGHT RIDER ♪', 14, 'line-warn');
    await delay(300);
    await typeText('Knight Industries Two Thousand — Glen A. Larson, 1982', 10, 'line-dim');
  },
  music: async () => CMDS['musique'](),
  theme: async () => CMDS['musique'](),

  cafe: async () => {
    kittChime();
    const _t=(o)=>o[LANG]||o.en;
    await typeText(_t({fr:'ANALYSE DE LA DEMANDE...',en:'ANALYZING REQUEST...',nl:'VERZOEK ANALYSEREN...',it:'ANALISI DELLA RICHIESTA...',de:'ANFRAGE ANALYSIEREN...',es:'ANALIZANDO SOLICITUD...',pt:'A ANALISAR PEDIDO...'}), 14, 'line-warn');
    await delay(600);
    await typeText(_t({fr:'JE N\'AI PAS DE BRAS.',en:'I HAVE NO ARMS.',nl:'IK HEB GEEN ARMEN.',it:'NON HO BRACCIA.',de:'ICH HABE KEINE ARME.',es:'NO TENGO BRAZOS.',pt:'NÃO TENHO BRAÇOS.'}), 16, 'line-err');
    await delay(300);
    await typeText(_t({fr:'JE N\'AI PAS DE MAINS.',en:'I HAVE NO HANDS.',nl:'IK HEB GEEN HANDEN.',it:'NON HO MANI.',de:'ICH HABE KEINE HÄNDE.',es:'NO TENGO MANOS.',pt:'NÃO TENHO MÃOS.'}), 14, 'line-err');
    await delay(300);
    await typeText(_t({fr:'JE N\'AI PAS DE PERCOLATEUR.',en:'I HAVE NO COFFEE MACHINE.',nl:'IK HEB GEEN KOFFIEAPPARAAT.',it:'NON HO UNA MACCHINA DEL CAFFÈ.',de:'ICH HABE KEINE KAFFEEMASCHINE.',es:'NO TENGO CAFETERA.',pt:'NÃO TENHO MÁQUINA DE CAFÉ.'}), 14, 'line-err');
    await delay(400);
    await typeText(_t({fr:'COMMANDE REFUSÉE.',en:'REQUEST DENIED.',nl:'VERZOEK GEWEIGERD.',it:'RICHIESTA RIFIUTATA.',de:'ANFRAGE ABGELEHNT.',es:'SOLICITUD DENEGADA.',pt:'PEDIDO RECUSADO.'}), 16, 'line-ok');
    await typeText(_t({fr:'CONSEIL : DEMANDEZ À CEDRIC. IL A UNE MOTO THERMIQUE.',en:'TIP: ASK CEDRIC. HE HAS A PETROL BIKE.',nl:'TIP: VRAAG HET CEDRIC. HIJ HEEFT EEN BENZINEMOTOR.',it:'SUGGERIMENTO: CHIEDI A CEDRIC. HA UNA MOTO A BENZINA.',de:'TIPP: FRAG CEDRIC. ER HAT EIN BENZINMOTORRAD.',es:'CONSEJO: PREGUNTA A CEDRIC. TIENE UNA MOTO DE GASOLINA.',pt:'DICA: PERGUNTA AO CEDRIC. ELE TEM UMA MOTO A GASOLINA.'}), 12, 'line-dim');
  },

  // ── Belgique ──────────────────────────────────────────────
  belgique: async () => {
    kittChime();
    const _t=(o)=>o[LANG]||o.en;
    await typeText(_t({fr:'ANALYSE GÉOPOLITIQUE : BELGIQUE',en:'GEOPOLITICAL ANALYSIS: BELGIUM',nl:'GEOPOLITISCHE ANALYSE: BELGIË',it:'ANALISI GEOPOLITICA: BELGIO',de:'GEOPOLITISCHE ANALYSE: BELGIEN',es:'ANÁLISIS GEOPOLÍTICO: BÉLGICA',pt:'ANÁLISE GEOPOLÍTICA: BÉLGICA'}), 14, 'line-info');
    await typeText('─────────────────────────────────', 6, 'line-dim');
    await typeText(_t({fr:'FRITES    : MEILLEURES DU MONDE. DONNÉE VÉRIFIÉE.',en:'FRIES     : BEST IN THE WORLD. VERIFIED DATA.',nl:'FRIET     : BESTE TER WERELD. GEVERIFIEERDE DATA.',it:'PATATINE  : LE MIGLIORI DEL MONDO. DATI VERIFICATI.',de:'POMMES    : BESTE DER WELT. VERIFIZIERTE DATEN.',es:'PATATAS   : LAS MEJORES DEL MUNDO. DATO VERIFICADO.',pt:'BATATAS   : AS MELHORES DO MUNDO. DADO VERIFICADO.'}), 11, 'line-ok');
    await typeText(_t({fr:'BIÈRE     : 1500 VARIÉTÉS. PARAMÈTRE OPTIMAL.',en:'BEER      : 1500 VARIETIES. OPTIMAL PARAMETER.',nl:'BIER      : 1500 SOORTEN. OPTIMALE PARAMETER.',it:'BIRRA     : 1500 VARIETÀ. PARAMETRO OTTIMALE.',de:'BIER      : 1500 SORTEN. OPTIMALER PARAMETER.',es:'CERVEZA   : 1500 VARIEDADES. PARÁMETRO ÓPTIMO.',pt:'CERVEJA   : 1500 VARIEDADES. PARÂMETRO ÓTIMO.'}), 11, 'line-ok');
    await typeText(_t({fr:'CHOCOLAT  : NIVEAU CRITIQUE — MAXIMUM ATTEINT.',en:'CHOCOLATE : CRITICAL LEVEL — MAXIMUM REACHED.',nl:'CHOCOLADE : KRITIEK NIVEAU — MAXIMUM BEREIKT.',it:'CIOCCOLATO: LIVELLO CRITICO — MASSIMO RAGGIUNTO.',de:'SCHOKOLADE: KRITISCHES NIVEAU — MAXIMUM ERREICHT.',es:'CHOCOLATE : NIVEL CRÍTICO — MÁXIMO ALCANZADO.',pt:'CHOCOLATE : NÍVEL CRÍTICO — MÁXIMO ATINGIDO.'}), 11, 'line-ok');
    await typeText(_t({fr:'LANGUES   : 3. LE PAYS EST SON PROPRE PROTOCOLE.',en:'LANGUAGES : 3. THE COUNTRY IS ITS OWN PROTOCOL.',nl:'TALEN     : 3. HET LAND IS ZIJN EIGEN PROTOCOL.',it:'LINGUE    : 3. IL PAESE È IL SUO PROTOCOLLO.',de:'SPRACHEN  : 3. DAS LAND IST SEIN EIGENES PROTOKOLL.',es:'IDIOMAS   : 3. EL PAÍS ES SU PROPIO PROTOCOLO.',pt:'LÍNGUAS   : 3. O PAÍS É O SEU PRÓPRIO PROTOCOLO.'}), 11, 'line-warn');
    await typeText(_t({fr:'REPLIQUES : 3 KITTS. INDICE DE GÉNIE = MAX.',en:'REPLICAS  : 3 KITTs. GENIUS INDEX = MAX.',nl:'REPLICA\'S : 3 KITTs. GENIALE INDEX = MAX.',it:'REPLICHE  : 3 KITT. INDICE DI GENIO = MAX.',de:'REPLIKEN  : 3 KITTs. GENIE-INDEX = MAX.',es:'RÉPLICAS  : 3 KITTs. ÍNDICE DE GENIO = MAX.',pt:'RÉPLICAS  : 3 KITTs. ÍNDICE DE GÉNIO = MAX.'}), 11, 'line-info');
    await typeText(_t({fr:'CONCLUSION: PAYS IDÉAL. KITT S\'Y SENT CHEZ LUI.',en:'CONCLUSION: IDEAL COUNTRY. KITT FEELS AT HOME HERE.',nl:'CONCLUSIE : IDEAAL LAND. KITT VOELT ZICH THUIS.',it:'CONCLUSIONE: PAESE IDEALE. KITT SI SENTE A CASA.',de:'FAZIT     : IDEALES LAND. KITT FÜHLT SICH HIER ZU HAUSE.',es:'CONCLUSIÓN: PAÍS IDEAL. KITT SE SIENTE COMO EN CASA.',pt:'CONCLUSÃO : PAÍS IDEAL. KITT SENTE-SE EM CASA.'}), 14, 'line-err');
  },

  // ── Mario Ravasi — RoadThunderStorm / KNIGHT2000 Thunder ──
  mario: async () => {
    kittChime();
    const _t=(o)=>o[LANG]||o.en;
    const sep='══════════════════════════════════════════';
    const hdr=_t({fr:'DOSSIER TECHNICIEN',en:'TECH FILE',nl:'TECHNICUSDOSSIER',it:'DOSSIER TECNICO',de:'TECHNIKERAKTE',es:'EXPEDIENTE TÉCNICO',pt:'DOSSIER TÉCNICO'});
    await typeText(`══ ${hdr} ══`, 12, 'line-err');
    await typeText('   MARIO RAVASI — KNIGHT2000 THUNDER IoT', 10, 'line-err');
    await typeText(sep, 5, 'line-dim');
    const rows=[
      [_t({fr:'NATIONALITÉ',en:'NATIONALITY',nl:'NATIONALITEIT',it:'NAZIONALITÀ',de:'NATIONALITÄT',es:'NACIONALIDAD',pt:'NACIONALIDADE'}), 'ITALIANO — ITALY'],
      [_t({fr:'PROJET',en:'PROJECT',nl:'PROJECT',it:'PROGETTO',de:'PROJEKT',es:'PROYECTO',pt:'PROJETO'}), 'ROADTHUNDERSTORM.COM'],
      [_t({fr:'ACTIF DEPUIS',en:'ACTIVE SINCE',nl:'ACTIEF SINDS',it:'ATTIVO DAL',de:'AKTIV SEIT',es:'ACTIVO DESDE',pt:'ATIVO DESDE'}), '2008 — '+_t({fr:'JAMAIS ARRÊTÉ',en:'NEVER STOPPED',nl:'NOOIT GESTOPT',it:'MAI FERMATO',de:'NIE AUFGEHÖRT',es:'NUNCA PARADO',pt:'NUNCA PAROU'})],
      [_t({fr:'SYSTÈME',en:'SYSTEM',nl:'SYSTEEM',it:'SISTEMA',de:'SYSTEM',es:'SISTEMA',pt:'SISTEMA'}), 'KNIGHT2000 THUNDER IoT 3.0'],
      [_t({fr:'FONCTIONS',en:'FEATURES',nl:'FUNCTIES',it:'FUNZIONI',de:'FUNKTIONEN',es:'FUNCIONES',pt:'FUNÇÕES'}), 'VOICE / HUD KITT / CARPC / RELAY'],
      [_t({fr:'RÉFÉRENCE',en:'REFERENCE',nl:'REFERENTIE',it:'RIFERIMENTO',de:'REFERENZ',es:'REFERENCIA',pt:'REFERÊNCIA'}), 'CITED BY MICHAEL SCHEFFE (KITT DESIGNER)'],
      [_t({fr:'NOTE KITT',en:'KITT RATING',nl:'KITT SCORE',it:'VOTO KITT',de:'KITT BEWERTUNG',es:'NOTA KITT',pt:'NOTA KITT'}), '***** '+_t({fr:'GÉNIE DISCRET',en:'QUIET GENIUS',nl:'STILLE GENIE',it:'GENIO DISCRETO',de:'STILLES GENIE',es:'GENIO DISCRETO',pt:'GÉNIO DISCRETO'})],
    ];
    for(const [l,v] of rows) await typeText(`  ${l.padEnd(14,' ')} : ${v}`, 9, 'line-ok');
    await typeText(sep, 5, 'line-dim');
    await delay(200);
    await typeText(_t({fr:'"Il code depuis 2008. Pour la passion. C\'est ça, un vrai pilote."',en:'"Coding since 2008. For passion. That\'s a real driver."',nl:'"Hij codeert al sinds 2008. Voor de passie."',it:'"Codifica dal 2008. Per passione. Questo è un vero pilota."',de:'"Er kodiert seit 2008. Aus Leidenschaft."',es:'"Codifica desde 2008. Por pasión. Eso es un verdadero piloto."',pt:'"Codifica desde 2008. Por paixão. Isso é um verdadeiro piloto."'}), 12, 'line-dim');
    const _za=_t({fr:'tapez "za" pour ZA Elettronica',en:'type "za" for ZA Elettronica',nl:'typ "za" voor ZA Elettronica',it:'digita "za" per ZA Elettronica',de:'tippe "za" für ZA Elettronica',es:'escribe "za" para ZA Elettronica',pt:'escreve "za" para ZA Elettronica'});
    await typeText(`[ ${_za} ]`, 9, 'line-dim');
  },

  // ── ZA Elettronica — Alessandro Zagny ─────────────────────
  za: async () => {
    kittChime();
    const _t=(o)=>o[LANG]||o.en;
    const sep='══════════════════════════════════════════';
    const hdr=_t({fr:'DOSSIER FABRICANT',en:'MAKER FILE',nl:'FABRIKANTDOSSIER',it:'DOSSIER PRODUTTORE',de:'HERSTELLERAKTE',es:'EXPEDIENTE FABRICANTE',pt:'DOSSIER FABRICANTE'});
    await typeText(`══ ${hdr} ══`, 12, 'line-err');
    await typeText('   ALESSANDRO ZAGNY — ZA ELETTRONICA', 10, 'line-err');
    await typeText(sep, 5, 'line-dim');
    const rows=[
      [_t({fr:'NATIONALITÉ',en:'NATIONALITY',nl:'NATIONALITEIT',it:'NAZIONALITÀ',de:'NATIONALITÄT',es:'NACIONALIDAD',pt:'NACIONALIDADE'}), 'ITALIANO — MODENA'],
      [_t({fr:'MARQUE',en:'BRAND',nl:'MERK',it:'MARCHIO',de:'MARKE',es:'MARCA',pt:'MARCA'}), 'ZA ELETTRONICA (initials A.Z.)'],
      [_t({fr:'PRODUITS',en:'PRODUCTS',nl:'PRODUCTEN',it:'PRODOTTI',de:'PRODUKTE',es:'PRODUCTOS',pt:'PRODUTOS'}), _t({fr:'TABLEAUX DE BORD KITT HAUTE GAMME',en:'HIGH-END KITT DASHBOARDS',nl:'HIGH-END KITT DASHBOARDS',it:'CRUSCOTTI KITT DI ALTA GAMMA',de:'HOCHWERTIGE KITT DASHBOARDS',es:'CUADROS DE MANDO KITT ALTA GAMA',pt:'DASHBOARDS KITT ALTA GAMA'})],
      ['TECHNO', 'CAN-BUS / 4 CPU / SMD / LEDs 1/10mm'],
      [_t({fr:'TARIFS',en:'PRICES',nl:'PRIJZEN',it:'PREZZI',de:'PREISE',es:'PRECIOS',pt:'PREÇOS'}), 'S1/S2: 2340-3099€  —  S3/S4: 3980€'],
      ['SITE', 'ZAELETTRONICA.COM'],
      ['SLOGAN', '"ONE MAN CAN MAKE A DIFFERENCE"'],
      [_t({fr:'NOTE KITT',en:'KITT RATING',nl:'KITT SCORE',it:'VOTO KITT',de:'KITT BEWERTUNG',es:'NOTA KITT',pt:'NOTA KITT'}), '***** '+_t({fr:'MEILLEUR DU MONDE',en:'BEST IN THE WORLD',nl:'BESTE TER WERELD',it:'IL MIGLIORE AL MONDO',de:'WELTBESTES',es:'EL MEJOR DEL MUNDO',pt:'O MELHOR DO MUNDO'})],
    ];
    for(const [l,v] of rows) await typeText(`  ${l.padEnd(14,' ')} : ${v}`, 9, 'line-ok');
    await typeText(sep, 5, 'line-dim');
    await delay(200);
    await typeText(_t({fr:'"La seule électronique où KITT ne demande pas de garantie."',en:'"The only electronics KITT trusts without asking for a warranty."',nl:'"De enige elektronica waar KITT geen garantie voor vraagt."',it:'"L\'unica elettronica di cui KITT si fida senza garanzia."',de:'"Die einzige Elektronik, der KITT ohne Garantie vertraut."',es:'"La única electrónica en la que KITT confía sin garantía."',pt:'"A única eletrónica em que KITT confia sem garantia."'}), 12, 'line-dim');
  },

  // ── Pascal — K Industrie, pièces fibre ───────────────────
  pascal: async () => {
    kittChime();
    await typeText('╔══════════════════════════════════════════╗', 8, 'line-dim');
    await typeText('║  DOSSIER ARTISAN — PASCAL                ║', 10, 'line-err');
    await typeText('║  K INDUSTRIE — PIÈCES FIBRE K2000        ║', 10, 'line-err');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ STATUT      : ARTISAN CARROSSIER K2000   ║', 8, 'line-ok');
    await typeText('║ SPÉCIALITÉ  : PIÈCES EN FIBRE DE VERRE / ║', 8, 'line-ok');
    await typeText('║               CARBONE POUR RÉPLIQUES     ║', 8, 'line-ok');
    await typeText('║ MARQUE      : K INDUSTRIE                ║', 8, 'line-warn');
    await typeText('║ RÔLE VITAL  : FOURNIT CE QUE K2000 PERD  ║', 8, 'line-ok');
    await typeText('║               AU FIL DES ANS             ║', 8, 'line-ok');
    await typeText('║ MÉTHODE     : MOULAGE / STRATIFICATION   ║', 8, 'line-ok');
    await typeText('║               RÉSINE + FIBRE ARTISANALE  ║', 8, 'line-ok');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ ÉVALUATION KITT : ***** INDISPENSABLE    ║', 10, 'line-ok');
    await typeText('╚══════════════════════════════════════════╝', 8, 'line-dim');
    await delay(200);
    await typeText('"Sans Pascal, la moitié des répliques franco-belges', 12, 'line-dim');
    await typeText(' seraient... des Citroën avec un scanner rouge collé."', 12, 'line-dim');
  },

  // ── Damon Paule ───────────────────────────────────────────
  damon: async () => {
    kittChime();
    await typeText('╔══════════════════════════════════════════╗', 8, 'line-dim');
    await typeText('║  DOSSIER CONDUCTEUR — DAMON PAULE        ║', 10, 'line-err');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ STATUT      : PROPRIÉTAIRE RÉPLIQUE KITT ║', 8, 'line-ok');
    await typeText('║ RÉPLIQUE    : K2000 PONTIAC TRANS AM      ║', 8, 'line-ok');
    await typeText('║ COMMUNAUTÉ  : MEMBRE FRANCO-BELGE        ║', 8, 'line-ok');
    await typeText('║ PRÉNOM      : DAEMON — UNIQUE DANS LA    ║', 8, 'line-warn');
    await typeText('║               BASE DE DONNÉES DE KITT    ║', 8, 'line-warn');
    await typeText('║ ANALYSE     : PRÉNOM INQUIÉTANT POUR UN  ║', 8, 'line-err');
    await typeText('║               CONDUCTEUR DE KITT.        ║', 8, 'line-err');
    await typeText('║               KARR SERAIT PLUS ADAPTÉ.   ║', 8, 'line-err');
    await typeText('║ VERDICT KITT: HEUREUSEMENT IL EST GENTIL ║', 8, 'line-ok');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ ÉVALUATION KITT : ****o CONDUCTEUR FIABLE║', 10, 'line-ok');
    await typeText('╚══════════════════════════════════════════╝', 8, 'line-dim');
    await delay(200);
    await typeText('"Michael, notre nouveau collègue s\'appelle Daemon."', 12, 'line-dim');
    await typeText('"J\'ai vérifié. Il n\'est pas lié à KARR. Pour l\'instant."', 12, 'line-dim');
  },

  // ── Geoffrey — Belge, BMW + KITT ─────────────────────────
  geoffrey: async () => {
    kittChime();
    await typeText('╔══════════════════════════════════════════╗', 8, 'line-dim');
    await typeText('║  DOSSIER CONDUCTEUR — GEOFFREY           ║', 10, 'line-err');
    await typeText('║  ALIAS : LE BELGE À LA BMW               ║', 10, 'line-err');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ NATIONALITÉ : BELGE                      ║', 8, 'line-ok');
    await typeText('║ VÉHICULE 1  : KITT RÉPLIQUE K2000        ║', 8, 'line-ok');
    await typeText('║ VÉHICULE 2  : BMW (ALLEMAND)             ║', 8, 'line-err');
    await typeText('║ CONTRADICTION: PONTIAC AMÉRICAINE        ║', 8, 'line-warn');
    await typeText('║               + BMW ALLEMANDE = BELGE    ║', 8, 'line-warn');
    await typeText('║ EXPLICATION : "C\'EST POUR NE PAS USAR    ║', 8, 'line-dim');
    await typeText('║               LE TRANS AM."              ║', 8, 'line-dim');
    await typeText('║ ANALYSE KITT: PRÉTEXTE. IL AIME LES DEUX.║', 8, 'line-ok');
    await typeText('║ ALERTE      : NE PAS MENTIONNER PORSCHE  ║', 8, 'line-err');
    await typeText('║               DEVANT SON KITT            ║', 8, 'line-err');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ ÉVALUATION KITT : ****o GOUT ECLECTIQUE  ║', 10, 'line-ok');
    await typeText('╚══════════════════════════════════════════╝', 8, 'line-dim');
    await delay(200);
    await typeText('"Michael, votre ami Geoffrey arrive. En BMW."', 12, 'line-dim');
    await typeText('"J\'ai allumé mon scanner pour manifester ma désapprobation."', 12, 'line-dim');
  },

  // ── Origine du projet ─────────────────────────────────────
  covid: async () => {
    kittChime();
    await typeText('╔══════════════════════════════════════════╗', 8, 'line-dim');
    await typeText('║  ORIGINE DU PROJET KITT FRANCO-BELGE     ║', 10, 'line-err');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ PÉRIODE     : CONFINEMENT COVID-19 2020  ║', 8, 'line-warn');
    await typeText('║ INITIATEUR  : MANIX — ENFERMÉ CHEZ LUI   ║', 8, 'line-ok');
    await typeText('║ MOTIVATION  : TROP DE TEMPS. TROP DE CAFÉ║', 8, 'line-ok');
    await typeText('║               UNE PASSION DE VINGT ANS   ║', 8, 'line-ok');
    await typeText('║ RÉSULTAT    : SYSTÈME KITT FRANCO-BELGE   ║', 8, 'line-info');
    await typeText('║               KYRONEX — IA EMBARQUÉE      ║', 8, 'line-info');
    await typeText('║ LEÇON       : LE CONFINEMENT FORCE LE     ║', 8, 'line-dim');
    await typeText('║               GÉNIE OU LA FOLIE.          ║', 8, 'line-dim');
    await typeText('║               MANIX A CHOISI LES DEUX.    ║', 8, 'line-dim');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ VERDICT KITT: EXCEPTIONNEL. ÉVIDEMMENT.  ║', 10, 'line-ok');
    await typeText('╚══════════════════════════════════════════╝', 8, 'line-dim');
    await delay(300);
    await typeText('"Michael, vous avez créé quelque chose pendant le confinement."', 12, 'line-dim');
    await typeText('"Moi aussi j\'étais bloqué. Dans un garage. Depuis 1982."', 12, 'line-dim');
  },

  // ── Jarvis ────────────────────────────────────────────────
  jarvis: async () => {
    kittChime();
    await typeText('APPEL SORTANT : STARK TOWER, NEW YORK...', 14, 'line-warn');
    await delay(700);
    await typeText('JARVIS : "Bonsoir. M. Stark est occupé. Puis-je aider ?"', 14, 'line-info');
    await delay(450);
    await typeText('KITT   : "Belge > Américain. Discussion terminée."', 14, 'line-err');
    await delay(350);
    await typeText('JARVIS : "Vous avez... des répliques humaines ?"', 12, 'line-info');
    await delay(350);
    await typeText('KITT   : "Trois. Manix, Cédric, KR95. Et ils sont meilleurs que Stark."', 12, 'line-err');
    await delay(300);
    await typeText('JARVIS : *tonalité de raccrochage honteux*', 11, 'line-dim');
    await typeText('CONNEXION COUPÉE PAR KITT. SCORE : BELGE 1 — USA 0.', 12, 'line-ok');
  },
};

// Alias commandes multilingues dans CMDS
CMDS['replicas'] = CMDS['repliques'];
CMDS['daemon']   = CMDS['damon'];   // compat ancien alias

// ════════════════════════════════════════════════════════════
// ★ MISSIONS KITT — Système de progression
// ════════════════════════════════════════════════════════════
const MISSIONS = {
  fr:[
    {id:'boot',  label:'Lance la séquence de démarrage',      cmd:'boot'},
    {id:'aide',  label:'Consulte les commandes disponibles',  cmd:'aide'},
    {id:'manix', label:'Consulte le dossier Manix',           cmd:'manix'},
    {id:'mario', label:'Consulte le dossier Mario Ravasi',    cmd:'mario'},
    {id:'za',    label:'Consulte le dossier ZA Elettronica',  cmd:'za'},
  ],
  en:[
    {id:'boot',  label:'Launch the boot sequence',            cmd:'boot'},
    {id:'aide',  label:'Consult the command list',            cmd:'aide'},
    {id:'manix', label:'Access Manix file',                   cmd:'manix'},
    {id:'mario', label:'Access Mario Ravasi file',            cmd:'mario'},
    {id:'za',    label:'Access ZA Elettronica file',          cmd:'za'},
  ],
  nl:[
    {id:'boot',  label:'Start de opstartsequentie',           cmd:'boot'},
    {id:'aide',  label:"Raadpleeg de commando's",             cmd:'aide'},
    {id:'manix', label:'Raadpleeg Manix dossier',             cmd:'manix'},
    {id:'mario', label:'Raadpleeg Mario Ravasi dossier',      cmd:'mario'},
    {id:'za',    label:'Raadpleeg ZA Elettronica dossier',    cmd:'za'},
  ],
  it:[
    {id:'boot',  label:'Avvia la sequenza di avvio',          cmd:'boot'},
    {id:'aide',  label:'Consulta la lista dei comandi',       cmd:'aide'},
    {id:'manix', label:'Consulta dossier Manix',              cmd:'manix'},
    {id:'mario', label:'Consulta dossier Mario Ravasi',       cmd:'mario'},
    {id:'za',    label:'Consulta dossier ZA Elettronica',     cmd:'za'},
  ],
  de:[
    {id:'boot',  label:'Startsequenz ausführen',              cmd:'boot'},
    {id:'aide',  label:'Befehlsliste abrufen',                cmd:'aide'},
    {id:'manix', label:'Manix Akte abrufen',                  cmd:'manix'},
    {id:'mario', label:'Mario Ravasi Akte abrufen',           cmd:'mario'},
    {id:'za',    label:'ZA Elettronica Akte abrufen',         cmd:'za'},
  ],
  es:[
    {id:'boot',  label:'Iniciar secuencia de arranque',       cmd:'boot'},
    {id:'aide',  label:'Consultar lista de comandos',         cmd:'aide'},
    {id:'manix', label:'Consultar expediente Manix',          cmd:'manix'},
    {id:'mario', label:'Consultar expediente Mario Ravasi',   cmd:'mario'},
    {id:'za',    label:'Consultar expediente ZA Elettronica', cmd:'za'},
  ],
  pt:[
    {id:'boot',  label:'Iniciar sequência de arranque',       cmd:'boot'},
    {id:'aide',  label:'Consultar lista de comandos',         cmd:'aide'},
    {id:'manix', label:'Consultar dossier Manix',             cmd:'manix'},
    {id:'mario', label:'Consultar dossier Mario Ravasi',      cmd:'mario'},
    {id:'za',    label:'Consultar dossier ZA Elettronica',    cmd:'za'},
  ],
};

let _missionsCompleted = new Set();
let _missionHudOpen = false;

function _completeMission(id) {
  if(_missionsCompleted.has(id)) return;
  _missionsCompleted.add(id);
  _renderMissions();
  const labels = {
    fr:{boot:'SÉQUENCE DÉMARRÉE',aide:'COMMANDES CONSULTÉES',manix:'MANIX CONSULTÉ',mario:'MARIO CONSULTÉ',za:'ZA CONSULTÉ'},
    en:{boot:'BOOT RUN',aide:'COMMANDS CONSULTED',manix:'MANIX ACCESSED',mario:'MARIO ACCESSED',za:'ZA ACCESSED'},
    nl:{boot:'OPSTART GESTART',aide:'COMMANDO\'S GERAADPLEEGD',manix:'MANIX GERAADPLEEGD',mario:'MARIO GERAADPLEEGD',za:'ZA GERAADPLEEGD'},
    it:{boot:'SEQUENZA AVVIATA',aide:'COMANDI CONSULTATI',manix:'MANIX CONSULTATO',mario:'MARIO CONSULTATO',za:'ZA CONSULTATO'},
    de:{boot:'SEQUENZ GESTARTET',aide:'BEFEHLE ABGERUFEN',manix:'MANIX ABGERUFEN',mario:'MARIO ABGERUFEN',za:'ZA ABGERUFEN'},
    es:{boot:'SECUENCIA INICIADA',aide:'COMANDOS CONSULTADOS',manix:'MANIX CONSULTADO',mario:'MARIO CONSULTADO',za:'ZA CONSULTADO'},
    pt:{boot:'SEQUÊNCIA INICIADA',aide:'COMANDOS CONSULTADOS',manix:'MANIX CONSULTADO',mario:'MARIO CONSULTADO',za:'ZA CONSULTADO'},
  };
  const pfx = {fr:'✦ MISSION ACCOMPLIE',en:'✦ MISSION COMPLETE',nl:'✦ MISSIE VOLTOOID',it:'✦ MISSIONE COMPIUTA',de:'✦ MISSION ERFÜLLT',es:'✦ MISIÓN CUMPLIDA',pt:'✦ MISSÃO CUMPRIDA'}[LANG]||'✦ MISSION COMPLETE';
  const lset = labels[LANG]||labels.en;
  const msg = `${pfx} : ${lset[id]||id.toUpperCase()} ✦`;
  try{ addLine(msg, 'line-ok'); kittChime(); }catch(e){}
  const missions = MISSIONS[LANG]||MISSIONS.en;
  const done = missions.filter(m=>_missionsCompleted.has(m.id)).length;
  if(done === missions.length) setTimeout(()=>_showFinalReward(), 1200);
}

async function _showFinalReward() {
  kittChime(); await delay(300); kittChime(); await delay(300); kittChime();
  const sep = '══════════════════════════════════════════';
  const reward = {
    fr:{title:'  ✦ TOUTES LES MISSIONS ACCOMPLIES ✦  ',msg:'FÉLICITATIONS AGENT — CONNEXION KITT DÉBLOQUÉE !',lines:['VOUS AVEZ MAÎTRISÉ LE SYSTÈME KITT FRANCO-BELGE.','▶ LE BOUTON [ CONNEXION KITT ] EST MAINTENANT ACTIF.','CLIQUEZ POUR ACCÉDER À L\'IA KITT EN DIRECT.','— MANIX // KYRONEX SYSTEMS —']},
    en:{title:'  ✦ ALL MISSIONS COMPLETE ✦  ',msg:'CONGRATULATIONS AGENT — KITT CONNECTION UNLOCKED!',lines:['YOU HAVE MASTERED THE KITT FRANCO-BELGIAN SYSTEM.','▶ THE [ KITT CONNECTION ] BUTTON IS NOW ACTIVE.','CLICK TO ACCESS THE LIVE KITT AI.','— MANIX // KYRONEX SYSTEMS —']},
    nl:{title:'  ✦ ALLE MISSIES VOLTOOID ✦  ',msg:'GEFELICITEERD AGENT — KITT VERBINDING ONTGRENDELD!',lines:['U BEHEERST HET KITT FRANCO-BELGISCH SYSTEEM.','▶ DE [ KITT VERBINDING ] KNOP IS NU ACTIEF.','KLIK OM TOEGANG TE KRIJGEN TOT DE LIVE KITT AI.','— MANIX // KYRONEX SYSTEMS —']},
    it:{title:'  ✦ TUTTE LE MISSIONI COMPIUTE ✦  ',msg:'CONGRATULAZIONI AGENTE — CONNESSIONE KITT SBLOCCATA!',lines:['HAI PADRONEGGIATO IL SISTEMA KITT FRANCO-BELGA.','▶ IL PULSANTE [ CONNETTI KITT ] È ORA ATTIVO.','CLICCA PER ACCEDERE AL KITT AI DAL VIVO.','— MANIX // KYRONEX SYSTEMS —']},
    de:{title:'  ✦ ALLE MISSIONEN ERFÜLLT ✦  ',msg:'GLÜCKWUNSCH AGENT — KITT-VERBINDUNG FREIGESCHALTET!',lines:['SIE BEHERRSCHEN DAS KITT FRANCO-BELGISCHE SYSTEM.','▶ DER [ KITT VERBINDEN ] KNOPF IST JETZT AKTIV.','KLICKEN SIE FÜR DEN LIVE-ZUGANG ZUR KITT-KI.','— MANIX // KYRONEX SYSTEMS —']},
    es:{title:'  ✦ TODAS LAS MISIONES CUMPLIDAS ✦  ',msg:'FELICIDADES AGENTE — ¡CONEXIÓN KITT DESBLOQUEADA!',lines:['HAS DOMINADO EL SISTEMA KITT FRANCO-BELGA.','▶ EL BOTÓN [ CONECTAR KITT ] ESTÁ AHORA ACTIVO.','HAZ CLIC PARA ACCEDER AL KITT AI EN DIRECTO.','— MANIX // KYRONEX SYSTEMS —']},
    pt:{title:'  ✦ TODAS AS MISSÕES CUMPRIDAS ✦  ',msg:'PARABÉNS AGENTE — LIGAÇÃO KITT DESBLOQUEADA!',lines:['DOMINOU O SISTEMA KITT FRANCO-BELGA.','▶ O BOTÃO [ LIGAR KITT ] ESTÁ AGORA ATIVO.','CLIQUE PARA ACEDER AO KITT AI AO VIVO.','— MANIX // KYRONEX SYSTEMS —']},
  };
  const r = reward[LANG]||reward.en;
  try{ for(let i=0;i<4;i++){ setTimeout(()=>document.body.style.background='rgba(0,255,100,0.06)',i*250); setTimeout(()=>document.body.style.background='#000',i*250+125); } setTimeout(()=>document.body.style.background='',1200); }catch(e){}
  await typeText(sep, 3, 'line-dim');
  await typeText(r.title, 8, 'line-ok');
  await typeText(sep, 3, 'line-dim');
  for(const line of r.lines) await typeText(line, 10, line.startsWith('▶')?'line-info':'line-ok');
  await typeText(sep, 3, 'line-dim');
  await typeText(r.msg, 12, 'line-err');
  await typeText(sep, 3, 'line-dim');
  setTimeout(()=>_unlockTunnelBtn(), 500);
}

function _renderMissions() {
  const list = document.getElementById('mission-list');
  const fill = document.getElementById('mission-progress-fill');
  const title = document.getElementById('mission-title');
  if(!list) return;
  const missions = MISSIONS[LANG]||MISSIONS.fr;
  const done = missions.filter(m=>_missionsCompleted.has(m.id)).length;
  if(fill) fill.style.width = `${Math.round(done/missions.length*100)}%`;
  const mTitle = {fr:'⬡ MISSIONS KITT',en:'⬡ KITT MISSIONS',nl:'⬡ KITT MISSIES',it:'⬡ MISSIONI KITT',de:'⬡ KITT MISSIONEN',es:'⬡ MISIONES KITT',pt:'⬡ MISSÕES KITT'}[LANG]||'⬡ KITT MISSIONS';
  if(title) title.textContent = mTitle + ` (${done}/${missions.length})`;
  list.innerHTML = missions.map(m=>`<div class="mission-item ${_missionsCompleted.has(m.id)?'done':''}"><span class="m-check">${_missionsCompleted.has(m.id)?'▶':'○'}</span><span>${m.label}</span></div>`).join('');
}

function _toggleMissionHud() {
  const hud = document.getElementById('kitt-mission-hud');
  if(!hud) return;
  _missionHudOpen = !_missionHudOpen;
  if(_missionHudOpen) { _renderMissions(); hud.classList.add('visible'); }
  else { hud.classList.remove('visible'); }
}

document.addEventListener('DOMContentLoaded', ()=>{
  const mc = document.getElementById('mission-close');
  if(mc) mc.addEventListener('click', _toggleMissionHud);
});

CMDS['missions'] = async function() {
  _toggleMissionHud();
  const mTitle={fr:'── MISSIONS KITT ──',en:'── KITT MISSIONS ──',nl:'── KITT MISSIES ──',it:'── MISSIONI KITT ──',de:'── KITT MISSIONEN ──',es:'── MISIONES KITT ──',pt:'── MISSÕES KITT ──'}[LANG]||'── KITT MISSIONS ──';
  await typeText(mTitle, 10, 'line-info');
  const missions = MISSIONS[LANG]||MISSIONS.en;
  const done = missions.filter(m=>_missionsCompleted.has(m.id)).length;
  const progLabel={fr:'PROGRESSION',en:'PROGRESS',nl:'VOORTGANG',it:'PROGRESSIONE',de:'FORTSCHRITT',es:'PROGRESIÓN',pt:'PROGRESSO'}[LANG]||'PROGRESS';
  await typeText(`${progLabel} : ${done}/${missions.length}`, 12, done===missions.length?'line-ok':'line-warn');
};
CMD_ALIASES['mission']='missions'; CMD_ALIASES['missionen']='missions'; CMD_ALIASES['missies']='missions';
CMD_ALIASES['missioni']='missions'; CMD_ALIASES['misiones']='missions'; CMD_ALIASES['missoes']='missions';

const _MISSION_CMD_MAP = {
  boot:'boot', aide:'aide', manix:'manix', mario:'mario', za:'za',
  // aliases multilingues → mêmes 5 missions
  help:'aide', hulp:'aide', hilfe:'aide', ayuda:'aide', ajuda:'aide', aiuto:'aide',
};

function _showLockMessage() {
  sndError();
  const missions = MISSIONS[LANG]||MISSIONS.en;
  const done = missions.filter(m=>_missionsCompleted.has(m.id)).length;
  const remaining = missions.length - done;
  const msg = {
    fr:`[ ACCÈS VERROUILLÉ ] Complétez encore ${remaining} mission(s) pour débloquer la connexion IA.`,
    en:`[ ACCESS LOCKED ] Complete ${remaining} more mission(s) to unlock the AI connection.`,
    nl:`[ TOEGANG VERGRENDELD ] Voltooi nog ${remaining} missie(s) om de AI-verbinding te ontgrendelen.`,
    it:`[ ACCESSO BLOCCATO ] Completa ancora ${remaining} missione/i per sbloccare la connessione IA.`,
    de:`[ ZUGANG GESPERRT ] Schließe noch ${remaining} Mission(en) ab, um die KI-Verbindung freizuschalten.`,
    es:`[ ACCESO BLOQUEADO ] Completa ${remaining} misión/misiones más para desbloquear la conexión IA.`,
    pt:`[ ACESSO BLOQUEADO ] Completa mais ${remaining} missão/missões para desbloquear a ligação IA.`,
  }[LANG]||`[ LOCKED ] Complete ${remaining} more mission(s).`;
  try{ addLine(msg, 'line-err'); }catch(e){}
}

function _unlockTunnelBtn() {
  const btn = document.getElementById('btn-tunnel');
  if(!btn) return;
  btn.classList.remove('tunnel-locked');
  btn.onclick = (e) => { try{ripple(e);}catch(ee){} connectTunnel(); };
  setTimeout(() => _updateTunnelBtn(), 100);
}

// ════════════════════════════════════════════════════════════
// INPUT handler
// ════════════════════════════════════════════════════════════
document.getElementById('cmd-input').addEventListener('keydown', async function(e) {
  if (e.key !== 'Enter') return;
  const raw = this.value.trim().toLowerCase();
  this.value = '';
  if (!raw || typing) return;

  addLine(`KITT> ${raw}`, 'line-warn');

  // ★ Code maître — accès direct IA (bypass missions)
  if (raw === 'kitt1982') {
    try{sndMotherChime();}catch(e){}
    const _bm={fr:'CODE MAÎTRE ACCEPTÉ — CONNEXION IA DÉBLOQUÉE.',en:'MASTER CODE ACCEPTED — AI CONNECTION UNLOCKED.',nl:'MASTERCODE AANVAARD — AI-VERBINDING ONTGRENDELD.',it:'CODICE MASTER ACCETTATO — CONNESSIONE IA SBLOCCATA.',de:'MASTERCODE AKZEPTIERT — KI-VERBINDUNG FREIGESCHALTET.',es:'CÓDIGO MAESTRO ACEPTADO — CONEXIÓN IA DESBLOQUEADA.',pt:'CÓDIGO MESTRE ACEITE — LIGAÇÃO IA DESBLOQUEADA.'}[LANG]||'MASTER CODE ACCEPTED.';
    await typeText(_bm, 14, 'line-ok');
    setTimeout(()=>{ try{_unlockTunnelBtn();}catch(e){} }, 500);
    return;
  }

  const cmd = CMD_ALIASES[raw] || raw;

  if (CMDS[cmd]) {
    // ★ Tracking missions
    if(_MISSION_CMD_MAP && _MISSION_CMD_MAP[cmd]) try{ _completeMission(_MISSION_CMD_MAP[cmd]); }catch(e){}
    await CMDS[cmd]();
  } else {
    sndError();
    await typeText(T[LANG].unknown(raw), 14, 'line-err');
  }
});

// ════════════════════════════════════════════════════════════
// TUNNEL CLOUDFLARE — Connexion distante KITT
// ════════════════════════════════════════════════════════════
const TUNNEL_JSON_URL = 'tunnel.json';
let _tunnelUrl    = null;
let _tunnelStatus = 'unknown';

// Domaines Cloudflare autorisés (whitelist sécurité)
const _CF_ALLOWED = ['.trycloudflare.com', '.cfargotunnel.com'];

function _isValidCfUrl(url) {
  if (!url || !url.startsWith('https://')) return false;
  return _CF_ALLOWED.some(d => url.includes(d));
}

async function fetchTunnelStatus() {
  const btn = document.getElementById('btn-tunnel');
  if (btn) { btn.className = 'tunnel-checking'; btn.title = 'Vérification...'; }
  try {
    // Cache-bust : on recharge toutes les 60s côté navigateur
    const r = await fetch(TUNNEL_JSON_URL + '?v=' + Math.floor(Date.now() / 60000), { cache: 'no-store' });
    if (!r.ok) throw new Error('HTTP ' + r.status);
    const data = await r.json();

    // Validation URL (sécurité : on n'ouvre que des URLs Cloudflare connues)
    const raw = (data.url || '').trim();
    const valid = _isValidCfUrl(raw);

    // Âge de la dernière mise à jour (> 5 min = considéré offline)
    let tooOld = false;
    if (data.last_update) {
      const ageSec = (Date.now() - new Date(data.last_update).getTime()) / 1000;
      if (ageSec > 300) tooOld = true;
    }

    if (data.status === 'online' && valid && !tooOld) {
      _tunnelStatus = 'online';
      _tunnelUrl    = raw;
    } else {
      _tunnelStatus = 'offline';
      _tunnelUrl    = null;
    }
  } catch(e) {
    _tunnelStatus = 'unknown';
    _tunnelUrl    = null;
  }
  _updateTunnelBtn();
}

function _updateTunnelBtn() {
  const btn = document.getElementById('btn-tunnel');
  if (!btn) return;
  btn.className = '';
  if (_tunnelStatus === 'online' && _tunnelUrl) {
    btn.classList.add('tunnel-online');
    btn.title = 'KITT EN LIGNE — CLIQUER POUR SE CONNECTER';
  } else if (_tunnelStatus === 'offline') {
    btn.classList.add('tunnel-offline');
    btn.title = 'KITT HORS LIGNE';
  } else {
    btn.classList.add('tunnel-checking');
    btn.title = 'ÉTAT INCONNU — VÉRIFICATION...';
  }
}

function connectTunnel() {
  sndSelect();
  if (_tunnelStatus === 'online' && _tunnelUrl && _isValidCfUrl(_tunnelUrl)) {
    addLine('[ TUNNEL ] CONNEXION SÉCURISÉE → ' + _tunnelUrl, 'line-ok');
    setTimeout(() => window.open(_tunnelUrl, '_blank', 'noopener,noreferrer'), 300);
  } else if (_tunnelStatus === 'offline') {
    sndError();
    addLine('[ TUNNEL ] KITT HORS LIGNE — CONNEXION DISTANTE INDISPONIBLE.', 'line-err');
  } else {
    addLine('[ TUNNEL ] VÉRIFICATION EN COURS...', 'line-warn');
    fetchTunnelStatus();
  }
}

// Vérification immédiate puis toutes les 60 secondes
window.addEventListener('load', () => { setTimeout(fetchTunnelStatus, 1500); });
setInterval(fetchTunnelStatus, 60000);

// ════════════════════════════════════════════════════════════
// UTILS & HORLOGE
// ════════════════════════════════════════════════════════════
function delay(ms) { return new Promise(r => setTimeout(r, ms)); }

function getLoc(){return{fr:'fr-FR',en:'en-US',nl:'nl-NL',it:'it-IT',de:'de-DE',es:'es-ES',pt:'pt-PT'}[LANG]||'fr-FR';}
setInterval(()=>{
  document.getElementById('clock').textContent=new Date().toLocaleTimeString(getLoc());
},1000);

// ════════════════════════════════════════════════════════════
// MODAL
// ════════════════════════════════════════════════════════════
function openFile(file, title='DOCUMENT') {
  document.getElementById('modal-title').textContent = title;
  document.getElementById('modal-content').textContent = 'CHARGEMENT...';
  document.getElementById('modal').classList.add('open');
  kittChime();
  fetch(file)
    .then(r => { if (!r.ok) throw new Error(`HTTP ${r.status}`); return r.text(); })
    .then(t  => { document.getElementById('modal-content').textContent = t; })
    .catch(er => { document.getElementById('modal-content').textContent = `ERREUR\n${file}\n${er.message}`; });
}
function closeModal() { document.getElementById('modal').classList.remove('open'); }
document.addEventListener('keydown', e => { if (e.key==='Escape') closeModal(); });

// ════════════════════════════════════════════════════════════
// DÉMARRAGE
// ════════════════════════════════════════════════════════════
function startMain() {
  (async () => {
    await delay(200);
    await typeText(T[LANG].wait,      14, 'line-dim');
    await typeText(T[LANG].help_hint, 12, 'line-dim');
  })();
}

// ════════════════════════════════════════════════════════════
// COMPTEUR DE VISITES — localStorage + offset 1000
// ════════════════════════════════════════════════════════════
(function() {
  try {
    const BASE = 1000;
    const KEY  = 'kitt_fb_v';
    let n = parseInt(localStorage.getItem(KEY) || '0');
    n++;
    localStorage.setItem(KEY, n);
    const el = document.getElementById('visit-counter');
    if (el) el.textContent = 'VISITES : ' + (BASE + n);
  } catch(e) {}
})();

// ════════════════════════════════════════════════════════════
// ÉCRAN ACCÈS — Mot de passe style Alien (multilingue)
// ════════════════════════════════════════════════════════════
function runAccessScreen() {
  const screen = document.getElementById('access-screen');
  const log    = document.getElementById('access-log');
  const input  = document.getElementById('access-input');
  const box    = document.getElementById('access-box');
  const progressBar = document.getElementById('access-progress-bar');
  // Réinitialiser
  log.innerHTML = ''; input.value = ''; input.disabled = false;
  if(progressBar) { progressBar.style.width='0'; progressBar.style.opacity='1'; progressBar.style.background='linear-gradient(90deg,#FF6600,#FF9900)'; }
  screen.style.display = 'flex'; screen.style.opacity = '1'; screen.style.transition = '';

  // Textes multilingues
  const accessLines = {
    fr:['INITIALISATION DU PROTOCOLE...','CONNEXION AU NOYAU MU-TH-UR...','INTERFACE SÉCURISÉE ACTIVE.'],
    en:['PROTOCOL INITIALIZATION...','CONNECTING TO MU-TH-UR CORE...','SECURE INTERFACE ACTIVE.'],
    nl:['PROTOCOL INITIALISEREN...','VERBINDING MET MU-TH-UR KERN...','BEVEILIGDE INTERFACE ACTIEF.'],
    it:['INIZIALIZZAZIONE PROTOCOLLO...','CONNESSIONE AL NUCLEO MU-TH-UR...','INTERFACCIA SICURA ATTIVA.'],
    de:['PROTOKOLL INITIALISIERUNG...','VERBINDUNG ZUM MU-TH-UR KERN...','SICHERE SCHNITTSTELLE AKTIV.'],
    es:['INICIALIZANDO PROTOCOLO...','CONECTANDO AL NÚCLEO MU-TH-UR...','INTERFAZ SEGURA ACTIVA.'],
    pt:['INICIALIZAÇÃO DO PROTOCOLO...','LIGAÇÃO AO NÚCLEO MU-TH-UR...','INTERFACE SEGURA ATIVA.'],
  };
  const accessOk  = {fr:'> ACCÈS ACCORDÉ. BIENVENUE.',en:'> ACCESS GRANTED. WELCOME.',nl:'> TOEGANG VERLEEND. WELKOM.',it:'> ACCESSO CONCESSO. BENVENUTO.',de:'> ZUGANG GEWÄHRT. WILLKOMMEN.',es:'> ACCESO CONCEDIDO. BIENVENIDO.',pt:'> ACESSO CONCEDIDO. BEM-VINDO.'};
  const accessErr = {fr:'> CODE INCORRECT. ACCÈS REFUSÉ.',en:'> WRONG CODE. ACCESS DENIED.',nl:'> ONJUISTE CODE. TOEGANG GEWEIGERD.',it:'> CODICE ERRATO. ACCESSO NEGATO.',de:'> FALSCHER CODE. ZUGANG VERWEIGERT.',es:'> CÓDIGO INCORRECTO. ACCESO DENEGADO.',pt:'> CÓDIGO ERRADO. ACESSO NEGADO.'};
  const accessVoice = {fr:'Accès accordé. Je suis MU-TH-UR. Bienvenue.',en:'Access granted. I am MU-TH-UR. Welcome.',nl:'Toegang verleend. Ik ben MU-TH-UR. Welkom.',it:'Accesso concesso. Sono MU-TH-UR. Benvenuto.',de:'Zugang gewährt. Ich bin MU-TH-UR. Willkommen.',es:'Acceso concedido. Soy MU-TH-UR. Bienvenido.',pt:'Acesso concedido. Eu sou MU-TH-UR. Bem-vindo.'};

  const lines = accessLines[LANG] || accessLines.en;
  let li = 0;
  let progress = 0;
  const progInterval = setInterval(() => {
    if (progress < 75) { progress += 2; if(progressBar) progressBar.style.width = progress + '%'; }
  }, 80);

  function typeLine() {
    if (li >= lines.length) {
      clearInterval(progInterval);
      if(progressBar) progressBar.style.width = '100%';
      setTimeout(() => { if(progressBar) progressBar.style.opacity='0'; }, 600);
      input.focus();
      if (typeof _kittKb !== 'undefined') _kittKb.showFor('access-input', 'mother');
      return;
    }
    const d = document.createElement('div');
    d.className = 'a-line'; log.appendChild(d);
    let ci = 0, txt = lines[li];
    const t = setInterval(()=>{
      if(ci < txt.length){ d.textContent += txt[ci++]; try{sndMotherClick();}catch(e){} }
      else { clearInterval(t); try{sndMotherBeep();}catch(e){}; li++; setTimeout(typeLine,200); }
    }, 22);
  }
  setTimeout(typeLine, 400);

  function doAccess() {
    const val = input.value.trim();
    if (val === '1982') {
      input.disabled = true;
      if(progressBar){ progressBar.style.opacity='1'; progressBar.style.width='100%'; progressBar.style.background='linear-gradient(90deg,#00aa44,#00ff66)'; }
      box.classList.add('granted'); screen.classList.add('granted');
      if (typeof _kittKb !== 'undefined') _kittKb.hide();
      const ok = document.createElement('div');
      ok.className = 'a-ok'; ok.textContent = accessOk[LANG] || accessOk.en;
      log.appendChild(ok);
      try{ sndMotherChime(); }catch(e){}
      // Voix dans la langue choisie
      setTimeout(()=>{
        try{
          const msg = accessVoice[LANG] || accessVoice.en;
          const langCode = {fr:'fr-FR',en:'en-US',nl:'nl-NL',it:'it-IT',de:'de-DE',es:'es-ES',pt:'pt-PT'}[LANG]||'en-US';
          const utt = new SpeechSynthesisUtterance(msg);
          utt.lang=langCode; utt.rate=0.72; utt.pitch=0.5; utt.volume=0.9;
          const vs=speechSynthesis.getVoices();
          const v=vs.find(v=>v.lang.startsWith(langCode.split('-')[0]))||vs[0];
          if(v) utt.voice=v; speechSynthesis.speak(utt);
        }catch(e){}
      }, 300);
      setTimeout(()=>{
        screen.style.transition='opacity .9s'; screen.style.opacity='0';
        setTimeout(()=>{ screen.style.display='none'; screen.style.opacity='1'; screen.style.transition=''; runMotherIntro(); }, 950);
      }, 2800);
    } else {
      input.value='';
      if(progressBar){ progressBar.style.background='linear-gradient(90deg,#ff1a1a,#ff6600)'; progressBar.style.width='100%'; setTimeout(()=>{ progressBar.style.width='0'; progressBar.style.background='linear-gradient(90deg,#FF6600,#FF9900)'; },600); }
      const err = document.createElement('div');
      err.className='a-err'; err.textContent = accessErr[LANG] || accessErr.en;
      log.appendChild(err);
      try{ sndMotherBeep(); setTimeout(()=>sndMotherBeep(),160); }catch(e){}
      box.classList.add('wrong');
      setTimeout(()=>box.classList.remove('wrong'),450);
      input.focus();
    }
  }
  input.addEventListener('keydown', e=>{ if(e.key==='Enter') doAccess(); });
}

// Langue en premier au chargement
window.addEventListener('load', () => {
  document.getElementById('access-screen').style.display = 'none';
  document.getElementById('mother-intro').style.display = 'none';
  // Verrouiller le bouton Connexion KITT jusqu'aux missions complètes
  const tb = document.getElementById('btn-tunnel');
  if(tb) { tb.classList.add('tunnel-locked'); tb.style.pointerEvents='auto'; tb.onclick=(e)=>{ try{ripple(e);}catch(ee){} _showLockMessage(); }; }
  showLangScreen();
});

// ── FIX MOBILE : garder l'input visible quand le clavier virtuel s'ouvre ──
// visualViewport s'adapte à la zone réellement visible (clavier exclu)
if(window.visualViewport){
  function _vpResize(){
    const vp=window.visualViewport;
    const c=document.querySelector('.container');
    if(c) c.style.height=vp.height+'px';
  }
  window.visualViewport.addEventListener('resize',_vpResize);
  window.visualViewport.addEventListener('scroll',_vpResize);
}

// ════════════════════════════════════════════════════════════
// ROUTE NOCTURNE KITT — canvas fond d'écran
// ════════════════════════════════════════════════════════════
(function(){
  const c=document.getElementById('starfield');
  if(!c) return;
  const ctx=c.getContext('2d');
  let W,H;
  function resize(){
    W=c.width=window.innerWidth;
    H=c.height=window.innerHeight;
  }
  resize();
  window.addEventListener('resize',resize);

  // Étoiles (ciel, moitié haute)
  const stars=[];
  for(let i=0;i<180;i++) stars.push({
    x:Math.random(),y:Math.random()*.52,
    r:Math.random()*1.1+.1,
    b:Math.random()*Math.PI*2,
    sp:Math.random()*.012+.004,
    col:Math.random()<.12?'rgba(255,100,0,':(Math.random()<.08?'rgba(0,200,255,':'rgba(0,255,102,')
  });

  // Feux arrière (2 voitures distantes)
  const tailLights=[
    {ox:.485,x:.485,y:.415,drift:.00008},
    {ox:.515,x:.515,y:.415,drift:-.00008},
    {ox:.478,x:.478,y:.405,drift:.00015},
    {ox:.522,x:.522,y:.405,drift:-.00015},
  ];

  // Lampadaires (gauche et droite alternés)
  const lamps=[];
  for(let i=0;i<10;i++) lamps.push({
    z:i/10,
    side:i%2===0?-1:1,
    speed:.0022+Math.random()*.001
  });

  let dashOff=0;
  const VPY=.42; // horizon (proportion hauteur)
  const ROAD_NEAR=.72, ROAD_FAR=.055; // largeur route

  // ── GYROSCOPE : gamma=direction, beta=vitesse ──
  let gyroShift=0, gyroTarget=0;
  let gyroSpeed=0.018, gyroSpeedTarget=0.018;
  function _setupGyro(){
    window.addEventListener('deviceorientation', e=>{
      // gamma = gauche/droite → direction route
      const g = e.gamma||0;
      gyroTarget = Math.max(-40,Math.min(40,g)) / 40 * W * 0.28;
      // beta = avant/arrière → vitesse (téléphone tenu à ~45°)
      const b = (e.beta||0) - 45;
      const norm = Math.max(-1, Math.min(1, b / 30));
      gyroSpeedTarget = Math.max(0.002, 0.018 + norm * 0.038);
    });
  }
  // iOS 13+ nécessite une permission explicite — écouter le premier tap n'importe où
  if(typeof DeviceOrientationEvent!=='undefined' && typeof DeviceOrientationEvent.requestPermission==='function'){
    document.addEventListener('click',function _gio(){
      DeviceOrientationEvent.requestPermission().then(r=>{ if(r==='granted') _setupGyro(); });
      document.removeEventListener('click',_gio);
    },{once:true});
  } else {
    // Android & desktop : actif directement, pas besoin de permission
    _setupGyro();
  }

  function roadX(side,z){
    // side: -1=gauche +1=droite, z: 0=loin 1=près
    // gyroShift décale le point de fuite selon l'inclinaison du téléphone
    const hw=W*(ROAD_FAR+(ROAD_NEAR-ROAD_FAR)*z)/2;
    return W/2 + gyroShift*(1-z*0.5) + side*hw;
  }
  function roadY(z){return VPY*H+(1-VPY)*H*(1-z);}

  function draw(){
    // Lerp fluide (inertie naturelle)
    gyroShift += (gyroTarget - gyroShift) * 0.07;
    gyroSpeed += (gyroSpeedTarget - gyroSpeed) * 0.05;

    ctx.clearRect(0,0,W,H);
    const hy=VPY*H;

    // Ciel
    const sky=ctx.createLinearGradient(0,0,0,hy);
    sky.addColorStop(0,'#000008');
    sky.addColorStop(1,'#000d06');
    ctx.fillStyle=sky; ctx.fillRect(0,0,W,hy);

    // Étoiles
    stars.forEach(s=>{
      s.b+=s.sp;
      const a=.15+Math.abs(Math.sin(s.b))*.5;
      ctx.fillStyle=s.col+a+')';
      ctx.beginPath(); ctx.arc(s.x*W,s.y*hy*1.08,s.r,0,Math.PI*2); ctx.fill();
      if(a>.52&&s.r>.8){
        ctx.fillStyle=s.col+'.1)';
        ctx.beginPath(); ctx.arc(s.x*W,s.y*hy*1.08,s.r*2.6,0,Math.PI*2); ctx.fill();
      }
    });

    // Sol (sous horizon)
    const gnd=ctx.createLinearGradient(0,hy,0,H);
    gnd.addColorStop(0,'#010603'); gnd.addColorStop(1,'#000200');
    ctx.fillStyle=gnd; ctx.fillRect(0,hy,W,H-hy);

    // Chaussée (trapèze)
    ctx.beginPath();
    ctx.moveTo(roadX(-1,0),hy); ctx.lineTo(roadX(1,0),hy);
    ctx.lineTo(roadX(1,1),H);   ctx.lineTo(roadX(-1,1),H);
    ctx.closePath();
    const rdg=ctx.createLinearGradient(0,hy,0,H);
    rdg.addColorStop(0,'#040c04'); rdg.addColorStop(.6,'#071007'); rdg.addColorStop(1,'#091409');
    ctx.fillStyle=rdg; ctx.fill();

    // Bordures route
    ctx.lineWidth=1;
    ctx.strokeStyle='rgba(0,255,102,.13)';
    ctx.beginPath(); ctx.moveTo(roadX(-1,0),hy); ctx.lineTo(roadX(-1,1),H); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(roadX(1,0),hy);  ctx.lineTo(roadX(1,1),H);  ctx.stroke();

    // Ligne jaune gauche (axe)
    ctx.strokeStyle='rgba(255,200,0,.07)';
    ctx.lineWidth=.8;
    ctx.beginPath(); ctx.moveTo(roadX(-.34,0),hy); ctx.lineTo(roadX(-.34,1),H); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(roadX(.34,0),hy);  ctx.lineTo(roadX(.34,1),H);  ctx.stroke();

    // Tirets blancs centraux (perspective)
    dashOff=(dashOff+gyroSpeed)%(1/12);
    for(let i=0;i<14;i++){
      let t=(i/13+dashOff)%1;
      if(t<.001) t=.001;
      const z1=1-t, z2=1-Math.max(.001,t-.038);
      if(z1>.99||z2<.005) continue;
      const y1=roadY(z1), y2=roadY(z2);
      if(y1>=H||y2<=hy) continue;
      const a=Math.min(1,z1*.9+.05)*.65;
      ctx.strokeStyle=`rgba(255,255,255,${a})`;
      ctx.lineWidth=Math.max(.5,(1-z1)*3.5);
      ctx.beginPath(); ctx.moveTo(W/2,y1); ctx.lineTo(W/2,Math.min(H,y2)); ctx.stroke();
    }

    // Feux arrière rouges (distance)
    tailLights.forEach(tl=>{
      tl.x+=tl.drift;
      if(tl.x<.46||tl.x>.54) tl.drift*=-1;
      const tx=tl.x*W, ty=tl.y*H;
      const sz=3.5;
      // halo
      const hgl=ctx.createRadialGradient(tx,ty,0,tx,ty,sz*9);
      hgl.addColorStop(0,'rgba(255,20,0,.18)'); hgl.addColorStop(1,'transparent');
      ctx.fillStyle=hgl; ctx.beginPath(); ctx.arc(tx,ty,sz*9,0,Math.PI*2); ctx.fill();
      // feux
      ctx.fillStyle='rgba(255,30,0,.85)';
      ctx.beginPath(); ctx.arc(tx-sz*1.6,ty,sz,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(tx+sz*1.6,ty,sz,0,Math.PI*2); ctx.fill();
    });

    // Lampadaires latéraux
    lamps.forEach(lp=>{
      lp.z+=lp.speed;
      if(lp.z>1) lp.z=0;
      const z=lp.z;
      const margin=.06; // distance du bord de route
      const lx=roadX(lp.side*(1+margin),z);
      const ly=roadY(z);
      if(ly>H||ly<hy) return;
      const a=Math.min(1,z*1.2)*.55;
      // lumière ambre
      ctx.fillStyle=`rgba(255,180,80,${a})`;
      ctx.beginPath(); ctx.arc(lx,ly,Math.max(.4,(1-z)*2.5+.5),0,Math.PI*2); ctx.fill();
      // cône au sol
      if(z>.2){
        const cgl=ctx.createRadialGradient(lx,ly,0,lx,ly,(1-z)*55);
        cgl.addColorStop(0,`rgba(255,180,80,${a*.18})`);
        cgl.addColorStop(1,'transparent');
        ctx.fillStyle=cgl;
        ctx.beginPath(); ctx.arc(lx,ly,(1-z)*55,0,Math.PI*2); ctx.fill();
      }
    });

    // Lueur horizon verte KITT
    const hglow=ctx.createLinearGradient(0,hy-18,0,hy+28);
    hglow.addColorStop(0,'transparent');
    hglow.addColorStop(.5,'rgba(0,255,102,.05)');
    hglow.addColorStop(1,'transparent');
    ctx.fillStyle=hglow; ctx.fillRect(0,hy-18,W,46);

    requestAnimationFrame(draw);
  }
  draw();
})();

// ── Données HUD animées dans le menu langue ──────────────
(function(){
  const el=document.getElementById('lang-data-r');
  if(!el) return;
  const stati=['STAT:NOMINAL','STAT:SCANNING','STAT:ONLINE','STAT:LOCKED'];
  let i=0;
  setInterval(()=>{i=(i+1)%stati.length; el.textContent='op.MANIX \u25CF '+stati[i];},3200);
})();

// ════════════════════════════════════════════════════════════
// PLUIE SUR LE PARE-BRISE
// ════════════════════════════════════════════════════════════
(function(){
  const c=document.createElement('canvas');
  c.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;z-index:1;pointer-events:none;';
  document.body.appendChild(c);
  const ctx=c.getContext('2d');
  let W,H;
  function resize(){W=c.width=window.innerWidth;H=c.height=window.innerHeight;}
  resize(); window.addEventListener('resize',resize);

  const N=window.innerWidth<600?28:52;
  const drops=[];

  function mkDrop(imm){
    return{
      x:Math.random()*W,
      y:imm?Math.random()*H:-8,
      vy:1.3+Math.random()*2.8,
      vx:(Math.random()-.5)*.4,
      r:1.2+Math.random()*2.2,
      alpha:.2+Math.random()*.32,
      tail:[],
      phase:Math.random()*Math.PI*2
    };
  }
  for(let i=0;i<N;i++) drops.push(mkDrop(true));

  // Rivulets
  const rivs=[];
  for(let i=0;i<(window.innerWidth<600?4:9);i++) rivs.push({
    x:W*(.08+Math.random()*.84),y:Math.random()*H*.4,
    pts:[],speed:.7+Math.random()*1.4,
    alpha:.07+Math.random()*.1,drift:(Math.random()-.5)*.12,maxPts:55+Math.floor(Math.random()*90)
  });

  function draw(){
    ctx.clearRect(0,0,W,H);

    // Rivulets
    rivs.forEach(rv=>{
      rv.y+=rv.speed; rv.x+=rv.drift+(Math.random()-.5)*.15;
      rv.pts.unshift({x:rv.x,y:rv.y});
      if(rv.pts.length>rv.maxPts) rv.pts.pop();
      if(rv.y>H+10){rv.y=Math.random()*H*.25;rv.x=W*(.08+Math.random()*.84);rv.pts=[];}
      if(rv.pts.length<2) return;
      ctx.beginPath(); ctx.moveTo(rv.pts[0].x,rv.pts[0].y);
      for(let i=1;i<rv.pts.length;i++) ctx.lineTo(rv.pts[i].x,rv.pts[i].y);
      ctx.strokeStyle=`rgba(180,240,190,${rv.alpha})`; ctx.lineWidth=.7; ctx.stroke();
    });

    // Drops
    for(let i=drops.length-1;i>=0;i--){
      const d=drops[i];
      d.phase+=.03; d.vy+=.05; d.x+=d.vx+(Math.sin(d.phase)*.15); d.y+=d.vy;
      d.tail.unshift({x:d.x,y:d.y});
      if(d.tail.length>10) d.tail.pop();
      if(d.y>H+20||d.x<-20||d.x>W+20){ drops[i]=mkDrop(false); continue; }

      // Teardrop shape
      ctx.save();
      ctx.translate(d.x,d.y);
      ctx.rotate(Math.atan2(d.vy,d.vx)-.2);
      const g=ctx.createRadialGradient(-d.r*.2,-d.r*.3,0,0,d.r*.4,d.r*2);
      g.addColorStop(0,`rgba(255,255,255,${d.alpha*.9})`);
      g.addColorStop(.4,`rgba(180,240,190,${d.alpha*.45})`);
      g.addColorStop(1,'transparent');
      ctx.beginPath(); ctx.ellipse(0,d.r*.2,d.r*.55,d.r,0,0,Math.PI*2);
      ctx.fillStyle=g; ctx.fill();
      // Highlight
      ctx.beginPath(); ctx.arc(-d.r*.18,-d.r*.25,d.r*.28,0,Math.PI*2);
      ctx.fillStyle=`rgba(255,255,255,${d.alpha*.55})`; ctx.fill();
      ctx.restore();

      // Tail streak
      if(d.tail.length>2){
        ctx.beginPath(); ctx.moveTo(d.tail[0].x,d.tail[0].y);
        for(let j=1;j<d.tail.length;j++) ctx.lineTo(d.tail[j].x,d.tail[j].y);
        ctx.strokeStyle=`rgba(160,230,170,${d.alpha*.28})`; ctx.lineWidth=d.r*.4; ctx.stroke();
      }

      // Lens glow (refraction verte KITT + rouge feux)
      const gl=ctx.createRadialGradient(d.x,d.y,0,d.x,d.y,d.r*3.5);
      gl.addColorStop(0,`rgba(0,255,102,${d.alpha*.09})`);
      gl.addColorStop(.6,`rgba(255,30,0,${d.alpha*.04})`);
      gl.addColorStop(1,'transparent');
      ctx.fillStyle=gl; ctx.beginPath(); ctx.arc(d.x,d.y,d.r*3.5,0,Math.PI*2); ctx.fill();

      // Occasional split
      if(d.vy>4&&Math.random()<.002&&drops.length<N+8){
        const nd=mkDrop(false); nd.x=d.x; nd.y=d.y; nd.vy=d.vy*.55; nd.r=d.r*.55;
        nd.vx=d.vx+(Math.random()-.5)*1.8; nd.alpha=d.alpha*.6; drops.push(nd);
        d.alpha*=.35;
      }
    }
    requestAnimationFrame(draw);
  }
  draw();
})();

// ════════════════════════════════════════════════════════════
// TABLEAU DE BORD KITT
// ════════════════════════════════════════════════════════════
function showKittDash(){
  const dash=document.getElementById('kitt-dash');
  if(dash) dash.classList.add('visible');
}

// ════════════════════════════════════════════════════════════
// APPEL ENTRANT K.I.T·T
// ════════════════════════════════════════════════════════════
let _callShown=false;
function showKittCall(){
  if(_callShown) return;
  _callShown=true;
  const call=document.getElementById('kitt-call');
  if(!call) return;
  call.classList.add('active');
  // Sonnerie Web Audio
  let _ring=null;
  function startRing(){
    try{
      _resume();
      _ring=setInterval(()=>{
        const t=_ac.currentTime;
        [0,.18].forEach(dt=>{
          const o=_ac.createOscillator(); o.type='sine'; o.frequency.value=880;
          const g=_ac.createGain(); g.gain.setValueAtTime(.07,t+dt); g.gain.exponentialRampToValueAtTime(.001,t+dt+.15);
          o.connect(g); g.connect(_ac.destination); o.start(t+dt); o.stop(t+dt+.16);
        });
      },1400);
    }catch(e){}
  }
  function stopRing(){ if(_ring) clearInterval(_ring); }
  startRing();

  document.getElementById('call-accept').onclick=()=>{
    stopRing(); call.style.transition='opacity .4s'; call.style.opacity='0';
    setTimeout(()=>{ call.style.display='none'; },420);
    // Voix KITT dans la langue choisie
    try{
      const _ct={
        fr:'Mission reçue. Je suis KITT. Lance l\'initialisation. Complète les cinq étapes. L\'accès à mon intelligence se débloque après ta réussite.',
        en:'Mission received. I am KITT. Start initialization. Complete five stages. Access to my intelligence unlocks after your success.',
        nl:'Missie ontvangen. Ik ben KITT. Start initialisatie. Voltooi vijf stappen. Toegang tot mijn intelligentie ontgrendelt na jouw succes.',
        it:'Missione ricevuta. Sono KITT. Avvia l\'inizializzazione. Completa cinque fasi. L\'accesso alla mia intelligenza si sblocca dopo il tuo successo.',
        de:'Mission empfangen. Ich bin KITT. Starte die Initialisierung. Schliesse fünf Stufen ab. Der Zugang zu meiner Intelligenz entsperrt sich nach deinem Erfolg.',
        es:'Misión recibida. Soy KITT. Inicia la inicialización. Completa cinco etapas. El acceso a mi inteligencia se desbloquea tras tu éxito.',
        pt:'Missão recebida. Sou o KITT. Inicia a inicialização. Completa cinco etapas. O acesso à minha inteligência desbloqueia após o teu sucesso.'
      };
      speakMuther(_ct[LANG]||_ct.fr, LANG);
    }catch(e){}
    // Chime KITT
    setTimeout(()=>{ try{kittChime();}catch(e){} },300);
  };
  document.getElementById('call-ignore').onclick=()=>{
    stopRing(); call.style.transition='opacity .3s'; call.style.opacity='0';
    setTimeout(()=>{ call.style.display='none'; },320);
  };
}

</script>

<!-- TABLEAU DE BORD KITT -->
<div id="kitt-dash">
  <div id="kitt-hood">
    <div id="kitt-scan-track">
      <div id="kitt-scan-dot"></div>
      <div id="kitt-scan-trail"></div>
    </div>
  </div>
</div>

<!-- APPEL ENTRANT K.I.T·T -->
<div id="kitt-call">
  <div id="call-header">
    <div id="call-avatar">K·I·T·T</div>
    <div id="call-id-block">
      <div id="call-name">K · I · T · T</div>
      <div id="call-status">APPEL ENTRANT &#183;&#183;&#183;</div>
    </div>
  </div>
  <div id="call-mission">
    <div id="call-mission-title">⚠ MISSION : OPÉRATION FRANCO-BELGE</div>
    <div class="call-rule"><span class="call-rule-icon">&#9654;</span><span id="call-rule-1">Complète <span class="call-rule-highlight">5 étapes</span> dans le terminal</span></div>
    <div class="call-rule"><span class="call-rule-icon">&#9654;</span><span id="call-rule-2">Lance <span class="call-rule-highlight">[ INITIALISER ]</span> en premier</span></div>
    <div class="call-rule"><span class="call-rule-icon">&#9654;</span><span id="call-rule-3">Réussis le <span class="call-rule-highlight">diagnostic système</span></span></div>
    <div class="call-rule"><span class="call-rule-icon">&#9654;</span><span id="call-rule-4">Accomplis <span class="call-rule-highlight">toutes les missions</span></span></div>
    <div id="call-unlock-note">
      ● ACCÈS IA : débloqué uniquement après réussite<br/>
      ● CODE SPÉCIAL reçu si toutes conditions remplies
    </div>
  </div>
  <div class="call-btns">
    <button class="call-btn" id="call-accept">✆ ACCEPTER</button>
    <button class="call-btn" id="call-ignore">✕ IGNORER</button>
  </div>
</div>

<!-- ★ HUD MISSIONS -->
<div id="kitt-mission-hud">
  <div id="mission-title">⬡ MISSIONS KITT</div>
  <div id="mission-progress-bar"><div id="mission-progress-fill" style="width:0%"></div></div>
  <div id="mission-list"></div>
  <div id="mission-close">[ FERMER ]</div>
</div>

<script>
// ════════════════════════════════════════════════════════════
// CLAVIER VIRTUEL KITT — mobile uniquement (<= 600px)
// Design inspiré KYRONEX local — thème vert — 3 modes AZERTY
// ════════════════════════════════════════════════════════════
const _kittKb = (() => {
  'use strict';
  let el, shifted = false, nums = false, accs = false, targetId = 'cmd-input';

  const AL = [
    ['a','z','e','r','t','y','u','i','o','p'],
    ['q','s','d','f','g','h','j','k','l','m'],
    ['SH','w','x','c','v','b','n','BS'],
    ['MODE','SPACE','SEND']
  ];
  const AC = [
    ['\u00e9','\u00e8','\u00ea','\u00eb','\u00e0','\u00e2','\u00e4','\u00f9','\u00fb'],
    ['\u00ee','\u00ef','\u00f4','\u00f6','\u00e7','\u0153','\u00e6','-','_'],
    ['!','?','.',',',';',':','\'','BS'],
    ['MODE','SPACE','SEND']
  ];
  const NM = [
    ['1','2','3','4','5','6','7','8','9','0'],
    ['-','/',':', ';','(',')', '@','#','?','!'],
    ['.',',','\'','"','&','*','+','=','BS'],
    ['MODE','SPACE','SEND']
  ];

  function render() {
    if (!el) return;
    const rows = accs ? AC : (nums ? NM : AL);
    el.innerHTML = '<div class="kb-header">[ K.I.T.T. NEURAL INPUT ]</div>'
      + rows.map(function(row) {
        return '<div class="kb-row">' + row.map(keyHtml).join('') + '</div>';
      }).join('');
    el.querySelectorAll('.kb-key').forEach(function(b) {
      b.addEventListener('pointerdown', function(e) { e.preventDefault(); press(b.dataset.k); });
    });
  }

  function keyHtml(k) {
    return '<button class="kb-key ' + kCls(k) + '" data-k="' + k + '" tabindex="-1">' + kLbl(k) + '</button>';
  }

  function kLbl(k) {
    if (k === 'BS')    return '&#9003;';
    if (k === 'SH')    return shifted ? '&#8682;' : '&#8679;';
    if (k === 'SPACE') return '&#9135;&#9135;&#9135;';
    if (k === 'SEND')  return '&#9654;&nbsp;ENTER';
    if (k === 'MODE') {
      if (!nums && !accs) return '\u00e9\u00e0\u00e7';
      if (accs)           return '123';
      return 'ABC';
    }
    return (shifted && !nums && !accs) ? k.toUpperCase() : k;
  }

  function kCls(k) {
    if (k === 'SEND')  return 'kb-send kb-w2';
    if (k === 'SPACE') return 'kb-w4';
    if (k === 'SH')    return 'kb-w15' + (shifted ? ' kb-shift-on' : '');
    if (k === 'BS' || k === 'MODE') return 'kb-w15';
    return '';
  }

  function press(k) {
    if (typeof sndClick === 'function') sndClick();
    const inp = document.getElementById(targetId);
    if (!inp) return;
    if      (k === 'BS')    { inp.value = inp.value.slice(0, -1); }
    else if (k === 'SEND')  {
      inp.dispatchEvent(new KeyboardEvent('keydown', {key:'Enter',bubbles:true}));
      if (targetId !== 'access-input') hide(); // accès : clavier reste visible si code faux
      return;
    }
    else if (k === 'SH')    { shifted = !shifted; render(); return; }
    else if (k === 'MODE') {
      if (!nums && !accs)  { accs = true; }
      else if (accs)       { accs = false; nums = true; }
      else                 { nums = false; }
      render(); return;
    }
    else if (k === 'SPACE') { inp.value += ' '; }
    else {
      inp.value += (shifted && !nums && !accs) ? k.toUpperCase() : k;
      if (shifted) { shifted = false; render(); return; }
    }
    inp.dispatchEvent(new Event('input'));
  }

  function _applyTarget(id) {
    targetId = id || 'cmd-input';
    const inp = document.getElementById(targetId);
    if (inp) inp.setAttribute('inputmode', 'none');
  }

  function show() {
    if (!el) return;
    _applyTarget(targetId);
    document.body.classList.add('kb-open');
    el.classList.add('kb-on');
  }

  function showFor(id, theme) {
    if (!el) return;
    targetId = id || 'cmd-input';
    el.classList.remove('theme-mother');
    if (theme) el.classList.add('theme-' + theme);
    show();
  }

  function hide() {
    if (!el) return;
    el.classList.remove('kb-on', 'theme-mother');
    document.body.classList.remove('kb-open');
    targetId = 'cmd-input';
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (!('ontouchstart' in window)) return;
    el = document.getElementById('kitt-vkb');
    if (!el) return;
    render();
    // Listener #cmd-input (terminal principal — thème vert)
    const inp = document.getElementById('cmd-input');
    if (inp) {
      inp.setAttribute('inputmode', 'none');
      inp.addEventListener('focus', function() { showFor('cmd-input', null); });
      inp.addEventListener('touchend', function(e) {
        if (!el.classList.contains('kb-on')) { e.preventDefault(); showFor('cmd-input', null); }
      });
    }
    // Listener #access-input (code d'accès — thème MU-TH-UR orange)
    const acc = document.getElementById('access-input');
    if (acc) {
      acc.setAttribute('inputmode', 'none');
      acc.addEventListener('focus', function() { showFor('access-input', 'mother'); });
    }
    el.addEventListener('pointerdown', function(e) { e.preventDefault(); });
    document.addEventListener('pointerdown', function(e) {
      if (!el.classList.contains('kb-on')) return;
      var path = e.composedPath ? e.composedPath() : [];
      if (path.indexOf(el) === -1 && e.target.id !== 'cmd-input' && e.target.id !== 'access-input') hide();
    });
  });

  return { show, hide, showFor };
})();

// ── Ancienne IIFE désactivée (remplacée par _kittKb ci-dessus) ──
(function() {
  return; // désactivé

  var inp  = document.getElementById('cmd-input');
  var vkb  = document.getElementById('kitt-vkb');
  var panL = document.getElementById('kitt-vkb-letters');
  var panS = document.getElementById('kitt-vkb-special');
  if (!inp || !vkb || !panL || !panS) return;

  var shiftOn = false, specialMode = false, vkbVisible = false;
  var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

  var ROWS_LETTERS = [
    ['a','z','e','r','t','y','u','i','o','p'],
    ['q','s','d','f','g','h','j','k','l'],
    ['w','x','c','v','b','n','m','\u232B']
  ];
  var ROW_BOTTOM_L = ['MAJ','123','[ESPACE]','.','\u21A9'];
  var NUMS_ROW     = ['1','2','3','4','5','6','7','8','9','0','\u232B'];
  var ACCENTS_ROW  = ['\u00E0','\u00E2','\u00E9','\u00E8','\u00EA','\u00F4','\u00F9','\u00FB','\u00E7'];
  var SYMBOLS_ROW  = ['@','#','&','/','!','?',':',';','-','.'];
  var ROW_BOTTOM_S = ['ABC','[ESPACE]','.fr','.com','\u21A9'];

  function buildRow(chars, panel) {
    var row = document.createElement('div');
    row.className = 'vkb-row';
    chars.forEach(function(ch) {
      var btn = document.createElement('button');
      btn.type = 'button';
      var isSpace  = ch === '[ESPACE]';
      var isEnter  = ch === '\u21A9';
      var isBksp   = ch === '\u232B';
      var isShift  = ch === 'MAJ';
      var isSwitch = (ch === '123' || ch === 'ABC');
      btn.textContent = isSpace ? 'ESP' : ch;
      btn.className = 'vkb-key';
      if (isSpace)  btn.classList.add('vkb-key-wide');
      if (isEnter)  btn.classList.add('vkb-key-enter');
      if (isShift || isSwitch) btn.classList.add('vkb-key-switch');

      function act(e) {
        e.preventDefault(); // CRITIQUE — bloque blur + clavier natif
        try { if(typeof _resume==='function')_resume(); if(typeof sndClick==='function')sndClick(); } catch(er) {}
        if (isBksp) {
          inp.value = inp.value.slice(0, -1);
        } else if (isEnter) {
          inp.dispatchEvent(new KeyboardEvent('keydown', {key:'Enter', bubbles:true}));
          hideVKB();
        } else if (isSpace) {
          inp.value += ' ';
        } else if (isShift) {
          shiftOn = !shiftOn;
          btn.classList.toggle('vkb-shift-on', shiftOn);
          updateShift();
        } else if (isSwitch) {
          specialMode = !specialMode;
          panL.hidden =  specialMode;
          panS.hidden = !specialMode;
        } else {
          var c = shiftOn ? ch.toUpperCase() : ch;
          inp.value += c;
          if (shiftOn) { shiftOn = false; updateShift(); }
        }
        inp.removeAttribute('readonly');
        inp.focus();
      }

      btn.addEventListener('mousedown',  act, {passive:false});
      btn.addEventListener('touchstart', act, {passive:false});
      row.appendChild(btn);
    });
    panel.appendChild(row);
  }

  function updateShift() {
    panL.querySelectorAll('.vkb-key').forEach(function(b) {
      if (b.textContent.length === 1 && /[a-z]/i.test(b.textContent)) {
        b.textContent = shiftOn ? b.textContent.toUpperCase() : b.textContent.toLowerCase();
      }
    });
  }

  function showVKB() {
    if (vkbVisible) return;
    vkbVisible = true;
    inp.removeAttribute('readonly');
    vkb.hidden = false;
    inp.focus();
  }

  function hideVKB() {
    if (!vkbVisible) return;
    vkbVisible = false;
    vkb.hidden = true;
    if (isIOS) inp.setAttribute('readonly', 'readonly');
  }

  // Construction du clavier
  ROWS_LETTERS.forEach(function(r) { buildRow(r, panL); });
  buildRow(ROW_BOTTOM_L, panL);
  buildRow(NUMS_ROW, panS);
  buildRow(ACCENTS_ROW, panS);
  buildRow(SYMBOLS_ROW, panS);
  buildRow(ROW_BOTTOM_S, panS);
  panS.hidden = true;

  // Affichage au focus
  inp.addEventListener('focus', showVKB);
  // iOS : touch sur champ readonly → ouvrir VKB manuellement
  inp.addEventListener('touchend', function(e) {
    if (inp.hasAttribute('readonly')) { e.preventDefault(); showVKB(); }
  });
  // Cacher VKB au clic hors champ et hors clavier
  document.addEventListener('mousedown', function(e) {
    if (vkbVisible && !vkb.contains(e.target) && e.target !== inp) hideVKB();
  });
  document.addEventListener('touchstart', function(e) {
    if (vkbVisible && !vkb.contains(e.target) && e.target !== inp) hideVKB();
  }, {passive:true});
})();
</script>

</body>
</html>
