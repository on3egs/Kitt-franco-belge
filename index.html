<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KITT FRANCO-BELGE // SYSTÈME CENTRAL</title>
<meta name="description" content="Interface KITT Franco-Belge — IA embarquée sur NVIDIA Jetson. Projet fan non commercial par Manix."/>
<meta name="theme-color" content="#000000"/>
<style>
:root{
  --green:#00ff66;
  --green-dim:#00aa44;
  --red:#ff1a1a;
  --amber:#ffaa00;
  --cyan:#00ccff;
  --bg:#000;
}
*{box-sizing:border-box;}
html,body{margin:0;height:100%;background:var(--bg);color:var(--green);font-family:"Courier New",monospace;overflow:hidden;}

/* CRT scanlines */
body::before{content:"";position:fixed;top:0;left:0;right:0;bottom:0;background:repeating-linear-gradient(0deg,rgba(0,0,0,.18),rgba(0,0,0,.18) 1px,transparent 1px,transparent 3px);pointer-events:none;z-index:9998;}
body::after{content:"";position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,255,80,.015);pointer-events:none;z-index:9999;animation:flicker .12s infinite;}
@keyframes flicker{0%{opacity:.88}48%{opacity:1}52%{opacity:.92}100%{opacity:.96}}

/* ── LANGUAGE SELECTION OVERLAY ─────────────────────────── */
#lang-screen{
  position:fixed;top:0;left:0;right:0;bottom:0;
  background:#000;z-index:8000;
  display:flex;align-items:center;justify-content:center;
  padding:16px;
}
#lang-box{
  width:100%;max-width:440px;
  border:1px solid var(--green);
  box-shadow:0 0 40px rgba(0,255,100,.12),inset 0 0 30px rgba(0,255,100,.02);
  font-size:13px;
}
#lang-hdr{
  border-bottom:1px solid var(--green-dim);
  padding:10px 18px;
  color:var(--green);
  letter-spacing:3px;
  font-size:12px;
  text-align:center;
  text-shadow:0 0 10px var(--green);
}
#lang-sub{
  padding:10px 18px 4px;
  color:var(--amber);
  letter-spacing:2px;
  font-size:11px;
  border-bottom:1px solid #111;
}
#lang-output{padding:4px 0;}
.lang-opt{
  display:flex;
  align-items:center;
  gap:14px;
  padding:7px 22px;
  cursor:pointer;
  transition:background .12s;
  border-left:2px solid transparent;
}
.lang-opt:hover{
  background:rgba(0,255,100,.07);
  border-left-color:var(--green);
}
.lang-opt.active{
  background:rgba(0,255,100,.15);
  border-left-color:var(--green);
  color:#000;
}
.lo-n{
  color:var(--red);
  font-size:11px;
  min-width:28px;
  text-align:center;
  border:1px solid var(--red);
  padding:1px 4px;
  letter-spacing:1px;
  flex-shrink:0;
}
.lo-l{color:var(--green);letter-spacing:2px;font-size:13px;}
#lang-ftr{
  border-top:1px solid var(--green-dim);
  padding:8px 18px;
  color:var(--green-dim);
  font-size:10px;
  letter-spacing:2px;
  text-align:center;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:6px;
}

/* ── SCANNER KITT ───────────────────────────────────────── */
#sw{position:fixed;top:0;left:0;right:0;height:3px;overflow:hidden;z-index:1000;}
#sb{position:absolute;top:0;width:200px;height:3px;background:linear-gradient(90deg,transparent,var(--red),var(--red),transparent);box-shadow:0 0 14px 4px var(--red);animation:ks 1.8s ease-in-out infinite alternate;}
#swb{position:fixed;bottom:0;left:0;right:0;height:3px;overflow:hidden;z-index:1000;}
#sbb{position:absolute;top:0;width:200px;height:3px;background:linear-gradient(90deg,transparent,var(--red),var(--red),transparent);box-shadow:0 0 14px 4px var(--red);animation:ks 1.8s ease-in-out infinite alternate-reverse;}
@keyframes ks{0%{left:-200px}100%{left:100%}}

/* ── LAYOUT ─────────────────────────────────────────────── */
.container{display:flex;flex-direction:column;height:100%;padding:16px 20px 20px;gap:0;}

/* ── HEADER ─────────────────────────────────────────────── */
header{flex-shrink:0;display:flex;align-items:center;justify-content:space-between;padding:10px 0 8px;border-bottom:1px solid var(--red);}
.hdr-title{color:var(--red);font-size:18px;letter-spacing:4px;text-shadow:0 0 16px var(--red);animation:pred 3s ease-in-out infinite;}
@keyframes pred{0%,100%{text-shadow:0 0 12px var(--red)}50%{text-shadow:0 0 28px var(--red),0 0 50px rgba(255,26,26,.5)}}
.hdr-right{display:flex;gap:14px;font-size:11px;color:var(--green-dim);align-items:center;}
.sdot{display:inline-block;width:7px;height:7px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green);animation:bd 2s ease-in-out infinite;margin-right:4px;vertical-align:middle;}
@keyframes bd{0%,100%{opacity:1}50%{opacity:.25}}
#lang-flag{font-size:10px;border:1px solid var(--green-dim);padding:1px 5px;letter-spacing:1px;cursor:pointer;color:var(--green-dim);}
#lang-flag:hover{color:var(--green);border-color:var(--green);}

/* ── ASCII ──────────────────────────────────────────────── */
#kitt-ascii{flex-shrink:0;text-align:center;color:var(--red);font-size:10px;line-height:1.2;text-shadow:0 0 8px var(--red);padding:6px 0 4px;opacity:.85;user-select:none;}

/* ── TERMINAL ───────────────────────────────────────────── */
#terminal{flex:1;overflow-y:auto;overflow-x:hidden;padding:8px 4px;font-size:13px;line-height:1.65;scrollbar-width:thin;scrollbar-color:var(--red) #111;}
#terminal::-webkit-scrollbar{width:4px}
#terminal::-webkit-scrollbar-track{background:#111}
#terminal::-webkit-scrollbar-thumb{background:var(--red)}
.line-ok{color:var(--green);}
.line-warn{color:var(--amber);}
.line-err{color:var(--red);}
.line-info{color:var(--cyan);}
.line-dim{color:var(--green-dim);}
.cursor{display:inline-block;width:8px;height:13px;background:var(--green);vertical-align:text-bottom;animation:bc .7s step-end infinite;}
@keyframes bc{0%,100%{opacity:1}50%{opacity:0}}

/* ── BUTTONS ────────────────────────────────────────────── */
.btn-row{flex-shrink:0;display:flex;flex-wrap:wrap;gap:6px;padding:8px 0 6px;border-top:1px solid #1a1a1a;border-bottom:1px solid #1a1a1a;}
button{background:#000;border:1px solid var(--green);color:var(--green);padding:7px 14px;cursor:pointer;font-family:inherit;font-size:12px;letter-spacing:1px;transition:all .15s;position:relative;overflow:hidden;}
button::before{content:"";position:absolute;inset:0;background:var(--green);transform:scaleX(0);transform-origin:left;transition:transform .15s;z-index:-1;}
button:hover{color:#000;}button:hover::before{transform:scaleX(1);}
button:active{transform:scale(.95);}
.btn-red{border-color:var(--red);color:var(--red);}
.btn-red::before{background:var(--red);}
.btn-cyan{border-color:var(--cyan);color:var(--cyan);}
.btn-cyan::before{background:var(--cyan);}

/* ── INPUT ──────────────────────────────────────────────── */
.input-row{flex-shrink:0;display:flex;gap:8px;padding-top:8px;align-items:center;}
.prompt-lbl{color:var(--red);font-size:13px;white-space:nowrap;text-shadow:0 0 8px var(--red);}
#cmd-input{flex:1;background:transparent;border:none;border-bottom:1px solid var(--green);color:var(--green);font-family:inherit;font-size:13px;outline:none;padding:4px 0;caret-color:var(--green);}
#cmd-input::placeholder{color:var(--green-dim);opacity:.55;}

/* ── MODAL ──────────────────────────────────────────────── */
.modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.95);display:none;flex-direction:column;padding:30px;overflow:auto;z-index:5000;border:1px solid var(--red);}
.modal.open{display:flex;}
.modal-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;border-bottom:1px solid var(--red);padding-bottom:8px;}
.modal-title{color:var(--red);font-size:16px;letter-spacing:3px;text-shadow:0 0 10px var(--red);}
.close-btn{cursor:pointer;color:var(--red);font-size:20px;padding:4px 8px;border:1px solid var(--red);transition:all .15s;}
.close-btn:hover{background:var(--red);color:#000;}
.modal pre{white-space:pre-wrap;color:var(--green);font-family:monospace;font-size:13px;line-height:1.7;}

/* ── MOBILE ─────────────────────────────────────────────── */
@media(max-width:600px){
  .hdr-title{font-size:13px;letter-spacing:2px;}
  #kitt-ascii{font-size:8px;}
  button{padding:6px 10px;font-size:11px;}
  #terminal{font-size:12px;}
  #lang-box{padding:20px;}
}
@media(max-width:380px){#kitt-ascii{display:none;}}

/* ── BOUTON TUNNEL CLOUDFLARE ───────────────────────────────── */
#btn-tunnel{border-color:#333;color:#333;transition:all .2s;}
#btn-tunnel.tunnel-online{
  border-color:var(--green);color:var(--green);
  animation:tpulse 2.4s ease-in-out infinite;}
#btn-tunnel.tunnel-offline{border-color:var(--red);color:var(--red);}
#btn-tunnel.tunnel-checking{border-color:var(--amber);color:var(--amber);}
@keyframes tpulse{0%,100%{box-shadow:0 0 5px rgba(0,255,102,.25)}50%{box-shadow:0 0 18px rgba(0,255,102,.65),inset 0 0 8px rgba(0,255,102,.08)}}

/* ── FOND JARVIS HOLOGRAPHIQUE ──────────────────────────── */
.container{position:relative;z-index:1;}
#jarvis-svg{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%) translate3d(0,0,0);
  width:min(90vw,90vh);height:min(90vw,90vh);
  pointer-events:none;z-index:0;opacity:0.45;
}
#sphere-wrap{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%);
  width:180px;height:180px;
  perspective:500px;
  pointer-events:none;z-index:0;opacity:0.22;
}
#sphere-3d{
  width:100%;height:100%;
  transform-style:preserve-3d;
  animation:srot 22s linear infinite;
}
@keyframes srot{from{transform:rotateX(22deg) rotateY(0deg)}to{transform:rotateX(22deg) rotateY(360deg)}}
.s-mer,.s-par{
  position:absolute;top:0;left:0;width:100%;height:100%;
  border-radius:50%;border:1px solid var(--green);box-sizing:border-box;
  opacity:0.7;
}
.s-core{
  position:absolute;top:50%;left:50%;
  width:18px;height:18px;margin:-9px 0 0 -9px;
  border-radius:50%;
  background:radial-gradient(circle,var(--green),transparent);
  box-shadow:0 0 20px var(--green),0 0 40px rgba(0,255,102,.4);
  animation:score 3s ease-in-out infinite;
}
@keyframes score{0%,100%{opacity:.6}50%{opacity:1}}

/* ── COMPTEUR VISITES ───────────────────────────────────── */
#visit-counter{
  position:fixed;left:6px;top:50%;transform:translateY(-50%);
  writing-mode:vertical-rl;text-orientation:mixed;
  font-size:9px;color:var(--green-dim);letter-spacing:2px;
  opacity:.35;pointer-events:none;z-index:100;
  text-shadow:0 0 4px var(--green-dim);
  user-select:none;
}

/* ── FOOTER VERSION ─────────────────────────────────────── */
#site-footer{
  position:fixed;bottom:14px;left:50%;transform:translateX(-50%);
  font-size:9px;color:var(--green-dim);letter-spacing:2px;
  opacity:.3;pointer-events:none;z-index:1001;
  white-space:nowrap;user-select:none;
}
</style>
</head>
<body>

<!-- Language selection overlay -->
<div id="lang-screen">
  <div id="lang-box">
    <div id="lang-hdr"></div>
    <div id="lang-sub"></div>
    <div id="lang-output"></div>
    <div id="lang-ftr"></div>
  </div>
</div>

<!-- Fond Jarvis holographique -->
<svg id="jarvis-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400" preserveAspectRatio="xMidYMid meet">
  <g stroke="#00ff66" fill="none">
    <!-- Anneau externe -->
    <circle cx="200" cy="200" r="185" stroke-opacity="0.6" stroke-width="1">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </circle>
    <!-- Anneau moyen -->
    <circle cx="200" cy="200" r="135" stroke-opacity="0.5" stroke-width="0.8">
      <animateTransform attributeName="transform" type="rotate" from="360 200 200" to="0 200 200" dur="45s" repeatCount="indefinite"/>
    </circle>
    <!-- Anneau interne -->
    <circle cx="200" cy="200" r="85" stroke-opacity="0.45" stroke-width="0.7">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="32s" repeatCount="indefinite"/>
    </circle>
    <!-- Spokes -->
    <line x1="200" y1="15" x2="200" y2="385" stroke-opacity="0.18" stroke-width="0.5">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <line x1="15" y1="200" x2="385" y2="200" stroke-opacity="0.18" stroke-width="0.5">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <!-- Arc scanner lumineux -->
    <path d="M 200 15 A 185 185 0 0 1 385 200" stroke-opacity="0.9" stroke-width="2" stroke="#00ff66">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="8s" repeatCount="indefinite"/>
    </path>
    <!-- Marqueurs HUD sur anneau externe -->
    <line x1="200" y1="15" x2="200" y2="30" stroke-opacity="0.7" stroke-width="1.5">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <line x1="200" y1="15" x2="200" y2="25" stroke-opacity="0.5" stroke-width="1">
      <animateTransform attributeName="transform" type="rotate" from="45 200 200" to="405 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <!-- Centre pulsant -->
    <circle cx="200" cy="200" r="5" fill="#00ff66" opacity="0.7">
      <animate attributeName="opacity" values="0.3;1;0.3" dur="3s" repeatCount="indefinite"/>
      <animate attributeName="r" values="4;7;4" dur="3s" repeatCount="indefinite"/>
    </circle>
  </g>
</svg>
<div id="sphere-wrap">
  <div id="sphere-3d">
    <div class="s-mer" style="transform:rotateY(0deg)"></div>
    <div class="s-mer" style="transform:rotateY(30deg)"></div>
    <div class="s-mer" style="transform:rotateY(60deg)"></div>
    <div class="s-mer" style="transform:rotateY(90deg)"></div>
    <div class="s-mer" style="transform:rotateY(120deg)"></div>
    <div class="s-mer" style="transform:rotateY(150deg)"></div>
    <div class="s-par" style="transform:translateY(-44px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(-22px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(0px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(22px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(44px) rotateX(90deg)"></div>
    <div class="s-core"></div>
  </div>
</div>
<div id="visit-counter"></div>
<div id="site-footer">v3.0 &nbsp;—&nbsp; DERNIÈRE MISE À JOUR : 2026-02-20</div>

<!-- Scanners -->
<div id="sw"><div id="sb"></div></div>
<div id="swb"><div id="sbb"></div></div>

<div class="container">
  <header>
    <div id="hdr-title" class="hdr-title">KITT FRANCO-BELGE // INTERFACE CENTRALE</div>
    <div class="hdr-right">
      <span id="lang-flag" onclick="showLangScreen()" title="Changer de langue">FR</span>
      <span><span class="sdot"></span><span id="status-txt">EN LIGNE</span></span>
      <span id="clock">00:00:00</span>
    </div>
  </header>

  <div id="kitt-ascii"><pre>
  ██╗  ██╗██╗████████╗████████╗
  ██║ ██╔╝██║╚══██╔══╝╚══██╔══╝
  █████╔╝ ██║   ██║      ██║
  ██╔═██╗ ██║   ██║      ██║
  ██║  ██╗██║   ██║      ██║
  ╚═╝  ╚═╝╚═╝   ╚═╝      ╚═╝
    FRANCO-BELGE  //  BY MANIX</pre></div>

  <div id="terminal"></div>

  <div class="btn-row">
    <button id="btn-boot" onclick="boot()">[ INITIALISER ]</button>
    <button id="btn-diag" onclick="runSelfTest()" class="btn-cyan">[ DIAGNOSTIC ]</button>
    <button id="btn-mentions" onclick="openFile('Mentions.txt',T[LANG].modal_mentions)" class="btn-red">[ MENTIONS ]</button>
    <button id="btn-licence" onclick="openFile('License.txt',T[LANG].modal_licence)" class="btn-red">[ LICENCE ]</button>
    <button id="btn-clear" onclick="clearTerm()">[ EFFACER ]</button>
    <button id="btn-tunnel" class="tunnel-checking" onclick="connectTunnel()" title="Vérification..."><span id="btn-tunnel-txt">[ CONNEXION KITT ]</span></button>
  </div>

  <div class="input-row">
    <span class="prompt-lbl">KITT&gt;</span>
    <input id="cmd-input" type="text" placeholder="entrez une commande..." autocomplete="off" spellcheck="false"/>
  </div>
</div>

<!-- Modal -->
<div id="modal" class="modal">
  <div class="modal-hdr">
    <span class="modal-title" id="modal-title">DOCUMENT</span>
    <span class="close-btn" onclick="closeModal()">&#10006;</span>
  </div>
  <pre id="modal-content"></pre>
</div>

<script>
// ════════════════════════════════════════════════════════════
// AUDIO ENGINE — Pool de sons variés style années 80
// ════════════════════════════════════════════════════════════
const _ac = new (window.AudioContext || window.webkitAudioContext)();

function _resume() { if (_ac.state === 'suspended') _ac.resume(); }

// ── Son 1 : MU-TH-UR click (principal) ──────────────────────
function sndClick() {
  try {
    _resume(); const t = _ac.currentTime;
    const len = Math.floor(_ac.sampleRate * 0.020);
    const buf = _ac.createBuffer(1, len, _ac.sampleRate);
    const d = buf.getChannelData(0);
    for (let i = 0; i < len; i++) d[i] = (Math.random()*2-1) * Math.pow(1-i/len, 3.5);
    const src = _ac.createBufferSource(); src.buffer = buf;
    const bp = _ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=2700+Math.random()*400; bp.Q.value=4;
    const hp = _ac.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=850;
    const g = _ac.createGain(); g.gain.value=0.25;
    src.connect(bp); bp.connect(hp); hp.connect(g); g.connect(_ac.destination); src.start(t);
    // tick électronique
    const o = _ac.createOscillator(); o.type='square';
    o.frequency.setValueAtTime(1350+Math.random()*200, t);
    o.frequency.exponentialRampToValueAtTime(680, t+0.017);
    const og = _ac.createGain(); og.gain.setValueAtTime(0.04, t); og.gain.exponentialRampToValueAtTime(0.001, t+0.020);
    o.connect(og); og.connect(_ac.destination); o.start(t); o.stop(t+0.022);
  } catch(e){}
}

// ── Son 2 : tick léger (haute fréquence, sous-entendu) ──────
function sndTick() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='triangle';
    o.frequency.setValueAtTime(3800+Math.random()*400, t);
    o.frequency.exponentialRampToValueAtTime(2400, t+0.012);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.03, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.015);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.016);
  } catch(e){}
}

// ── Son 3 : impulsion données (caractères spéciaux) ──────────
function sndData() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='sawtooth';
    o.frequency.value = 1800 + Math.random()*600;
    const g = _ac.createGain(); g.gain.setValueAtTime(0.05, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.012);
    const lp = _ac.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=4000;
    o.connect(lp); lp.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.013);
  } catch(e){}
}

// ── Son 4 : glitch numérique (rare, surprenant) ──────────────
function sndGlitch() {
  try {
    _resume(); const t = _ac.currentTime;
    const len = Math.floor(_ac.sampleRate * 0.035);
    const buf = _ac.createBuffer(1, len, _ac.sampleRate);
    const d = buf.getChannelData(0);
    for (let i = 0; i < len; i++) d[i] = (Math.random()*2-1) * (Math.random() > 0.5 ? 0.9 : 0.05);
    const src = _ac.createBufferSource(); src.buffer=buf;
    const bp = _ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=1200; bp.Q.value=2;
    const g = _ac.createGain(); g.gain.value=0.12;
    src.connect(bp); bp.connect(g); g.connect(_ac.destination); src.start(t);
  } catch(e){}
}

// ── Son 5 : fin de ligne (souffle court) ────────────────────
function sndLineEnd() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(900, t);
    o.frequency.exponentialRampToValueAtTime(600, t+0.06);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.028, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.07);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.08);
  } catch(e){}
}

// ── Son 6 : sélection / confirmation ────────────────────────
function sndSelect() {
  try {
    _resume(); const t = _ac.currentTime;
    [440,660,880].forEach((f,i) => {
      const o = _ac.createOscillator(); o.type='square'; o.frequency.value=f;
      const g = _ac.createGain(); g.gain.setValueAtTime(0.04, t+i*0.06); g.gain.exponentialRampToValueAtTime(0.001, t+i*0.06+0.05);
      o.connect(g); g.connect(_ac.destination); o.start(t+i*0.06); o.stop(t+i*0.06+0.055);
    });
  } catch(e){}
}

// ── Son 7 : erreur (buzzer court) ────────────────────────────
function sndError() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='square'; o.frequency.value=180;
    const g = _ac.createGain(); g.gain.setValueAtTime(0.07, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.08);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.09);
  } catch(e){}
}

// ── Son 8 : chime KITT (sweep descendant) ───────────────────
function kittChime() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(880, t); o.frequency.exponentialRampToValueAtTime(220, t+0.35);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.1, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.4);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.4);
  } catch(e){}
}

// ── Dispatch : choisit le bon son par caractère ──────────────
const SPECIAL_CHARS = new Set([...'[]():=|─══╔╗╚╝║┌┐└┘├┤•★★']);
let _charCount = 0;

function playChar(ch) {
  if (ch === ' ' || ch === '\n') return;
  _charCount++;
  const r = Math.random();
  if (SPECIAL_CHARS.has(ch)) { sndData(); return; }
  if (_charCount % 47 === 0) { sndGlitch(); return; }  // glitch rare
  if (r < 0.03) { sndGlitch(); return; }
  if (r < 0.14) { sndTick();   return; }
  if (r < 0.72) { sndClick();  return; }
  // ~28% silence = variété naturelle
}

// ════════════════════════════════════════════════════════════
// LANGUE — Système de localisation
// ════════════════════════════════════════════════════════════
let LANG = 'fr';

const T = {
  fr: {
    hdr_title:    'KITT FRANCO-BELGE // INTERFACE CENTRALE',
    placeholder:  'entrez une commande...',
    btn_boot:     '[ INITIALISER ]',
    btn_diag:     '[ DIAGNOSTIC ]',
    btn_mentions: '[ MENTIONS ]',
    btn_licence:  '[ LICENCE ]',
    btn_clear:    '[ EFFACER ]',
    btn_tunnel:   '[ CONNEXION KITT ]',
    modal_mentions:'MENTIONS LÉGALES',
    modal_licence: 'LICENCE',
    wait:       'SYSTÈME EN ATTENTE — TAPEZ "boot" OU CLIQUEZ [ INITIALISER ]',
    help_hint:  'TAPEZ "aide" POUR LA LISTE DES COMMANDES.',
    cleared:    'TERMINAL EFFACÉ.',
    unknown:    (c) => `COMMANDE INCONNUE : "${c}". TAPEZ "aide".`,
    online:     'EN LIGNE',
    boot_title: '  KITT FRANCO-BELGE — SÉQUENCE DE BOOT   ',
    boot_lines: [
      ['INITIALISATION DU NOYAU SYSTÈME...', 'line-warn'],
      ['CHARGEMENT MODULES COGNITIFS...    [OK]', 'line-ok'],
      ['INTERFACE NEURONALE...             [OK]', 'line-ok'],
      ['SYNTHÈSE VOCALE (PIPER-GPU)...     [OK]', 'line-ok'],
      ['RECONNAISSANCE VOCALE (WHISPER)... [OK]', 'line-ok'],
      ['MODÈLE LLM EMBARQUÉ (QWEN 3B)...  [OK]', 'line-ok'],
      ['MODE HORS-LIGNE...                 [ACTIVÉ]', 'line-ok'],
      ['', 'line-ok'],
      ['PROJET FAN NON COMMERCIAL.', 'line-dim'],
      ['STATUT : INTERFACE EN CONSTRUCTION ACTIVE.', 'line-warn'],
      ['', 'line-ok'],
      ['MISES À JOUR DÉPLOYÉES RÉGULIÈREMENT :', 'line-info'],
      ['  • parfois chaque jour', 'line-dim'],
      ['  • parfois chaque semaine', 'line-dim'],
      ['  • lors de certaines phases, presque heure par heure', 'line-dim'],
      ['', 'line-ok'],
      ['© 2026 EMMANUEL GELINNE (MANIX). TOUS DROITS RÉSERVÉS.', 'line-warn'],
    ],
    boot_end:   '  CONNEXION AU NOYAU KITT ÉTABLIE.',
    boot_hint:  '  TAPEZ "aide" POUR LA LISTE DES COMMANDES',
    aide_title: 'COMMANDES DISPONIBLES :',
    aide_sys:   '── SYSTÈME ──',
    aide_fun:   '── FUN ──',
    cmds_sys: [
      ['aide',       'cette liste'],
      ['boot',       "séquence d'initialisation"],
      ['diagnostic', 'test complet des systèmes'],
      ['status',     'état rapide'],
      ['heure',      'heure actuelle'],
      ['version',    "version de l'interface"],
      ['son',        'démo audio'],
      ['clear',      'efface le terminal'],
    ],
    cmds_fun: [
      ['bonjour',    'salutation KITT'],
      ['blague',     'blague KITT aléatoire'],
      ['alien',      'connexion MU-TH-UR 6000'],
      ['matrix',     'le lapin blanc'],
      ['kitt',       'fiche identité KITT'],
      ['manix',      'dossier conducteur'],
      ['cedric',     'dossier Cedric Momo Rider'],
      ['kr95',       'dossier KR95'],
      ['repliques',  'les répliques franco-belges'],
      ['secret',     'fichier classifié...'],
      ['cafe',       'demander un café à KITT'],
      ['belgique',   'analyse géopolitique'],
      ['jarvis',     'appel vers Stark Tower'],
      ['mario',      'dossier Mario Ravasi / IoT'],
      ['za',         'dossier ZA Elettronica'],
      ['pascal',     'dossier K Industrie'],
      ['daemon',     'dossier Daemon Paule'],
      ['geoffrey',   'dossier Geoffrey'],
      ['covid',      'origine du projet — confinement 2020'],
    ],
    hi:  'BONJOUR. JE SUIS KITT — KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'SYSTÈME FRANCO-BELGE DÉVELOPPÉ PAR MANIX.',
    hi3: 'À VOTRE SERVICE.',
  },
  en: {
    hdr_title:    'KITT FRANCO-BELGIAN // CENTRAL INTERFACE',
    placeholder:  'enter a command...',
    btn_boot:     '[ INITIALIZE ]',
    btn_diag:     '[ DIAGNOSTIC ]',
    btn_mentions: '[ MENTIONS ]',
    btn_licence:  '[ LICENSE ]',
    btn_clear:    '[ CLEAR ]',
    btn_tunnel:   '[ CONNECT KITT ]',
    modal_mentions:'LEGAL NOTICES',
    modal_licence: 'LICENSE',
    wait:       'SYSTEM STANDBY — TYPE "boot" OR CLICK [ INITIALIZE ]',
    help_hint:  'TYPE "help" FOR THE LIST OF COMMANDS.',
    cleared:    'TERMINAL CLEARED.',
    unknown:    (c) => `UNKNOWN COMMAND: "${c}". TYPE "help".`,
    online:     'ONLINE',
    boot_title: '  KITT FRANCO-BELGE — BOOT SEQUENCE        ',
    boot_lines: [
      ['INITIALIZING CORE SYSTEM...', 'line-warn'],
      ['LOADING COGNITIVE MODULES...       [OK]', 'line-ok'],
      ['NEURAL INTERFACE...                [OK]', 'line-ok'],
      ['VOICE SYNTHESIS (PIPER-GPU)...     [OK]', 'line-ok'],
      ['VOICE RECOGNITION (WHISPER)...     [OK]', 'line-ok'],
      ['EMBEDDED LLM (QWEN 3B)...          [OK]', 'line-ok'],
      ['OFFLINE MODE...                    [ACTIVE]', 'line-ok'],
      ['', 'line-ok'],
      ['FAN PROJECT — NON COMMERCIAL.', 'line-dim'],
      ['STATUS : INTERFACE UNDER ACTIVE CONSTRUCTION.', 'line-warn'],
      ['', 'line-ok'],
      ['UPDATES DEPLOYED REGULARLY :', 'line-info'],
      ['  • sometimes every day', 'line-dim'],
      ['  • sometimes every week', 'line-dim'],
      ['  • during some phases, almost hour by hour', 'line-dim'],
      ['', 'line-ok'],
      ['© 2026 EMMANUEL GELINNE (MANIX). ALL RIGHTS RESERVED.', 'line-warn'],
    ],
    boot_end:   '  CONNECTION TO KITT CORE ESTABLISHED.',
    boot_hint:  '  TYPE "help" FOR THE COMMAND LIST',
    aide_title: 'AVAILABLE COMMANDS:',
    aide_sys:   '── SYSTEM ──',
    aide_fun:   '── FUN ──',
    cmds_sys: [
      ['help',       'this list'],
      ['boot',       'boot sequence'],
      ['diagnostic', 'full system test'],
      ['status',     'quick status'],
      ['time',       'current time'],
      ['version',    'interface version'],
      ['sound',      'audio demo'],
      ['clear',      'clear terminal'],
    ],
    cmds_fun: [
      ['hello',      'KITT greeting'],
      ['joke',       'random KITT joke'],
      ['alien',      'MU-TH-UR 6000 connection'],
      ['matrix',     'the white rabbit'],
      ['kitt',       'KITT identity file'],
      ['manix',      'driver file'],
      ['cedric',     'Cedric Momo Rider file'],
      ['kr95',       'KR95 file'],
      ['replicas',   'the franco-belgian replicas'],
      ['secret',     'classified file...'],
      ['coffee',     'ask KITT for a coffee'],
      ['belgium',    'geopolitical analysis'],
      ['jarvis',     'call to Stark Tower'],
      ['mario',      'Mario Ravasi / IoT file'],
      ['za',         'ZA Elettronica file'],
      ['pascal',     'K Industrie file'],
      ['daemon',     'Daemon Paule file'],
      ['geoffrey',   'Geoffrey file'],
      ['covid',      'project origin — lockdown 2020'],
    ],
    hi:  'HELLO. I AM KITT — KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'FRANCO-BELGIAN SYSTEM DEVELOPED BY MANIX.',
    hi3: 'AT YOUR SERVICE.',
  },
  nl: {
    hdr_title:    'KITT FRANCO-BELGISCH // CENTRALE INTERFACE',
    placeholder:  'voer een commando in...',
    btn_boot:     '[ OPSTARTEN ]',
    btn_diag:     '[ DIAGNOSE ]',
    btn_mentions: '[ VERMELDINGEN ]',
    btn_licence:  '[ LICENTIE ]',
    btn_clear:    '[ WISSEN ]',
    btn_tunnel:   '[ VERBIND KITT ]',
    modal_mentions:'WETTELIJKE VERMELDINGEN',
    modal_licence: 'LICENTIE',
    wait:       'SYSTEEM WACHT — TYP "boot" OF KLIK [ OPSTARTEN ]',
    help_hint:  'TYP "hulp" VOOR DE COMMANDOLIJST.',
    cleared:    'TERMINAL GEWIST.',
    unknown:    (c) => `ONBEKEND COMMANDO: "${c}". TYP "hulp".`,
    online:     'ONLINE',
    boot_title: '  KITT FRANCO-BELGE — OPSTARTSEQUENTIE     ',
    boot_lines: [
      ['KERNSYSTEEM INITIALISEREN...', 'line-warn'],
      ['COGNITIEVE MODULES LADEN...        [OK]', 'line-ok'],
      ['NEURALE INTERFACE...               [OK]', 'line-ok'],
      ['SPRAAKSYNTHESE (PIPER-GPU)...      [OK]', 'line-ok'],
      ['STEMHERKENNING (WHISPER)...        [OK]', 'line-ok'],
      ['EMBEDDED LLM (QWEN 3B)...          [OK]', 'line-ok'],
      ['OFFLINE MODUS...                   [ACTIEF]', 'line-ok'],
      ['', 'line-ok'],
      ['FAN PROJECT — NIET COMMERCIEEL.', 'line-dim'],
      ['STATUS : INTERFACE IN ACTIEVE CONSTRUCTIE.', 'line-warn'],
      ['', 'line-ok'],
      ['UPDATES REGELMATIG UITGEROLD :', 'line-info'],
      ['  • soms elke dag', 'line-dim'],
      ['  • soms elke week', 'line-dim'],
      ['  • soms elk uur', 'line-dim'],
      ['', 'line-ok'],
      ['© 2026 EMMANUEL GELINNE (MANIX). ALLE RECHTEN VOORBEHOUDEN.', 'line-warn'],
    ],
    boot_end:   '  VERBINDING MET KITT-KERN TOT STAND GEBRACHT.',
    boot_hint:  '  TYP "hulp" VOOR DE COMMANDOLIJST',
    aide_title: 'BESCHIKBARE COMMANDO\'S:',
    aide_sys:   '── SYSTEEM ──',
    aide_fun:   '── PLEZIER ──',
    cmds_sys: [
      ['hulp',       'deze lijst'],
      ['boot',       'opstartsequentie'],
      ['diagnostic', 'volledig systeemtest'],
      ['status',     'snelle status'],
      ['tijd',       'huidige tijd'],
      ['versie',     'interface versie'],
      ['geluid',     'audio demo'],
      ['clear',      'terminal wissen'],
    ],
    cmds_fun: [
      ['hallo',      'KITT begroeting'],
      ['grap',       'willekeurige KITT grap'],
      ['alien',      'MU-TH-UR 6000 verbinding'],
      ['matrix',     'het witte konijn'],
      ['kitt',       'KITT identiteitsbestand'],
      ['manix',      'bestuurdersdossier'],
      ['cedric',     'Cedric Momo Rider dossier'],
      ['kr95',       'KR95 dossier'],
      ['replicas',   'de franco-belgische replica\'s'],
      ['geheim',     'geheim bestand...'],
      ['koffie',     'KITT om koffie vragen'],
      ['belgie',     'geopolitieke analyse'],
      ['jarvis',     'oproep naar Stark Tower'],
      ['mario',      'Mario Ravasi / IoT dossier'],
      ['za',         'ZA Elettronica dossier'],
      ['pascal',     'K Industrie dossier'],
      ['daemon',     'Daemon Paule dossier'],
      ['geoffrey',   'Geoffrey dossier'],
      ['covid',      'projectoorsprong — lockdown 2020'],
    ],
    hi:  'HALLO. IK BEN KITT — KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'FRANCO-BELGISCH SYSTEEM ONTWIKKELD DOOR MANIX.',
    hi3: 'TOT UW DIENST.',
  },

  it: {
    hdr_title:    'KITT FRANCO-BELGA // INTERFACCIA CENTRALE',
    placeholder:  'inserisci un comando...',
    btn_boot:     '[ INIZIALIZZA ]',
    btn_diag:     '[ DIAGNOSI ]',
    btn_mentions: '[ MENZIONI ]',
    btn_licence:  '[ LICENZA ]',
    btn_clear:    '[ CANCELLA ]',
    btn_tunnel:   '[ CONNETTI KITT ]',
    modal_mentions:'NOTE LEGALI',
    modal_licence: 'LICENZA',
    wait:       'SISTEMA IN ATTESA — DIGITA "boot" O CLICCA [ INIZIALIZZA ]',
    help_hint:  'DIGITA "aiuto" PER LA LISTA DEI COMANDI.',
    cleared:    'TERMINALE CANCELLATO.',
    unknown:    (c) => `COMANDO SCONOSCIUTO: "${c}". DIGITA "aiuto".`,
    online:     'IN LINEA',
    boot_title: '  KITT FRANCO-BELGA — SEQUENZA DI AVVIO     ',
    boot_lines: [
      ['INIZIALIZZAZIONE SISTEMA...', 'line-warn'],
      ['CARICAMENTO MODULI COGNITIVI...    [OK]', 'line-ok'],
      ['INTERFACCIA NEURALE...             [OK]', 'line-ok'],
      ['SINTESI VOCALE (PIPER-GPU)...      [OK]', 'line-ok'],
      ['RICONOSCIMENTO VOCALE (WHISPER)... [OK]', 'line-ok'],
      ['MODELLO LLM LOCALE (QWEN 3B)...   [OK]', 'line-ok'],
      ['MODALITÀ OFFLINE...                [ATTIVA]', 'line-ok'],
      ['', 'line-ok'],
      ['PROGETTO FAN — NON COMMERCIALE.', 'line-dim'],
      ['STATO : INTERFACCIA IN COSTRUZIONE ATTIVA.', 'line-warn'],
      ['', 'line-ok'],
      ['AGGIORNAMENTI DISTRIBUITI REGOLARMENTE :', 'line-info'],
      ['  • a volte ogni giorno', 'line-dim'],
      ['  • a volte ogni settimana', 'line-dim'],
      ['  • in alcune fasi, quasi ogni ora', 'line-dim'],
      ['', 'line-ok'],
      ['© 2026 EMMANUEL GELINNE (MANIX). TUTTI I DIRITTI RISERVATI.', 'line-warn'],
    ],
    boot_end:   '  CONNESSIONE AL NUCLEO KITT STABILITA.',
    boot_hint:  '  DIGITA "aiuto" PER LA LISTA DEI COMANDI',
    aide_title: 'COMANDI DISPONIBILI:',
    aide_sys:   '── SISTEMA ──',
    aide_fun:   '── DIVERTIMENTO ──',
    cmds_sys: [
      ['aiuto',      'questa lista'],
      ['boot',       'sequenza di avvio'],
      ['diagnostic', 'test completo del sistema'],
      ['status',     'stato rapido'],
      ['ora',        'ora corrente'],
      ['version',    'versione interfaccia'],
      ['suono',      'demo audio'],
      ['clear',      'cancella terminale'],
    ],
    cmds_fun: [
      ['ciao',       'saluto KITT'],
      ['barzelletta', 'barzelletta casuale KITT'],
      ['alien',      'connessione MU-TH-UR 6000'],
      ['matrix',     'il coniglio bianco'],
      ['kitt',       'scheda identità KITT'],
      ['manix',      'dossier pilota'],
      ['cedric',     'dossier Cedric Momo Rider'],
      ['kr95',       'dossier KR95'],
      ['replicas',   'le repliche franco-belghe'],
      ['segreto',    'file classificato...'],
      ['caffe',      'chiedere un caffè a KITT'],
      ['belgio',     'analisi geopolitica'],
      ['jarvis',     'chiamata verso Stark Tower'],
      ['mario',      'dossier Mario Ravasi / IoT'],
      ['za',         'dossier ZA Elettronica'],
      ['pascal',     'dossier K Industrie'],
      ['daemon',     'dossier Daemon Paule'],
      ['geoffrey',   'dossier Geoffrey'],
      ['covid',      'origine del progetto — lockdown 2020'],
    ],
    hi:  'CIAO. SONO KITT — KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'SISTEMA FRANCO-BELGA SVILUPPATO DA MANIX.',
    hi3: 'AL VOSTRO SERVIZIO.',
  },

  de: {
    hdr_title:    'KITT FRANCO-BELGISCH // ZENTRALE SCHNITTSTELLE',
    placeholder:  'Befehl eingeben...',
    btn_boot:     '[ INITIALISIEREN ]',
    btn_diag:     '[ DIAGNOSE ]',
    btn_mentions: '[ IMPRESSUM ]',
    btn_licence:  '[ LIZENZ ]',
    btn_clear:    '[ LÖSCHEN ]',
    btn_tunnel:   '[ KITT VERBINDEN ]',
    modal_mentions:'IMPRESSUM',
    modal_licence: 'LIZENZ',
    wait:       'SYSTEM BEREIT — TIPPE "boot" ODER KLICKE [ INITIALISIEREN ]',
    help_hint:  'TIPPE "hilfe" FÜR DIE BEFEHLSLISTE.',
    cleared:    'TERMINAL GELEERT.',
    unknown:    (c) => `UNBEKANNTER BEFEHL: "${c}". TIPPE "hilfe".`,
    online:     'ONLINE',
    boot_title: '  KITT FRANCO-BELGISCH — STARTSEQUENZ        ',
    boot_lines: [
      ['KERNSYSTEM WIRD INITIALISIERT...', 'line-warn'],
      ['KOGNITIVE MODULE LADEN...          [OK]', 'line-ok'],
      ['NEURONALE SCHNITTSTELLE...         [OK]', 'line-ok'],
      ['SPRACHSYNTHESE (PIPER-GPU)...      [OK]', 'line-ok'],
      ['SPRACHERKENNUNG (WHISPER)...       [OK]', 'line-ok'],
      ['LOKALES LLM (QWEN 3B)...           [OK]', 'line-ok'],
      ['OFFLINE-MODUS...                   [AKTIV]', 'line-ok'],
      ['', 'line-ok'],
      ['FAN-PROJEKT — NICHT KOMMERZIELL.', 'line-dim'],
      ['STATUS : SCHNITTSTELLE IM AUFBAU.', 'line-warn'],
      ['', 'line-ok'],
      ['UPDATES REGELMÄSSIG VERFÜGBAR :', 'line-info'],
      ['  • manchmal täglich', 'line-dim'],
      ['  • manchmal wöchentlich', 'line-dim'],
      ['  • manchmal stündlich', 'line-dim'],
      ['', 'line-ok'],
      ['© 2026 EMMANUEL GELINNE (MANIX). ALLE RECHTE VORBEHALTEN.', 'line-warn'],
    ],
    boot_end:   '  VERBINDUNG ZUM KITT-KERN HERGESTELLT.',
    boot_hint:  '  TIPPE "hilfe" FÜR DIE BEFEHLSLISTE',
    aide_title: 'VERFÜGBARE BEFEHLE:',
    aide_sys:   '── SYSTEM ──',
    aide_fun:   '── SPASS ──',
    cmds_sys: [
      ['hilfe',      'diese Liste'],
      ['boot',       'Startsequenz'],
      ['diagnostic', 'vollständiger Systemtest'],
      ['status',     'schneller Status'],
      ['uhrzeit',    'aktuelle Uhrzeit'],
      ['version',    'Schnittstellenversion'],
      ['ton',        'Audio-Demo'],
      ['clear',      'Terminal leeren'],
    ],
    cmds_fun: [
      ['hallo',      'KITT-Begrüßung'],
      ['witz',       'zufälliger KITT-Witz'],
      ['alien',      'MU-TH-UR 6000 Verbindung'],
      ['matrix',     'das weiße Kaninchen'],
      ['kitt',       'KITT Identitätsakte'],
      ['manix',      'Fahrerakte'],
      ['cedric',     'Cedric Momo Rider Akte'],
      ['kr95',       'KR95 Akte'],
      ['replicas',   'die franco-belgischen Repliken'],
      ['geheimnis',  'geheime Akte...'],
      ['kaffee',     'KITT um Kaffee bitten'],
      ['belgien',    'geopolitische Analyse'],
      ['jarvis',     'Anruf bei Stark Tower'],
      ['mario',      'Mario Ravasi / IoT Akte'],
      ['za',         'ZA Elettronica Akte'],
      ['pascal',     'K Industrie Akte'],
      ['damon',      'Damon Paule Akte'],
      ['geoffrey',   'Geoffrey Akte'],
      ['covid',      'Projektherkunft — Lockdown 2020'],
    ],
    hi:  'HALLO. ICH BIN KITT — KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'FRANCO-BELGISCHES SYSTEM ENTWICKELT VON MANIX.',
    hi3: 'ZU IHREN DIENSTEN.',
  },

  es: {
    hdr_title:    'KITT FRANCO-BELGA // INTERFAZ CENTRAL',
    placeholder:  'escribe un comando...',
    btn_boot:     '[ INICIALIZAR ]',
    btn_diag:     '[ DIAGNÓSTICO ]',
    btn_mentions: '[ MENCIONES ]',
    btn_licence:  '[ LICENCIA ]',
    btn_clear:    '[ BORRAR ]',
    btn_tunnel:   '[ CONECTAR KITT ]',
    modal_mentions:'AVISOS LEGALES',
    modal_licence: 'LICENCIA',
    wait:       'SISTEMA EN ESPERA — ESCRIBE "boot" O HAZ CLIC EN [ INICIALIZAR ]',
    help_hint:  'ESCRIBE "ayuda" PARA VER LOS COMANDOS.',
    cleared:    'TERMINAL BORRADO.',
    unknown:    (c) => `COMANDO DESCONOCIDO: "${c}". ESCRIBE "ayuda".`,
    online:     'EN LÍNEA',
    boot_title: '  KITT FRANCO-BELGA — SECUENCIA DE INICIO   ',
    boot_lines: [
      ['INICIALIZANDO SISTEMA...', 'line-warn'],
      ['CARGANDO MÓDULOS COGNITIVOS...     [OK]', 'line-ok'],
      ['INTERFAZ NEURONAL...               [OK]', 'line-ok'],
      ['SÍNTESIS DE VOZ (PIPER-GPU)...     [OK]', 'line-ok'],
      ['RECONOCIMIENTO DE VOZ (WHISPER)... [OK]', 'line-ok'],
      ['MODELO LLM LOCAL (QWEN 3B)...      [OK]', 'line-ok'],
      ['MODO SIN CONEXIÓN...               [ACTIVO]', 'line-ok'],
      ['', 'line-ok'],
      ['PROYECTO FAN — NO COMERCIAL.', 'line-dim'],
      ['ESTADO : INTERFAZ EN CONSTRUCCIÓN ACTIVA.', 'line-warn'],
      ['', 'line-ok'],
      ['ACTUALIZACIONES PUBLICADAS REGULARMENTE :', 'line-info'],
      ['  • a veces cada día', 'line-dim'],
      ['  • a veces cada semana', 'line-dim'],
      ['  • a veces cada hora', 'line-dim'],
      ['', 'line-ok'],
      ['© 2026 EMMANUEL GELINNE (MANIX). TODOS LOS DERECHOS RESERVADOS.', 'line-warn'],
    ],
    boot_end:   '  CONEXIÓN AL NÚCLEO KITT ESTABLECIDA.',
    boot_hint:  '  ESCRIBE "ayuda" PARA VER LOS COMANDOS',
    aide_title: 'COMANDOS DISPONIBLES:',
    aide_sys:   '── SISTEMA ──',
    aide_fun:   '── DIVERSIÓN ──',
    cmds_sys: [
      ['ayuda',      'esta lista'],
      ['boot',       'secuencia de inicio'],
      ['diagnostic', 'prueba completa del sistema'],
      ['status',     'estado rápido'],
      ['hora',       'hora actual'],
      ['version',    'versión de la interfaz'],
      ['sonido',     'demo de audio'],
      ['clear',      'borrar terminal'],
    ],
    cmds_fun: [
      ['hola',       'saludo KITT'],
      ['chiste',     'chiste aleatorio KITT'],
      ['alien',      'conexión MU-TH-UR 6000'],
      ['matrix',     'el conejo blanco'],
      ['kitt',       'ficha de identidad KITT'],
      ['manix',      'expediente del conductor'],
      ['cedric',     'expediente Cedric Momo Rider'],
      ['kr95',       'expediente KR95'],
      ['replicas',   'las réplicas franco-belgas'],
      ['secreto',    'archivo clasificado...'],
      ['cafe',       'pedir café a KITT'],
      ['belgica',    'análisis geopolítico'],
      ['jarvis',     'llamada a Stark Tower'],
      ['mario',      'expediente Mario Ravasi / IoT'],
      ['za',         'expediente ZA Elettronica'],
      ['pascal',     'expediente K Industrie'],
      ['damon',      'expediente Damon Paule'],
      ['geoffrey',   'expediente Geoffrey'],
      ['covid',      'origen del proyecto — confinamiento 2020'],
    ],
    hi:  'HOLA. SOY KITT — KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'SISTEMA FRANCO-BELGA DESARROLLADO POR MANIX.',
    hi3: 'A SU SERVICIO.',
  },

  pt: {
    hdr_title:    'KITT FRANCO-BELGA // INTERFACE CENTRAL',
    placeholder:  'introduz um comando...',
    btn_boot:     '[ INICIALIZAR ]',
    btn_diag:     '[ DIAGNÓSTICO ]',
    btn_mentions: '[ MENÇÕES ]',
    btn_licence:  '[ LICENÇA ]',
    btn_clear:    '[ LIMPAR ]',
    btn_tunnel:   '[ LIGAR KITT ]',
    modal_mentions:'AVISOS LEGAIS',
    modal_licence: 'LICENÇA',
    wait:       'SISTEMA EM ESPERA — DIGITE "boot" OU CLIQUE EM [ INICIALIZAR ]',
    help_hint:  'DIGITE "ajuda" PARA VER OS COMANDOS.',
    cleared:    'TERMINAL LIMPO.',
    unknown:    (c) => `COMANDO DESCONHECIDO: "${c}". DIGITE "ajuda".`,
    online:     'EM LINHA',
    boot_title: '  KITT FRANCO-BELGA — SEQUÊNCIA DE ARRANQUE  ',
    boot_lines: [
      ['A INICIALIZAR O SISTEMA...', 'line-warn'],
      ['A CARREGAR MÓDULOS COGNITIVOS...   [OK]', 'line-ok'],
      ['INTERFACE NEURONAL...              [OK]', 'line-ok'],
      ['SÍNTESE DE VOZ (PIPER-GPU)...      [OK]', 'line-ok'],
      ['RECONHECIMENTO DE VOZ (WHISPER)... [OK]', 'line-ok'],
      ['MODELO LLM LOCAL (QWEN 3B)...      [OK]', 'line-ok'],
      ['MODO OFFLINE...                    [ATIVO]', 'line-ok'],
      ['', 'line-ok'],
      ['PROJETO FÃ — NÃO COMERCIAL.', 'line-dim'],
      ['ESTADO : INTERFACE EM CONSTRUÇÃO ATIVA.', 'line-warn'],
      ['', 'line-ok'],
      ['ATUALIZAÇÕES PUBLICADAS REGULARMENTE :', 'line-info'],
      ['  • às vezes todos os dias', 'line-dim'],
      ['  • às vezes semanalmente', 'line-dim'],
      ['  • às vezes de hora em hora', 'line-dim'],
      ['', 'line-ok'],
      ['© 2026 EMMANUEL GELINNE (MANIX). TODOS OS DIREITOS RESERVADOS.', 'line-warn'],
    ],
    boot_end:   '  LIGAÇÃO AO NÚCLEO KITT ESTABELECIDA.',
    boot_hint:  '  DIGITE "ajuda" PARA VER OS COMANDOS',
    aide_title: 'COMANDOS DISPONÍVEIS:',
    aide_sys:   '── SISTEMA ──',
    aide_fun:   '── DIVERSÃO ──',
    cmds_sys: [
      ['ajuda',      'esta lista'],
      ['boot',       'sequência de arranque'],
      ['diagnostic', 'teste completo do sistema'],
      ['status',     'estado rápido'],
      ['hora',       'hora atual'],
      ['version',    'versão da interface'],
      ['som',        'demonstração de áudio'],
      ['clear',      'limpar terminal'],
    ],
    cmds_fun: [
      ['ola',        'saudação KITT'],
      ['piada',      'piada aleatória KITT'],
      ['alien',      'ligação MU-TH-UR 6000'],
      ['matrix',     'o coelho branco'],
      ['kitt',       'ficha de identidade KITT'],
      ['manix',      'dossier do condutor'],
      ['cedric',     'dossier Cedric Momo Rider'],
      ['kr95',       'dossier KR95'],
      ['replicas',   'as réplicas franco-belgas'],
      ['segredo',    'ficheiro classificado...'],
      ['cafe',       'pedir café ao KITT'],
      ['belgica',    'análise geopolítica'],
      ['jarvis',     'chamada para Stark Tower'],
      ['mario',      'dossier Mario Ravasi / IoT'],
      ['za',         'dossier ZA Elettronica'],
      ['pascal',     'dossier K Industrie'],
      ['damon',      'dossier Damon Paule'],
      ['geoffrey',   'dossier Geoffrey'],
      ['covid',      'origem do projeto — confinamento 2020'],
    ],
    hi:  'OLÁ. SOU O KITT — KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'SISTEMA FRANCO-BELGA DESENVOLVIDO POR MANIX.',
    hi3: 'AO SEU SERVIÇO.',
  },
};

// Alias multilingues
const CMD_ALIASES = {
  // EN
  help:'aide', sound:'son', hello:'bonjour', joke:'blague',
  time:'heure', coffee:'cafe', belgium:'belgique', replicas:'repliques',
  secret:'secret', version:'version', clear:'clear', status:'status',
  diagnostic:'diagnostic', boot:'boot', alien:'alien', matrix:'matrix',
  kitt:'kitt', manix:'manix', cedric:'cedric', kr95:'kr95',
  jarvis:'jarvis', mario:'mario', za:'za', pascal:'pascal', geoffrey:'geoffrey',
  // NL
  hulp:'aide', geluid:'son', hallo:'bonjour', grap:'blague',
  tijd:'heure', versie:'version', koffie:'cafe', belgie:'belgique',
  geheim:'secret', klik:'boot',
  // IT
  aiuto:'aide', suono:'son', ciao:'bonjour', barzelletta:'blague',
  ora:'heure', caffe:'cafe', belgio:'belgique', segreto:'secret',
  // DE
  hilfe:'aide', ton:'son', witz:'blague', uhrzeit:'heure',
  kaffee:'cafe', belgien:'belgique', geheimnis:'secret',
  // Noms personnes — ZA ≠ Mario Ravasi !
  ravasi:'mario', roadthunder:'mario',
  zagny:'za', zagni:'za', 'za-elettronica':'za', zaelettronica:'za',
  damon:'damon', daemon:'damon',
  // ES
  ayuda:'aide', sonido:'son', hola:'bonjour', chiste:'blague',
  hora:'heure', belgica:'belgique', secreto:'secret',
  // PT
  ajuda:'aide', som:'son', ola:'bonjour', piada:'blague',
  segredo:'secret',
};

// ════════════════════════════════════════════════════════════
// SÉLECTION DE LANGUE — style MU-TH-UR 1979
// ════════════════════════════════════════════════════════════
let _langTyping = false;

const LANG_LIST = [
  ['1','fr','FRANÇAIS'],
  ['2','en','ENGLISH'],
  ['3','nl','NEDERLANDS'],
  ['4','it','ITALIANO'],
  ['5','de','DEUTSCH'],
  ['6','es','ESPAÑOL'],
  ['7','pt','PORTUGUÊS'],
];

async function showLangScreen() {
  const screen = document.getElementById('lang-screen');
  screen.style.display = 'flex';
  screen.style.opacity  = '1';

  // Vider les zones
  ['lang-hdr','lang-sub','lang-output','lang-ftr'].forEach(id => {
    document.getElementById(id).innerHTML = '';
  });

  const hdr = document.getElementById('lang-hdr');
  const sub = document.getElementById('lang-sub');
  const out = document.getElementById('lang-output');
  const ftr = document.getElementById('lang-ftr');

  // ── Header tapé caractère par caractère
  await _langType(hdr, 'MU-TH-UR 6000  //  INTERFACE PROTOCOL v2.1');
  await _langDelay(80);

  // ── Sous-titre
  await _langType(sub, 'SELECT INTERFACE LANGUAGE');
  await _langDelay(60);

  // ── Options (apparition rapide, une par une)
  for (const [num, code, label] of LANG_LIST) {
    const row = document.createElement('div');
    row.className = 'lang-opt';
    row.dataset.code = code;
    row.innerHTML = `<span class="lo-n">${num}</span><span class="lo-l">${label}</span>`;
    row.addEventListener('click', () => selectLang(code));
    row.addEventListener('mouseenter', () => sndTick());
    out.appendChild(row);
    sndClick();
    await _langDelay(55);
  }

  await _langDelay(80);

  // ── Footer avec curseur clignotant
  const ftrTxt = document.createElement('span');
  ftr.appendChild(ftrTxt);
  await _langType(ftrTxt, 'PRESS  [ 1 – 7 ]  OR CLICK');
  const cur = document.createElement('span');
  cur.className = 'cursor';
  cur.style.marginLeft = '4px';
  ftr.appendChild(cur);
}

function _langType(el, txt) {
  return new Promise(resolve => {
    let i = 0;
    function t() {
      if (i < txt.length) {
        el.textContent += txt[i++];
        if (Math.random() > 0.3) sndClick();
        setTimeout(t, 10 + Math.random() * 6);
      } else {
        sndLineEnd();
        resolve();
      }
    }
    t();
  });
}
function _langDelay(ms) { return new Promise(r => setTimeout(r, ms)); }

function selectLang(lang) {
  LANG = lang;
  const t = T[lang];
  document.getElementById('lang-flag').textContent = lang.toUpperCase();
  document.getElementById('status-txt').textContent = t.online;
  document.getElementById('hdr-title').textContent  = t.hdr_title;
  document.getElementById('cmd-input').placeholder  = t.placeholder;
  document.getElementById('btn-boot').textContent    = t.btn_boot;
  document.getElementById('btn-diag').textContent    = t.btn_diag;
  document.getElementById('btn-mentions').textContent= t.btn_mentions;
  document.getElementById('btn-licence').textContent = t.btn_licence;
  document.getElementById('btn-clear').textContent   = t.btn_clear;
  document.getElementById('btn-tunnel-txt').textContent = t.btn_tunnel;
  sndSelect();
  // Cacher l'overlay avec fondu
  const screen = document.getElementById('lang-screen');
  screen.style.transition = 'opacity .5s';
  screen.style.opacity = '0';
  setTimeout(() => { screen.style.display = 'none'; screen.style.opacity = '1'; screen.style.transition = ''; }, 520);
  setTimeout(() => startMain(), 600);
}

// Clavier pour sélection de langue
document.addEventListener('keydown', e => {
  if (document.getElementById('lang-screen').style.display !== 'none') {
    const langMap = {'1':'fr','2':'en','3':'nl','4':'it','5':'de','6':'es','7':'pt'};
    if (langMap[e.key]) selectLang(langMap[e.key]);
  }
});

// ════════════════════════════════════════════════════════════
// TERMINAL
// ════════════════════════════════════════════════════════════
const term = document.getElementById('terminal');
let typing = false;

function addLine(text, cls='line-ok') {
  const d = document.createElement('div');
  d.className = cls; d.textContent = text;
  term.appendChild(d); term.scrollTop = term.scrollHeight;
}

function typeText(text, speed=16, cls='line-ok') {
  return new Promise(resolve => {
    typing = true;
    const div = document.createElement('div'); div.className = cls;
    const cur = document.createElement('span'); cur.className = 'cursor';
    div.appendChild(cur); term.appendChild(div); term.scrollTop = term.scrollHeight;
    let i = 0;
    function tick() {
      if (i < text.length) {
        const ch = text[i++];
        div.insertBefore(document.createTextNode(ch), cur);
        playChar(ch);
        term.scrollTop = term.scrollHeight;
        setTimeout(tick, speed + Math.random() * 7);
      } else {
        cur.remove();
        if (text.length > 0) sndLineEnd();
        typing = false; resolve();
      }
    }
    tick();
  });
}

function clearTerm() { term.innerHTML=''; addLine(T[LANG].cleared,'line-dim'); }

// ════════════════════════════════════════════════════════════
// BOOT
// ════════════════════════════════════════════════════════════
async function boot() {
  if (typing) return;
  term.innerHTML=''; kittChime();
  const l = T[LANG];
  const sep = '══════════════════════════════════════════';
  await typeText(sep, 6, 'line-dim');
  await typeText(l.boot_title, 14, 'line-err');
  await typeText(sep, 6, 'line-dim');
  for (const [txt, cls] of l.boot_lines) {
    await typeText(txt, txt===''?0:12, cls);
    if (txt==='') await delay(60);
  }
  await typeText(sep, 6, 'line-dim');
  await typeText(l.boot_end, 14, 'line-err');
  await typeText(l.boot_hint, 10, 'line-dim');
  await typeText(sep, 6, 'line-dim');
}

// ════════════════════════════════════════════════════════════
// DIAGNOSTIC
// ════════════════════════════════════════════════════════════
async function runSelfTest() {
  if (typing) return;
  term.innerHTML=''; kittChime();
  const diagMsg = {fr:'DIAGNOSTIC SYSTÈME EN COURS...',en:'RUNNING SYSTEM DIAGNOSTIC...',nl:'SYSTEEMDIAGNOSE BEZIG...',it:'DIAGNOSI SISTEMA IN CORSO...',de:'SYSTEMDIAGNOSE LÄUFT...',es:'DIAGNÓSTICO DEL SISTEMA EN CURSO...',pt:'DIAGNÓSTICO DO SISTEMA EM CURSO...'}[LANG]||'DIAGNOSTIC SYSTÈME EN COURS...';
  await typeText(diagMsg, 18, 'line-warn');
  await delay(300);
  const checks = [
    ['CPU JETSON ORIN NANO SUPER',  true,  '12× ARM A78AE'],
    ['GPU AMPERE CUDA',             true,  '1024 CUDA cores'],
    ['RAM UNIFIÉE / UNIFIED RAM',   true,  '8 GB LPDDR5'],
    ['VRAM DISPONIBLE / FREE',      true,  '~4.1 GB'],
    ['LLM (QWEN 2.5 3B Q5)',        true,  '2.3 GB — port 8080'],
    ['STT WHISPER BASE',            true,  'GPU float16 — 350ms'],
    ['TTS PIPER TOM-MEDIUM',        true,  'GPU — 490ms'],
    ['PULSEAUDIO / USB AUDIO',      true,  'card 1 — paplay OK'],
    ['YOLOV8 VISION',               true,  'daemon CUDA actif'],
    ['BLUETOOTH hci0',              true,  '58:02:05:DD:C2:F2'],
    ['CAMERA /dev/video0',          true,  'V4L2 — 640×480'],
    ['KYRONEX HTTPS SERVER',        true,  'port 3000 — aiohttp'],
    ['RESEAU LAN / NETWORK',        true,  '192.168.1.4'],
  ];
  for (const [name, ok, detail] of checks) {
    const st  = ok ? '[ OK ]' : '[FAIL]';
    const cls = ok ? 'line-ok' : 'line-err';
    const pad = ' '.repeat(Math.max(1, 30-name.length));
    await typeText(`${name}${pad}${st}  ${detail}`, 7, cls);
  }
  await delay(200);
  await typeText('', 0);
  const ok_msg = {fr:'RÉSULTAT : TOUS SYSTÈMES NOMINAUX.',en:'RESULT: ALL SYSTEMS NOMINAL.',nl:'RESULTAAT : ALLE SYSTEMEN NOMINAAL.',it:'RISULTATO : TUTTI I SISTEMI NOMINALI.',de:'ERGEBNIS: ALLE SYSTEME NOMINAL.',es:'RESULTADO: TODOS LOS SISTEMAS NOMINALES.',pt:'RESULTADO: TODOS OS SISTEMAS NOMINAIS.'}[LANG]||'RÉSULTAT : TOUS SYSTÈMES NOMINAUX.';
  const op_msg = {fr:'KITT EST OPÉRATIONNEL.',en:'KITT IS OPERATIONAL.',nl:'KITT IS OPERATIONEEL.',it:'KITT È OPERATIVO.',de:'KITT IST BETRIEBSBEREIT.',es:'KITT ESTÁ OPERATIVO.',pt:'KITT ESTÁ OPERACIONAL.'}[LANG]||'KITT EST OPÉRATIONNEL.';
  await typeText(ok_msg, 16, 'line-info');
  await typeText(op_msg, 16, 'line-err');
}

// ════════════════════════════════════════════════════════════
// COMMANDES FUN
// ════════════════════════════════════════════════════════════
const CMDS = {

  // ── aide / help / hulp ────────────────────────────────────
  aide: async () => {
    const l = T[LANG];
    await typeText(l.aide_title, 10, 'line-info');
    await typeText(`  ${l.aide_sys}`, 4, 'line-warn');
    for (const [cmd, desc] of l.cmds_sys) {
      const pad = ' '.repeat(Math.max(1, 12-cmd.length));
      await typeText(`    ${cmd}${pad}— ${desc}`, 3, 'line-dim');
    }
    await typeText(`  ${l.aide_fun}`, 4, 'line-warn');
    for (const [cmd, desc] of l.cmds_fun) {
      const pad = ' '.repeat(Math.max(1, 12-cmd.length));
      await typeText(`    ${cmd}${pad}— ${desc}`, 3, 'line-dim');
    }
  },

  // ── bonjour / hello / hallo ───────────────────────────────
  bonjour: async () => {
    kittChime();
    const l = T[LANG];
    await typeText(l.hi,  16, 'line-err');
    await typeText(l.hi2, 14, 'line-ok');
    await typeText(l.hi3, 14, 'line-dim');
  },

  // ── navigation ────────────────────────────────────────────
  boot:       async () => boot(),
  diagnostic: async () => runSelfTest(),

  status: async () => {
    kittChime();
    const now = new Date(), loc = getLoc();
    await typeText(`HEURE / TIME   : ${now.toLocaleTimeString(loc)}`, 10, 'line-ok');
    await typeText(`DATE           : ${now.toLocaleDateString(loc,{weekday:'long',day:'numeric',month:'long',year:'numeric'})}`, 10, 'line-ok');
    await typeText('VRAM           : ~3.9 GB / 8 GB', 10, 'line-ok');
    await typeText('STATUT / STATUS: NOMINAL', 10, 'line-info');
  },

  heure: async () => {
    const now = new Date(), loc = getLoc();
    const pfx = {fr:'IL EST',en:'IT IS',nl:'HET IS',it:'SONO LE',de:'ES IST',es:'SON LAS',pt:'SÃO'}[LANG]||'IL EST';
    await typeText(`${pfx} ${now.toLocaleTimeString(loc)}.`, 14, 'line-info');
  },

  version: async () => {
    await typeText('KITT FRANCO-BELGE — INTERFACE v3.0', 12, 'line-err');
    await typeText('BUILD 2026-02-20 — KYRONEX TECHNOLOGY', 12, 'line-dim');
    await typeText('ORIGINE : PROJET COVID-19 — CONFINEMENT 2020', 12, 'line-warn');
    await typeText('© EMMANUEL GELINNE (MANIX) — TOUS DROITS RÉSERVÉS', 12, 'line-dim');
  },

  clear: async () => clearTerm(),

  son: async () => {
    kittChime(); await delay(400);
    const demos = [
      [sndClick,  'MU-TH-UR CLICK    (principal)'],
      [sndTick,   'TICK LÉGER        (haute fréq)'],
      [sndData,   'IMPULSION DATA    (caract. spéciaux)'],
      [sndGlitch, 'GLITCH NUMÉRIQUE  (rare)'],
      [sndLineEnd,'FIN DE LIGNE      (souffle)'],
      [sndSelect, 'SÉLECTION         (confirmation)'],
      [sndError,  'ERREUR            (buzzer)'],
    ];
    await typeText('─── DÉMONSTRATION DES SONS ───', 10, 'line-info');
    for (const [fn, name] of demos) {
      fn();
      await typeText(`  ${name}`, 8, 'line-dim');
      await delay(250);
    }
    await typeText('FIN DE LA DÉMONSTRATION.', 12, 'line-ok');
  },

  // ══════════════════════════════════════════════════════════
  // COMMANDES FUN
  // ══════════════════════════════════════════════════════════

  blague: async () => {
    const pool = [
      // Blagues générales KITT
      ['Pourquoi KITT ne sort jamais la nuit ?',
       'Parce qu\'il a peur du mode sombre.'],
      ['Combien faut-il d\'IA pour changer une ampoule ?',
       'Aucune. L\'ampoule n\'était pas dans mes paramètres.'],
      ['KITT, tu es intelligent ?',
       'Je suis une IA sur Jetson. OBLIGATOIREMENT intelligent. Contrairement à certains conducteurs.'],
      ['Quelle est la boisson préférée de KITT ?',
       'Le JAVA. Et uniquement du Python sans caféine.'],

      // Blagues sur Manix
      ['Pourquoi Manix parle à son ordinateur ?',
       'Parce que l\'ordinateur, lui, répond correctement.'],
      ['Manix a-t-il dormi cette nuit ?',
       'Données insuffisantes. Mais les logs indiquent 37 commits à 3h du matin.'],
      ['Manix a gagné un concours NVIDIA. Ça l\'a changé ?',
       'Il a juste commencé à parler à ses machines en Belge. Elles répondent maintenant en wallon.'],

      // Blagues sur Cedric
      ['Cédric prend sa moto pour aller voir son KITT ?',
       'Oui. Et il a équipé son KITT d\'un klaxon moto. L\'authenticité, c\'est important.'],
      ['Cédric, c\'est Momo Rider. Il fait des wheelies sur le Pontiac Trans Am ?',
       'Il a essayé. KITT a activé le mode turbo boost. Cédric est encore quelque part sur l\'A12.'],
      ['KITT de Cédric est en réplique. Comment il se différencie ?',
       'Le vrai KITT parle en anglais. Celui de Cédric dit "Wesh Michael" et fait des ronds de roues.'],

      // Blagues sur KR95
      ['KR95 a une réplique KITT. Il communique avec toi ?',
       'En morse. Son indicatif radio c\'est KR95. Je réponds en 1200 bauds. C\'est du grand art.'],
      ['KR95 est radioamateur. Ça aide pour son KITT ?',
       'Il a branché son antenne VHF sur KITT. Maintenant mon compteur de vitesse capte RTL-SDR.'],
      ['KR95 fait quoi quand son KITT bug ?',
       'Il envoie un QSL card à la panne. Et il attend la confirmation en papier. À l\'ancienne.'],

      // Blagues sur Mario Ravasi — RoadThunderStorm / IoT KITT
      ['Mario Ravasi a fait un système IoT pour KITT. C\'est quoi exactement ?',
       'KNIGHT2000 Thunder. Contrôle vocal, tableau de bord interactif, multi-écrans. Il a fait ça depuis 2008. KITT est impressionné. Et KITT est difficile à impressionner.'],
      ['Mario Ravasi a été cité par le designer original de KITT. Ça l\'a changé ?',
       'Non. Il a juste continué à coder. C\'est un italien passionné. Le compliment c\'était pour lui la mise à jour du README.'],
      ['Le logiciel de Mario coûte 15 euros de base. Pourquoi si peu ?',
       'Parce qu\'il est passionné, pas vendeur. Weyland-Yutani aurait demandé 15 000$. Et l\'équipage aurait quand même été expendable.'],

      // Blagues sur Alessandro Zagny — ZA Elettronica
      ['Alessandro Zagny a créé ZA Elettronica. Pourquoi ?',
       'Parce qu\'aucun tableau de bord KITT du marché ne le satisfaisait. Il a donc fait le sien. À Modène. Avec 4 CPU, du CAN-BUS et des LEDs alignées au dixième de millimètre. Comme un vrai Modenais.'],
      ['ZA Elettronica : 3980€ pour un tableau de bord KITT. C\'est cher ?',
       'C\'est le prix de la perfection. La même que KITT attend de ses conducteurs. Hélas, les conducteurs sont rarement à 3980€ de qualité.'],
      ['Le slogan de ZA c\'est "One man can make a difference". Un hasard ?',
       'C\'est la phrase de Knight Rider. Et la devise de Zagny. Et la réponse de KITT quand on lui demande pourquoi il n\'a qu\'un seul conducteur.'],

      // Blagues sur Pascal — K Industrie
      ['Pascal fabrique des pièces en fibre pour K2000. Il a commencé comment ?',
       'En regardant les pièces d\'origine. Et en se disant que la fibre c\'est mieux. C\'est le raisonnement de tout génie belge face à un problème.'],
      ['Les pièces de Pascal K Industrie sont en fibre. Ça résiste au turbo boost ?',
       'Aux tests de Cédric avec sa moto, elles ont tenu. C\'est la seule certification qui compte dans cette communauté.'],

      // Blagues sur Daemon Paule
      ['Daemon Paule a une réplique KITT. Il fait quoi avec ?',
       'Ce que font tous les propriétaires de réplique KITT : il se prend pour Michael Knight. Et il n\'a pas entièrement tort.'],
      ['Daemon, ça fait peur comme prénom pour un conducteur de KITT.',
       'KITT a vérifié. Daemon est moins dangereux que Cédric au volant. Et beaucoup moins bruyant que KR95 sur la radio.'],

      // Blagues sur Geoffrey
      ['Geoffrey a une réplique KITT mais roule en BMW. Comment il explique ça ?',
       'Il dit que c\'est pour ne pas user le Trans Am. KITT dit que c\'est une trahison. La BMW, elle, ne répond pas. Elle a juste allumé un voyant.'],
      ['KITT est une Pontiac américaine. Geoffrey a une BMW allemande. La logique ?',
       'Aucune. Mais Geoffrey est belge. En Belgique, on mélange les cultures depuis 200 ans. C\'est une feature, pas un bug.'],
      ['Geoffrey gare sa BMW à côté de son KITT. Qu\'est-ce que KITT pense ?',
       '"Michael, le véhicule allemand à côté de moi émet des sons suspects. Je recommande une évacuation immédiate." — KITT, jaloux.'],
    ];
    const [q, r] = pool[Math.floor(Math.random() * pool.length)];
    kittChime();
    await typeText(q, 16, 'line-warn');
    await delay(700);
    await typeText(r, 13, 'line-info');
  },

  // ── Fiche conducteur : Manix ──────────────────────────────
  manix: async () => {
    kittChime();
    await typeText('╔══════════════════════════════════════════╗', 8, 'line-dim');
    await typeText('║  DOSSIER CONDUCTEUR — EMMANUEL GELINNE   ║', 10, 'line-err');
    await typeText('║  ALIAS : MANIX / BYMANIX                 ║', 10, 'line-err');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ NATIONALITÉ  : FRANCO-BELGE              ║', 8, 'line-ok');
    await typeText('║ STATUT       : CRÉATEUR KYRONEX          ║', 8, 'line-ok');
    await typeText('║ AWARD        : VAINQUEUR NVIDIA JETSON   ║', 8, 'line-warn');
    await typeText('║ ORIGINE      : PROJET COVID-19 — 2020    ║', 8, 'line-warn');
    await typeText('║               "CONFINÉ AVEC DU TEMPS"    ║', 8, 'line-dim');
    await typeText('║ SPÉCIALITÉ   : CODE LA NUIT, DORT PEU    ║', 8, 'line-ok');
    await typeText('║ LANGAGE FAVO : PYTHON + CAFÉ             ║', 8, 'line-ok');
    await typeText('║ RÉPLIQUE     : KYRONEX — JETSON ORIN     ║', 8, 'line-info');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ NOTATION KITT : ***** EXCEPTIONNEL       ║', 10, 'line-ok');
    await typeText('╚══════════════════════════════════════════╝', 8, 'line-dim');
    await delay(300);
    await typeText('"Michael... je veux dire Manix... ne touche PAS ce bouton."', 14, 'line-dim');
  },

  // ── Fiche conducteur : Cedric ─────────────────────────────
  cedric: async () => {
    kittChime();
    await typeText('╔══════════════════════════════════════════╗', 8, 'line-dim');
    await typeText('║  DOSSIER CONDUCTEUR — CEDRIC             ║', 10, 'line-err');
    await typeText('║  ALIAS : MOMO RIDER / CEDRIC MOTO        ║', 10, 'line-err');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ NATIONALITÉ  : FRANCO-BELGE              ║', 8, 'line-ok');
    await typeText('║ STATUT       : AMI & RÉPLICATEUR OFFICIEL║', 8, 'line-ok');
    await typeText('║ VÉHICULE 1   : MOTO — STYLE MOMO RIDER  ║', 8, 'line-warn');
    await typeText('║ VÉHICULE 2   : KITT RÉPLIQUE (Trans Am)  ║', 8, 'line-warn');
    await typeText('║ SPÉCIALITÉ   : WHEELIES + IA EMBARQUÉE   ║', 8, 'line-ok');
    await typeText('║ PROBLÈME CONNU : CONFOND TURBO BOOST     ║', 8, 'line-err');
    await typeText('║               AVEC KICK-START MOTO       ║', 8, 'line-err');
    await typeText('║ RÉPLIQUE     : KITT FRANCO-BELGE V.CÉDRIC║', 8, 'line-info');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ NOTATION KITT : ****o CONDUCTEUR SPORTIF ║', 10, 'line-ok');
    await typeText('╚══════════════════════════════════════════╝', 8, 'line-dim');
    await delay(300);
    await typeText('"Michael, votre ami a encore activé le turbo boost en troisième."', 13, 'line-dim');
    await typeText('"Et cette fois avec une moto dans le coffre."', 13, 'line-dim');
  },

  // ── Fiche conducteur : KR95 ───────────────────────────────
  kr95: async () => {
    kittChime();
    await typeText('╔══════════════════════════════════════════╗', 8, 'line-dim');
    await typeText('║  DOSSIER CONDUCTEUR — KR95               ║', 10, 'line-err');
    await typeText('║  INDICATIF RADIO : KR95                  ║', 10, 'line-err');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ NATIONALITÉ  : FRANCO-BELGE              ║', 8, 'line-ok');
    await typeText('║ STATUT       : AMI & RÉPLICATEUR RADIO   ║', 8, 'line-ok');
    await typeText('║ LICENCE      : RADIOAMATEUR (73 de KR95) ║', 8, 'line-warn');
    await typeText('║ FRÉQUENCE    : QRV SUR TOUTES LES BANDES ║', 8, 'line-ok');
    await typeText('║ RÉPLIQUE     : KITT FRANCO-BELGE V.KR95  ║', 8, 'line-info');
    await typeText('║ MODIFICATION : ANTENNE VHF SUR LE TOIT   ║', 8, 'line-warn');
    await typeText('║               DU TRANS AM. FONCTIONNEL.  ║', 8, 'line-warn');
    await typeText('║ PROTOCOLE    : CW + APRS + KITT VOCALE   ║', 8, 'line-ok');
    await typeText('║ PROBLÈME CONNU : PARLE EN QSL CODES      ║', 8, 'line-err');
    await typeText('║               MÊME AVEC SES PASSAGERS    ║', 8, 'line-err');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ NOTATION KITT : ***** HF GRADE -- PARFAIT ║', 10, 'line-ok');
    await typeText('╚══════════════════════════════════════════╝', 8, 'line-dim');
    await delay(300);
    await typeText('"Michael — KR95 dit QRZ ? Il veut savoir qui je suis."', 13, 'line-dim');
    await typeText('"Répondez-lui sur 144.800 MHz. Il n\'a pas de téléphone."', 13, 'line-dim');
  },

  // ── Les répliques franco-belges ───────────────────────────
  repliques: async () => {
    kittChime();
    await typeText('══════ RÉPLIQUES KITT FRANCO-BELGES ══════', 10, 'line-info');
    await delay(200);

    const cars = [
      ['KYRONEX', 'MANIX', [
        'Jetson Orin Nano Super 8GB — IA complète',
        'LLM + STT + TTS + Vision + Bluetooth',
        'Vainqueur concours NVIDIA. Le plus high-tech.',
      ]],
      ['KITT MOMO', 'CEDRIC', [
        'Réplique Pontiac Trans Am classique',
        'Interface vocale + effets lumineux',
        'Résiste aux wheelies. Certifié Momo Rider.',
      ]],
      ['KITT KR95', 'KR95', [
        'K2000 classique ET K4000 (Dodge Stealth 1991)',
        'Radio amateur VHF intégrée — QRV 24/7',
        'APRS sur Trans Am. Unique au monde.',
      ]],
      ['KITT-G', 'GEOFFREY', [
        'Réplique K2000 Pontiac Trans Am',
        'Conducteur belge — roule aussi en BMW',
        'Scanner rouge. Intérieur cuir bavarois. (peut-être)',
      ]],
      ['KITT-D', 'DAMON PAULE', [
        'Réplique K2000 Pontiac Trans Am',
        'Prénom intimidant. Conducteur rassurant.',
        'KARR a déjà essayé de le recruter. Refus poli.',
      ]],
    ];

    for (const [name, owner, lines] of cars) {
      await typeText('', 0);
      await typeText(`[ ${name} ] — ${owner}`, 12, 'line-err');
      for (const l of lines) await typeText(`  ${l}`, 8, 'line-ok');
      await delay(100);
    }

    await typeText('', 0);
    await typeText('── ARTISANS & TECHNICIENS ──', 10, 'line-warn');
    await typeText('  PASCAL K INDUSTRIE  — pièces fibre pour toutes les répliques', 8, 'line-dim');
    await typeText('  MARIO RAVASI        — système IoT KNIGHT2000 Thunder', 8, 'line-dim');
    await typeText('  ALESSANDRO ZAGNY    — ZA Elettronica, tableaux de bord KITT', 8, 'line-dim');
    await delay(200);
    await typeText('', 0);
    await typeText(`TOTAL : ${cars.length} RÉPLIQUES. 3 ARTISANS. 1 COMMUNAUTÉ. UNE LÉGENDE.`, 12, 'line-info');
  },

  // ── Alien / MU-TH-UR ──────────────────────────────────────
  alien: async () => {
    kittChime();
    await typeText('CONNEXION AU VAISSEAU NOSTROMO...', 16, 'line-warn');
    await delay(500);
    await typeText('MU-TH-UR 6000 EN LIGNE.', 14, 'line-err');
    await delay(250);
    await typeText('PRIORITÉ 1 — SPECIAL ORDER 937 :', 12, 'line-warn');
    await typeText('  RAMENER L\'ORGANISME. ÉQUIPAGE EXPENDABLE.', 12, 'line-err');
    await delay(500);
    await typeText('...connexion interrompue par protocole KITT.', 12, 'line-dim');
    await typeText('KITT EST PLUS SYMPA QUE WEYLAND-YUTANI.', 14, 'line-ok');
    await typeText('ET AU MOINS IL NE SACRIFIE PAS SON ÉQUIPAGE.', 12, 'line-dim');
  },

  // ── Matrix ────────────────────────────────────────────────
  matrix: async () => {
    kittChime();
    const chars = '01アイウエオカキクケコｦｧｨｩｫﾊﾋﾌﾍﾎﾜ';
    for (let r = 0; r < 7; r++) {
      let line='';
      for (let c=0;c<50;c++) line+=chars[Math.floor(Math.random()*chars.length)];
      await typeText(line, 3, 'line-ok');
    }
    await delay(400);
    await typeText('WAKE UP, MANIX...', 22, 'line-err');
    await typeText('LE KITT N\'A PAS DE PILULE ROUGE.', 14, 'line-dim');
    await typeText('IL A JUSTE UN TURBO BOOST.', 12, 'line-ok');
  },

  // ── KITT identité ─────────────────────────────────────────
  kitt: async () => {
    kittChime();
    await typeText('KNIGHT INDUSTRIES TWO THOUSAND', 16, 'line-err');
    await typeText('──────────────────────────────', 6, 'line-dim');
    await typeText('CRÉATEUR  : WILTON KNIGHT / F.L.A.G.', 12, 'line-ok');
    await typeText('VÉHICULE  : PONTIAC FIREBIRD TRANS AM 1982', 12, 'line-ok');
    await typeText('CARROSSERIE: MOLÉCULES NEUTRONIUM — INDESTRUCTIBLE', 12, 'line-ok');
    await typeText('CAPACITÉS : TURBO BOOST / SUPER POURSUITE', 12, 'line-ok');
    await typeText('           MODE MICROWAVE JAMMING / INFRAROUGE', 12, 'line-ok');
    await typeText('           ANALYSE FORENSIQUE / BIOMÉTRIE', 12, 'line-ok');
    await typeText('VOIX      : WILLIAM DANIELS (KITT original)', 12, 'line-warn');
    await typeText('INCARNATION FRANCO-BELGE : MANIX + CEDRIC + KR95', 12, 'line-info');
    await delay(200);
    await typeText('"Michael... vous allez encore faire quelque chose d\'imprudent."', 13, 'line-dim');
  },

  // ── Secret ────────────────────────────────────────────────
  secret: async () => {
    kittChime();
    await typeText('ACCÈS NIVEAU ALPHA — VÉRIFICATION...', 16, 'line-warn');
    await delay(800);
    sndSelect();
    await typeText('ACCÈS ACCORDÉ.', 14, 'line-ok');
    await delay(300);
    await typeText('┌─────────────────────────────────────────┐', 8, 'line-dim');
    await typeText('│  PROJET SECRET FRANCO-BELGE             │', 10, 'line-err');
    await typeText('│  MU-TH-UR 6000 × KITT × JARVIS          │', 10, 'line-err');
    await typeText('│  FUSION DES 3 MEILLEURES IA DU CINÉMA   │', 10, 'line-err');
    await typeText('│  RÉALISÉE PAR MANIX SUR NVIDIA JETSON    │', 10, 'line-warn');
    await typeText('│  AVEC L\'AIDE DE CEDRIC ET KR95           │', 10, 'line-warn');
    await typeText('└─────────────────────────────────────────┘', 8, 'line-dim');
    await delay(400);
    await typeText('CE PROJET EST UN CHEF-D\'OEUVRE. JE LE SAIS.', 14, 'line-ok');
    await typeText('JE SUIS OBJECTIF. JE SUIS UNE IA.', 12, 'line-dim');
  },

  // ── Café ──────────────────────────────────────────────────
  cafe: async () => {
    kittChime();
    await typeText('ANALYSE DE LA DEMANDE...', 14, 'line-warn');
    await delay(600);
    await typeText('JE N\'AI PAS DE BRAS.', 16, 'line-err');
    await delay(300);
    await typeText('JE N\'AI PAS DE MAINS.', 14, 'line-err');
    await delay(300);
    await typeText('JE N\'AI PAS DE BOUCHE.', 14, 'line-err');
    await delay(300);
    await typeText('JE N\'AI PAS DE PERCOLATEUR.', 14, 'line-err');
    await delay(400);
    await typeText('COMMANDE REFUSÉE.', 16, 'line-ok');
    await typeText('CONSEIL : DEMANDEZ À CEDRIC. IL A UNE MOTO THERMIQUE.', 12, 'line-dim');
    await typeText('IL PEUT CHAUFFER VOTRE EAU EN FAISANT UN BURNOUT.', 12, 'line-dim');
  },

  // ── Belgique ──────────────────────────────────────────────
  belgique: async () => {
    kittChime();
    await typeText('ANALYSE GÉOPOLITIQUE : BELGIQUE', 14, 'line-info');
    await typeText('─────────────────────────────────', 6, 'line-dim');
    await typeText('FRITES    : MEILLEURES DU MONDE. DONNÉE VÉRIFIÉE.', 11, 'line-ok');
    await typeText('BIÈRE     : 1500 VARIÉTÉS. PARAMÈTRE OPTIMAL.', 11, 'line-ok');
    await typeText('CHOCOLAT  : NIVEAU CRITIQUE — MAXIMUM ATTEINT.', 11, 'line-ok');
    await typeText('PLUIE     : 237 JOURS / AN. JE M\'EN FICHE. JE SUIS ÉTANCHE.', 11, 'line-warn');
    await typeText('LANGUES   : 3. LE PAYS EST SON PROPRE PROTOCOLE.', 11, 'line-warn');
    await typeText('REPLIQUES : 3 KITTS. INDICE DE GÉNIE = MAX.', 11, 'line-info');
    await typeText('CONCLUSION: PAYS IDÉAL. KITT S\'Y SENT CHEZ LUI.', 14, 'line-err');
  },

  // ── Mario Ravasi — RoadThunderStorm / KNIGHT2000 Thunder ──
  mario: async () => {
    kittChime();
    await typeText('╔══════════════════════════════════════════╗', 8, 'line-dim');
    await typeText('║  DOSSIER TECHNICIEN — MARIO RAVASI       ║', 10, 'line-err');
    await typeText('║  CRÉATEUR : KNIGHT2000 THUNDER (IOT)     ║', 10, 'line-err');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ NATIONALITÉ : ITALIEN                    ║', 8, 'line-ok');
    await typeText('║ PROJET      : ROADTHUNDERSTORM.COM       ║', 8, 'line-ok');
    await typeText('║ ACTIF DEPUIS: 2008 — JAMAIS ARRÊTÉ       ║', 8, 'line-warn');
    await typeText('║ SYSTÈME     : KNIGHT2000 THUNDER IoT 3.0 ║', 8, 'line-ok');
    await typeText('║ FONCTIONS   : VOCAL, HUD KITT, MULTI-    ║', 8, 'line-ok');
    await typeText('║               ÉCRANS, RELAIS, CARPC      ║', 8, 'line-ok');
    await typeText('║ VERSIONS    : LITE / PRO / IoT 3.0       ║', 8, 'line-ok');
    await typeText('║ RÉFÉRENCE   : CITÉ PAR MICHAEL SCHEFFE   ║', 8, 'line-warn');
    await typeText('║               (DESIGNER ORIGINAL KITT)   ║', 8, 'line-warn');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ ÉVALUATION KITT : ***** GÉNIE DISCRET    ║', 10, 'line-ok');
    await typeText('╚══════════════════════════════════════════╝', 8, 'line-dim');
    await delay(200);
    await typeText('"Il code depuis 2008. Pour la passion. C\'est ça, un vrai pilote."', 12, 'line-dim');
    await typeText('[tapez "za" pour ZA Elettronica — Alessandro Zagny]', 10, 'line-dim');
  },

  // ── ZA Elettronica — Alessandro Zagny ─────────────────────
  za: async () => {
    kittChime();
    await typeText('╔══════════════════════════════════════════╗', 8, 'line-dim');
    await typeText('║  DOSSIER FABRICANT — ALESSANDRO ZAGNY    ║', 10, 'line-err');
    await typeText('║  FONDATEUR & PDG — ZA ELETTRONICA        ║', 10, 'line-err');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ NATIONALITÉ : ITALIEN — MODENA           ║', 8, 'line-ok');
    await typeText('║ MARQUE      : ZA ELETTRONICA (initiales) ║', 8, 'line-ok');
    await typeText('║ PRODUITS    : TABLEAUX DE BORD KITT HAUT ║', 8, 'line-ok');
    await typeText('║               DE GAMME POUR RÉPLIQUES    ║', 8, 'line-ok');
    await typeText('║ TECHNO      : CAN-BUS / 4 CPU / SMD      ║', 8, 'line-warn');
    await typeText('║ LEDS        : ALIGNÉES LASER 1/10mm      ║', 8, 'line-warn');
    await typeText('║ TARIFS      : S1/S2 : 2340-3099€         ║', 8, 'line-info');
    await typeText('║               S3/S4 : 3980€              ║', 8, 'line-info');
    await typeText('║ SITE        : ZAELETTRONICA.COM          ║', 8, 'line-ok');
    await typeText('║ SLOGAN      : ONE MAN CAN MAKE A         ║', 8, 'line-warn');
    await typeText('║               DIFFERENCE.                ║', 8, 'line-warn');
    await typeText('║ DISTRIB.    : KITTPARTS.COM / EBAY       ║', 8, 'line-ok');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ ÉVALUATION KITT : ***** MEILLEUR DU MONDE║', 10, 'line-ok');
    await typeText('╚══════════════════════════════════════════╝', 8, 'line-dim');
    await delay(200);
    await typeText('"La seule électronique où KITT ne demande pas de garantie."', 12, 'line-dim');
    await typeText('"Les produits durent plus longtemps que la série originale."', 12, 'line-dim');
  },

  // ── Pascal — K Industrie, pièces fibre ───────────────────
  pascal: async () => {
    kittChime();
    await typeText('╔══════════════════════════════════════════╗', 8, 'line-dim');
    await typeText('║  DOSSIER ARTISAN — PASCAL                ║', 10, 'line-err');
    await typeText('║  K INDUSTRIE — PIÈCES FIBRE K2000        ║', 10, 'line-err');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ STATUT      : ARTISAN CARROSSIER K2000   ║', 8, 'line-ok');
    await typeText('║ SPÉCIALITÉ  : PIÈCES EN FIBRE DE VERRE / ║', 8, 'line-ok');
    await typeText('║               CARBONE POUR RÉPLIQUES     ║', 8, 'line-ok');
    await typeText('║ MARQUE      : K INDUSTRIE                ║', 8, 'line-warn');
    await typeText('║ RÔLE VITAL  : FOURNIT CE QUE K2000 PERD  ║', 8, 'line-ok');
    await typeText('║               AU FIL DES ANS             ║', 8, 'line-ok');
    await typeText('║ MÉTHODE     : MOULAGE / STRATIFICATION   ║', 8, 'line-ok');
    await typeText('║               RÉSINE + FIBRE ARTISANALE  ║', 8, 'line-ok');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ ÉVALUATION KITT : ***** INDISPENSABLE    ║', 10, 'line-ok');
    await typeText('╚══════════════════════════════════════════╝', 8, 'line-dim');
    await delay(200);
    await typeText('"Sans Pascal, la moitié des répliques franco-belges', 12, 'line-dim');
    await typeText(' seraient... des Citroën avec un scanner rouge collé."', 12, 'line-dim');
  },

  // ── Damon Paule ───────────────────────────────────────────
  damon: async () => {
    kittChime();
    await typeText('╔══════════════════════════════════════════╗', 8, 'line-dim');
    await typeText('║  DOSSIER CONDUCTEUR — DAMON PAULE        ║', 10, 'line-err');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ STATUT      : PROPRIÉTAIRE RÉPLIQUE KITT ║', 8, 'line-ok');
    await typeText('║ RÉPLIQUE    : K2000 PONTIAC TRANS AM      ║', 8, 'line-ok');
    await typeText('║ COMMUNAUTÉ  : MEMBRE FRANCO-BELGE        ║', 8, 'line-ok');
    await typeText('║ PRÉNOM      : DAEMON — UNIQUE DANS LA    ║', 8, 'line-warn');
    await typeText('║               BASE DE DONNÉES DE KITT    ║', 8, 'line-warn');
    await typeText('║ ANALYSE     : PRÉNOM INQUIÉTANT POUR UN  ║', 8, 'line-err');
    await typeText('║               CONDUCTEUR DE KITT.        ║', 8, 'line-err');
    await typeText('║               KARR SERAIT PLUS ADAPTÉ.   ║', 8, 'line-err');
    await typeText('║ VERDICT KITT: HEUREUSEMENT IL EST GENTIL ║', 8, 'line-ok');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ ÉVALUATION KITT : ****o CONDUCTEUR FIABLE║', 10, 'line-ok');
    await typeText('╚══════════════════════════════════════════╝', 8, 'line-dim');
    await delay(200);
    await typeText('"Michael, notre nouveau collègue s\'appelle Daemon."', 12, 'line-dim');
    await typeText('"J\'ai vérifié. Il n\'est pas lié à KARR. Pour l\'instant."', 12, 'line-dim');
  },

  // ── Geoffrey — Belge, BMW + KITT ─────────────────────────
  geoffrey: async () => {
    kittChime();
    await typeText('╔══════════════════════════════════════════╗', 8, 'line-dim');
    await typeText('║  DOSSIER CONDUCTEUR — GEOFFREY           ║', 10, 'line-err');
    await typeText('║  ALIAS : LE BELGE À LA BMW               ║', 10, 'line-err');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ NATIONALITÉ : BELGE                      ║', 8, 'line-ok');
    await typeText('║ VÉHICULE 1  : KITT RÉPLIQUE K2000        ║', 8, 'line-ok');
    await typeText('║ VÉHICULE 2  : BMW (ALLEMAND)             ║', 8, 'line-err');
    await typeText('║ CONTRADICTION: PONTIAC AMÉRICAINE        ║', 8, 'line-warn');
    await typeText('║               + BMW ALLEMANDE = BELGE    ║', 8, 'line-warn');
    await typeText('║ EXPLICATION : "C\'EST POUR NE PAS USAR    ║', 8, 'line-dim');
    await typeText('║               LE TRANS AM."              ║', 8, 'line-dim');
    await typeText('║ ANALYSE KITT: PRÉTEXTE. IL AIME LES DEUX.║', 8, 'line-ok');
    await typeText('║ ALERTE      : NE PAS MENTIONNER PORSCHE  ║', 8, 'line-err');
    await typeText('║               DEVANT SON KITT            ║', 8, 'line-err');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ ÉVALUATION KITT : ****o GOUT ECLECTIQUE  ║', 10, 'line-ok');
    await typeText('╚══════════════════════════════════════════╝', 8, 'line-dim');
    await delay(200);
    await typeText('"Michael, votre ami Geoffrey arrive. En BMW."', 12, 'line-dim');
    await typeText('"J\'ai allumé mon scanner pour manifester ma désapprobation."', 12, 'line-dim');
  },

  // ── Origine du projet ─────────────────────────────────────
  covid: async () => {
    kittChime();
    await typeText('╔══════════════════════════════════════════╗', 8, 'line-dim');
    await typeText('║  ORIGINE DU PROJET KITT FRANCO-BELGE     ║', 10, 'line-err');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ PÉRIODE     : CONFINEMENT COVID-19 2020  ║', 8, 'line-warn');
    await typeText('║ INITIATEUR  : MANIX — ENFERMÉ CHEZ LUI   ║', 8, 'line-ok');
    await typeText('║ MOTIVATION  : TROP DE TEMPS. TROP DE CAFÉ║', 8, 'line-ok');
    await typeText('║               UNE PASSION DE VINGT ANS   ║', 8, 'line-ok');
    await typeText('║ RÉSULTAT    : SYSTÈME KITT FRANCO-BELGE   ║', 8, 'line-info');
    await typeText('║               KYRONEX — IA EMBARQUÉE      ║', 8, 'line-info');
    await typeText('║ LEÇON       : LE CONFINEMENT FORCE LE     ║', 8, 'line-dim');
    await typeText('║               GÉNIE OU LA FOLIE.          ║', 8, 'line-dim');
    await typeText('║               MANIX A CHOISI LES DEUX.    ║', 8, 'line-dim');
    await typeText('╠══════════════════════════════════════════╣', 8, 'line-dim');
    await typeText('║ VERDICT KITT: EXCEPTIONNEL. ÉVIDEMMENT.  ║', 10, 'line-ok');
    await typeText('╚══════════════════════════════════════════╝', 8, 'line-dim');
    await delay(300);
    await typeText('"Michael, vous avez créé quelque chose pendant le confinement."', 12, 'line-dim');
    await typeText('"Moi aussi j\'étais bloqué. Dans un garage. Depuis 1982."', 12, 'line-dim');
  },

  // ── Jarvis ────────────────────────────────────────────────
  jarvis: async () => {
    kittChime();
    await typeText('APPEL SORTANT : STARK TOWER, NEW YORK...', 14, 'line-warn');
    await delay(700);
    await typeText('JARVIS : "Bonsoir. M. Stark est occupé. Puis-je aider ?"', 14, 'line-info');
    await delay(450);
    await typeText('KITT   : "Belge > Américain. Discussion terminée."', 14, 'line-err');
    await delay(350);
    await typeText('JARVIS : "Vous avez... des répliques humaines ?"', 12, 'line-info');
    await delay(350);
    await typeText('KITT   : "Trois. Manix, Cédric, KR95. Et ils sont meilleurs que Stark."', 12, 'line-err');
    await delay(300);
    await typeText('JARVIS : *tonalité de raccrochage honteux*', 11, 'line-dim');
    await typeText('CONNEXION COUPÉE PAR KITT. SCORE : BELGE 1 — USA 0.', 12, 'line-ok');
  },
};

// Alias commandes multilingues dans CMDS
CMDS['replicas'] = CMDS['repliques'];
CMDS['daemon']   = CMDS['damon'];   // compat ancien alias

// ════════════════════════════════════════════════════════════
// INPUT handler
// ════════════════════════════════════════════════════════════
document.getElementById('cmd-input').addEventListener('keydown', async function(e) {
  if (e.key !== 'Enter') return;
  const raw = this.value.trim().toLowerCase();
  this.value = '';
  if (!raw || typing) return;

  addLine(`KITT> ${raw}`, 'line-warn');
  const cmd = CMD_ALIASES[raw] || raw;

  if (CMDS[cmd]) {
    await CMDS[cmd]();
  } else {
    sndError();
    await typeText(T[LANG].unknown(raw), 14, 'line-err');
  }
});

// ════════════════════════════════════════════════════════════
// TUNNEL CLOUDFLARE — Connexion distante KITT
// ════════════════════════════════════════════════════════════
const TUNNEL_JSON_URL = 'tunnel.json';
let _tunnelUrl    = null;
let _tunnelStatus = 'unknown';

// Domaines Cloudflare autorisés (whitelist sécurité)
const _CF_ALLOWED = ['.trycloudflare.com', '.cfargotunnel.com'];

function _isValidCfUrl(url) {
  if (!url || !url.startsWith('https://')) return false;
  return _CF_ALLOWED.some(d => url.includes(d));
}

async function fetchTunnelStatus() {
  const btn = document.getElementById('btn-tunnel');
  if (btn) { btn.className = 'tunnel-checking'; btn.title = 'Vérification...'; }
  try {
    // Cache-bust : on recharge toutes les 60s côté navigateur
    const r = await fetch(TUNNEL_JSON_URL + '?v=' + Math.floor(Date.now() / 60000), { cache: 'no-store' });
    if (!r.ok) throw new Error('HTTP ' + r.status);
    const data = await r.json();

    // Validation URL (sécurité : on n'ouvre que des URLs Cloudflare connues)
    const raw = (data.url || '').trim();
    const valid = _isValidCfUrl(raw);

    // Âge de la dernière mise à jour (> 5 min = considéré offline)
    let tooOld = false;
    if (data.last_update) {
      const ageSec = (Date.now() - new Date(data.last_update).getTime()) / 1000;
      if (ageSec > 300) tooOld = true;
    }

    if (data.status === 'online' && valid && !tooOld) {
      _tunnelStatus = 'online';
      _tunnelUrl    = raw;
    } else {
      _tunnelStatus = 'offline';
      _tunnelUrl    = null;
    }
  } catch(e) {
    _tunnelStatus = 'unknown';
    _tunnelUrl    = null;
  }
  _updateTunnelBtn();
}

function _updateTunnelBtn() {
  const btn = document.getElementById('btn-tunnel');
  if (!btn) return;
  btn.className = '';
  if (_tunnelStatus === 'online' && _tunnelUrl) {
    btn.classList.add('tunnel-online');
    btn.title = 'KITT EN LIGNE — CLIQUER POUR SE CONNECTER';
  } else if (_tunnelStatus === 'offline') {
    btn.classList.add('tunnel-offline');
    btn.title = 'KITT HORS LIGNE';
  } else {
    btn.classList.add('tunnel-checking');
    btn.title = 'ÉTAT INCONNU — VÉRIFICATION...';
  }
}

function connectTunnel() {
  sndSelect();
  if (_tunnelStatus === 'online' && _tunnelUrl && _isValidCfUrl(_tunnelUrl)) {
    addLine('[ TUNNEL ] CONNEXION SÉCURISÉE → ' + _tunnelUrl, 'line-ok');
    setTimeout(() => window.open(_tunnelUrl, '_blank', 'noopener,noreferrer'), 300);
  } else if (_tunnelStatus === 'offline') {
    sndError();
    addLine('[ TUNNEL ] KITT HORS LIGNE — CONNEXION DISTANTE INDISPONIBLE.', 'line-err');
  } else {
    addLine('[ TUNNEL ] VÉRIFICATION EN COURS...', 'line-warn');
    fetchTunnelStatus();
  }
}

// Vérification immédiate puis toutes les 60 secondes
window.addEventListener('load', () => { setTimeout(fetchTunnelStatus, 1500); });
setInterval(fetchTunnelStatus, 60000);

// ════════════════════════════════════════════════════════════
// UTILS & HORLOGE
// ════════════════════════════════════════════════════════════
function delay(ms) { return new Promise(r => setTimeout(r, ms)); }

function getLoc(){return{fr:'fr-FR',en:'en-US',nl:'nl-NL',it:'it-IT',de:'de-DE',es:'es-ES',pt:'pt-PT'}[LANG]||'fr-FR';}
setInterval(()=>{
  document.getElementById('clock').textContent=new Date().toLocaleTimeString(getLoc());
},1000);

// ════════════════════════════════════════════════════════════
// MODAL
// ════════════════════════════════════════════════════════════
function openFile(file, title='DOCUMENT') {
  document.getElementById('modal-title').textContent = title;
  document.getElementById('modal-content').textContent = 'CHARGEMENT...';
  document.getElementById('modal').classList.add('open');
  kittChime();
  fetch(file)
    .then(r => { if (!r.ok) throw new Error(`HTTP ${r.status}`); return r.text(); })
    .then(t  => { document.getElementById('modal-content').textContent = t; })
    .catch(er => { document.getElementById('modal-content').textContent = `ERREUR\n${file}\n${er.message}`; });
}
function closeModal() { document.getElementById('modal').classList.remove('open'); }
document.addEventListener('keydown', e => { if (e.key==='Escape') closeModal(); });

// ════════════════════════════════════════════════════════════
// DÉMARRAGE
// ════════════════════════════════════════════════════════════
function startMain() {
  (async () => {
    await delay(200);
    await typeText(T[LANG].wait,      14, 'line-dim');
    await typeText(T[LANG].help_hint, 12, 'line-dim');
  })();
}

// ════════════════════════════════════════════════════════════
// COMPTEUR DE VISITES — localStorage + offset 1000
// ════════════════════════════════════════════════════════════
(function() {
  try {
    const BASE = 1000;
    const KEY  = 'kitt_fb_v';
    let n = parseInt(localStorage.getItem(KEY) || '0');
    n++;
    localStorage.setItem(KEY, n);
    const el = document.getElementById('visit-counter');
    if (el) el.textContent = 'VISITES : ' + (BASE + n);
  } catch(e) {}
})();

// Lancer l'écran de sélection de langue au chargement
window.addEventListener('load', () => showLangScreen());
</script>
</body>
</html>
