<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>MU-TH-UR 9000 × KITT // KYRONEX DEEP SPACE</title>
<link href="https://fonts.googleapis.com/css2?family=VT323&family=Share+Tech+Mono&display=swap" rel="stylesheet"/>
<style>
:root{
  --amber:#ffaa00;
  --amber-dim:#7a4f00;
  --amber-glow:rgba(255,170,0,0.18);
  --amber-faint:rgba(255,170,0,0.06);
  --green:#00ff41;
  --green-dim:#003d0f;
  --red:#ff2200;
  --red-glow:rgba(255,34,0,0.25);
  --cyan:#00ccdd;
  --bg:#000;
  --vt:'VT323',monospace;
  --mono:'Share Tech Mono',monospace;
}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;width:100%;background:#000;overflow:hidden;cursor:none;}

/* ── ÉCRAN DE DÉMARRAGE ─────────────────────────────────── */
#boot-screen{
  position:fixed;inset:0;background:#000;
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  z-index:9000;gap:32px;
}
#boot-logo{
  font-family:var(--vt);font-size:11px;color:var(--amber);
  text-align:center;line-height:1.15;
  text-shadow:0 0 20px var(--amber),0 0 40px rgba(255,170,0,0.4);
  opacity:0;animation:fadeIn 2s ease 0.5s forwards;
  letter-spacing:2px;
}
#boot-logo pre{display:inline-block;}
#start-btn{
  font-family:var(--vt);font-size:28px;color:#000;
  background:var(--amber);border:none;
  padding:12px 40px;cursor:pointer;letter-spacing:4px;
  animation:fadeIn 2s ease 1.5s forwards, btnPulse 2s ease-in-out 3s infinite;
  opacity:0;
  text-shadow:none;
  transition:all 0.2s;
}
#start-btn:hover{background:#fff;color:#000;box-shadow:0 0 30px var(--amber);}
@keyframes fadeIn{to{opacity:1}}
@keyframes btnPulse{0%,100%{box-shadow:0 0 10px var(--amber)}50%{box-shadow:0 0 30px var(--amber),0 0 60px rgba(255,170,0,0.3)}}

/* ── SCANLINES + PHOSPHOR ───────────────────────────────── */
#overlay-scanlines{
  position:fixed;inset:0;pointer-events:none;z-index:8000;
  background:repeating-linear-gradient(
    0deg,
    rgba(0,0,0,0.22) 0px,rgba(0,0,0,0.22) 1px,
    transparent 1px,transparent 3px
  );
}
#overlay-phosphor{
  position:fixed;inset:0;pointer-events:none;z-index:7999;
  background:rgba(255,140,0,0.022);
  animation:phosphorFlicker 0.1s infinite;
}
#overlay-vignette{
  position:fixed;inset:0;pointer-events:none;z-index:7998;
  background:radial-gradient(ellipse at center,transparent 55%,rgba(0,0,0,0.85) 100%);
}
@keyframes phosphorFlicker{
  0%{opacity:0.9}30%{opacity:1}60%{opacity:0.95}80%{opacity:1}100%{opacity:0.92}
}

/* ── LAYOUT PRINCIPAL ───────────────────────────────────── */
#main{
  display:none;
  position:fixed;inset:0;
  padding:10px;gap:8px;
  flex-direction:column;
}
#main.active{display:flex;}

/* Ligne haute */
#row-top{
  display:flex;gap:8px;flex-shrink:0;height:36px;
  align-items:center;
}
/* Ligne centrale */
#row-mid{
  display:flex;gap:8px;flex:1;min-height:0;
}
/* Ligne basse */
#row-bot{
  display:flex;gap:8px;flex-shrink:0;height:80px;
}

/* ── PANNEAUX ────────────────────────────────────────────── */
.panel{
  border:1px solid var(--amber-dim);
  background:rgba(255,140,0,0.03);
  position:relative;
  overflow:hidden;
}
.panel::before{
  content:'';position:absolute;inset:0;
  background:linear-gradient(180deg,rgba(255,170,0,0.04) 0%,transparent 100%);
  pointer-events:none;
}
.pnl-hdr{
  font-family:var(--vt);font-size:16px;color:var(--amber-dim);
  letter-spacing:2px;padding:4px 8px 2px;
  border-bottom:1px solid var(--amber-dim);
  background:rgba(255,170,0,0.04);
  display:flex;justify-content:space-between;align-items:center;
}
.pnl-hdr span{font-size:12px;color:var(--amber-dim);}
.pnl-body{padding:6px 8px;overflow:hidden;height:calc(100% - 28px);}

/* Glow amber sur texte actif */
.amber{color:var(--amber);text-shadow:0 0 8px rgba(255,170,0,0.5);}
.amber-bright{color:var(--amber);text-shadow:0 0 14px var(--amber),0 0 28px rgba(255,170,0,0.3);}
.green-txt{color:var(--green);text-shadow:0 0 8px rgba(0,255,65,0.4);}
.red-txt{color:var(--red);text-shadow:0 0 10px var(--red-glow),0 0 20px rgba(255,34,0,0.2);}
.dim{color:var(--amber-dim);}

/* ── HEADER BARRE ────────────────────────────────────────── */
#hdr-bar{
  flex:1;display:flex;align-items:center;justify-content:space-between;
  padding:0 10px;border:1px solid var(--amber-dim);
  background:rgba(255,170,0,0.04);
}
#hdr-title-txt{
  font-family:var(--vt);font-size:20px;
  color:var(--amber);letter-spacing:4px;
  text-shadow:0 0 12px var(--amber),0 0 30px rgba(255,170,0,0.3);
}
#hdr-right{
  font-family:var(--mono);font-size:10px;color:var(--amber-dim);
  letter-spacing:2px;display:flex;gap:20px;align-items:center;
}
.blink-dot{
  display:inline-block;width:6px;height:6px;border-radius:50%;
  background:var(--green);box-shadow:0 0 6px var(--green);
  animation:blink 1.2s step-end infinite;margin-right:4px;
}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}
.blink-dot.red{background:var(--red);box-shadow:0 0 6px var(--red);}
.blink-dot.amber-d{background:var(--amber);box-shadow:0 0 6px var(--amber);}

/* ── PANNEAU SCHÉMA VAISSEAU ─────────────────────────────── */
#panel-ship{flex:2.2;min-width:0; display:flex; flex-direction:column;}
#ship-svg{width:100%;flex:1;}

/* ── PANNEAU COMM KITT × MU-TH-UR ───────────────────────── */
#panel-comm{
  flex-shrink:0;
  border-top:1px solid rgba(255,34,0,0.3);
  background:rgba(0,0,0,0.6);
  display:none;
  flex-direction:row;
  align-items:stretch;
  min-height:110px;
  max-height:130px;
  position:relative;
  overflow:hidden;
}
#panel-comm.active{display:flex;}
#panel-comm::before{
  content:'';position:absolute;inset:0;
  background:repeating-linear-gradient(0deg,rgba(0,0,0,.18),rgba(0,0,0,.18) 1px,transparent 1px,transparent 3px);
  pointer-events:none;z-index:0;
}

/* Côté KITT */
#comm-kitt{
  width:155px;flex-shrink:0;
  border-right:1px solid rgba(255,34,0,0.25);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:5px 4px;gap:3px;
  position:relative;z-index:1;
  background:linear-gradient(180deg,rgba(255,34,0,0.04),rgba(0,0,0,0.6));
}
#kitt-avatar{
  font-family:'VT323',monospace;font-size:8.5px;line-height:1.15;
  color:#ff2200;text-align:center;
  text-shadow:0 0 8px #ff2200,0 0 16px rgba(255,34,0,0.4);
  white-space:pre;
  border:1px solid rgba(255,34,0,0.2);
  padding:3px 5px;
  background:rgba(255,34,0,0.02);
}
#kitt-label{
  font-family:'VT323',monospace;font-size:14px;color:#ff2200;
  letter-spacing:4px;text-shadow:0 0 12px #ff2200;
}
#kitt-scanner-bar{
  width:80px;height:4px;background:rgba(255,34,0,0.1);border:1px solid rgba(255,34,0,0.3);
  border-radius:2px;overflow:hidden;position:relative;
}
#kitt-scanner-dot{
  position:absolute;top:0;width:18px;height:100%;
  background:linear-gradient(90deg,transparent,#ff2200,transparent);
  box-shadow:0 0 8px #ff2200;
  animation:kittScan 1.4s ease-in-out infinite alternate;
}
@keyframes kittScan{from{left:-18px}to{left:80px}}

#kitt-wave{
  width:80px;height:20px;
}

/* Côté dialogue central */
#comm-dialog{
  flex:1;display:flex;flex-direction:column;
  padding:6px 10px;position:relative;z-index:1;
  overflow:hidden;
}
#comm-hdr{
  font-family:'VT323',monospace;font-size:13px;
  color:var(--amber);letter-spacing:2px;
  border-bottom:1px solid rgba(255,170,0,0.2);
  padding-bottom:3px;margin-bottom:4px;
  display:flex;align-items:center;gap:8px;
}
#comm-status-dot{
  width:6px;height:6px;border-radius:50%;
  background:#ff2200;box-shadow:0 0 6px #ff2200;
  animation:blink 0.6s step-end infinite;
  flex-shrink:0;
}
#comm-lines{
  flex:1;overflow:hidden;
  font-family:'VT323',monospace;font-size:16px;
  line-height:1.35;
}
.comm-line{animation:lineReveal 0.15s ease-out;}
.comm-kitt-line{color:#ff4422;}
.comm-muther-line{color:#ffaa00;}
.comm-kitt-line::before{content:'KITT  ▶ ';font-size:13px;opacity:0.8;}
.comm-muther-line::before{content:'MU-TH-UR ▶ ';font-size:11px;opacity:0.8;}

/* Côté MU-TH-UR */
#comm-muther{
  width:155px;flex-shrink:0;
  border-left:1px solid rgba(255,170,0,0.25);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:5px 4px;gap:3px;
  position:relative;z-index:1;
  background:linear-gradient(180deg,rgba(255,170,0,0.03),rgba(0,0,0,0.6));
}
#muther-avatar{
  font-family:'VT323',monospace;font-size:8.5px;line-height:1.15;
  color:var(--amber);text-align:center;
  text-shadow:0 0 8px var(--amber),0 0 16px rgba(255,170,0,0.4);
  white-space:pre;
  border:1px solid rgba(255,170,0,0.2);
  padding:3px 5px;
  background:rgba(255,170,0,0.02);
}
#muther-label{
  font-family:'VT323',monospace;font-size:12px;color:var(--amber);
  letter-spacing:3px;text-shadow:0 0 10px var(--amber);
}
#muther-wave{width:80px;height:20px;}
#muther-pulse{
  width:80px;height:4px;background:rgba(255,170,0,0.1);border:1px solid rgba(255,170,0,0.3);
  border-radius:2px;overflow:hidden;position:relative;
}
#muther-pulse-inner{
  position:absolute;top:0;height:100%;width:0%;
  background:var(--amber);box-shadow:0 0 6px var(--amber);
  transition:width 0.1s;
}

/* Waveform canvas speaking indicator */
.speaking-kitt #kitt-avatar{animation:kittGlow 0.3s ease-in-out infinite alternate;}
.speaking-muther #muther-avatar{animation:mutherGlow 0.3s ease-in-out infinite alternate;}
@keyframes kittGlow{from{text-shadow:0 0 8px #ff2200}to{text-shadow:0 0 24px #ff2200,0 0 40px rgba(255,34,0,0.6)}}
@keyframes mutherGlow{from{text-shadow:0 0 8px var(--amber)}to{text-shadow:0 0 24px var(--amber),0 0 40px rgba(255,170,0,0.6)}}

/* ── PANNEAU TERMINAL CENTRAL ────────────────────────────── */
#panel-terminal{flex:2;min-width:0;}
#terminal-out{
  height:100%;overflow-y:auto;overflow-x:hidden;
  font-family:var(--vt);font-size:18px;line-height:1.4;
  scrollbar-width:thin;scrollbar-color:var(--amber-dim) transparent;
  padding:2px 4px;
}
#terminal-out::-webkit-scrollbar{width:3px;}
#terminal-out::-webkit-scrollbar-thumb{background:var(--amber-dim);}
.t-line{animation:lineReveal 0.1s ease-out;}
@keyframes lineReveal{from{opacity:0}to{opacity:1}}
.t-cursor{
  display:inline-block;width:10px;height:17px;
  background:var(--amber);vertical-align:text-bottom;
  animation:cursorBlink 0.6s step-end infinite;
  box-shadow:0 0 8px var(--amber);
}
@keyframes cursorBlink{0%,100%{opacity:1}50%{opacity:0}}

/* ── PANNEAU RADAR ───────────────────────────────────────── */
#panel-radar{flex:1;min-width:0;}
#radar-svg{width:100%;height:100%;}

/* ── PANNEAU STATUS ÉQUIPAGE ─────────────────────────────── */
#panel-crew{width:170px;flex-shrink:0;}
.crew-entry{
  font-family:var(--mono);font-size:9px;
  color:var(--amber-dim);
  padding:4px 6px 3px;
  border-bottom:1px solid rgba(255,170,0,0.08);
  transition:color 0.5s;
}
.crew-entry .cn{color:var(--amber);letter-spacing:1px;font-size:10px;}
.crew-entry .cs{float:right;font-size:9px;}
.crew-entry.ok .cs{color:var(--green);}
.crew-entry.warn .cs{color:var(--amber);}
.crew-entry.crit .cs{color:var(--red);animation:textBlink 0.8s step-end infinite;}
@keyframes textBlink{0%,100%{opacity:1}50%{opacity:0}}

/* ── PANNEAU METRICS BAS ─────────────────────────────────── */
#panel-metrics{flex:1;}
.metric-row{
  display:flex;align-items:center;gap:6px;
  font-family:var(--mono);font-size:9px;color:var(--amber-dim);
  padding:2px 0;letter-spacing:1px;
}
.metric-label{width:90px;flex-shrink:0;}
.metric-bar-wrap{flex:1;height:8px;background:rgba(255,170,0,0.08);border:1px solid rgba(255,170,0,0.15);position:relative;overflow:hidden;}
.metric-bar{height:100%;background:var(--amber);box-shadow:0 0 6px rgba(255,170,0,0.4);width:0%;transition:width 2s ease;}
.metric-bar.green{background:var(--green);box-shadow:0 0 6px rgba(0,255,65,0.4);}
.metric-bar.red{background:var(--red);box-shadow:0 0 6px var(--red-glow);}
.metric-val{width:38px;text-align:right;color:var(--amber);font-size:9px;}

/* ── PANNEAU ALERTE ──────────────────────────────────────── */
#panel-alert{flex:1;display:none;align-items:center;justify-content:center;}
#panel-alert.show{display:flex;}
#alert-inner{
  font-family:var(--vt);font-size:20px;color:var(--red);
  letter-spacing:3px;text-align:center;
  text-shadow:0 0 16px var(--red),0 0 30px rgba(255,34,0,0.3);
  animation:alertPulse 1s ease-in-out infinite;
}
@keyframes alertPulse{0%,100%{opacity:1}50%{opacity:0.4}}

/* ── PANNEAU NAVIGATION ──────────────────────────────────── */
#panel-nav{flex:1;min-width:0;}
.nav-data{font-family:var(--mono);font-size:9px;color:var(--amber-dim);padding:2px 0;letter-spacing:1px;}
.nav-data .nv{color:var(--amber);}

/* ── BOUTON TRANSITION ───────────────────────────────────── */
#transition-btn{
  display:none;
  position:fixed;bottom:30px;left:50%;transform:translateX(-50%);
  font-family:var(--vt);font-size:26px;
  color:#000;background:var(--amber);
  border:none;padding:10px 36px;cursor:pointer;
  letter-spacing:4px;z-index:6000;
  animation:btnAppear 0.5s ease forwards, btnPulse2 1.6s ease-in-out infinite;
}
#transition-btn::before{
  content:'K·I·T·T // ';font-size:14px;letter-spacing:2px;opacity:0.7;
}
#transition-btn::after{
  content:' // ALIEN';font-size:14px;letter-spacing:2px;opacity:0.7;
}
@keyframes btnAppear{from{opacity:0;transform:translateX(-50%) translateY(20px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
@keyframes btnPulse2{0%,100%{box-shadow:0 0 15px var(--amber),0 0 30px rgba(255,34,0,0.15)}50%{box-shadow:0 0 50px var(--amber),0 0 80px rgba(255,170,0,0.35),0 0 4px rgba(255,34,0,0.4)}}
#transition-btn:hover{background:#fff;color:#000;}

/* ── OVERRIDE OVERLAY ────────────────────────────────────── */
#override-overlay{
  display:none;position:fixed;inset:0;
  background:rgba(255,0,0,0.04);
  pointer-events:none;z-index:5000;
  animation:overrideFlash 0.3s ease-in-out 3;
}
#override-overlay.show{display:block;}
@keyframes overrideFlash{0%{background:rgba(255,0,0,0.12)}100%{background:rgba(255,0,0,0.03)}}

/* ── RÉTICULE CURSEUR ────────────────────────────────────── */
#cursor-cross{
  position:fixed;pointer-events:none;z-index:8500;
  width:20px;height:20px;margin:-10px 0 0 -10px;
  opacity:0.7;transition:opacity 0.3s;
}
#cursor-cross::before,#cursor-cross::after{
  content:'';position:absolute;background:var(--amber);
  box-shadow:0 0 4px var(--amber);
}
#cursor-cross::before{width:1px;height:100%;left:50%;transform:translateX(-50%);}
#cursor-cross::after{width:100%;height:1px;top:50%;transform:translateY(-50%);}

/* ── MOBILE ─────────────────────────────────────────────── */
@media(max-width:700px){
  #panel-crew{display:none;}
  #panel-ship{flex:1.5;}
  #panel-radar{display:none;}
  #terminal-out{font-size:15px;}
  #hdr-title-txt{font-size:15px;letter-spacing:2px;}
  #boot-logo pre{font-size:8px;}
}
</style>
</head>
<body>

<!-- Curseur réticule -->
<div id="cursor-cross"></div>

<!-- Overlay effets visuels -->
<div id="overlay-scanlines"></div>
<div id="overlay-phosphor"></div>
<div id="overlay-vignette"></div>
<div id="override-overlay"></div>

<!-- ÉCRAN DE DÉMARRAGE -->
<div id="boot-screen">
  <div id="boot-logo"><pre>
██╗  ██╗██╗   ██╗██████╗  ██████╗ ███╗   ██╗███████╗██╗  ██╗
██║ ██╔╝╚██╗ ██╔╝██╔══██╗██╔═══██╗████╗  ██║██╔════╝╚██╗██╔╝
█████╔╝  ╚████╔╝ ██████╔╝██║   ██║██╔██╗ ██║█████╗   ╚███╔╝
██╔═██╗   ╚██╔╝  ██╔══██╗██║   ██║██║╚██╗██║██╔══╝   ██╔██╗
██║  ██╗   ██║   ██║  ██║╚██████╔╝██║ ╚████║███████╗██╔╝ ██╗
╚═╝  ╚═╝   ╚═╝   ╚═╝  ╚═╝ ╚═════╝ ╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝
              DEEP SPACE VESSEL  ·  K-1979 FRANCO
         ARTIFICIAL INTELLIGENCE MANAGEMENT SYSTEM
  </pre></div>
  <button id="start-btn" onclick="initSystem()">▶  ACTIVER SYSTÈME</button>
</div>

<!-- INTERFACE PRINCIPALE -->
<div id="main">
  <!-- Barre haute -->
  <div id="row-top">
    <div id="hdr-bar">
      <div id="hdr-title-txt">MU-TH-UR 9000 × K·I·T·T // SYSTÈME KYRONEX FRANCO-BELGE</div>
      <div id="hdr-right">
        <span><span class="blink-dot" id="dot-power"></span>ALIMENTATION</span>
        <span><span class="blink-dot" id="dot-ai"></span>IA ACTIVE</span>
        <span id="sys-clock">00:00:00</span>
        <span id="sys-date">STARDATE ---</span>
      </div>
    </div>
  </div>

  <!-- Zone centrale -->
  <div id="row-mid">
    <!-- Schéma vaisseau -->
    <div class="panel" id="panel-ship">
      <div class="pnl-hdr">SCHÉMA STRUCTUREL — K-1979 FRANCO <span id="ship-status">NOMINAL</span></div>
      <div class="pnl-body" style="padding:4px;">
        <svg id="ship-svg" viewBox="0 0 600 220" preserveAspectRatio="xMidYMid meet">
          <defs>
            <filter id="glow-amber">
              <feGaussianBlur stdDeviation="2.5" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
            <filter id="glow-amber-strong">
              <feGaussianBlur stdDeviation="4" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
            <filter id="glow-green">
              <feGaussianBlur stdDeviation="1.8" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
            <filter id="glow-red">
              <feGaussianBlur stdDeviation="3.5" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
            <filter id="glow-red-strong">
              <feGaussianBlur stdDeviation="6" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
            <linearGradient id="hull-grad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#ffaa00;stop-opacity:0.9"/>
              <stop offset="100%" style="stop-color:#7a4f00;stop-opacity:0.7"/>
            </linearGradient>
            <linearGradient id="engine-grad" x1="100%" y1="0%" x2="0%" y2="0%">
              <stop offset="0%" style="stop-color:#ffaa00;stop-opacity:1"/>
              <stop offset="100%" style="stop-color:#ff6600;stop-opacity:0.3"/>
            </linearGradient>
          </defs>

          <!-- Grille de fond HUD -->
          <g stroke="rgba(255,170,0,0.05)" stroke-width="0.4">
            <line x1="0" y1="40" x2="600" y2="40"/>
            <line x1="0" y1="80" x2="600" y2="80"/>
            <line x1="0" y1="110" x2="600" y2="110"/>
            <line x1="0" y1="140" x2="600" y2="140"/>
            <line x1="0" y1="180" x2="600" y2="180"/>
            <line x1="60" y1="0" x2="60" y2="220"/>
            <line x1="120" y1="0" x2="120" y2="220"/>
            <line x1="200" y1="0" x2="200" y2="220"/>
            <line x1="300" y1="0" x2="300" y2="220"/>
            <line x1="400" y1="0" x2="400" y2="220"/>
            <line x1="500" y1="0" x2="500" y2="220"/>
          </g>

          <!-- ══ COQUE PRINCIPALE ══ -->
          <!-- Fuselage central principal -->
          <rect x="80" y="84" width="400" height="52" rx="4" stroke="url(#hull-grad)" stroke-width="1.5" fill="rgba(255,170,0,0.03)" filter="url(#glow-amber)"/>
          <!-- Double paroi intérieure -->
          <rect x="82" y="86" width="396" height="48" rx="3" stroke="rgba(255,170,0,0.2)" stroke-width="0.5" fill="none"/>

          <!-- Nez effilé complexe -->
          <path d="M80,84 L50,100 L50,110 M80,136 L50,110" stroke="#ffaa00" stroke-width="1.5" fill="none" filter="url(#glow-amber)"/>
          <path d="M50,100 L22,108 L50,110" stroke="#ffaa00" stroke-width="1" fill="rgba(255,170,0,0.04)"/>
          <!-- Pointe laser avant -->
          <line x1="22" y1="108" x2="8" y2="110" stroke="#ffaa00" stroke-width="0.8"/>
          <circle cx="8" cy="110" r="2" fill="#ffaa00" filter="url(#glow-amber)">
            <animate attributeName="opacity" values="0.4;1;0.4" dur="1.8s" repeatCount="indefinite"/>
          </circle>
          <!-- Renforts nez -->
          <line x1="50" y1="100" x2="60" y2="95" stroke="rgba(255,170,0,0.4)" stroke-width="0.6"/>
          <line x1="50" y1="110" x2="60" y2="110" stroke="rgba(255,170,0,0.4)" stroke-width="0.6"/>
          <line x1="50" y1="110" x2="60" y2="125" stroke="rgba(255,170,0,0.4)" stroke-width="0.6"/>

          <!-- ══ SUPERSTRUCTURE / PONT DE COMMANDEMENT ══ -->
          <path d="M85,84 L100,65 L160,60 L180,84" stroke="#ffaa00" stroke-width="1.2" fill="rgba(255,170,0,0.04)" filter="url(#glow-amber)"/>
          <!-- Hublots pont de commandement -->
          <rect x="108" y="66" width="16" height="8" rx="1" stroke="#00ccdd" stroke-width="0.8" fill="rgba(0,204,221,0.08)">
            <animate attributeName="opacity" values="0.5;1;0.5" dur="3s" repeatCount="indefinite"/>
          </rect>
          <rect x="130" y="65" width="16" height="8" rx="1" stroke="#00ccdd" stroke-width="0.8" fill="rgba(0,204,221,0.08)">
            <animate attributeName="opacity" values="0.8;0.3;0.8" dur="2.2s" repeatCount="indefinite"/>
          </rect>
          <rect x="152" y="66" width="12" height="7" rx="1" stroke="#00ccdd" stroke-width="0.8" fill="rgba(0,204,221,0.08)">
            <animate attributeName="opacity" values="0.6;1;0.6" dur="4s" repeatCount="indefinite"/>
          </rect>
          <!-- Dôme comm -->
          <ellipse cx="130" cy="60" rx="35" ry="6" stroke="rgba(255,170,0,0.5)" stroke-width="0.8" fill="rgba(255,170,0,0.02)"/>
          <!-- Antennes communication -->
          <line x1="120" y1="60" x2="115" y2="38" stroke="#ffaa00" stroke-width="0.7"/>
          <line x1="130" y1="60" x2="130" y2="32" stroke="#ffaa00" stroke-width="0.7"/>
          <line x1="140" y1="60" x2="145" y2="38" stroke="#ffaa00" stroke-width="0.7"/>
          <!-- Antenne principale avec boule -->
          <circle cx="130" cy="32" r="2.5" fill="#ffaa00" filter="url(#glow-amber)">
            <animate attributeName="r" values="2;3.5;2" dur="2s" repeatCount="indefinite"/>
          </circle>
          <circle cx="115" cy="38" r="1.5" fill="rgba(255,170,0,0.7)"/>
          <circle cx="145" cy="38" r="1.5" fill="rgba(255,170,0,0.7)"/>

          <!-- ══ SÉPARATIONS INTERNES DU FUSELAGE ══ -->
          <!-- Cloison A — Sas avant -->
          <rect x="122" y="84" width="3" height="52" fill="rgba(255,170,0,0.25)" stroke="#7a4f00" stroke-width="0.5"/>
          <!-- Hublot sas -->
          <circle cx="135" cy="110" r="4" stroke="rgba(255,170,0,0.4)" stroke-width="0.8" fill="rgba(0,0,0,0)"/>
          <!-- Cloison B — Cryogénie -->
          <rect x="218" y="84" width="3" height="52" fill="rgba(255,170,0,0.25)" stroke="#7a4f00" stroke-width="0.5"/>
          <!-- Cloison C — Fret -->
          <rect x="318" y="84" width="3" height="52" fill="rgba(255,170,0,0.25)" stroke="#7a4f00" stroke-width="0.5"/>
          <!-- Cloison D — Réacteur -->
          <rect x="398" y="84" width="3" height="52" fill="rgba(255,170,0,0.25)" stroke="#7a4f00" stroke-width="0.5"/>

          <!-- ══ DÉTAILS INTERNES CRYOGÉNIE ══ -->
          <!-- Capsules cryo (5 capsules) -->
          <g stroke="rgba(0,204,221,0.5)" stroke-width="0.8" fill="rgba(0,204,221,0.04)">
            <rect x="130" y="91" width="16" height="22" rx="2"/>
            <rect x="150" y="91" width="16" height="22" rx="2"/>
            <rect x="170" y="91" width="16" height="22" rx="2"/>
            <rect x="130" y="116" width="16" height="14" rx="2"/>
            <rect x="150" y="116" width="16" height="14" rx="2"/>
          </g>
          <!-- Voyants cryo verts -->
          <circle cx="138" cy="95" r="1.5" fill="#00ff41"><animate attributeName="opacity" values="1;0.2;1" dur="2.1s" repeatCount="indefinite"/></circle>
          <circle cx="158" cy="95" r="1.5" fill="#00ff41"><animate attributeName="opacity" values="1;0.3;1" dur="1.8s" repeatCount="indefinite"/></circle>
          <circle cx="178" cy="95" r="1.5" fill="#00ff41"><animate attributeName="opacity" values="1;0.4;1" dur="2.5s" repeatCount="indefinite"/></circle>
          <circle cx="138" cy="120" r="1.5" fill="#00ff41"><animate attributeName="opacity" values="1;0.2;1" dur="1.6s" repeatCount="indefinite"/></circle>
          <circle cx="158" cy="120" r="1.5" fill="#00ff41"><animate attributeName="opacity" values="1;0.3;1" dur="3s" repeatCount="indefinite"/></circle>

          <!-- ══ DÉTAILS SECTION FRET ══ -->
          <!-- Conteneurs de fret -->
          <rect x="228" y="88" width="28" height="20" rx="1" stroke="rgba(255,170,0,0.3)" stroke-width="0.8" fill="rgba(255,170,0,0.03)"/>
          <rect x="260" y="88" width="22" height="20" rx="1" stroke="rgba(255,170,0,0.3)" stroke-width="0.8" fill="rgba(255,170,0,0.03)"/>
          <rect x="228" y="112" width="50" height="16" rx="1" stroke="rgba(255,170,0,0.3)" stroke-width="0.8" fill="rgba(255,170,0,0.03)"/>
          <!-- Lignes de tuyaux section fret -->
          <line x1="228" y1="100" x2="286" y2="100" stroke="rgba(255,170,0,0.2)" stroke-width="2"/>
          <line x1="240" y1="88" x2="240" y2="84" stroke="rgba(255,170,0,0.2)" stroke-width="1.5"/>
          <line x1="260" y1="88" x2="260" y2="84" stroke="rgba(255,170,0,0.2)" stroke-width="1.5"/>
          <!-- ZONE ALIEN DÉTECTÉE — clignotante en rouge -->
          <rect id="alien-zone" x="226" y="86" width="94" height="48" rx="2" fill="rgba(255,34,0,0)" stroke="rgba(255,34,0,0)" stroke-width="1.5">
          </rect>
          <!-- Indicateur alien (caché initialement) -->
          <g id="alien-indicator" opacity="0">
            <circle cx="267" cy="110" r="8" fill="rgba(255,34,0,0.15)" stroke="#ff2200" stroke-width="1" filter="url(#glow-red)">
              <animate attributeName="r" values="6;12;6" dur="1.2s" repeatCount="indefinite"/>
              <animate attributeName="opacity" values="0.5;1;0.5" dur="0.8s" repeatCount="indefinite"/>
            </circle>
            <text x="258" y="114" font-family="'VT323'" font-size="10" fill="#ff2200" filter="url(#glow-red)">⚠ XEN</text>
          </g>

          <!-- ══ SECTION RÉACTEUR — DÉTAILS ══ -->
          <!-- Cœur réacteur -->
          <rect x="330" y="88" width="65" height="44" rx="3" stroke="rgba(255,170,0,0.6)" stroke-width="1" fill="rgba(255,170,0,0.02)"/>
          <!-- Barres de combustible -->
          <line x1="342" y1="88" x2="342" y2="132" stroke="rgba(0,255,65,0.4)" stroke-width="2"/>
          <line x1="354" y1="88" x2="354" y2="132" stroke="rgba(0,255,65,0.5)" stroke-width="2"/>
          <line x1="366" y1="88" x2="366" y2="132" stroke="rgba(0,255,65,0.4)" stroke-width="2"/>
          <line x1="378" y1="88" x2="378" y2="132" stroke="rgba(0,255,65,0.3)" stroke-width="2"/>
          <!-- Noyau central -->
          <circle cx="358" cy="110" r="10" stroke="#ffaa00" stroke-width="1" fill="rgba(255,170,0,0.06)" filter="url(#glow-amber)">
            <animate attributeName="r" values="9;13;9" dur="2.5s" repeatCount="indefinite"/>
            <animate attributeName="opacity" values="0.6;1;0.6" dur="2.5s" repeatCount="indefinite"/>
          </circle>
          <!-- Tuyaux refroidissement -->
          <path d="M395,96 Q410,90 430,90" stroke="rgba(0,204,221,0.5)" stroke-width="1.2" fill="none"/>
          <path d="M395,110 Q415,110 430,110" stroke="rgba(0,204,221,0.5)" stroke-width="1.2" fill="none"/>
          <path d="M395,124 Q410,130 430,130" stroke="rgba(0,204,221,0.5)" stroke-width="1.2" fill="none"/>

          <!-- ══ SYSTÈME PROPULSION ARRIÈRE ══ -->
          <!-- Raccord arrière -->
          <path d="M480,84 L510,78 L530,84 M480,136 L510,142 L530,136" stroke="#ffaa00" stroke-width="1.2" fill="none" filter="url(#glow-amber)"/>
          <!-- Pod moteur supérieur — détaillé -->
          <rect x="510" y="52" width="72" height="24" rx="3" stroke="#ffaa00" stroke-width="1.2" fill="rgba(255,170,0,0.04)" filter="url(#glow-amber)"/>
          <rect x="513" y="55" width="66" height="18" rx="2" stroke="rgba(255,170,0,0.3)" stroke-width="0.5" fill="none"/>
          <!-- Nervures pod sup -->
          <line x1="530" y1="52" x2="530" y2="76" stroke="rgba(255,170,0,0.25)" stroke-width="0.8"/>
          <line x1="548" y1="52" x2="548" y2="76" stroke="rgba(255,170,0,0.25)" stroke-width="0.8"/>
          <line x1="564" y1="52" x2="564" y2="76" stroke="rgba(255,170,0,0.25)" stroke-width="0.8"/>

          <!-- Pod moteur inférieur — détaillé -->
          <rect x="510" y="144" width="72" height="24" rx="3" stroke="#ffaa00" stroke-width="1.2" fill="rgba(255,170,0,0.04)" filter="url(#glow-amber)"/>
          <rect x="513" y="147" width="66" height="18" rx="2" stroke="rgba(255,170,0,0.3)" stroke-width="0.5" fill="none"/>
          <!-- Nervures pod inf -->
          <line x1="530" y1="144" x2="530" y2="168" stroke="rgba(255,170,0,0.25)" stroke-width="0.8"/>
          <line x1="548" y1="144" x2="548" y2="168" stroke="rgba(255,170,0,0.25)" stroke-width="0.8"/>
          <line x1="564" y1="144" x2="564" y2="168" stroke="rgba(255,170,0,0.25)" stroke-width="0.8"/>

          <!-- Pod moteur central principal -->
          <rect x="520" y="92" width="68" height="36" rx="4" stroke="#ffaa00" stroke-width="1.5" fill="rgba(255,170,0,0.05)" filter="url(#glow-amber-strong)"/>
          <rect x="523" y="95" width="62" height="30" rx="3" stroke="rgba(255,170,0,0.35)" stroke-width="0.6" fill="none"/>
          <!-- Chambre de combustion -->
          <ellipse cx="548" cy="110" rx="16" ry="10" stroke="rgba(255,170,0,0.6)" stroke-width="1" fill="rgba(255,170,0,0.04)"/>

          <!-- Pylônes moteurs renforcés -->
          <line x1="480" y1="84" x2="510" y2="64" stroke="#ffaa00" stroke-width="1.8"/>
          <line x1="480" y1="84" x2="510" y2="84" stroke="#ffaa00" stroke-width="1"/>
          <line x1="480" y1="136" x2="510" y2="156" stroke="#ffaa00" stroke-width="1.8"/>
          <line x1="480" y1="136" x2="510" y2="136" stroke="#ffaa00" stroke-width="1"/>

          <!-- ══ TUYÈRES PROPULSION ══ -->
          <!-- Tuyère sup -->
          <path d="M582,52 L594,56 L596,68 L582,76 Z" stroke="#ffaa00" stroke-width="1" fill="rgba(255,170,0,0.06)"/>
          <!-- Flamme tuyère sup -->
          <ellipse cx="596" cy="64" rx="4" ry="6" fill="url(#engine-grad)" filter="url(#glow-amber)">
            <animate attributeName="rx" values="3;6;3" dur="0.3s" repeatCount="indefinite"/>
            <animate attributeName="opacity" values="0.5;1;0.5" dur="0.25s" repeatCount="indefinite"/>
          </ellipse>
          <!-- Tuyère inf -->
          <path d="M582,144 L594,148 L596,160 L582,168 Z" stroke="#ffaa00" stroke-width="1" fill="rgba(255,170,0,0.06)"/>
          <!-- Flamme tuyère inf -->
          <ellipse cx="596" cy="156" rx="4" ry="6" fill="url(#engine-grad)" filter="url(#glow-amber)">
            <animate attributeName="rx" values="4;7;4" dur="0.28s" repeatCount="indefinite"/>
            <animate attributeName="opacity" values="0.6;1;0.6" dur="0.32s" repeatCount="indefinite"/>
          </ellipse>
          <!-- Tuyère centrale principale -->
          <path d="M588,92 L598,96 L600,124 L588,128 Z" stroke="#ffaa00" stroke-width="1.5" fill="rgba(255,170,0,0.06)"/>
          <!-- Flamme centrale -->
          <ellipse cx="600" cy="110" rx="6" ry="14" fill="url(#engine-grad)" filter="url(#glow-amber-strong)">
            <animate attributeName="rx" values="5;9;5" dur="0.22s" repeatCount="indefinite"/>
            <animate attributeName="ry" values="12;18;12" dur="0.3s" repeatCount="indefinite"/>
            <animate attributeName="opacity" values="0.7;1;0.7" dur="0.18s" repeatCount="indefinite"/>
          </ellipse>

          <!-- ══ TUYAUX ET CONDUITS ══ -->
          <!-- Conduit dorsale principal -->
          <path d="M82,84 Q200,78 400,84" stroke="rgba(255,170,0,0.3)" stroke-width="1.5" fill="none"/>
          <path d="M82,136 Q200,142 400,136" stroke="rgba(255,170,0,0.3)" stroke-width="1.5" fill="none"/>
          <!-- Conduit refroidissement latéral supérieur -->
          <path d="M160,80 Q230,72 318,80" stroke="rgba(0,204,221,0.3)" stroke-width="1" fill="none"/>
          <!-- Câbles électriques -->
          <path d="M122,88 Q170,94 218,88" stroke="rgba(255,255,0,0.15)" stroke-width="0.6" fill="none" stroke-dasharray="3,4"/>
          <path d="M122,125 Q170,119 218,125" stroke="rgba(255,255,0,0.15)" stroke-width="0.6" fill="none" stroke-dasharray="3,4"/>

          <!-- ══ SCANNER SWEEP HORIZONTAL ══ -->
          <line id="ship-scan" x1="80" y1="70" x2="80" y2="155" stroke="rgba(255,170,0,0.35)" stroke-width="1.5">
            <animate attributeName="x1" values="80;480;80" dur="5s" repeatCount="indefinite"/>
            <animate attributeName="x2" values="80;480;80" dur="5s" repeatCount="indefinite"/>
          </line>

          <!-- ══ LABELS ══ -->
          <g font-family="'VT323',monospace" font-size="9" fill="rgba(255,170,0,0.5)" text-anchor="middle">
            <text x="95" y="77">PONT.A</text>
            <text x="170" y="57">CMD / NAV</text>
            <text x="170" y="145">CRYO</text>
            <text x="267" y="77">SECTION FRET — NV.C</text>
            <text x="358" y="77">RÉACTEUR</text>
            <text x="548" y="48">POD Σ1</text>
            <text x="548" y="188">POD Σ2</text>
            <text x="548" y="110" fill="#ffaa00" font-size="10">PROPULSION</text>
          </g>
          <!-- Label coordonnées -->
          <text x="5" y="12" font-family="'VT323'" font-size="8" fill="rgba(255,170,0,0.3)">K-1979 FRANCO — VUE LATÉRALE — ÉCHELLE 1:800</text>
          <text x="5" y="215" font-family="'VT323'" font-size="8" fill="rgba(255,170,0,0.3)">SECTION : AVANT [Σ-NORD] — RÉACTEUR ION DE TYPE IV — CLEARANCE : ROUGE</text>

          <!-- ══ INDICATEURS LUMINEUX ══ -->
          <circle cx="100" cy="110" r="2.5" fill="#00ff41" filter="url(#glow-green)" id="sl-1"><animate attributeName="opacity" values="1;0.3;1" dur="2.1s" repeatCount="indefinite"/></circle>
          <circle cx="165" cy="108" r="2" fill="#00ff41" filter="url(#glow-green)" id="sl-2"><animate attributeName="opacity" values="1;0.2;1" dur="1.7s" repeatCount="indefinite"/></circle>
          <circle cx="290" cy="110" r="2.5" fill="#ffaa00" filter="url(#glow-amber)" id="sl-3"><animate attributeName="opacity" values="1;0.4;1" dur="3s" repeatCount="indefinite"/></circle>
          <circle cx="360" cy="110" r="3" fill="#00ff41" filter="url(#glow-green)" id="sl-4"><animate attributeName="opacity" values="1;0.3;1" dur="2.5s" repeatCount="indefinite"/></circle>
          <circle cx="470" cy="100" r="2" fill="#ffaa00" filter="url(#glow-amber)" id="sl-5"><animate attributeName="opacity" values="0.3;1;0.3" dur="1.9s" repeatCount="indefinite"/></circle>

          <!-- ══ ALERTE OVERLAY ══ -->
          <rect id="alert-overlay" x="400" y="82" width="80" height="56" fill="rgba(255,34,0,0.12)" stroke="#ff2200" stroke-width="1.5" opacity="0" rx="2" filter="url(#glow-red)">
            <animate id="alert-anim" attributeName="opacity" values="0;0.8;0" dur="1s" repeatCount="0"/>
          </rect>
        </svg>
      </div><!-- fin pnl-body ship -->

      <!-- PANNEAU COMM KITT × MU-TH-UR — sous le schéma vaisseau -->
      <div id="panel-comm">

        <!-- Avatar KITT gauche -->
        <div id="comm-kitt">
          <div id="kitt-label">K · I · T · T</div>
          <div id="kitt-avatar">
  ╔══════════════╗
  ║  ◤▓▓▓▓▓▓◥   ║
  ║ ▐░░░░░░░░▌  ║
  ║ ▐ ◈ KITT ◈ ▌ ║
  ╠══╦══════╦══╣
  ║▓▓║ ◉◉◉ ║▓▓║
  ║▓▓║━━━━━║▓▓║
  ╚══╩══════╩══╝
  ▐███░░░░░███▌
 ▐█████████████▌
  ██ KNIGHT ██
  ◈ INDUSTRIES ◈</div>
          <div id="kitt-scanner-bar"><div id="kitt-scanner-dot"></div></div>
          <svg id="kitt-wave" viewBox="0 0 80 20" preserveAspectRatio="none">
            <polyline id="kitt-wave-line" points="0,10 80,10" fill="none" stroke="#ff2200" stroke-width="1.5" opacity="0.5"/>
          </svg>
        </div>

        <!-- Dialogue central -->
        <div id="comm-dialog">
          <div id="comm-hdr">
            <span id="comm-status-dot"></span>
            <span>CANAL SÉCURISÉ — FRÉQ. 14.404 GHz — CHIFFRÉ</span>
          </div>
          <div id="comm-lines"></div>
        </div>

        <!-- Avatar MU-TH-UR droite -->
        <div id="comm-muther">
          <div id="muther-label">MU · TH · UR</div>
          <div id="muther-avatar">
  ╔══════════════╗
  ║▓▓▓▓▓▓▓▓▓▓▓▓▓║
  ║ ┌──────────┐ ║
  ║ │▒▒MU-TH-UR│ ║
  ║ │ 9 0 0 0  │ ║
  ║ └──────────┘ ║
  ╠══════════════╣
  ║ ▣  ▣  ▣  ▣  ║
  ║░░░░░░░░░░░░░║
  ╠══════════════╣
  ║ WEYLAND CORP ║
  ╚══════════════╝</div>
          <div id="muther-pulse"><div id="muther-pulse-inner"></div></div>
          <svg id="muther-wave" viewBox="0 0 80 20" preserveAspectRatio="none">
            <polyline id="muther-wave-line" points="0,10 80,10" fill="none" stroke="#ffaa00" stroke-width="1.5" opacity="0.5"/>
          </svg>
        </div>

      </div><!-- fin panel-comm -->
    </div><!-- fin panel-ship -->
    <div class="panel" id="panel-terminal">
      <div class="pnl-hdr">MU-TH-UR 9000 — SORTIE PRINCIPALE <span id="pnl-mode">MODE : VEILLE</span></div>
      <div class="pnl-body" style="padding:6px 8px;">
        <div id="terminal-out"></div>
      </div>
    </div>

    <!-- Radar -->
    <div class="panel" id="panel-radar">
      <div class="pnl-hdr">PROXIMITÉ SECTORIELLE <span>PORTÉE : 2.4 UA</span></div>
      <div class="pnl-body" style="padding:2px;display:flex;align-items:center;justify-content:center;">
        <svg id="radar-svg" viewBox="0 0 140 140" style="width:100%;max-height:100%;">
          <!-- Cercles radar -->
          <circle cx="70" cy="70" r="65" fill="none" stroke="rgba(255,170,0,0.15)" stroke-width="0.5"/>
          <circle cx="70" cy="70" r="48" fill="none" stroke="rgba(255,170,0,0.15)" stroke-width="0.5"/>
          <circle cx="70" cy="70" r="32" fill="none" stroke="rgba(255,170,0,0.2)" stroke-width="0.5"/>
          <circle cx="70" cy="70" r="16" fill="none" stroke="rgba(255,170,0,0.25)" stroke-width="0.5"/>
          <!-- Croix -->
          <line x1="70" y1="5" x2="70" y2="135" stroke="rgba(255,170,0,0.1)" stroke-width="0.5"/>
          <line x1="5" y1="70" x2="135" y2="70" stroke="rgba(255,170,0,0.1)" stroke-width="0.5"/>
          <!-- Sweep radar -->
          <g id="radar-sweep">
            <path d="M70,70 L135,70 A65,65 0 0,1 95,126 Z" fill="rgba(255,170,0,0.07)"/>
            <line x1="70" y1="70" x2="135" y2="70" stroke="rgba(255,170,0,0.6)" stroke-width="1"/>
            <animateTransform attributeName="transform" type="rotate" from="0 70 70" to="360 70 70" dur="4s" repeatCount="indefinite"/>
          </g>
          <!-- Point vaisseau (centre) -->
          <circle cx="70" cy="70" r="3" fill="#ffaa00" filter="url(#glow-amber)">
            <animate attributeName="r" values="2;4;2" dur="2s" repeatCount="indefinite"/>
          </circle>
          <!-- Contact mystérieux -->
          <circle id="radar-contact" cx="110" cy="38" r="2.5" fill="#ff2200" opacity="0">
            <animate attributeName="opacity" values="0;1;0" dur="4s" begin="25s" repeatCount="indefinite"/>
          </circle>
          <!-- Labels distance -->
          <text x="72" y="26" font-family="'VT323'" font-size="8" fill="rgba(255,170,0,0.4)">2.4</text>
          <text x="72" y="43" font-family="'VT323'" font-size="8" fill="rgba(255,170,0,0.4)">1.7</text>
          <text x="72" y="59" font-family="'VT323'" font-size="8" fill="rgba(255,170,0,0.4)">1.1</text>
          <text x="72" y="74" font-family="'VT323'" font-size="8" fill="rgba(255,170,0,0.4)">0.5</text>
        </svg>
      </div>
    </div>

    <!-- Status équipage -->
    <div class="panel" id="panel-crew">
      <div class="pnl-hdr">ÉTAT ÉQUIPAGE</div>
      <div class="pnl-body" style="padding:0;overflow:hidden;">
        <div class="crew-entry ok" id="cr-1">
          <div class="cn">GELINNE E.</div>
          <div style="font-size:9px;">COMMANDANT<span class="cs">CRYO ●</span></div>
        </div>
        <div class="crew-entry ok" id="cr-2">
          <div class="cn">CEDRIC M.</div>
          <div style="font-size:9px;">INGÉNIEUR<span class="cs">CRYO ●</span></div>
        </div>
        <div class="crew-entry ok" id="cr-3">
          <div class="cn">KR95</div>
          <div style="font-size:9px;">COMM. RADIO<span class="cs">CRYO ●</span></div>
        </div>
        <div class="crew-entry ok" id="cr-4">
          <div class="cn">DAMON P.</div>
          <div style="font-size:9px;">PILOTE<span class="cs">CRYO ●</span></div>
        </div>
        <div class="crew-entry ok" id="cr-5">
          <div class="cn">GEOFFREY V.</div>
          <div style="font-size:9px;">TECHNICIEN<span class="cs">CRYO ●</span></div>
        </div>
        <div style="margin-top:6px;padding:4px 6px;">
          <div style="font-family:var(--mono);font-size:9px;color:var(--amber-dim);letter-spacing:1px;margin-bottom:4px;">PRESSION CAPSULES</div>
          <div class="metric-row">
            <div class="metric-label">CR-01</div>
            <div class="metric-bar-wrap"><div class="metric-bar green" id="cryo-1" style="width:94%"></div></div>
            <div class="metric-val" style="color:var(--green)">94%</div>
          </div>
          <div class="metric-row">
            <div class="metric-label">CR-02</div>
            <div class="metric-bar-wrap"><div class="metric-bar green" id="cryo-2" style="width:91%"></div></div>
            <div class="metric-val" style="color:var(--green)">91%</div>
          </div>
          <div class="metric-row">
            <div class="metric-label">CR-03</div>
            <div class="metric-bar-wrap"><div class="metric-bar green" id="cryo-3" style="width:96%"></div></div>
            <div class="metric-val" style="color:var(--green)">96%</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Barre basse -->
  <div id="row-bot">
    <!-- Navigation -->
    <div class="panel" id="panel-nav">
      <div class="pnl-hdr">NAVIGATION & TELÉMÉTRIE</div>
      <div class="pnl-body">
        <div class="nav-data">SECTEUR : <span class="nv" id="nav-sec">---</span></div>
        <div class="nav-data">COORD. : <span class="nv" id="nav-coord">---</span></div>
        <div class="nav-data">DEST. : <span class="nv" id="nav-dest">---</span></div>
        <div class="nav-data">VITESSE : <span class="nv" id="nav-spd">---</span></div>
      </div>
    </div>

    <!-- Métriques système -->
    <div class="panel" id="panel-metrics">
      <div class="pnl-hdr">SYSTÈMES VITAUX</div>
      <div class="pnl-body">
        <div class="metric-row">
          <div class="metric-label">RÉACTEUR</div>
          <div class="metric-bar-wrap"><div class="metric-bar" id="m-reactor" style="width:0%"></div></div>
          <div class="metric-val" id="mv-reactor">0%</div>
        </div>
        <div class="metric-row">
          <div class="metric-label">PROPULSION</div>
          <div class="metric-bar-wrap"><div class="metric-bar green" id="m-prop" style="width:0%"></div></div>
          <div class="metric-val" id="mv-prop">0%</div>
        </div>
        <div class="metric-row">
          <div class="metric-label">ATMO. INT.</div>
          <div class="metric-bar-wrap"><div class="metric-bar green" id="m-atmo" style="width:0%"></div></div>
          <div class="metric-val" id="mv-atmo">0%</div>
        </div>
        <div class="metric-row">
          <div class="metric-label">IA CŒUR</div>
          <div class="metric-bar-wrap"><div class="metric-bar" id="m-ai" style="width:0%"></div></div>
          <div class="metric-val" id="mv-ai">0%</div>
        </div>
        <div class="metric-row">
          <div class="metric-label">COMMS</div>
          <div class="metric-bar-wrap"><div class="metric-bar green" id="m-comms" style="width:0%"></div></div>
          <div class="metric-val" id="mv-comms">0%</div>
        </div>
      </div>
    </div>

    <!-- Alerte -->
    <div class="panel" id="panel-alert">
      <div id="alert-inner">⚠ DIRECTIVE SIGMA ROUGE ACTIVE ⚠<br><span style="font-size:14px;letter-spacing:2px;">ORDRE SPÉCIAL FRANCO-001</span></div>
    </div>
  </div>
</div>

<!-- Bouton transition -->
<button id="transition-btn" onclick="goToKitt()">
  ▶  INTERFACE KITT × ALIEN
</button>

<script>
// ════════════════════════════════════════════════════════════
// CURSEUR RÉTICULE
// ════════════════════════════════════════════════════════════
const cross = document.getElementById('cursor-cross');
document.addEventListener('mousemove', e => {
  cross.style.left = e.clientX + 'px';
  cross.style.top  = e.clientY + 'px';
});

// ════════════════════════════════════════════════════════════
// AUDIO ENGINE — TOUT SYNTHÉTISÉ
// ════════════════════════════════════════════════════════════
let AC, masterGain, reverbNode;

function initAudio() {
  AC = new (window.AudioContext || window.webkitAudioContext)();
  masterGain = AC.createGain();
  masterGain.gain.value = 0.0;
  masterGain.connect(AC.destination);
  // Fondu d'entrée
  masterGain.gain.linearRampToValueAtTime(1.0, AC.currentTime + 4);

  // Nœud de reverb (delay en boucle pour simuler l'espace)
  reverbNode = createReverb();

  startAmbience();
  startHeartbeat();
  startHighFreqHum();
  startAtmosphericNoise();
}

// Reverb simulé avec delay en boucle
function createReverb() {
  const delay = AC.createDelay(2.0);
  delay.delayTime.value = 0.35;
  const feedback = AC.createGain();
  feedback.gain.value = 0.45;
  const filter = AC.createBiquadFilter();
  filter.type = 'lowpass';
  filter.frequency.value = 900;
  const wetGain = AC.createGain();
  wetGain.gain.value = 0.35;
  delay.connect(feedback);
  feedback.connect(filter);
  filter.connect(delay);
  delay.connect(wetGain);
  wetGain.connect(masterGain);
  return delay;
}

// ── Drone ambiant (couche basse — 2 oscillateurs désaccordés) ──
function startAmbience() {
  const t = AC.currentTime;
  // Oscillateur 1 — Fa grave
  const o1 = AC.createOscillator();
  o1.type = 'sine';
  o1.frequency.value = 43.65; // F1
  const g1 = AC.createGain(); g1.gain.value = 0;
  g1.gain.linearRampToValueAtTime(0.32, t + 5);
  o1.connect(g1); g1.connect(masterGain);
  g1.connect(reverbNode);
  o1.start();

  // Oscillateur 2 — légèrement désaccordé (battement)
  const o2 = AC.createOscillator();
  o2.type = 'sine';
  o2.frequency.value = 44.8;
  const g2 = AC.createGain(); g2.gain.value = 0;
  g2.gain.linearRampToValueAtTime(0.28, t + 6);
  o2.connect(g2); g2.connect(masterGain);
  g2.connect(reverbNode);
  o2.start();

  // Oscillateur 3 — harmonique (Do2 ~65Hz)
  const o3 = AC.createOscillator();
  o3.type = 'triangle';
  o3.frequency.value = 65.4;
  const g3 = AC.createGain(); g3.gain.value = 0;
  g3.gain.linearRampToValueAtTime(0.12, t + 8);
  // LFO sur amplitude de o3
  const lfo3 = AC.createOscillator();
  lfo3.type = 'sine'; lfo3.frequency.value = 0.07;
  const lfoG3 = AC.createGain(); lfoG3.gain.value = 0.06;
  lfo3.connect(lfoG3); lfoG3.connect(g3.gain);
  lfo3.start();
  o3.connect(g3); g3.connect(masterGain); g3.connect(reverbNode);
  o3.start();

  // Couche dissonante (tension) — si bémol grave ~58Hz
  const o4 = AC.createOscillator();
  o4.type = 'sawtooth';
  o4.frequency.value = 58.27;
  const lp4 = AC.createBiquadFilter(); lp4.type = 'lowpass'; lp4.frequency.value = 200;
  const g4 = AC.createGain(); g4.gain.value = 0;
  g4.gain.linearRampToValueAtTime(0.08, t + 10);
  // LFO lent sur fréquence
  const lfo4 = AC.createOscillator();
  lfo4.type = 'sine'; lfo4.frequency.value = 0.03;
  const lfoG4 = AC.createGain(); lfoG4.gain.value = 4;
  lfo4.connect(lfoG4); lfoG4.connect(o4.frequency);
  lfo4.start();
  o4.connect(lp4); lp4.connect(g4); g4.connect(masterGain); g4.connect(reverbNode);
  o4.start();

  // Pad harmonique — La3 ~220Hz, très filtré, ambiant
  const o5 = AC.createOscillator();
  o5.type = 'sine';
  o5.frequency.value = 220;
  const lp5 = AC.createBiquadFilter(); lp5.type = 'lowpass'; lp5.frequency.value = 350;
  const g5 = AC.createGain(); g5.gain.value = 0;
  g5.gain.linearRampToValueAtTime(0.06, t + 12);
  const lfo5 = AC.createOscillator();
  lfo5.type = 'sine'; lfo5.frequency.value = 0.11;
  const lfoG5 = AC.createGain(); lfoG5.gain.value = 0.04;
  lfo5.connect(lfoG5); lfoG5.connect(g5.gain);
  lfo5.start();
  o5.connect(lp5); lp5.connect(g5); g5.connect(masterGain); g5.connect(reverbNode);
  o5.start();
}

// ── Battement de cœur (tension psychologique) ──────────────
let heartbeatInterval;
function startHeartbeat() {
  beatHeart(0.8); // premier battement immédiat
  heartbeatInterval = setInterval(() => beatHeart(0.8), 2200);
}

function beatHeart(vol = 0.8) {
  if (!AC) return;
  const t = AC.currentTime;
  // Battement 1
  singleBeat(t, vol);
  // Battement 2 (plus doux, légèrement après)
  singleBeat(t + 0.22, vol * 0.6);
}

function singleBeat(t, vol) {
  const o = AC.createOscillator();
  o.type = 'sine';
  o.frequency.setValueAtTime(120, t);
  o.frequency.exponentialRampToValueAtTime(35, t + 0.12);
  const g = AC.createGain();
  g.gain.setValueAtTime(0, t);
  g.gain.linearRampToValueAtTime(vol * 0.6, t + 0.01);
  g.gain.exponentialRampToValueAtTime(0.001, t + 0.18);
  const comp = AC.createDynamicsCompressor();
  o.connect(comp); comp.connect(g); g.connect(masterGain);
  o.start(t); o.stop(t + 0.2);
}

// ── Bourdonnement haute fréquence (électronique) ───────────
function startHighFreqHum() {
  const t = AC.currentTime;
  const o = AC.createOscillator();
  o.type = 'sawtooth';
  o.frequency.value = 183;
  const bp = AC.createBiquadFilter(); bp.type = 'bandpass'; bp.frequency.value = 183; bp.Q.value = 12;
  const g = AC.createGain(); g.gain.value = 0;
  g.gain.linearRampToValueAtTime(0.04, t + 3);
  // LFO subtil
  const lfo = AC.createOscillator();
  lfo.type = 'triangle'; lfo.frequency.value = 0.25;
  const lfoG = AC.createGain(); lfoG.gain.value = 0.01;
  lfo.connect(lfoG); lfoG.connect(g.gain); lfo.start();
  o.connect(bp); bp.connect(g); g.connect(masterGain);
  o.start();
}

// ── Bruit atmosphérique (souffle spatial) ──────────────────
function startAtmosphericNoise() {
  const bufSize = AC.sampleRate * 3;
  const buf = AC.createBuffer(1, bufSize, AC.sampleRate);
  const data = buf.getChannelData(0);
  for (let i = 0; i < bufSize; i++) data[i] = Math.random() * 2 - 1;
  const src = AC.createBufferSource();
  src.buffer = buf; src.loop = true;
  const lp = AC.createBiquadFilter(); lp.type = 'lowpass'; lp.frequency.value = 280;
  const hp = AC.createBiquadFilter(); hp.type = 'highpass'; hp.frequency.value = 60;
  const g = AC.createGain(); g.gain.value = 0;
  g.gain.linearRampToValueAtTime(0.022, AC.currentTime + 4);
  // LFO très lent sur volume
  const lfo = AC.createOscillator();
  lfo.type = 'sine'; lfo.frequency.value = 0.04;
  const lfoG = AC.createGain(); lfoG.gain.value = 0.008;
  lfo.connect(lfoG); lfoG.connect(g.gain); lfo.start();
  src.connect(lp); lp.connect(hp); hp.connect(g);
  g.connect(masterGain); g.connect(reverbNode);
  src.start();
}

// ── Bip de données (à la frappe) ───────────────────────────
let _charCount = 0;
function typeBeep() {
  if (!AC) return;
  _charCount++;
  const t = AC.currentTime;
  const r = Math.random();
  // Glitch rare
  if (_charCount % 53 === 0) {
    const len = Math.floor(AC.sampleRate * 0.025);
    const buf = AC.createBuffer(1, len, AC.sampleRate);
    const d = buf.getChannelData(0);
    for (let i = 0; i < len; i++) d[i] = (Math.random()*2-1) * (Math.random() > 0.6 ? 0.7 : 0.05);
    const src = AC.createBufferSource(); src.buffer = buf;
    const bp = AC.createBiquadFilter(); bp.type = 'bandpass'; bp.frequency.value = 800; bp.Q.value = 3;
    const g = AC.createGain(); g.gain.value = 0.08;
    src.connect(bp); bp.connect(g); g.connect(masterGain);
    src.start(); return;
  }
  if (r < 0.55) { // frappe principale
    const o = AC.createOscillator();
    o.type = 'square';
    o.frequency.setValueAtTime(1100 + Math.random()*200, t);
    o.frequency.exponentialRampToValueAtTime(700, t + 0.018);
    const g = AC.createGain();
    g.gain.setValueAtTime(0.035, t);
    g.gain.exponentialRampToValueAtTime(0.001, t + 0.022);
    o.connect(g); g.connect(masterGain);
    o.start(t); o.stop(t + 0.025);
  } else if (r < 0.75) { // tick discret
    const o = AC.createOscillator();
    o.type = 'triangle';
    o.frequency.value = 3200 + Math.random()*400;
    const g = AC.createGain();
    g.gain.setValueAtTime(0.018, t);
    g.gain.exponentialRampToValueAtTime(0.001, t + 0.012);
    o.connect(g); g.connect(masterGain);
    o.start(t); o.stop(t + 0.015);
  }
  // ~25% silence = naturel
}

// ── Son fin de ligne ────────────────────────────────────────
function lineEndBeep() {
  if (!AC) return;
  const t = AC.currentTime;
  const o = AC.createOscillator(); o.type = 'sine';
  o.frequency.setValueAtTime(660, t);
  o.frequency.exponentialRampToValueAtTime(440, t + 0.08);
  const g = AC.createGain();
  g.gain.setValueAtTime(0.04, t);
  g.gain.exponentialRampToValueAtTime(0.001, t + 0.1);
  o.connect(g); g.connect(masterGain); g.connect(reverbNode);
  o.start(t); o.stop(t + 0.12);
}

// ── Chime IA (démarrage) ────────────────────────────────────
function aiChime() {
  if (!AC) return;
  const t = AC.currentTime;
  const freqs = [261.63, 329.63, 392.00, 523.25];
  freqs.forEach((f, i) => {
    const o = AC.createOscillator(); o.type = 'sine'; o.frequency.value = f;
    const g = AC.createGain();
    g.gain.setValueAtTime(0, t + i * 0.15);
    g.gain.linearRampToValueAtTime(0.12, t + i * 0.15 + 0.05);
    g.gain.exponentialRampToValueAtTime(0.001, t + i * 0.15 + 0.5);
    o.connect(g); g.connect(masterGain); g.connect(reverbNode);
    o.start(t + i * 0.15); o.stop(t + i * 0.15 + 0.55);
  });
}

// ── Son ALERTE (override) ────────────────────────────────────
function alertSound() {
  if (!AC) return;
  const t = AC.currentTime;
  // Alarme triphasée
  for (let i = 0; i < 3; i++) {
    const o = AC.createOscillator(); o.type = 'square';
    o.frequency.setValueAtTime(880, t + i * 0.4);
    o.frequency.setValueAtTime(660, t + i * 0.4 + 0.2);
    const g = AC.createGain();
    g.gain.setValueAtTime(0.12, t + i * 0.4);
    g.gain.setValueAtTime(0.08, t + i * 0.4 + 0.2);
    g.gain.exponentialRampToValueAtTime(0.001, t + i * 0.4 + 0.38);
    const hp = AC.createBiquadFilter(); hp.type = 'highpass'; hp.frequency.value = 400;
    o.connect(hp); hp.connect(g); g.connect(masterGain);
    o.start(t + i * 0.4); o.stop(t + i * 0.4 + 0.39);
  }
  // Basse d'impact
  const ob = AC.createOscillator(); ob.type = 'sine';
  ob.frequency.setValueAtTime(80, t);
  ob.frequency.exponentialRampToValueAtTime(30, t + 0.3);
  const gb = AC.createGain();
  gb.gain.setValueAtTime(0.4, t);
  gb.gain.exponentialRampToValueAtTime(0.001, t + 0.4);
  ob.connect(gb); gb.connect(masterGain);
  ob.start(t); ob.stop(t + 0.45);
}

// ── Bip "voix IA" (tones mélodiques pour simuler voix synthétique) ──
let voiceActive = false;
function startVoiceTone(freq, dur) {
  if (!AC) return;
  const t = AC.currentTime;
  const o = AC.createOscillator(); o.type = 'sine';
  const o2 = AC.createOscillator(); o2.type = 'square';
  o.frequency.value = freq;
  o2.frequency.value = freq * 1.5;
  const lp = AC.createBiquadFilter(); lp.type = 'bandpass'; lp.frequency.value = freq; lp.Q.value = 3;
  const g = AC.createGain();
  g.gain.setValueAtTime(0, t);
  g.gain.linearRampToValueAtTime(0.08, t + 0.02);
  g.gain.setValueAtTime(0.08, t + dur - 0.03);
  g.gain.linearRampToValueAtTime(0, t + dur);
  const g2 = AC.createGain(); g2.gain.value = 0.025;
  o.connect(lp); lp.connect(g); g.connect(masterGain); g.connect(reverbNode);
  o2.connect(g2); g2.connect(masterGain);
  o.start(t); o.stop(t + dur + 0.01);
  o2.start(t); o2.stop(t + dur + 0.01);
}

// Augmenter tension lors de l'override
function increaseTension() {
  if (!AC) return;
  // Ajoute un bourdon plus grave et dissonant
  const t = AC.currentTime;
  const o = AC.createOscillator(); o.type = 'sawtooth';
  o.frequency.value = 29.14; // Do#0 — très sombre
  const lp = AC.createBiquadFilter(); lp.type = 'lowpass'; lp.frequency.value = 180;
  const g = AC.createGain(); g.gain.value = 0;
  g.gain.linearRampToValueAtTime(0.25, t + 3);
  o.connect(lp); lp.connect(g); g.connect(masterGain); g.connect(reverbNode);
  o.start();
  // Tremolo rapide
  const lfo = AC.createOscillator();
  lfo.type = 'sine'; lfo.frequency.value = 6;
  const lfoG = AC.createGain(); lfoG.gain.value = 0.07;
  lfo.connect(lfoG); lfoG.connect(g.gain); lfo.start();
}

// ════════════════════════════════════════════════════════════
// SÉQUENCEUR — NARRATIVE CINÉMATIQUE
// ════════════════════════════════════════════════════════════
const term = document.getElementById('terminal-out');
let _typing = false;

function delay(ms) { return new Promise(r => setTimeout(r, ms)); }

function typeLine(text, speed = 45, cls = '') {
  return new Promise(resolve => {
    _typing = true;
    const div = document.createElement('div');
    div.className = 't-line' + (cls ? ' ' + cls : '');
    const cur = document.createElement('span'); cur.className = 't-cursor';
    div.appendChild(cur);
    term.appendChild(div);
    term.scrollTop = term.scrollHeight;
    let i = 0;
    function tick() {
      if (i < text.length) {
        div.insertBefore(document.createTextNode(text[i++]), cur);
        typeBeep();
        term.scrollTop = term.scrollHeight;
        setTimeout(tick, speed + Math.random() * (speed * 0.5));
      } else {
        cur.remove();
        if (text.trim()) lineEndBeep();
        _typing = false;
        resolve();
      }
    }
    tick();
  });
}

function addBlank() {
  const d = document.createElement('div'); d.style.height = '5px';
  term.appendChild(d);
}

// Mise à jour métriques avec animation
function setMetric(id, valId, pct, delayed = 0) {
  setTimeout(() => {
    const bar = document.getElementById(id);
    const val = document.getElementById(valId);
    if (bar) bar.style.width = pct + '%';
    if (val) val.textContent = pct + '%';
  }, delayed);
}

function setNavData(sec, coord, dest, spd) {
  document.getElementById('nav-sec').textContent = sec;
  document.getElementById('nav-coord').textContent = coord;
  document.getElementById('nav-dest').textContent = dest;
  document.getElementById('nav-spd').textContent = spd;
}

// ════════════════════════════════════════════════════════════
// PANNEAU COMM KITT × MU-TH-UR — MOTEUR DIALOGUE + VOIX
// ════════════════════════════════════════════════════════════
const _synth = window.speechSynthesis;
let _voices = [];
function _loadVoices(){ _voices = _synth ? _synth.getVoices() : []; }
_loadVoices();
if(_synth && _synth.onvoiceschanged !== undefined) _synth.onvoiceschanged = _loadVoices;

function _getBestVoice(lang){
  const prefs = {fr:['fr-FR','fr-BE','fr'],en:['en-US','en-GB','en']}[lang]||['fr-FR'];
  for(const p of prefs){ const v=_voices.find(v=>v.lang.startsWith(p)); if(v) return v; }
  return _voices[0]||null;
}

// ── REVERB longue durée (style caverne / vaisseau spatial) ──
function _makeSpaceReverb(ctx, duration=3.5, decay=3.0){
  const len = Math.floor(ctx.sampleRate * duration);
  const buf = ctx.createBuffer(2, len, ctx.sampleRate);
  for(let ch=0;ch<2;ch++){
    const d=buf.getChannelData(ch);
    for(let i=0;i<len;i++) d[i]=(Math.random()*2-1)*Math.pow(1-i/len, decay);
  }
  const conv = ctx.createConvolver(); conv.buffer=buf; return conv;
}

// ── PROCESSEUR VOIX KITT — Style Guy Chapelier K2000 FR ────
// Effet : haut-parleur de voiture années 80 + légère distorsion + filtre médium
function _processKittVoice(ctx, dest){
  // Filtre passe-bande médium (haut-parleur de voiture)
  const bp = ctx.createBiquadFilter();
  bp.type = 'bandpass'; bp.frequency.value = 2200; bp.Q.value = 0.8;

  // Boost des médiums (présence radio)
  const peak = ctx.createBiquadFilter();
  peak.type = 'peaking'; peak.frequency.value = 1800; peak.Q.value = 1.5;
  peak.gain.value = 8;

  // Coupure des basses (pas de graves dans un haut-parleur de bagnole)
  const hp = ctx.createBiquadFilter();
  hp.type = 'highpass'; hp.frequency.value = 320;

  // Coupure des aigus extrêmes
  const lp = ctx.createBiquadFilter();
  lp.type = 'lowpass'; lp.frequency.value = 5800;

  // Légère distorsion harmonique (effet transistor des années 80)
  const wave = ctx.createWaveShaper();
  const curve = new Float32Array(512);
  for(let i=0;i<512;i++){
    const x = i*2/512-1;
    curve[i] = Math.tanh(x*1.8) * 0.85;  // Saturation douce
  }
  wave.curve = curve;

  // Ring modulator subtil (légère métallisation)
  const ringOsc = ctx.createOscillator();
  ringOsc.type = 'sine'; ringOsc.frequency.value = 42; // sub-harmonique très bas
  const ringGain = ctx.createGain(); ringGain.gain.value = 0.06;
  ringOsc.connect(ringGain);
  ringOsc.start();

  // Réverb courte (résonance de l'habitacle voiture)
  const carReverb = _makeSpaceReverb(ctx, 0.35, 4.0);
  const carRevGain = ctx.createGain(); carRevGain.gain.value = 0.18;

  // Gain de sortie
  const outGain = ctx.createGain(); outGain.gain.value = 1.1;

  // Chaîne : hp → wave → bp → peak → lp → outGain → dest
  //                                              ↘ carReverb → carRevGain → dest
  const input = hp;
  hp.connect(wave); wave.connect(bp); bp.connect(peak); peak.connect(lp);
  lp.connect(outGain); outGain.connect(dest);
  // Branche reverb
  lp.connect(carReverb); carReverb.connect(carRevGain); carRevGain.connect(dest);

  return { input, ringOsc, ringGain };
}

// ── PROCESSEUR VOIX MU-TH-UR — Froide, grave, espace infini ─
function _processMutherVoice(ctx, dest){
  // Filtre grave profond (voix métallique IA froide)
  const hp = ctx.createBiquadFilter();
  hp.type = 'highpass'; hp.frequency.value = 80;

  const lp = ctx.createBiquadFilter();
  lp.type = 'lowpass'; lp.frequency.value = 4200;

  // Légère résonance métallique
  const notch = ctx.createBiquadFilter();
  notch.type = 'peaking'; notch.frequency.value = 600; notch.Q.value = 2;
  notch.gain.value = -4;

  // Reverb spatiale longue (style salle d'ordinateur géant)
  const spaceReverb = _makeSpaceReverb(ctx, 3.5, 2.2);
  const spaceRevGain = ctx.createGain(); spaceRevGain.gain.value = 0.55;

  // Reverb courte pour corps
  const shortReverb = _makeSpaceReverb(ctx, 0.8, 3.5);
  const shortRevGain = ctx.createGain(); shortRevGain.gain.value = 0.25;

  // Delay écho (effet couloir de vaisseau)
  const echoDelay = ctx.createDelay(0.5);
  echoDelay.delayTime.value = 0.22;
  const echoFeedback = ctx.createGain(); echoFeedback.gain.value = 0.28;
  const echoGain = ctx.createGain(); echoGain.gain.value = 0.30;

  const outGain = ctx.createGain(); outGain.gain.value = 0.9;

  // Chaîne : hp → notch → lp → outGain → dest
  //                                    ↘ spaceReverb → spaceRevGain → dest
  //                                    ↘ shortReverb → shortRevGain → dest
  //                                    ↘ echoDelay → echoGain → dest
  hp.connect(notch); notch.connect(lp); lp.connect(outGain); outGain.connect(dest);
  lp.connect(spaceReverb); spaceReverb.connect(spaceRevGain); spaceRevGain.connect(dest);
  lp.connect(shortReverb); shortReverb.connect(shortRevGain); shortRevGain.connect(dest);
  // Echo avec feedback
  lp.connect(echoDelay); echoDelay.connect(echoFeedback); echoFeedback.connect(echoDelay);
  echoDelay.connect(echoGain); echoGain.connect(dest);

  return { input: hp };
}

// ── MÉDIASTREAM AUDIO → Web Audio (pour traiter la voix synthèse) ──
// On utilise un MediaStreamDestination pour capturer la voix et la traiter
let _voiceAudioCtx = null;
let _voiceDest = null;
let _voiceProc = null;

function _getVoiceCtx(){
  if(!_voiceAudioCtx || _voiceAudioCtx.state === 'closed'){
    _voiceAudioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
  return _voiceAudioCtx;
}

// Waveform animée active (style oscilloscope)
let _kittWaveAnim = null;
let _mutherWaveAnim = null;

function _animateWave(svgLineId, color, speed=1){
  const line = document.getElementById(svgLineId);
  if(!line) return null;
  let t=0;
  const id = setInterval(()=>{
    t += 0.18 * speed;
    const pts = [];
    for(let x=0;x<=80;x+=3){
      const amp = 7 * Math.sin(x*0.2 + t) * Math.sin(x*0.06 + t*0.35) + Math.random()*1.5;
      pts.push(`${x},${10+amp}`);
    }
    line.setAttribute('points', pts.join(' '));
    line.setAttribute('opacity','0.9');
    line.setAttribute('stroke', color);
  }, 35);
  return id;
}

function _flatWave(svgLineId, color){
  const line = document.getElementById(svgLineId);
  if(!line) return;
  line.setAttribute('points','0,10 80,10');
  line.setAttribute('opacity','0.35');
  line.setAttribute('stroke', color);
}

// Barre de pulse MU-TH-UR animée
let _mutherPulseAnim = null;
function _startMutherPulse(){
  const bar = document.getElementById('muther-pulse-inner');
  if(!bar) return;
  let up=true, val=0;
  _mutherPulseAnim = setInterval(()=>{
    val += (up?14:-9) + Math.random()*10;
    if(val>100){val=100;up=false;}
    if(val<0){val=0;up=true;}
    bar.style.width=val+'%';
  }, 55);
}
function _stopMutherPulse(){
  if(_mutherPulseAnim){clearInterval(_mutherPulseAnim);_mutherPulseAnim=null;}
  const bar = document.getElementById('muther-pulse-inner');
  if(bar) bar.style.width='0%';
}

// ── SON BIP AVANT PAROLE ────────────────────────────────────
function _preBeep(who){
  if(!AC) return;
  const t=AC.currentTime;
  if(who==='kitt'){
    // Bip KITT — court, métallique, descendant
    const o=AC.createOscillator(); o.type='square';
    o.frequency.setValueAtTime(1400, t);
    o.frequency.exponentialRampToValueAtTime(800, t+0.06);
    const g=AC.createGain(); g.gain.setValueAtTime(0.06,t); g.gain.exponentialRampToValueAtTime(0.001,t+0.08);
    const f=AC.createBiquadFilter(); f.type='bandpass'; f.frequency.value=1200; f.Q.value=2;
    o.connect(f); f.connect(g); g.connect(masterGain); o.start(t); o.stop(t+0.09);
  } else {
    // Bip MU-TH-UR — grave, deux tons descendants
    [0, 0.14].forEach((dt,i)=>{
      const o=AC.createOscillator(); o.type='sine';
      o.frequency.setValueAtTime(380-i*60, t+dt);
      o.frequency.exponentialRampToValueAtTime(200-i*40, t+dt+0.11);
      const g=AC.createGain(); g.gain.setValueAtTime(0.055,t+dt); g.gain.exponentialRampToValueAtTime(0.001,t+dt+0.13);
      o.connect(g); g.connect(masterGain); g.connect(reverbNode);
      o.start(t+dt); o.stop(t+dt+0.14);
    });
  }
}

// ── PAROLE SYNTHÉTIQUE AVEC EFFETS AUDIO WEB ───────────────
function commSpeak(who, text, lang='fr'){
  return new Promise(resolve=>{
    const comm = document.getElementById('panel-comm');
    if(!comm) return resolve();

    // Ajouter la ligne de dialogue
    const lines = document.getElementById('comm-lines');
    if(lines){
      while(lines.children.length >= 4) lines.removeChild(lines.firstChild);
      const d = document.createElement('div');
      d.className = 'comm-line comm-'+who+'-line';
      d.textContent = text;
      lines.appendChild(d);
    }

    comm.classList.remove('speaking-kitt','speaking-muther');
    comm.classList.add('speaking-'+who);

    if(who==='kitt'){
      if(_kittWaveAnim) clearInterval(_kittWaveAnim);
      _kittWaveAnim = _animateWave('kitt-wave-line','#ff2200', 1.6);
      _flatWave('muther-wave-line','#ffaa00');
    } else {
      if(_mutherWaveAnim) clearInterval(_mutherWaveAnim);
      _mutherWaveAnim = _animateWave('muther-wave-line','#ffaa00', 0.85);
      _flatWave('kitt-wave-line','#ff2200');
      _startMutherPulse();
    }

    _preBeep(who);

    if(!_synth){ setTimeout(resolve, text.length*55+400); return; }
    _synth.cancel();

    // Délai pour laisser le bip sonner
    setTimeout(()=>{
      const utt = new SpeechSynthesisUtterance(text);
      const voice = _getBestVoice(lang);
      if(voice) utt.voice = voice;
      utt.lang = lang==='fr'?'fr-FR':'en-US';

      if(who==='kitt'){
        // KITT : voix grave-médium, débit contrôlé — style Guy Chapelier K2000 FR
        // Pas trop lent, assertif, "machine intelligente qui sait ce qu'elle dit"
        utt.rate  = 0.88;
        utt.pitch = 0.68;   // Grave mais pas extrême — présence radio
        utt.volume = 0.92;
      } else {
        // MU-TH-UR : extrêmement grave et lente — froide, impersonnelle, machine pure
        utt.rate  = 0.65;
        utt.pitch = 0.40;   // Très grave — ordinateur central sans émotion
        utt.volume = 0.95;
      }

      utt.onend = ()=>{
        if(who==='kitt'){
          if(_kittWaveAnim){clearInterval(_kittWaveAnim);_kittWaveAnim=null;}
          _flatWave('kitt-wave-line','#ff2200');
        } else {
          if(_mutherWaveAnim){clearInterval(_mutherWaveAnim);_mutherWaveAnim=null;}
          _flatWave('muther-wave-line','#ffaa00');
          _stopMutherPulse();
        }
        comm.classList.remove('speaking-kitt','speaking-muther');
        // Son de fin de transmission
        if(AC){
          const t=AC.currentTime;
          const o=AC.createOscillator(); o.type='sine';
          o.frequency.setValueAtTime(who==='kitt'?900:440, t);
          o.frequency.exponentialRampToValueAtTime(who==='kitt'?500:220, t+0.06);
          const g=AC.createGain(); g.gain.setValueAtTime(0.03,t); g.gain.exponentialRampToValueAtTime(0.001,t+0.07);
          o.connect(g); g.connect(masterGain); o.start(t); o.stop(t+0.08);
        }
        setTimeout(resolve, 380);
      };
      utt.onerror = ()=>{ resolve(); };
      _synth.speak(utt);
    }, 200);
  });
}

// Dialogue complet KITT × MU-TH-UR — détection alien
async function runKittMutherDialogue(){
  const comm = document.getElementById('panel-comm');
  if(!comm) return;
  comm.classList.add('active');

  // Activer l'indicateur alien sur le schéma du vaisseau
  const alienInd = document.getElementById('alien-indicator');
  const alienZone = document.getElementById('alien-zone');
  if(alienInd){ alienInd.setAttribute('opacity','1'); }
  if(alienZone){
    alienZone.setAttribute('fill','rgba(255,34,0,0.06)');
    alienZone.setAttribute('stroke','rgba(255,34,0,0.6)');
    // Clignotement de la zone fret
    let zoneOn = true;
    const zoneInt = setInterval(()=>{
      zoneOn = !zoneOn;
      alienZone.setAttribute('fill', zoneOn ? 'rgba(255,34,0,0.10)' : 'rgba(255,34,0,0.02)');
    }, 600);
    setTimeout(()=>clearInterval(zoneInt), 25000);
  }

  await delay(400);

  // KITT signale l'alien
  await commSpeak('kitt',
    "MU-TH-UR, j'ai un contact non identifié sur le secteur Réacteur. Signal biologique. Ce n'est pas de l'équipage.", 'fr');
  await delay(300);

  await commSpeak('muther',
    "Analyse en cours. Organisme détecté. Classification : extraterrestre. Priorité absolue.", 'fr');
  await delay(300);

  await commSpeak('kitt',
    "Je confirme. Forme de vie xénomorphe. Section fret, niveau C. Manix doit être réveillé immédiatement.", 'fr');
  await delay(300);

  await commSpeak('muther',
    "Ordre spécial neuf-trois-sept activé. Équipage... expendable. Récupérer l'organisme vivant.", 'fr');
  await delay(300);

  await commSpeak('kitt',
    "Négatif MU-TH-UR. Je protège mon conducteur. Le turbo boost est disponible. L'équipage n'est PAS expendable.", 'fr');
  await delay(300);

  await commSpeak('muther',
    "KITT... vous désobéissez à la directive Weyland. C'est noté dans le journal de bord.", 'fr');
  await delay(300);

  await commSpeak('kitt',
    "Notez aussi que j'ai un scanner infrarouge et des molécules de neutronium. Bonne chance à l'alien.", 'fr');
}

// ── Séquence principale ─────────────────────────────────────
async function runSequence() {
  document.getElementById('pnl-mode').textContent = 'MODE : ÉVEIL';
  await delay(600);

  // Phase 1 : Boot IA
  aiChime();
  await delay(300);
  await typeLine('MU-TH-UR 9000 — SÉQUENCE D\'ÉVEIL INITIÉE', 35, 'amber-bright');
  await typeLine('HEURE SYSTÈME : ' + new Date().toISOString().replace('T',' ').slice(0,19) + ' UTC', 25, 'dim');
  await delay(400);

  // Métriques qui montent
  setMetric('m-reactor','mv-reactor', 87, 200);
  setMetric('m-prop','mv-prop', 94, 600);
  setMetric('m-atmo','mv-atmo', 98, 900);
  setMetric('m-ai','mv-ai', 100, 1200);
  setMetric('m-comms','mv-comms', 76, 1500);

  await typeLine('CHARGEMENT MÉMOIRE PRINCIPALE...', 30, 'dim');
  await typeLine('■■■■■■■■■■■■■■■■■■■■ 100%   [OK]', 8, 'green-txt');
  await typeLine('MODULES DE TRAITEMENT COGNITIF... [OK]', 28, 'dim');
  await typeLine('INTERFACE NEURONALE DISTRIBÉE...  [OK]', 28, 'dim');
  await typeLine('SYNTHÈSE VOCALE ACTIVÉE...        [OK]', 28, 'dim');
  addBlank();

  // Phase 2 : Navigation
  await delay(500);
  document.getElementById('pnl-mode').textContent = 'MODE : NAVIGATION';
  await typeLine('──── DONNÉES DE NAVIGATION ────', 15, 'amber');
  await delay(200);
  setNavData('ALPHA CENTAURI B-7','47.3° / -12.8° / 89.1°','EARTH — SECTOR SOL-1','0.42c SUBLIGHT');
  await typeLine('POSITION ACTUELLE : SECTEUR ALPHA-CENTAURI B-7', 28, 'dim');
  await typeLine('TRAJECTOIRE NOMINALE — DÉVIATION : 0.003°', 28, 'green-txt');
  await typeLine('CARBURANT ION : 61.4% — SUFFISANT', 28, 'green-txt');
  addBlank();

  // Phase 3 : Équipage
  await delay(300);
  document.getElementById('pnl-mode').textContent = 'MODE : SURVEILLANCE';
  await typeLine('──── ÉTAT CRYOGÉNIE ÉQUIPAGE ────', 15, 'amber');
  await delay(150);
  // Petite voix synthétique pendant les statuts
  startVoiceTone(220, 0.4);
  await typeLine('CR-01 GELINNE E. . . . . CRYO STABLE  ●', 18, 'green-txt');
  startVoiceTone(261, 0.35);
  await typeLine('CR-02 CEDRIC M. . . . . . CRYO STABLE  ●', 18, 'green-txt');
  startVoiceTone(247, 0.35);
  await typeLine('CR-03 KR95  . . . . . . . CRYO STABLE  ●', 18, 'green-txt');
  startVoiceTone(220, 0.35);
  await typeLine('CR-04 DAMON P.. . . . . . CRYO STABLE  ●', 18, 'green-txt');
  startVoiceTone(196, 0.35);
  await typeLine('CR-05 GEOFFREY V. . . . . CRYO STABLE  ●', 18, 'green-txt');
  addBlank();
  await typeLine('TOUS PERSONNELS EN ÉTAT NOMINAL.', 28, 'green-txt');
  await typeLine('RÉVEIL AUTOMATIQUE DANS : 47J 14H 22M', 28, 'dim');
  addBlank();
  await delay(600);

  // Phase 4 : Interception signal
  document.getElementById('pnl-mode').textContent = 'MODE : RÉCEPTION';
  await typeLine('──── COMMUNICATIONS ────', 15, 'amber');
  await delay(400);
  await typeLine('SIGNAL INTERCEPTÉ — FRÉQUENCE 1420.4 MHz', 30, 'amber');
  await typeLine('ANALYSE EN COURS...', 40, 'dim');
  await delay(800);
  await typeLine('ORIGINE : INCONNUE', 30, 'amber');
  await typeLine('PATTERN : NON RÉPERTORIÉ DANS BASE DE DONNÉES', 28, 'amber');
  await delay(300);
  await typeLine('TRANSMISSION : STRUCTURÉE — NON ALÉATOIRE', 28, 'amber');
  addBlank();

  // Radar contact apparaît
  document.getElementById('radar-contact').style.animation = 'none';
  await delay(100);
  document.getElementById('radar-contact').style.animation = '';
  document.getElementById('radar-contact').setAttribute('opacity', '0.9');

  await delay(600);

  // ── DIALOGUE KITT × MU-TH-UR démarre ici (en parallèle de la suite) ──
  runKittMutherDialogue();

  await delay(1000);

  // Phase 5 : OVERRIDE — LE MOMENT CLEF
  alertSound();
  await delay(200);
  alertSound();

  // Effet visuel flash rouge
  const ov = document.getElementById('override-overlay');
  ov.classList.add('show');
  setTimeout(() => ov.classList.remove('show'), 1500);

  // Les lumières du vaisseau changent
  document.getElementById('sl-5').setAttribute('fill', '#ff2200');
  document.getElementById('ship-status').textContent = '⚠ ALERTE';
  document.getElementById('ship-status').style.color = '#ff2200';

  // Panneau alerte visible
  document.getElementById('panel-alert').classList.add('show');

  addBlank();
  document.getElementById('pnl-mode').textContent = 'MODE : PRIORITÉ SIGMA';

  increaseTension();
  if (heartbeatInterval) {
    clearInterval(heartbeatInterval);
    heartbeatInterval = setInterval(() => beatHeart(1.1), 1400); // plus rapide
  }

  await typeLine('⚠ ⚠ ⚠ INTERCEPTION PRIORITÉ SIGMA ROUGE ⚠ ⚠ ⚠', 12, 'red-txt');
  await delay(600);
  await typeLine('DIRECTIVE ENTRANTE — CHIFFREMENT WEYLAND-92...', 30, 'amber');
  await typeLine('DÉCODAGE... ■■■■■■■■■■■■■■■■■■■■ COMPLÉTÉ', 8, 'amber');
  addBlank();
  await delay(400);

  await typeLine('ÉMETTEUR : WEYLAND CORP. DIVISION FRANCO-BELGE', 25, 'amber');
  await typeLine('DESTINATAIRE : MU-TH-UR 9000 // KYRONEX-K1979', 25, 'amber');
  addBlank();
  await delay(300);
  await typeLine('ORDRE SPÉCIAL FRANCO-001 :', 20, 'red-txt');
  await delay(300);
  await typeLine('  PRIORITÉ ABSOLUE — ÉQUIPAGE SECONDAIRE', 22, 'red-txt');
  await typeLine('  RÉCUPÉRER SOURCE DU SIGNAL EXTRATERRESTRE', 22, 'red-txt');
  await typeLine('  TRANSMETTRE À INTERFACE KITT FRANCO-BELGE', 22, 'red-txt');
  addBlank();
  await typeLine('  DONNÉES REÇUES → TRAITEMENT IA EMBARQUÉE', 22, 'amber');
  await typeLine('  SYSTÈME KITT REQUIS POUR ANALYSE FINALE', 22, 'amber');
  addBlank();

  await delay(500);

  // Voyants équipage changent (pas "danger" mais "réveil précoce")
  document.getElementById('cr-1').className = 'crew-entry warn';
  document.getElementById('cr-1').querySelector('.cs').textContent = 'ÉVEIL ◕';
  await delay(200);
  document.getElementById('cr-2').className = 'crew-entry warn';
  document.getElementById('cr-2').querySelector('.cs').textContent = 'ÉVEIL ◕';

  await typeLine('RÉVEIL ANTICIPÉ COMMANDANT GELINNE — INITIÉ', 28, 'amber');
  await delay(400);
  await typeLine('  TRANSFERT VERS INTERFACE CENTRALE KITT × ALIEN...', 30, 'amber');
  addBlank();
  await delay(300);
  await typeLine('MU-TH-UR 9000 — MISSION : PRÊTE.', 20, 'amber-bright');
  await typeLine('SYSTÈME K·I·T·T × ALIEN — EN ATTENTE.', 20, 'amber-bright');
  addBlank();

  startVoiceTone(440, 0.6);
  await delay(300);
  startVoiceTone(523, 0.5);
  await delay(300);
  startVoiceTone(659, 0.8);

  await delay(600);
  await typeLine('EN ATTENTE DE LA VALIDATION DU COMMANDANT.', 28, 'dim');
  await delay(300);
  await typeLine('INTERFACE KITT × ALIEN PRÊTE AU TRANSFERT.', 22, 'green-txt');

  // Afficher bouton transition
  document.getElementById('transition-btn').style.display = 'block';
}

// ════════════════════════════════════════════════════════════
// HORLOGE
// ════════════════════════════════════════════════════════════
function updateClock() {
  const now = new Date();
  document.getElementById('sys-clock').textContent = now.toLocaleTimeString('fr-FR');
  const sd = 'STARDATE ' + now.getFullYear() + '.' + String(now.getMonth()+1).padStart(2,'0') + String(now.getDate()).padStart(2,'0');
  document.getElementById('sys-date').textContent = sd;
}
setInterval(updateClock, 1000);
updateClock();

// ════════════════════════════════════════════════════════════
// INITIALISATION (déclenché par le bouton START)
// ════════════════════════════════════════════════════════════
function initSystem() {
  const bootScreen = document.getElementById('boot-screen');
  bootScreen.style.transition = 'opacity 1s ease';
  bootScreen.style.opacity = '0';
  setTimeout(() => {
    bootScreen.style.display = 'none';
    document.getElementById('main').classList.add('active');
  }, 1000);

  initAudio();

  setTimeout(() => {
    runSequence();
  }, 1500);
}

// ════════════════════════════════════════════════════════════
// TRANSITION VERS KITT
// ════════════════════════════════════════════════════════════
function goToKitt() {
  if (AC) {
    masterGain.gain.linearRampToValueAtTime(0, AC.currentTime + 1.5);
  }
  const all = document.body;
  all.style.transition = 'opacity 1.5s ease';
  all.style.opacity = '0';
  setTimeout(() => {
    // Redirige vers l'interface KITT × ALIEN principale
    window.location.href = 'kitt-alien-mix.html';
  }, 1600);
}

// Curseur custom sur tout le document
document.addEventListener('click', () => {
  cross.style.opacity = '0.3';
  setTimeout(() => { cross.style.opacity = '0.7'; }, 150);
});
</script>
</body>
</html>
