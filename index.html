<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KITT FRANCO-BELGE // SYSTÈME CENTRAL</title>
<meta name="description" content="Interface KITT Franco-Belge — IA embarquée sur NVIDIA Jetson. Projet fan non commercial par Manix."/>
<meta name="theme-color" content="#000000"/>
<style>
:root{
  --green:#00ff66;
  --green-dim:#00aa44;
  --red:#ff1a1a;
  --amber:#ffaa00;
  --cyan:#00ccff;
  --bg:#000;
}
*{box-sizing:border-box;}
html,body{margin:0;height:100%;background:var(--bg);color:var(--green);font-family:"Courier New",monospace;overflow:hidden;}

/* CRT scanlines */
body::before{content:"";position:fixed;top:0;left:0;right:0;bottom:0;background:repeating-linear-gradient(0deg,rgba(0,0,0,.18),rgba(0,0,0,.18) 1px,transparent 1px,transparent 3px);pointer-events:none;z-index:9998;}
body::after{content:"";position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,255,80,.015);pointer-events:none;z-index:9999;animation:flicker .12s infinite;}
@keyframes flicker{0%{opacity:.88}48%{opacity:1}52%{opacity:.92}100%{opacity:.96}}

/* ── LANGUAGE SELECTION OVERLAY ─────────────────────────── */
#lang-screen{
  position:fixed;top:0;left:0;right:0;bottom:0;
  background:#000;z-index:8000;
  display:flex;align-items:center;justify-content:center;
  padding:16px;
}
#lang-box{
  width:100%;max-width:440px;
  border:1px solid var(--green);
  box-shadow:0 0 40px rgba(0,255,100,.12),inset 0 0 30px rgba(0,255,100,.02);
  font-size:13px;
}
#lang-hdr{
  border-bottom:1px solid var(--green-dim);
  padding:10px 18px;
  color:var(--green);
  letter-spacing:3px;
  font-size:12px;
  text-align:center;
  text-shadow:0 0 10px var(--green);
}
#lang-sub{
  padding:10px 18px 4px;
  color:var(--amber);
  letter-spacing:2px;
  font-size:11px;
  border-bottom:1px solid #111;
}
#lang-output{padding:4px 0;}
.lang-opt{
  display:flex;
  align-items:center;
  gap:14px;
  padding:7px 22px;
  cursor:pointer;
  transition:background .12s;
  border-left:2px solid transparent;
}
.lang-opt:hover{
  background:rgba(0,255,100,.07);
  border-left-color:var(--green);
}
.lang-opt.active{
  background:rgba(0,255,100,.15);
  border-left-color:var(--green);
  color:#000;
}
.lo-n{
  color:var(--red);
  font-size:11px;
  min-width:28px;
  text-align:center;
  border:1px solid var(--red);
  padding:1px 4px;
  letter-spacing:1px;
  flex-shrink:0;
}
.lo-l{color:var(--green);letter-spacing:2px;font-size:13px;}
#lang-ftr{
  border-top:1px solid var(--green-dim);
  padding:8px 18px;
  color:var(--green-dim);
  font-size:10px;
  letter-spacing:2px;
  text-align:center;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:6px;
}

/* ── SCANNER KITT ───────────────────────────────────────── */
#sw{position:fixed;top:0;left:0;right:0;height:3px;overflow:hidden;z-index:1000;}
#sb{position:absolute;top:0;width:200px;height:3px;background:linear-gradient(90deg,transparent,var(--red),var(--red),transparent);box-shadow:0 0 14px 4px var(--red);animation:ks 1.8s ease-in-out infinite alternate;}
#swb{position:fixed;bottom:0;left:0;right:0;height:3px;overflow:hidden;z-index:1000;}
#sbb{position:absolute;top:0;width:200px;height:3px;background:linear-gradient(90deg,transparent,var(--red),var(--red),transparent);box-shadow:0 0 14px 4px var(--red);animation:ks 1.8s ease-in-out infinite alternate-reverse;}
@keyframes ks{0%{left:-200px}100%{left:100%}}

/* ── LAYOUT ─────────────────────────────────────────────── */
.container{display:flex;flex-direction:column;height:100%;padding:16px 20px 20px;gap:0;}

/* ── HEADER ─────────────────────────────────────────────── */
header{flex-shrink:0;display:flex;align-items:center;justify-content:space-between;padding:10px 0 8px;border-bottom:1px solid var(--red);} 
.hdr-title{color:var(--red);font-size:18px;letter-spacing:4px;text-shadow:0 0 16px var(--red);animation:pred 3s ease-in-out infinite;} 
@keyframes pred{0%,100%{text-shadow:0 0 12px var(--red)}50%{text-shadow:0 0 28px var(--red),0 0 50px rgba(255,26,26,.5)}}
.hdr-right{display:flex;gap:14px;font-size:11px;color:var(--green-dim);align-items:center;} 
.sdot{display:inline-block;width:7px;height:7px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green);animation:bd 2s ease-in-out infinite;margin-right:4px;vertical-align:middle;} 
@keyframes bd{0%,100%{opacity:1}50%{opacity:.25}} 
#lang-flag{font-size:10px;border:1px solid var(--green-dim);padding:1px 5px;letter-spacing:1px;cursor:pointer;color:var(--green-dim);} 
#lang-flag:hover{color:var(--green);border-color:var(--green);} 

/* ── ASCII ──────────────────────────────────────────────── */
#kitt-ascii{flex-shrink:0;text-align:center;color:var(--red);font-size:10px;line-height:1.2;text-shadow:0 0 8px var(--red);padding:6px 0 4px;opacity:.85;user-select:none;} 

/* ── TERMINAL ───────────────────────────────────────────── */
#terminal{flex:1;overflow-y:auto;overflow-x:hidden;padding:8px 4px;font-size:13px;line-height:1.65;scrollbar-width:thin;scrollbar-color:var(--red) #111;} 
#terminal::-webkit-scrollbar{width:4px} 
#terminal::-webkit-scrollbar-track{background:#111} 
#terminal::-webkit-scrollbar-thumb{background:var(--red)} 
.line-ok{color:var(--green);} 
.line-warn{color:var(--amber);} 
.line-err{color:var(--red);} 
.line-info{color:var(--cyan);} 
.line-dim{color:var(--green-dim);} 
.cursor{display:inline-block;width:8px;height:13px;background:var(--green);vertical-align:text-bottom;animation:bc .7s step-end infinite;} 
@keyframes bc{0%,100%{opacity:1}50%{opacity:0}} 

/* ── BUTTONS ────────────────────────────────────────────── */
.btn-row{flex-shrink:0;display:flex;flex-wrap:wrap;gap:6px;padding:8px 0 6px;border-top:1px solid #1a1a1a;border-bottom:1px solid #1a1a1a;} 
button{background:#000;border:1px solid var(--green);color:var(--green);padding:7px 14px;cursor:pointer;font-family:inherit;font-size:12px;letter-spacing:1px;transition:all .15s;position:relative;overflow:hidden;} 
button::before{content:"";position:absolute;inset:0;background:var(--green);transform:scaleX(0);transform-origin:left;transition:transform .15s;z-index:-1;} 
button:hover{color:#000;}button:hover::before{transform:scaleX(1);}button:active{transform:scale(.95);} 
.btn-red{border-color:var(--red);color:var(--red);}.btn-red::before{background:var(--red);}.btn-cyan{border-color:var(--cyan);color:var(--cyan);}.btn-cyan::before{background:var(--cyan);} 

/* ── INPUT ──────────────────────────────────────────────── */
.input-row{flex-shrink:0;display:flex;gap:8px;padding-top:8px;align-items:center;} 
.prompt-lbl{color:var(--red);font-size:13px;white-space:nowrap;text-shadow:0 0 8px var(--red);} 
#cmd-input{flex:1;background:transparent;border:none;border-bottom:1px solid var(--green);color:var(--green);font-family:inherit;font-size:13px;outline:none;padding:4px 0;caret-color:var(--green);} 
#cmd-input::placeholder{color:var(--green-dim);opacity:.55;} 

/* ── MODAL ──────────────────────────────────────────────── */
.modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.95);display:none;flex-direction:column;padding:30px;overflow:auto;z-index:5000;border:1px solid var(--red);} 
.modal.open{display:flex;} 
.modal-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;border-bottom:1px solid var(--red);padding-bottom:8px;} 
.modal-title{color:var(--red);font-size:16px;letter-spacing:3px;text-shadow:0 0 10px var(--red);} 
.close-btn{cursor:pointer;color:var(--red);font-size:20px;padding:4px 8px;border:1px solid var(--red);transition:all .15s;} 
.close-btn:hover{background:var(--red);color:#000;} 
.modal pre{white-space:pre-wrap;color:var(--green);font-family:monospace;font-size:13px;line-height:1.7;} 

/* ── MOBILE ─────────────────────────────────────────────── */
@media(max-width:600px){
  .hdr-title{font-size:13px;letter-spacing:2px;}
  #kitt-ascii{font-size:8px;}
  button{padding:6px 10px;font-size:11px;}
  #terminal{font-size:12px;}
  #lang-box{padding:20px;}
}
@media(max-width:380px){#kitt-ascii{display:none;}} 

/* ── BOUTON TUNNEL CLOUDFLARE ───────────────────────────────── */
#btn-tunnel{border-color:#333;color:#333;transition:all .2s;} 
#btn-tunnel.tunnel-online{
  border-color:var(--green);color:var(--green);
  animation:tpulse 2.4s ease-in-out infinite;} 
#btn-tunnel.tunnel-offline{border-color:var(--red);color:var(--red);} 
#btn-tunnel.tunnel-checking{border-color:var(--amber);color:var(--amber);} 
@keyframes tpulse{0%,100%{box-shadow:0 0 5px rgba(0,255,102,.25)}50%{box-shadow:0 0 18px rgba(0,255,102,.65),0 0 8px rgba(0,255,102,.08)}} 

/* ── FOND JARVIS HOLOGRAPHIQUE ──────────────────────────── */
.container{position:relative;z-index:1;} 
#jarvis-svg{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%) translate3d(0,0,0);
  width:min(90vw,90vh);height:min(90vw,90vh);
  pointer-events:none;z-index:0;opacity:0.45;
} 
#sphere-wrap{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%);
  width:180px;height:180px;
  perspective:500px;
  pointer-events:none;z-index:0;opacity:0.22;
} 
#sphere-3d{
  width:100%;height:100%;
  transform-style:preserve-3d;
  animation:srot 22s linear infinite;
} 
@keyframes srot{from{transform:rotateX(22deg) rotateY(0deg)}to{transform:rotateX(22deg) rotateY(360deg)}} 
.s-mer,.s-par{
  position:absolute;top:0;left:0;width:100%;height:100%;
  border-radius:50%;border:1px solid var(--green);box-sizing:border-box;
  opacity:0.7;
} 
.s-core{
  position:absolute;top:50%;left:50%;
  width:18px;height:18px;margin:-9px 0 0 -9px;
  border-radius:50%;
  background:radial-gradient(circle,var(--green),transparent);
  box-shadow:0 0 20px var(--green),0 0 40px rgba(0,255,102,.4);
  animation:score 3s ease-in-out infinite;
} 
@keyframes score{0%,100%{opacity:.6}50%{opacity:1}} 

/* ── COMPTEUR VISITES ───────────────────────────────────── */
#visit-counter{
  position:fixed;left:8px;top:50%;transform:translateY(-50%);
  writing-mode:vertical-rl;text-orientation:mixed;
  font-size:11px;color:var(--green);letter-spacing:3px;
  opacity:.65;pointer-events:none;z-index:100;
  text-shadow:0 0 8px var(--green),0 0 16px rgba(0,255,102,.4);
  user-select:none;
  border-left:1px solid rgba(0,255,102,.3);
  padding-left:4px;
} 

/* ── FOOTER VERSION ─────────────────────────────────────── */
#site-footer{
  position:fixed;bottom:14px;left:50%;transform:translateX(-50%);
  font-size:10px;color:var(--green-dim);letter-spacing:2px;
  opacity:.55;pointer-events:none;z-index:1001;
  white-space:nowrap;user-select:none;
  text-shadow:0 0 6px var(--green-dim);
}
</style>
</head>
<body>

<!-- Language selection overlay -->
<div id="lang-screen">
  <div id="lang-box">
    <div id="lang-hdr"></div>
    <div id="lang-sub"></div>
    <div id="lang-output"></div>
    <div id="lang-ftr"></div>
  </div>
</div>

<!-- Fond Jarvis holographique -->
<svg id="jarvis-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400" preserveAspectRatio="xMidYMid meet">
  <g stroke="#00ff66" fill="none">
    <!-- Anneau externe -->
    <circle cx="200" cy="200" r="185" stroke-opacity="0.6" stroke-width="1">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </circle>
    <!-- Anneau moyen -->
    <circle cx="200" cy="200" r="135" stroke-opacity="0.5" stroke-width="0.8">
      <animateTransform attributeName="transform" type="rotate" from="360 200 200" to="0 200 200" dur="45s" repeatCount="indefinite"/>
    </circle>
    <!-- Anneau interne -->
    <circle cx="200" cy="200" r="85" stroke-opacity="0.45" stroke-width="0.7">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="32s" repeatCount="indefinite"/>
    </circle>
    <!-- Anneau supplémentaire -->
    <circle cx="200" cy="200" r="110" stroke-opacity="0.35" stroke-width="0.6">
      <animateTransform attributeName="transform" type="rotate" from="360 200 200" to="0 200 200" dur="38s" repeatCount="indefinite"/>
    </circle>
    <!-- Spokes -->
    <line x1="200" y1="15" x2="200" y2="385" stroke-opacity="0.18" stroke-width="0.5">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <line x1="15" y1="200" x2="385" y2="200" stroke-opacity="0.18" stroke-width="0.5">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <!-- Arc scanner lumineux -->
    <path d="M 200 15 A 185 185 0 0 1 385 200" stroke-opacity="0.9" stroke-width="2" stroke="#00ff66">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="8s" repeatCount="indefinite"/>
    </path>
    <!-- Marqueurs HUD sur anneau externe -->
    <line x1="200" y1="15" x2="200" y2="30" stroke-opacity="0.7" stroke-width="1.5">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <line x1="200" y1="15" x2="200" y1="25" stroke-opacity="0.5" stroke-width="1">
      <animateTransform attributeName="transform" type="rotate" from="45 200 200" to="405 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <!-- Centre pulsant -->
    <circle cx="200" cy="200" r="5" fill="#00ff66" opacity="0.7">
      <animate attributeName="opacity" values="0.3;1;0.3" dur="3s" repeatCount="indefinite"/>
      <animate attributeName="r" values="4;7;4" dur="3s" repeatCount="indefinite"/>
    </circle>
  </g>
</svg>
<div id="sphere-wrap">
  <div id="sphere-3d">
    <div class="s-mer" style="transform:rotateY(0deg);"></div>
    <div class="s-mer" style="transform:rotateY(30deg);"></div>
    <div class="s-mer" style="transform:rotateY(60deg);"></div>
    <div class="s-mer" style="transform:rotateY(90deg);"></div>
    <div class="s-mer" style="transform:rotateY(120deg);"></div>
    <div class="s-mer" style="transform:rotateY(150deg);"></div>
    <div class="s-par" style="transform:translateY(-44px) rotateX(90deg);"></div>
    <div class="s-par" style="transform:translateY(-22px) rotateX(90deg);"></div>
    <div class="s-par" style="transform:translateY(0px) rotateX(90deg);"></div>
    <div class="s-par" style="transform:translateY(22px) rotateX(90deg);"></div>
    <div class="s-par" style="transform:translateY(44px) rotateX(90deg);"></div>
    <div class="s-core"></div>
  </div>
</div>
<div id="visit-counter"></div>
<div id="site-footer">v3.0 &nbsp;—&nbsp; DERNIÈRE MISE À JOUR : 2026-02-21 16:48:09</div>

<!-- Scanners -->
<div id="sw"><div id="sb"></div></div>
<div id="swb"><div id="sbb"></div></div>

<div class="container">
  <header>
    <div id="hdr-title" class="hdr-title">KITT FRANCO-BELGIAN // CENTRAL INTERFACE</div>
    <div class="hdr-right">
      <span id="lang-flag" onclick="showLangScreen()" title="Changer de langue">FR</span>
      <span><span class="sdot"></span><span id="status-txt">EN LIGNE</span></span>
      <span id="clock">00:00:00</span>
    </div>
  </header>

  <div id="kitt-ascii"><pre>
  ██╗  ██╗██╗████████╗████████╗
  ██║ ██╔╝██║╚══██╔══╝╚══██╔══╝
  █████╔╝ ██║   ██║      ██║
  ██╔═██╗ ██║   ██║      ██║
  ██║  ██╗██║   ██║      ██║
  ╚═╝  ╚═╝╚═╝   ╚═╝      ╚═╝
    FRANCO-BELGE  //  BY MANIX</pre></div>

  <div id="terminal"></div>

  <div class="btn-row">
    <button id="btn-boot" onclick="boot()">[ INITIALISER ]</button>
    <button id="btn-diag" onclick="runSelfTest()" class="btn-cyan">[ DIAGNOSTIC ]</button>
    <button id="btn-mentions" onclick="openFile('Mentions.txt',T[LANG].modal_mentions)" class="btn-red">[ MENTIONS ]</button>
    <button id="btn-licence" onclick="openFile('License.txt',T[LANG].modal_licence)" class="btn-red">[ LICENCE ]</button>
    <button id="btn-clear" onclick="clearTerm()">[ EFFACER ]</button>
    <button id="btn-tunnel" class="tunnel-checking" onclick="connectTunnel()" title="Vérification..."><span id="btn-tunnel-txt">[ CONNEXION KITT ]</span></button>
  </div>

  <div class="input-row">
    <span class="prompt-lbl">KITT&gt;</span>
    <input id="cmd-input" type="text" placeholder="entrez une commande..." autocomplete="off" spellcheck="false"/>
  </div>
</div>

<!-- Modal -->
<div id="modal" class="modal">
  <div class="modal-hdr">
    <span class="modal-title" id="modal-title">DOCUMENT</span>
    <span class="close-btn" onclick="closeModal()">&#10006;</span>
  </div>
  <pre id="modal-content"></pre>
</div>

<script>
// ════════════════════════════════════════════════════════════
// AUDIO ENGINE — Pool de sons variés style années 80
// ════════════════════════════════════════════════════════════
const _ac = new (window.AudioContext || window.webkitAudioContext)();

function _resume() { if (_ac.state === 'suspended') _ac.resume(); }

// ... (audio functions unchanged) ...
function sndClick() { try {_resume(); const t=_ac.currentTime; const len=Math.floor(_ac.sampleRate*0.020); const buf=_ac.createBuffer(1,len,_ac.sampleRate); const d=buf.getChannelData(0); for(let i=0;i<len;i++) d[i]=(Math.random()*2-1)*Math.pow(1-i/len,3.5); const src=_ac.createBufferSource(); src.buffer=buf; const bp=_ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=2700+Math.random()*400; bp.Q.value=4; const hp=_ac.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=850; const g=_ac.createGain(); g.gain.value=0.25; src.connect(bp); bp.connect(hp); hp.connect(g); g.connect(_ac.destination); src.start(t); const o=_ac.createOscillator(); o.type='square'; o.frequency.setValueAtTime(1350+Math.random()*200,t); o.frequency.exponentialRampToValueAtTime(680,t+0.017); const og=_ac.createGain(); og.gain.setValueAtTime(0.04,t); og.gain.exponentialRampToValueAtTime(0.001,t+0.020); o.connect(og); og.connect(_ac.destination); o.start(t); o.stop(t+0.022);}catch(e){}
}
function sndTick(){try{_resume();const t=_ac.currentTime;const o=_ac.createOscillator();o.type='triangle';o.frequency.setValueAtTime(3800+Math.random()*400,t);o.frequency.exponentialRampToValueAtTime(2400,t+0.012);const g=_ac.createGain();g.gain.setValueAtTime(0.03,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.015);o.connect(g);g.connect(_ac.destination);o.start(t);o.stop(t+0.016);}catch(e){} }
function sndData(){try{_resume();const t=_ac.currentTime;const o=_ac.createOscillator();o.type='sawtooth';o.frequency.value=1800+Math.random()*600;const g=_ac.createGain();g.gain.setValueAtTime(0.05,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.012);const lp=_ac.createBiquadFilter();lp.type='lowpass';lp.frequency.value=4000;o.connect(lp);lp.connect(g);g.connect(_ac.destination);o.start(t);o.stop(t+0.013);}catch(e){}
}
function sndGlitch(){try{_resume();const t=_ac.currentTime;const len=Math.floor(_ac.sampleRate*0.035);const buf=_ac.createBuffer(1,len,_ac.sampleRate);const d=buf.getChannelData(0);for(let i=0;i<len;i++)d[i]=(Math.random()*2-1)*(Math.random()>0.5?0.9:0.05);const src=_ac.createBufferSource();src.buffer=buf;const bp=_ac.createBiquadFilter();bp.type='bandpass';bp.frequency.value=1200;bp.Q.value=2;const g=_ac.createGain();g.gain.value=0.12;src.connect(bp);bp.connect(g);g.connect(_ac.destination);src.start(t);}catch(e){}
}
function sndLineEnd(){try{_resume();const t=_ac.currentTime;const o=_ac.createOscillator();o.type='sine';o.frequency.setValueAtTime(900,t);o.frequency.exponentialRampToValueAtTime(600,t+0.06);const g=_ac.createGain();g.gain.setValueAtTime(0.028,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.07);o.connect(g);g.connect(_ac.destination);o.start(t);o.stop(t+0.08);}catch(e){}
}
function sndSelect(){try{_resume();const t=_ac.currentTime;[440,660,880].forEach((f,i)=>{const o=_ac.createOscillator();o.type='square';o.frequency.value=f;const g=_ac.createGain();g.gain.setValueAtTime(0.04,t+i*0.06);g.gain.exponentialRampToValueAtTime(0.001,t+i*0.06+0.05);o.connect(g);g.connect(_ac.destination);o.start(t+i*0.06);o.stop(t+i*0.06+0.055);});}catch(e){}
}
function sndError(){try{_resume();const t=_ac.currentTime;const o=_ac.createOscillator();o.type='square';o.frequency.value=180;const g=_ac.createGain();g.gain.setValueAtTime(0.07,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.08);o.connect(g);g.connect(_ac.destination);o.start(t);o.stop(t+0.09);}catch(e){}
}
function kittChime(){try{_resume();const t=_ac.currentTime;const o=_ac.createOscillator();o.type='sine';o.frequency.setValueAtTime(880,t);o.frequency.exponentialRampToValueAtTime(220,t+0.35);const g=_ac.createGain();g.gain.setValueAtTime(0.1,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.4);o.connect(g);g.connect(_ac.destination);o.start(t);o.stop(t+0.4);}catch(e){}
}
const SPECIAL_CHARS = new Set([...'[]():=|─══╔╗╚╝║┌┐└┘├┤•★★']);
let _charCount = 0;
function playChar(ch){if(ch===' '||ch==='
')return;_charCount++;const r=Math.random();if(SPECIAL_CHARS.has(ch)){sndData();return;}if(_charCount%47===0){sndGlitch();return;}if(r<0.03){sndGlitch();return;}if(r<0.14){sndTick();return;}if(r<0.72){sndClick();return;}}

// ════════════════════════════════════════════════════════════
// LANGUE — Système de localisation
// ════════════════════════════════════════════════════════════
let LANG = 'fr';
let langSelected = false;
let voiceSelected = false;
let LANG_VOICE = 'kitt';

const T = {
  fr: { hdr_title: 'KITT FRANCO-BELGE // INTERFACE CENTRALE', placeholder: 'entrez une commande...', btn_boot: '[ INITIALISER ]', btn_diag: '[ DIAGNOSTIC ]', btn_mentions: '[ MENTIONS ]', btn_licence: '[ LICENCE ]', btn_clear: '[ EFFACER ]', btn_tunnel: '[ CONNEXION KITT ]', modal_mentions:'MENTIONS LÉGALES', modal_licence: 'LICENCE', wait: 'SYSTÈME EN ATTENTE — TAPEZ "boot" OU CLIQUEZ [ INITIALISER ]', help_hint: 'TAPEZ "aide" POUR LA LISTE DES COMMANDES.', cleared: 'TERMINAL EFFACÉ.', unknown: (c) => `COMMANDE INCONNUE : "${c}". TAPEZ "aide".`, online: 'EN LIGNE', boot_title: '  KITT FRANCO-BELGE — SÉQUENCE DE BOOT   ', boot_lines: [['INITIALISATION DU NOYAU SYSTÈME...', 'line-warn'],['CHARGEMENT MODULES COGNITIFS...    [OK]', 'line-ok'],['INTERFACE NEURONALE...             [OK]', 'line-ok'],['SYNTHÈSE VOCALE (PIPER-GPU)...     [OK]', 'line-ok'],['RECONNAISSANCE VOCALE (WHISPER)... [OK]', 'line-ok'],['MODÈLE LLM EMBARQUÉ (QWEN 3B)...  [OK]', 'line-ok'],['MODE HORS-LIGNE...                 [ACTIVÉ]', 'line-ok'],['', 'line-ok'],['PROJET FAN NON COMMERCIAL.', 'line-dim'],['STATUT : INTERFACE EN CONSTRUCTION ACTIVE.', 'line-warn'],['', 'line-ok'],['MISES À JOUR DÉPLOYÉES RÉGULIÈREMENT :', 'line-info'],['  • parfois chaque jour', 'line-dim'],['  • parfois chaque semaine', 'line-dim'],['  • lors de certaines phases, presque heure par heure', 'line-dim'],['', 'line-ok'],['© 2026 EMMANUEL GELINNE (MANIX). TOUS DROITS RÉSERVÉS.', 'line-warn']], boot_end: '  CONNEXION AU NOYAU KITT ÉTABLIE.', boot_hint: '  TAPEZ "aide" POUR LA LISTE DES COMMANDES', aide_title: 'COMMANDES DISPONIBLES :', aide_sys: '── SYSTÈME ──', aide_fun: '── FUN ──', cmds_sys: [['aide', 'cette liste'],['boot', "séquence d'initialisation"],['diagnostic', 'test complet des systèmes'],['status', 'état rapide'],['heure', 'heure actuelle'],['version', "version de l'interface"],['son', 'démo audio'],['clear', 'efface le terminal']], cmds_fun: [['bonjour', 'salutation KITT'],['blague', 'blague KITT aléatoire'],['alien', 'connexion MU-TH-UR 6000'],['matrix', 'le lapin blanc'],['kitt', 'fiche identité KITT'],['manix', 'dossier conducteur'],['cedric', 'dossier Cedric Momo Rider'],['kr95', 'dossier KR95'],['repliques', 'les répliques franco-belges'],['secret', 'fichier classifié...'],['cafe', 'demander un café à KITT'],['belgique', 'analyse géopolitique'],['jarvis', 'appel vers Stark Tower'],['mario', 'dossier Mario Ravasi / IoT'],['za', 'dossier ZA Elettronica'],['pascal', 'dossier K Industrie'],['daemon', 'dossier Daemon Paule'],['geoffrey', 'dossier Geoffrey'],['covid', 'origine du projet — confinement 2020']], hi: 'BONJOUR. JE SUIS KITT — KNIGHT INDUSTRIES TWO THOUSAND.', hi2: 'SYSTÈME FRANCO-BELGE DÉVELOPPÉ PAR MANIX.', hi3: 'À VOTRE SERVICE.' },
  en: { hdr_title: 'KITT FRANCO-BELGIAN // CENTRAL INTERFACE', placeholder: 'enter a command...', btn_boot: '[ INITIALIZE ]', btn_diag: '[ DIAGNOSTIC ]', btn_mentions: '[ MENTIONS ]', btn_licence: '[ LICENSE ]', btn_clear: '[ CLEAR ]', btn_tunnel: '[ CONNECT KITT ]', modal_mentions:'LEGAL NOTICES', modal_licence: 'LICENSE', wait: 'SYSTEM STANDBY — TYPE "boot" OR CLICK [ INITIALIZE ]', help_hint: 'TYPE "help" FOR THE LIST OF COMMANDS.', cleared: 'TERMINAL CLEARED.', unknown: (c) => `UNKNOWN COMMAND: "${c}". TYPE "help".`, online: 'ONLINE', boot_title: '  KITT FRANCO-BELGE — BOOT SEQUENCE        ', boot_lines: [['INITIALIZING CORE SYSTEM...', 'line-warn'],['LOADING COGNITIVE MODULES...       [OK]', 'line-ok'],['NEURAL INTERFACE...                [OK]', 'line-ok'],['VOICE SYNTHESIS (PIPER-GPU)...     [OK]', 'line-ok'],['VOICE RECOGNITION (WHISPER)...     [OK]', 'line-ok'],['EMBEDDED LLM (QWEN 3B)...          [OK]', 'line-ok'],['OFFLINE MODE...                    [ACTIVE]', 'line-ok'],['', 'line-ok'],['FAN PROJECT — NON COMMERCIAL.', 'line-dim'],['STATUS : INTERFACE UNDER ACTIVE CONSTRUCTION.', 'line-warn'],['', 'line-ok'],['UPDATES DEPLOYED REGULARLY :', 'line-info'],['  • sometimes every day', 'line-dim'],['  • sometimes every week', 'line-dim'],['  • during some phases, almost hour by hour', 'line-dim'],['', 'line-ok'],['© 2026 EMMANUEL GELINNE (MANIX). ALL RIGHTS RESERVED.', 'line-warn']], boot_end: '  CONNECTION TO KITT CORE ESTABLISHED.', boot_hint: '  TYPE "help" FOR THE COMMAND LIST', aide_title: 'AVAILABLE COMMANDS:', aide_sys: '── SYSTEM ──', aide_fun: '── FUN ──', cmds_sys: [['help', 'this list'],['boot', 'boot sequence'],['diagnostic', 'full system test'],['status', 'quick status'],['time', 'current time'],['version', 'interface version'],['sound', 'audio demo'],['clear', 'clear terminal']], cmds_fun: [['hello', 'KITT greeting'],['joke', 'random KITT joke'],['alien', 'MU-TH-UR 6000 connection'],['matrix', 'the white rabbit'],['kitt', 'KITT identity file'],['manix', 'driver file'],['cedric', 'Cedric Momo Rider file'],['kr95', 'KR95 file'],['replicas', 'the franco-belgian replicas'],['secret', 'classified file...'],['coffee', 'ask KITT for a coffee'],['belgium', 'geopolitical analysis'],['jarvis', 'call to Stark Tower'],['mario', 'Mario Ravasi / IoT file'],['za', 'ZA Elettronica file'],['pascal', 'K Industrie file'],['daemon', 'Daemon Paule file'],['geoffrey', 'Geoffrey file'],['covid', 'project origin — lockdown 2020']], hi: 'HELLO. I AM KITT — KNIGHT INDUSTRIES TWO THOUSAND.', hi2: 'FRANCO-BELGIAN SYSTEM DEVELOPED BY MANIX.', hi3: 'AT YOUR SERVICE.' },
  nl: { hdr_title: 'KITT FRANCO-BELGISCH // CENTRALE INTERFACE', placeholder: 'voer een commando in...', btn_boot: '[ OPSTARTEN ]', btn_diag: '[ DIAGNOSE ]', btn_mentions: '[ VERMELDINGEN ]', btn_licence: '[ LICENTIE ]', btn_clear: '[ WISSEN ]', btn_tunnel: '[ VERBIND KITT ]', modal_mentions:"WETTELIJKE VERMELDINGEN", modal_licence: 'LICENTIE', wait: 'SYSTEEM WACHT — TYP "boot" OF KLIK [ OPSTARTEN ]', help_hint: 'TYP "hulp" VOOR DE COMMANDOLIJST.', cleared: 'TERMINAL GEWIST.', unknown: (c) => `ONBEKEND COMMANDO: "${c}". TYP "hulp".`, online: 'ONLINE', boot_title: '  KITT FRANCO-BELGE — OPSTARTSEQUENTIE     ', boot_lines: [['KERNSYSTEEM INITIALISEREN...', 'line-warn'],['COGNITIEVE MODULES LADEN...        [OK]', 'line-ok'],['NEURALE INTERFACE...               [OK]', 'line-ok'],['SPRAAKSYNTHESE (PIPER-GPU)...      [OK]', 'line-ok'],['STEMHERKENNING (WHISPER)...        [OK]', 'line-ok'],['LOKALES LLM (QWEN 3B)...           [OK]', 'line-ok'],['OFFLINE MODUS...                   [ACTIEF]', 'line-ok'],['', 'line-ok'],['FAN PROJECT — NIET COMMERCIEEL.', 'line-dim'],['STATUS : INTERFACE IN ACTIEVE CONSTRUCTIE.', 'line-warn'],['', 'line-ok'],['UPDATES REGELMATIG UITGEROLD :', 'line-info'],['  • soms elke dag', 'line-dim'],['  • soms elke week', 'line-dim'],['  • soms elk uur', 'line-dim'],['', 'line-ok'],['© 2026 EMMANUEL GELINNE (MANIX). ALLE RECHTEN VOORBEHOUDEN.', 'line-warn']], boot_end: '  VERBINDING MET KITT-KERN TOT STAND GEBRACHT.', boot_hint: '  TYP "hulp" VOOR DE COMMANDOLIJST', aide_title: "BESCHIKBARE COMMANDO'S:", aide_sys: '── SYSTEEM ──', aide_fun: '── PLEZIER ──', cmds_sys: [['hulp', 'deze lijst'],['boot', 'opstartsequential'],['diagnostic', 'volledig systeemtest'],['status', 'snelle status'],['tijd', 'huidige tijd'],['versie', 'interface versie'],['geluid', 'audio demo'],['clear', 'terminal wissen']], cmds_fun: [['hallo', 'KITT begroeting'],['grap', 'willekeurige KITT grap'],['alien', 'MU-TH-UR 6000 verbinding'],['matrix', 'het witte konijn'],['kitt', 'KITT identiteitsbestand'],['manix', 'bestuurdersdossier'],['cedric', 'Cedric Momo Rider dossier'],['kr95', 'KR95 dossier'],['replicas', "de franco-belgische replica's"],['geheim', 'geheim bestand...'],['koffie', 'KITT om koffie vragen'],['belgie', 'geopolitieke analyse'],['jarvis', 'oproep naar Stark Tower'],['mario', 'Mario Ravasi / IoT dossier'],['za', 'ZA Elettronica dossier'],['pascal', 'K Industrie dossier'],['daemon', 'daemon dossier'],['geoffrey', 'geoffrey dossier'],['covid', 'projectoorsprong — lockdown 2020']], hi: 'HALLO. IK BEN KITT — KNIGHT INDUSTRIES TWO THOUSAND.', hi2: 'FRANCO-BELGISCH SYSTEEM ONTWIKKELD DOOR MANIX.', hi3: 'TOT UW DIENST.' },
};

// -- Ensure minimal command system to avoid ReferenceError --
window.CMDS = window.CMDS || {};
window.CMD_ALIASES = window.CMD_ALIASES || {};
let typing = false;

function addLine(txt, cls) {
  const t = document.getElementById('terminal');
  if (!t) return;
  const d = document.createElement('div');
  if (cls) d.className = cls;
  d.textContent = txt;
  t.appendChild(d);
  t.scrollTop = t.scrollHeight;
}
async function typeText(text, speed = 12, cls) {
  // simple fallback: print whole line, play sounds per char
  addLine('', cls);
  const t = document.getElementById('terminal');
  const last = t.lastChild;
  for (let ch of text) {
    last.textContent += ch;
    playChar(ch);
    await new Promise(r => setTimeout(r, speed));
  }
  sndLineEnd();
}
function clearTerm(){ const t=document.getElementById('terminal'); if(t) t.innerHTML=''; addLine(T[LANG].cleared,'line-dim'); }
function showLangScreen(){
  const s = document.getElementById('lang-screen');
  const hdr = document.getElementById('lang-hdr');
  const sub = document.getElementById('lang-sub');
  const out = document.getElementById('lang-output');
  const ftr = document.getElementById('lang-ftr');
  hdr.textContent = 'KITT FRANCO-BELGE // SÉLECTION LANGUE';
  sub.textContent = 'Choisissez votre langue / Kies uw taal / Choose language';
  out.innerHTML = '';
  [['fr','FR'],['en','EN'],['nl','NL']].forEach(([k,label])=>{
    const el = document.createElement('div'); el.className='lang-opt'; el.onclick = ()=>{ LANG=k; s.style.display='none'; applyLocale(); startMain(); sndSelect(); };
    const lo = document.createElement('div'); lo.className='lo-n'; lo.textContent=label;
    const ll = document.createElement('div'); ll.className='lo-l'; ll.textContent = {'fr':'Français','en':'English','nl':'Nederlands'}[k];
    el.appendChild(lo); el.appendChild(ll); out.appendChild(el);
  });
  ftr.textContent = 'Projet fan — Manix';
  s.style.display='flex';
}

function applyLocale(){
  document.getElementById('hdr-title').textContent = T[LANG].hdr_title || document.getElementById('hdr-title').textContent;
  document.getElementById('cmd-input').placeholder = T[LANG].placeholder || '';
  document.getElementById('btn-boot').textContent = T[LANG].btn_boot || document.getElementById('btn-boot').textContent;
  document.getElementById('btn-diag').textContent = T[LANG].btn_diag || document.getElementById('btn-diag').textContent;
  document.getElementById('btn-mentions').textContent = T[LANG].btn_mentions || document.getElementById('btn-mentions').textContent;
  document.getElementById('btn-licence').textContent = T[LANG].btn_licence || document.getElementById('btn-licence').textContent;
  document.getElementById('btn-clear').textContent = T[LANG].btn_clear || document.getElementById('btn-clear').textContent;
}

// Basic command implementations
CMDS['aide'] = CMDS['help'] = async function(){ addLine(T[LANG].aide_title,'line-info'); addLine(T[LANG].aide_sys,'line-dim'); for(const c of T[LANG].cmds_sys) addLine('  '+c[0]+' — '+c[1],'line-dim'); addLine(T[LANG].aide_fun,'line-dim'); for(const c of T[LANG].cmds_fun) addLine('  '+c[0]+' — '+c[1],'line-dim'); };
CMDS['boot'] = async function(){ addLine(T[LANG].boot_title,'line-warn'); for(const l of T[LANG].boot_lines){ addLine(l[0], l[1]); await new Promise(r=>setTimeout(r,120)); } addLine(T[LANG].boot_end,'line-ok'); addLine(T[LANG].boot_hint,'line-dim'); };
CMDS['diagnostic'] = CMDS['diag'] = CMDS['diagnostic'] || (async function(){ addLine('[DIAGNOSTIC] Lancement...','line-warn'); await new Promise(r=>setTimeout(r,400)); addLine('[DIAGNOSTIC] Capteurs OK','line-ok'); await new Promise(r=>setTimeout(r,200)); addLine('[DIAGNOSTIC] Réseau OK','line-ok'); });
CMDS['status'] = CMDS['status'] || (async function(){ addLine('[STATUS] '+T[LANG].online,'line-ok'); });
CMDS['heure'] = CMDS['time'] = async function(){ addLine(new Date().toLocaleString(getLoc()),'line-info'); };
CMDS['version'] = async function(){ addLine('KITT FRANCO-BELGE — v3.0','line-info'); };
CMDS['son'] = CMDS['sound'] = async function(){ kittChime(); addLine('[SON] démo audio jouée','line-info'); };
CMDS['clear'] = async function(){ clearTerm(); };

// Map some aliases
CMD_ALIASES['aide']='aide'; CMD_ALIASES['help']='aide'; CMD_ALIASES['son']='son'; CMD_ALIASES['sound']='son';

// ════════════════════════════════════════════════════════════
// INPUT handler
// ════════════════════════════════════════════════════════════
document.getElementById('cmd-input').addEventListener('keydown', async function(e) {
  if (e.key !== 'Enter') return;
  const raw = this.value.trim().toLowerCase();
  this.value = '';
  if (!raw || typing) return;

  addLine(`KITT> ${raw}`, 'line-warn');
  const cmd = CMD_ALIASES[raw] || raw;

  if (CMDS[cmd]) {
    await CMDS[cmd]();
  } else {
    sndError();
    await typeText(T[LANG].unknown(raw), 14, 'line-err');
  }
});

// ════════════════════════════════════════════════════════════
// TUNNEL CLOUDFLARE — Connexion distante KITT
// ════════════════════════════════════════════════════════════
const TUNNEL_JSON_URL = 'tunnel.json';
let _tunnelUrl    = null;
let _tunnelStatus = 'unknown';

const _CF_ALLOWED = ['.trycloudflare.com', '.cfargotunnel.com'];
function _isValidCfUrl(url) { if (!url || !url.startsWith('https://')) return false; return _CF_ALLOWED.some(d => url.includes(d)); }
async function fetchTunnelStatus(){ const btn=document.getElementById('btn-tunnel'); if(btn){btn.className='tunnel-checking';btn.title='Vérification...';} try{ const r=await fetch(TUNNEL_JSON_URL+'?v='+Math.floor(Date.now()/60000),{cache:'no-store'}); if(!r.ok) throw new Error('HTTP '+r.status); const data=await r.json(); const raw=(data.url||'').trim(); const valid=_isValidCfUrl(raw); let tooOld=false; if(data.last_update){ const ageSec=(Date.now()-new Date(data.last_update).getTime())/1000; if(ageSec>300) tooOld=true;} if(data.status==='online'&&valid&&!tooOld){ _tunnelStatus='online'; _tunnelUrl=raw;} else { _tunnelStatus='offline'; _tunnelUrl=null; } }catch(e){ _tunnelStatus='unknown'; _tunnelUrl=null;} _updateTunnelBtn(); }
function _updateTunnelBtn(){ const btn=document.getElementById('btn-tunnel'); if(!btn) return; btn.className=''; if(_tunnelStatus==='online'&&_tunnelUrl){ btn.classList.add('tunnel-online'); btn.title='KITT EN LIGNE — CLIQUER POUR SE CONNECTER'; } else if(_tunnelStatus==='offline'){ btn.classList.add('tunnel-offline'); btn.title='KITT HORS LIGNE'; } else { btn.classList.add('tunnel-checking'); btn.title='ÉTAT INCONNU — VÉRIFICATION...'; } }
function connectTunnel(){ sndSelect(); if(_tunnelStatus==='online'&&_tunnelUrl&&_isValidCfUrl(_tunnelUrl)){ addLine('[ TUNNEL ] CONNEXION SÉCURISÉE → '+_tunnelUrl,'line-ok'); setTimeout(()=>window.open(_tunnelUrl,'_blank','noopener,noreferrer'),300); } else if(_tunnelStatus==='offline'){ sndError(); addLine('[ TUNNEL ] KITT HORS LIGNE — CONNEXION DISTANTE INDISPONIBLE.','line-err'); } else { addLine('[ TUNNEL ] VÉRIFICATION EN COURS...','line-warn'); fetchTunnelStatus(); } }
window.addEventListener('load', ()=>{ setTimeout(fetchTunnelStatus,1500); });
setInterval(fetchTunnelStatus,60000);

// ════════════════════════════════════════════════════════════
// UTILS & HORLOGE
// ════════════════════════════════════════════════════════════
function delay(ms){ return new Promise(r=>setTimeout(r,ms)); }
function getLoc(){return{fr:'fr-FR',en:'en-US',nl:'nl-NL',it:'it-IT',de:'de-DE',es:'es-ES',pt:'pt-PT'}[LANG]||'fr-FR';}
setInterval(()=>{ const clk=document.getElementById('clock'); if(clk) clk.textContent=new Date().toLocaleTimeString(getLoc()); },1000);

// ════════════════════════════════════════════════════════════
// MODAL
// ════════════════════════════════════════════════════════════
function openFile(file,title='DOCUMENT'){ document.getElementById('modal-title').textContent=title; document.getElementById('modal-content').textContent='CHARGEMENT...'; document.getElementById('modal').classList.add('open'); kittChime(); fetch(file).then(r=>{ if(!r.ok) throw new Error(`HTTP ${r.status}`); return r.text(); }).then(t=>{ document.getElementById('modal-content').textContent=t; }).catch(er=>{ document.getElementById('modal-content').textContent=`ERREUR\n${file}\n${er.message}`; }); }
function closeModal(){ document.getElementById('modal').classList.remove('open'); }
document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeModal(); });

// ════════════════════════════════════════════════════════════
// DÉMARRAGE
// ════════════════════════════════════════════════════════════
function startMain(){ (async ()=>{ await delay(200); await typeText(T[LANG].wait,14,'line-dim'); await typeText(T[LANG].help_hint,12,'line-dim'); })(); }

// ════════════════════════════════════════════════════════════
// COMPTEUR DE VISITES — localStorage + offset 1000
// ════════════════════════════════════════════════════════════
(function(){ try{ const BASE=1000; const KEY='kitt_fb_v'; let n=parseInt(localStorage.getItem(KEY)||'0'); n++; localStorage.setItem(KEY,n); const el=document.getElementById('visit-counter'); if(el) el.textContent='VISITES : '+(BASE+n); }catch(e){} })();

// Lancer l'écran de sélection de langue au chargement
window.addEventListener('load', ()=>{ showLangScreen(); applyLocale(); });
</script>
</body>
</html>