<!-- REMPLACEZ LA SECTION DU MENU DE LANGUES DANS VOTRE index.html -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- LANGUAGE SELECTION OVERLAY â€” IMPROVED VERSION -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<style>
/* â”€â”€ LANGUAGE SELECTION OVERLAY â€” AMÃ‰LIÃ‰Ã‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#lang-screen{
  position:fixed;top:0;left:0;right:0;bottom:0;
  background:#000;z-index:8000;
  display:flex;align-items:center;justify-content:center;
  padding:16px;
  animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

#lang-box{
  width:100%;max-width:500px;
  border:2px solid var(--green);
  box-shadow:0 0 40px rgba(0,255,100,.12),inset 0 0 30px rgba(0,255,100,.02);
  font-size:13px;
  border-radius:2px;
}

#lang-hdr{
  border-bottom:2px solid var(--green-dim);
  padding:14px 20px;
  color:var(--green);
  letter-spacing:3px;
  font-size:12px;
  text-align:center;
  text-shadow:0 0 10px var(--green);
  font-weight:bold;
}

#lang-sub{
  padding:10px 20px 8px;
  color:var(--amber);
  letter-spacing:2px;
  font-size:11px;
  border-bottom:1px solid #222;
  background:rgba(0,0,0,.3);
}

#lang-output{
  padding:12px 0;
  max-height:280px;
  overflow-y:auto;
}

/* Scrollbar styling */
#lang-output::-webkit-scrollbar {
  width:6px;
}

#lang-output::-webkit-scrollbar-track {
  background:rgba(0,255,102,.05);
}

#lang-output::-webkit-scrollbar-thumb {
  background:rgba(0,255,102,.2);
  border-radius:3px;
}

.lang-opt{
  display:flex;
  align-items:center;
  gap:12px;
  padding:10px 18px;
  cursor:pointer;
  transition:all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
  border-left:3px solid transparent;
  border-right:3px solid transparent;
  position:relative;
  outline:none;
}

.lang-opt:hover {
  background:rgba(0,255,100,.08);
  border-left-color:var(--green);
  transform:translateX(4px);
  box-shadow:inset 0 0 15px rgba(0,255,100,.05);
}

.lang-opt:focus-visible {
  background:rgba(0,255,100,.12);
  border-left-color:var(--cyan);
  outline:1px solid var(--cyan);
  outline-offset:-2px;
}

.lang-opt.active {
  background:rgba(0,255,100,.18);
  border-left-color:var(--green);
  border-right-color:var(--green);
  color:var(--green);
  font-weight:bold;
  box-shadow:
    inset 0 0 20px rgba(0,255,100,.08),
    0 0 20px rgba(0,255,100,.1);
}

.lang-opt.keyboard-selected {
  background:rgba(0,255,100,.15);
  border-left-color:var(--cyan);
}

/* Flag emoji */
.lo-f {
  font-size:24px;
  min-width:30px;
  text-align:center;
  filter:drop-shadow(0 0 4px rgba(0,255,102,.3));
}

/* Language number */
.lo-n{
  color:var(--red);
  font-size:11px;
  min-width:24px;
  text-align:center;
  border:1px solid var(--red);
  padding:2px 5px;
  letter-spacing:1px;
  flex-shrink:0;
  font-weight:bold;
  border-radius:1px;
  background:rgba(255,26,26,.05);
}

/* Language label container */
.lo-info {
  display:flex;
  flex-direction:column;
  gap:2px;
  flex:1;
}

/* Language full name */
.lo-l {
  color:var(--green);
  letter-spacing:2px;
  font-size:13px;
  font-weight:500;
}

/* Language ISO code */
.lo-iso {
  color:var(--amber);
  font-size:10px;
  letter-spacing:1px;
  opacity:0.7;
}

#lang-ftr{
  border-top:2px solid var(--green-dim);
  padding:10px 20px;
  color:var(--green-dim);
  font-size:10px;
  letter-spacing:2px;
  text-align:center;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  background:rgba(0,0,0,.2);
}

/* Curseur clignotant */
.cursor {
  display:inline-block;
  width:8px;
  height:10px;
  background:var(--green);
  margin-left:3px;
  animation:blink 0.8s infinite;
}

@keyframes blink {
  0%, 49% { opacity:1; }
  50%, 100% { opacity:0; }
}
</style>

<div id="lang-screen">
  <div id="lang-box">
    <div id="lang-hdr"></div>
    <div id="lang-sub"></div>
    <div id="lang-output" role="listbox" aria-label="SÃ©lectionner une langue"></div>
    <div id="lang-ftr"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- JAVASCRIPT â€” Language Selection IMPROVED -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SÃ‰LECTION DE LANGUE â€” Avec drapeaux, keyboard nav, persistence
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const LANG_LIST_IMPROVED = [
  ['1', 'fr', 'FRANÃ‡AIS',    'ğŸ‡«ğŸ‡·', 'fr-FR'],
  ['2', 'en', 'ENGLISH',     'ğŸ‡¬ğŸ‡§', 'en-US'],
  ['3', 'nl', 'NEDERLANDS',  'ğŸ‡³ğŸ‡±', 'nl-NL'],
  ['4', 'it', 'ITALIANO',    'ğŸ‡®ğŸ‡¹', 'it-IT'],
  ['5', 'de', 'DEUTSCH',     'ğŸ‡©ğŸ‡ª', 'de-DE'],
  ['6', 'es', 'ESPAÃ‘OL',     'ğŸ‡ªğŸ‡¸', 'es-ES'],
  ['7', 'pt', 'PORTUGUÃŠS',   'ğŸ‡µğŸ‡¹', 'pt-PT'],
];

let _currentLangIndex = 0; // Pour la navigation au clavier

async function showLangScreen() {
  const screen = document.getElementById('lang-screen');
  screen.style.display = 'flex';
  screen.style.opacity = '1';

  // Vider les zones
  ['lang-hdr','lang-sub','lang-output','lang-ftr'].forEach(id => {
    document.getElementById(id).innerHTML = '';
  });

  const hdr = document.getElementById('lang-hdr');
  const sub = document.getElementById('lang-sub');
  const out = document.getElementById('lang-output');
  const ftr = document.getElementById('lang-ftr');

  // â”€â”€ Header tapÃ© caractÃ¨re par caractÃ¨re
  await _langType(hdr, 'MU-TH-UR 6000  //  INTERFACE PROTOCOL v2.1');
  await _langDelay(80);

  // â”€â”€ Sous-titre
  await _langType(sub, 'SELECT INTERFACE LANGUAGE  â€”  CHOISIR UNE LANGUE');
  await _langDelay(60);

  // â”€â”€ Options avec drapeaux et codes
  for (let idx = 0; idx < LANG_LIST_IMPROVED.length; idx++) {
    const [num, code, label, flag, locale] = LANG_LIST_IMPROVED[idx];
    
    const row = document.createElement('div');
    row.className = 'lang-opt';
    row.dataset.code = code;
    row.dataset.index = idx;
    row.role = 'option';
    row.tabIndex = 0;
    row.setAttribute('aria-label', `${label} (${num})`);
    
    row.innerHTML = `
      <span class="lo-n">${num}</span>
      <span class="lo-f">${flag}</span>
      <div class="lo-info">
        <span class="lo-l">${label}</span>
        <span class="lo-iso">${code.toUpperCase()}</span>
      </div>
    `;
    
    row.addEventListener('click', () => selectLang(code));
    row.addEventListener('mouseenter', () => {
      sndTick();
      speakText(`${num} ${label}`, code);
      _currentLangIndex = idx;
      updateKeyboardSelection();
    });
    row.addEventListener('focus', () => {
      _currentLangIndex = idx;
      updateKeyboardSelection();
    });
    row.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        selectLang(code);
      }
    });
    
    out.appendChild(row);
    sndClick();
    await _langDelay(50);
  }

  await _langDelay(80);

  // â”€â”€ Footer avec instructions
  const ftrTxt = document.createElement('span');
  ftr.appendChild(ftrTxt);
  await _langType(ftrTxt, 'PRESS [ 1â€“7 ] â€¢ â†‘â†“ ARROW â€¢ ENTER OR CLICK');

  // â”€â”€ Ajouter le curseur
  const cur = document.createElement('span');
  cur.className = 'cursor';
  ftr.appendChild(cur);

  // â”€â”€ Charger la derniÃ¨re langue utilisÃ©e (optionnel)
  const savedLang = localStorage.getItem('kitt_lang');
  if (savedLang) {
    const row = out.querySelector(`[data-code="${savedLang}"]`);
    if (row) {
      row.classList.add('active');
      _currentLangIndex = parseInt(row.dataset.index);
    }
  }

  // â”€â”€ Keyboard navigation
  document.addEventListener('keydown', handleLangKeydown);
}

function updateKeyboardSelection() {
  const rows = document.querySelectorAll('.lang-opt');
  rows.forEach((r, i) => {
    if (i === _currentLangIndex) {
      r.classList.add('keyboard-selected');
      r.focus();
    } else {
      r.classList.remove('keyboard-selected');
    }
  });
}

function handleLangKeydown(e) {
  if (document.getElementById('lang-screen').style.display === 'none') {
    document.removeEventListener('keydown', handleLangKeydown);
    return;
  }

  const rows = document.querySelectorAll('.lang-opt');
  const langMap = {'1':'fr','2':'en','3':'nl','4':'it','5':'de','6':'es','7':'pt'};

  // SÃ©lection par numÃ©ro
  if (langMap[e.key]) {
    e.preventDefault();
    selectLang(langMap[e.key]);
    return;
  }

  // Navigation avec flÃ¨ches
  if (e.key === 'ArrowDown') {
    e.preventDefault();
    _currentLangIndex = (_currentLangIndex + 1) % rows.length;
    updateKeyboardSelection();
    sndTick();
  } else if (e.key === 'ArrowUp') {
    e.preventDefault();
    _currentLangIndex = (_currentLangIndex - 1 + rows.length) % rows.length;
    updateKeyboardSelection();
    sndTick();
  } else if (e.key === 'Enter') {
    e.preventDefault();
    const selectedCode = rows[_currentLangIndex].dataset.code;
    selectLang(selectedCode);
  }
}

function _langType(el, txt) {
  return new Promise(resolve => {
    let i = 0;
    function t() {
      if (i < txt.length) {
        el.textContent += txt[i++];
        if (Math.random() > 0.35) sndClick();
        setTimeout(t, 8 + Math.random() * 5);
      } else {
        sndLineEnd();
        resolve();
      }
    }
    t();
  });
}

function _langDelay(ms) { 
  return new Promise(r => setTimeout(r, ms)); 
}

function selectLang(lang) {
  // Sauvegarder la langue
  localStorage.setItem('kitt_lang', lang);
  
  LANG = lang;
  const t = T[lang];
  
  document.getElementById('lang-flag').textContent = lang.toUpperCase();
  document.getElementById('status-txt').textContent = t.online;
  document.getElementById('hdr-title').textContent  = t.hdr_title;
  document.getElementById('cmd-input').placeholder  = t.placeholder;
  document.getElementById('btn-boot').textContent    = t.btn_boot;
  document.getElementById('btn-diag').textContent    = t.btn_diag;
  document.getElementById('btn-mentions').textContent= t.btn_mentions;
  document.getElementById('btn-licence').textContent = t.btn_licence;
  document.getElementById('btn-clear').textContent   = t.btn_clear;
  document.getElementById('btn-tunnel-txt').textContent = t.btn_tunnel;
  
  sndSelect();
  
  // Cacher l'overlay avec fondu
  const screen = document.getElementById('lang-screen');
  screen.style.transition = 'opacity .4s ease-out';
  screen.style.opacity = '0';
  
  setTimeout(() => { 
    screen.style.display = 'none'; 
    screen.style.opacity = '1'; 
    screen.style.transition = ''; 
    document.removeEventListener('keydown', handleLangKeydown);
  }, 450);
  
  setTimeout(() => startMain(), 550);
}

// RÃ©cupÃ©rer la langue sauvegardÃ©e au dÃ©marrage
window.addEventListener('load', () => {
  const savedLang = localStorage.getItem('kitt_lang');
  if (savedLang && T[savedLang]) {
    LANG = savedLang;
    // Appliquer la langue sauvegardÃ©e silencieusement
    const t = T[LANG];
    document.getElementById('lang-flag').textContent = LANG.toUpperCase();
    document.getElementById('status-txt').textContent = t.online;
  }
  showLangScreen();
});
</script>
// â”€â”€ Son 3 : impulsion donnÃ©es (caractÃ¨res spÃ©ciaux) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function sndData() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='sawtooth';
    o.frequency.value = 1800 + Math.random()*600;
    const g = _ac.createGain(); g.gain.setValueAtTime(0.05, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.012);
    const lp = _ac.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=4000;
    o.connect(lp); lp.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.013);
  } catch(e){}
}

// â”€â”€ Son 4 : glitch numÃ©rique (rare, surprenant) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function sndGlitch() {
  try {
    _resume(); const t = _ac.currentTime;
    const len = Math.floor(_ac.sampleRate * 0.035);
    const buf = _ac.createBuffer(1, len, _ac.sampleRate);
    const d = buf.getChannelData(0);
    for (let i = 0; i < len; i++) d[i] = (Math.random()*2-1) * (Math.random() > 0.5 ? 0.9 : 0.05);
    const src = _ac.createBufferSource(); src.buffer=buf;
    const bp = _ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=1200; bp.Q.value=2;
    const g = _ac.createGain(); g.gain.value=0.12;
    src.connect(bp); bp.connect(g); g.connect(_ac.destination); src.start(t);
  } catch(e){}
}

// â”€â”€ Son 5 : fin de ligne (souffle court) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function sndLineEnd() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(900, t);
    o.frequency.exponentialRampToValueAtTime(600, t+0.06);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.028, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.07);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.08);
  } catch(e){}
}

// â”€â”€ Son 6 : sÃ©lection / confirmation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function sndSelect() {
  try {
    _resume(); const t = _ac.currentTime;
    [440,660,880].forEach((f,i) => {
      const o = _ac.createOscillator(); o.type='square'; o.frequency.value=f;
      const g = _ac.createGain(); g.gain.setValueAtTime(0.04, t+i*0.06); g.gain.exponentialRampToValueAtTime(0.001, t+i*0.06+0.05);
      o.connect(g); g.connect(_ac.destination); o.start(t+i*0.06); o.stop(t+i*0.06+0.055);
    });
  } catch(e){}
}

// â”€â”€ Son 7 : erreur (buzzer court) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function sndError() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='square'; o.frequency.value=180;
    const g = _ac.createGain(); g.gain.setValueAtTime(0.07, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.08);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.09);
  } catch(e){}
}

// â”€â”€ Son 8 : chime KITT (sweep descendant) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function kittChime() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(880, t); o.frequency.exponentialRampToValueAtTime(220, t+0.35);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.1, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.4);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.4);
  } catch(e){}
}

// â”€â”€ Dispatch : choisit le bon son par caractÃ¨re â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SPECIAL_CHARS = new Set([...'[]():=|â”€â•â•â•”â•—â•šâ•â•‘â”Œâ”â””â”˜â”œâ”¤â€¢â˜…â˜…']);
let _charCount = 0;

function playChar(ch) {
  if (ch === ' ' || ch === '\n') return;
  _charCount++;
  const r = Math.random();
  if (SPECIAL_CHARS.has(ch)) { sndData(); return; }
  if (_charCount % 47 === 0) { sndGlitch(); return; }  // glitch rare
  if (r < 0.03) { sndGlitch(); return; }
  if (r < 0.14) { sndTick();   return; }
  if (r < 0.72) { sndClick();  return; }
  // ~28% silence = variÃ©tÃ© naturelle
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LANGUE â€” SystÃ¨me de localisation
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let LANG = 'fr';

const T = {
  fr: {
    hdr_title:    'KITT FRANCO-BELGE // INTERFACE CENTRALE',
    placeholder:  'entrez une commande...',
    btn_boot:     '[ INITIALISER ]',
    btn_diag:     '[ DIAGNOSTIC ]',
    btn_mentions: '[ MENTIONS ]',
    btn_licence:  '[ LICENCE ]',
    btn_clear:    '[ EFFACER ]',
    btn_tunnel:   '[ CONNEXION KITT ]',
    modal_mentions:'MENTIONS LÃ‰GALES',
    modal_licence: 'LICENCE',
    wait:       'SYSTÃˆME EN ATTENTE â€” TAPEZ "boot" OU CLIQUEZ [ INITIALISER ]',
    help_hint:  'TAPEZ "aide" POUR LA LISTE DES COMMANDES.',
    cleared:    'TERMINAL EFFACÃ‰.',
    unknown:    (c) => `COMMANDE INCONNUE : "${c}". TAPEZ "aide".`,
    online:     'EN LIGNE',
    boot_title: '  KITT FRANCO-BELGE â€” SÃ‰QUENCE DE BOOT   ',
    boot_lines: [
      ['INITIALISATION DU NOYAU SYSTÃˆME...', 'line-warn'],
      ['CHARGEMENT MODULES COGNITIFS...    [OK]', 'line-ok'],
      ['INTERFACE NEURONALE...             [OK]', 'line-ok'],
      ['SYNTHÃˆSE VOCALE (PIPER-GPU)...     [OK]', 'line-ok'],
      ['RECONNAISSANCE VOCALE (WHISPER)... [OK]', 'line-ok'],
      ['MODÃˆLE LLM EMBARQUÃ‰ (QWEN 3B)...  [OK]', 'line-ok'],
      ['MODE HORS-LIGNE...                 [ACTIVÃ‰]', 'line-ok'],
      ['', 'line-ok'],
      ['PROJET FAN NON COMMERCIAL.', 'line-dim'],
      ['STATUT : INTERFACE EN CONSTRUCTION ACTIVE.', 'line-warn'],
      ['', 'line-ok'],
      ['MISES Ã€ JOUR DÃ‰PLOYÃ‰ES RÃ‰GULIÃˆREMENT :', 'line-info'],
      ['  â€¢ parfois chaque jour', 'line-dim'],
      ['  â€¢ parfois chaque semaine', 'line-dim'],
      ['  â€¢ lors de certaines phases, presque heure par heure', 'line-dim'],
      ['', 'line-ok'],
      ['Â© 2026 EMMANUEL GELINNE (MANIX). TOUS DROITS RÃ‰SERVÃ‰S.', 'line-warn'],
    ],
    boot_end:   '  CONNEXION AU NOYAU KITT Ã‰TABLIE.',
    boot_hint:  '  TAPEZ "aide" POUR LA LISTE DES COMMANDES',
    aide_title: 'COMMANDES DISPONIBLES :',
    aide_sys:   'â”€â”€ SYSTÃˆME â”€â”€',
    aide_fun:   'â”€â”€ FUN â”€â”€',
    cmds_sys: [
      ['aide',       'cette liste'],
      ['boot',       "sÃ©quence d'initialisation"],
      ['diagnostic', 'test complet des systÃ¨mes'],
      ['status',     'Ã©tat rapide'],
      ['heure',      'heure actuelle'],
      ['version',    "version de l'interface"],
      ['son',        'dÃ©mo audio'],
      ['clear',      'efface le terminal'],
    ],
    cmds_fun: [
      ['bonjour',    'salutation KITT'],
      ['blague',     'blague KITT alÃ©atoire'],
      ['alien',      'connexion MU-TH-UR 6000'],
      ['matrix',     'le lapin blanc'],
      ['kitt',       'fiche identitÃ© KITT'],
      ['manix',      'dossier conducteur'],
      ['cedric',     'dossier Cedric Momo Rider'],
      ['kr95',       'dossier KR95'],
      ['repliques',  'les rÃ©pliques franco-belges'],
      ['secret',     'fichier classifiÃ©...'],
      ['cafe',       'demander un cafÃ© Ã  KITT'],
      ['belgique',   'analyse gÃ©opolitique'],
      ['jarvis',     'appel vers Stark Tower'],
      ['mario',      'dossier Mario Ravasi / IoT'],
      ['za',         'dossier ZA Elettronica'],
      ['pascal',     'dossier K Industrie'],
      ['daemon',     'dossier Daemon Paule'],
      ['geoffrey',   'dossier Geoffrey'],
      ['covid',      'origine du projet â€” confinement 2020'],
    ],
    hi:  'BONJOUR. JE SUIS KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'SYSTÃˆME FRANCO-BELGE DÃ‰VELOPPÃ‰ PAR MANIX.',
    hi3: 'Ã€ VOTRE SERVICE.',
  },
  en: {
    hdr_title:    'KITT FRANCO-BELGIAN // CENTRAL INTERFACE',
    placeholder:  'enter a command...',
    btn_boot:     '[ INITIALIZE ]',
    btn_diag:     '[ DIAGNOSTIC ]',
    btn_mentions: '[ MENTIONS ]',
    btn_licence:  '[ LICENSE ]',
    btn_clear:    '[ CLEAR ]',
    btn_tunnel:   '[ CONNECT KITT ]',
    modal_mentions:'LEGAL NOTICES',
    modal_licence: 'LICENSE',
    wait:       'SYSTEM STANDBY â€” TYPE "boot" OR CLICK [ INITIALIZE ]',
    help_hint:  'TYPE "help" FOR THE LIST OF COMMANDS.',
    cleared:    'TERMINAL CLEARED.',
    unknown:    (c) => `UNKNOWN COMMAND: "${c}". TYPE "help".`,
    online:     'ONLINE',
    boot_title: '  KITT FRANCO-BELGE â€” BOOT SEQUENCE        ',
    boot_lines: [
      ['INITIALIZING CORE SYSTEM...', 'line-warn'],
      ['LOADING COGNITIVE MODULES...       [OK]', 'line-ok'],
      ['NEURAL INTERFACE...                [OK]', 'line-ok'],
      ['VOICE SYNTHESIS (PIPER-GPU)...     [OK]', 'line-ok'],
      ['VOICE RECOGNITION (WHISPER)...     [OK]', 'line-ok'],
      ['EMBEDDED LLM (QWEN 3B)...          [OK]', 'line-ok'],
      ['OFFLINE MODE...                    [ACTIVE]', 'line-ok'],
      ['', 'line-ok'],
      ['FAN PROJECT â€” NON COMMERCIAL.', 'line-dim'],
      ['STATUS : INTERFACE UNDER ACTIVE CONSTRUCTION.', 'line-warn'],
      ['', 'line-ok'],
      ['UPDATES DEPLOYED REGULARLY :', 'line-info'],
      ['  â€¢ sometimes every day', 'line-dim'],
      ['  â€¢ sometimes every week', 'line-dim'],
      ['  â€¢ during some phases, almost hour by hour', 'line-dim'],
      ['', 'line-ok'],
      ['Â© 2026 EMMANUEL GELINNE (MANIX). ALL RIGHTS RESERVED.', 'line-warn'],
    ],
    boot_end:   '  CONNECTION TO KITT CORE ESTABLISHED.',
    boot_hint:  '  TYPE "help" FOR THE COMMAND LIST',
    aide_title: 'AVAILABLE COMMANDS:',
    aide_sys:   'â”€â”€ SYSTEM â”€â”€',
    aide_fun:   'â”€â”€ FUN â”€â”€',
    cmds_sys: [
      ['help',       'this list'],
      ['boot',       'boot sequence'],
      ['diagnostic', 'full system test'],
      ['status',     'quick status'],
      ['time',       'current time'],
      ['version',    'interface version'],
      ['sound',      'audio demo'],
      ['clear',      'clear terminal'],
    ],
    cmds_fun: [
      ['hello',      'KITT greeting'],
      ['joke',       'random KITT joke'],
      ['alien',      'MU-TH-UR 6000 connection'],
      ['matrix',     'the white rabbit'],
      ['kitt',       'KITT identity file'],
      ['manix',      'driver file'],
      ['cedric',     'Cedric Momo Rider file'],
      ['kr95',       'KR95 file'],
      ['replicas',   'the franco-belgian replicas'],
      ['secret',     'classified file...'],
      ['coffee',     'ask KITT for a coffee'],
      ['belgium',    'geopolitical analysis'],
      ['jarvis',     'call to Stark Tower'],
      ['mario',      'Mario Ravasi / IoT file'],
      ['za',         'ZA Elettronica file'],
      ['pascal',     'K Industrie file'],
      ['daemon',     'Daemon Paule file'],
      ['geoffrey',   'Geoffrey file'],
      ['covid',      'project origin â€” lockdown 2020'],
    ],
    hi:  'HELLO. I AM KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'FRANCO-BELGIAN SYSTEM DEVELOPED BY MANIX.',
    hi3: 'AT YOUR SERVICE.',
  },
  nl: {
    hdr_title:    'KITT FRANCO-BELGISCH // CENTRALE INTERFACE',
    placeholder:  'voer een commando in...',
    btn_boot:     '[ OPSTARTEN ]',
    btn_diag:     '[ DIAGNOSE ]',
    btn_mentions: '[ VERMELDINGEN ]',
    btn_licence:  '[ LICENTIE ]',
    btn_clear:    '[ WISSEN ]',
    btn_tunnel:   '[ VERBIND KITT ]',
    modal_mentions:'WETTELIJKE VERMELDINGEN',
    modal_licence: 'LICENTIE',
    wait:       'SYSTEEM WACHT â€” TYP "boot" OF KLIK [ OPSTARTEN ]',
    help_hint:  'TYP "hulp" VOOR DE COMMANDOLIJST.',
    cleared:    'TERMINAL GEWIST.',
    unknown:    (c) => `ONBEKEND COMMANDO: "${c}". TYP "hulp".`,
    online:     'ONLINE',
    boot_title: '  KITT FRANCO-BELGE â€” OPSTARTSEQUENTIE     ',
    boot_lines: [
      ['KERNSYSTEEM INITIALISEREN...', 'line-warn'],
      ['COGNITIEVE MODULES LADEN...        [OK]', 'line-ok'],
      ['NEURALE INTERFACE...               [OK]', 'line-ok'],
      ['SPRAAKSYNTHESE (PIPER-GPU)...      [OK]', 'line-ok'],
      ['STEMHERKENNING (WHISPER)...        [OK]', 'line-ok'],
      ['EMBEDDED LLM (QWEN 3B)...          [OK]', 'line-ok'],
      ['OFFLINE MODUS...                   [ACTIEF]', 'line-ok'],
      ['', 'line-ok'],
      ['FAN PROJECT â€” NIET COMMERCIEEL.', 'line-dim'],
      ['STATUS : INTERFACE IN ACTIEVE CONSTRUCTIE.', 'line-warn'],
      ['', 'line-ok'],
      ['UPDATES REGELMATIG UITGEROLD :', 'line-info'],
      ['  â€¢ soms elke dag', 'line-dim'],
      ['  â€¢ soms elke week', 'line-dim'],
      ['  â€¢ soms elk uur', 'line-dim'],
      ['', 'line-ok'],
      ['Â© 2026 EMMANUEL GELINNE (MANIX). ALLE RECHTEN VOORBEHOUDEN.', 'line-warn'],
    ],
    boot_end:   '  VERBINDING MET KITT-KERN TOT STAND GEBRACHT.',
    boot_hint:  '  TYP "hulp" VOOR DE COMMANDOLIJST',
    aide_title: 'BESCHIKBARE COMMANDO\'S:',
    aide_sys:   'â”€â”€ SYSTEEM â”€â”€',
    aide_fun:   'â”€â”€ PLEZIER â”€â”€',
    cmds_sys: [
      ['hulp',       'deze lijst'],
      ['boot',       'opstartsequentie'],
      ['diagnostic', 'volledig systeemtest'],
      ['status',     'snelle status'],
      ['tijd',       'huidige tijd'],
      ['versie',     'interface versie'],
      ['geluid',     'audio demo'],
      ['clear',      'terminal wissen'],
    ],
    cmds_fun: [
      ['hallo',      'KITT begroeting'],
      ['grap',       'willekeurige KITT grap'],
      ['alien',      'MU-TH-UR 6000 verbinding'],
      ['matrix',     'het witte konijn'],
      ['kitt',       'KITT identiteitsbestand'],
      ['manix',      'bestuurdersdossier'],
      ['cedric',     'Cedric Momo Rider dossier'],
      ['kr95',       'KR95 dossier'],
      ['replicas',   'de franco-belgische replica\'s'],
      ['geheim',     'geheim bestand...'],
      ['koffie',     'KITT om koffie vragen'],
      ['belgie',     'geopolitieke analyse'],
      ['jarvis',     'oproep naar Stark Tower'],
      ['mario',      'Mario Ravasi / IoT dossier'],
      ['za',         'ZA Elettronica dossier'],
      ['pascal',     'K Industrie dossier'],
      ['daemon',     'Daemon Paule dossier'],
      ['geoffrey',   'Geoffrey dossier'],
      ['covid',      'projectoorsprong â€” lockdown 2020'],
    ],
    hi:  'HALLO. IK BEN KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'FRANCO-BELGISCH SYSTEEM ONTWIKKELD DOOR MANIX.',
    hi3: 'TOT UW DIENST.',
  },

  it: {
    hdr_title:    'KITT FRANCO-BELGA // INTERFACCIA CENTRALE',
    placeholder:  'inserisci un comando...',
    btn_boot:     '[ INIZIALIZZA ]',
    btn_diag:     '[ DIAGNOSI ]',
    btn_mentions: '[ MENZIONI ]',
    btn_licence:  '[ LICENZA ]',
    btn_clear:    '[ CANCELLA ]',
    btn_tunnel:   '[ CONNETTI KITT ]',
    modal_mentions:'NOTE LEGALI',
    modal_licence: 'LICENZA',
    wait:       'SISTEMA IN ATTESA â€” DIGITA "boot" O CLICCA [ INIZIALIZZA ]',
    help_hint:  'DIGITA "aiuto" PER LA LISTA DEI COMANDI.',
    cleared:    'TERMINALE CANCELLATO.',
    unknown:    (c) => `COMANDO SCONOSCIUTO: "${c}". DIGITA "aiuto".`,
    online:     'IN LINEA',
    boot_title: '  KITT FRANCO-BELGA â€” SEQUENZA DI AVVIO     ',
    boot_lines: [
      ['INIZIALIZZAZIONE SISTEMA...', 'line-warn'],
      ['CARICAMENTO MODULI COGNITIVI...    [OK]', 'line-ok'],
      ['INTERFACCIA NEURALE...             [OK]', 'line-ok'],
      ['SINTESI VOCALE (PIPER-GPU)...      [OK]', 'line-ok'],
      ['RICONOSCIMENTO VOCALE (WHISPER)... [OK]', 'line-ok'],
      ['MODELLO LLM LOCALE (QWEN 3B)...   [OK]', 'line-ok'],
      ['MODALITÃ€ OFFLINE...                [ATTIVA]', 'line-ok'],
      ['', 'line-ok'],
      ['PROGETTO FAN â€” NON COMMERCIALE.', 'line-dim'],
      ['STATO : INTERFACCIA IN COSTRUZIONE ATTIVA.', 'line-warn'],
      ['', 'line-ok'],
      ['AGGIORNAMENTI DISTRIBUITI REGOLARMENTE :', 'line-info'],
      ['  â€¢ a volte ogni giorno', 'line-dim'],
      ['  â€¢ a volte ogni settimana', 'line-dim'],
      ['  â€¢ in alcune fasi, quasi ogni ora', 'line-dim'],
      ['', 'line-ok'],
      ['Â© 2026 EMMANUEL GELINNE (MANIX). TUTTI I DIRITTI RISERVATI.', 'line-warn'],
    ],
    boot_end:   '  CONNESSIONE AL NUCLEO KITT STABILITA.',
    boot_hint:  '  DIGITA "aiuto" PER LA LISTA DEI COMANDI',
    aide_title: 'COMANDI DISPONIBILI:',
    aide_sys:   'â”€â”€ SISTEMA â”€â”€',
    aide_fun:   'â”€â”€ DIVERTIMENTO â”€â”€',
    cmds_sys: [
      ['aiuto',      'questa lista'],
      ['boot',       'sequenza di avvio'],
      ['diagnostic', 'test completo del sistema'],
      ['status',     'stato rapido'],
      ['ora',        'ora corrente'],
      ['version',    'versione interfaccia'],
      ['suono',      'demo audio'],
      ['clear',      'cancella terminale'],
    ],
    cmds_fun: [
      ['ciao',       'saluto KITT'],
      ['barzelletta', 'barzelletta casuale KITT'],
      ['alien',      'connessione MU-TH-UR 6000'],
      ['matrix',     'il coniglio bianco'],
      ['kitt',       'scheda identitÃ  KITT'],
      ['manix',      'dossier pilota'],
      ['cedric',     'dossier Cedric Momo Rider'],
      ['kr95',       'dossier KR95'],
      ['replicas',   'le repliche franco-belghe'],
      ['segreto',    'file classificato...'],
      ['caffe',      'chiedere un caffÃ¨ a KITT'],
      ['belgio',     'analisi geopolitica'],
      ['jarvis',     'chiamata verso Stark Tower'],
      ['mario',      'dossier Mario Ravasi / IoT'],
      ['za',         'dossier ZA Elettronica'],
      ['pascal',     'dossier K Industrie'],
      ['daemon',     'dossier Daemon Paule'],
      ['geoffrey',   'dossier Geoffrey'],
      ['covid',      'origine del progetto â€” lockdown 2020'],
    ],
    hi:  'CIAO. SONO KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'SISTEMA FRANCO-BELGA SVILUPPATO DA MANIX.',
    hi3: 'AL VOSTRO SERVIZIO.',
  },

  de: {
    hdr_title:    'KITT FRANCO-BELGISCH // ZENTRALE SCHNITTSTELLE',
    placeholder:  'Befehl eingeben...',
    btn_boot:     '[ INITIALISIEREN ]',
    btn_diag:     '[ DIAGNOSE ]',
    btn_mentions: '[ IMPRESSUM ]',
    btn_licence:  '[ LIZENZ ]',
    btn_clear:    '[ LÃ–SCHEN ]',
    btn_tunnel:   '[ KITT VERBINDEN ]',
    modal_mentions:'IMPRESSUM',
    modal_licence: 'LIZENZ',
    wait:       'SYSTEM BEREIT â€” TIPPE "boot" ODER KLICKE [ INITIALISIEREN ]',
    help_hint:  'TIPPE "hilfe" FÃœR DIE BEFEHLSLISTE.',
    cleared:    'TERMINAL GELEERT.',
    unknown:    (c) => `UNBEKANNTER BEFEHL: "${c}". TIPPE "hilfe".`,
    online:     'ONLINE',
    boot_title: '  KITT FRANCO-BELGISCH â€” STARTSEQUENZ        ',
    boot_lines: [
      ['KERNSYSTEM WIRD INITIALISIERT...', 'line-warn'],
      ['KOGNITIVE MODULE LADEN...          [OK]', 'line-ok'],
      ['NEURONALE SCHNITTSTELLE...         [OK]', 'line-ok'],
      ['SPRACHSYNTHESE (PIPER-GPU)...      [OK]', 'line-ok'],
      ['SPRACHERKENNUNG (WHISPER)...       [OK]', 'line-ok'],
      ['LOKALES LLM (QWEN 3B)...           [OK]', 'line-ok'],
      ['OFFLINE-MODUS...                   [AKTIV]', 'line-ok'],
      ['', 'line-ok'],
      ['FAN-PROJEKT â€” NICHT KOMMERZIELL.', 'line-dim'],
      ['STATUS : SCHNITTSTELLE IM AUFBAU.', 'line-warn'],
      ['', 'line-ok'],
      ['UPDATES REGELMÃ„SSIG VERFÃœGBAR :', 'line-info'],
      ['  â€¢ manchmal tÃ¤glich', 'line-dim'],
      ['  â€¢ manchmal wÃ¶chentlich', 'line-dim'],
      ['  â€¢ manchmal stÃ¼ndlich', 'line-dim'],
      ['', 'line-ok'],
      ['Â© 2026 EMMANUEL GELINNE (MANIX). ALLE RECHTE VORBEHALTEN.', 'line-warn'],
    ],
    boot_end:   '  VERBINDUNG ZUM KITT-KERN HERGESTELLT.',
    boot_hint:  '  TIPPE "hilfe" FÃœR DIE BEFEHLSLISTE',
    aide_title: 'VERFÃœGBARE BEFEHLE:',
    aide_sys:   'â”€â”€ SYSTEM â”€â”€',
    aide_fun:   'â”€â”€ SPASS â”€â”€',
    cmds_sys: [
      ['hilfe',      'diese Liste'],
      ['boot',       'Startsequenz'],
      ['diagnostic', 'vollstÃ¤ndiger Systemtest'],
      ['status',     'schneller Status'],
      ['uhrzeit',    'aktuelle Uhrzeit'],
      ['version',    'Schnittstellenversion'],
      ['ton',        'Audio-Demo'],
      ['clear',      'Terminal leeren'],
    ],
    cmds_fun: [
      ['hallo',      'KITT-BegrÃ¼ÃŸung'],
      ['witz',       'zufÃ¤lliger KITT-Witz'],
      ['alien',      'MU-TH-UR 6000 Verbindung'],
      ['matrix',     'das weiÃŸe Kaninchen'],
      ['kitt',       'KITT IdentitÃ¤tsakte'],
      ['manix',      'Fahrerakte'],
      ['cedric',     'Cedric Momo Rider Akte'],
      ['kr95',       'KR95 Akte'],
      ['replicas',   'die franco-belgischen Repliken'],
      ['geheimnis',  'geheime Akte...'],
      ['kaffee',     'KITT um Kaffee bitten'],
      ['belgien',    'geopolitische Analyse'],
      ['jarvis',     'Anruf bei Stark Tower'],
      ['mario',      'Mario Ravasi / IoT Akte'],
      ['za',         'ZA Elettronica Akte'],
      ['pascal',     'K Industrie Akte'],
      ['damon',      'Damon Paule Akte'],
      ['geoffrey',   'Geoffrey Akte'],
      ['covid',      'Projektherkunft â€” Lockdown 2020'],
    ],
    hi:  'HALLO. ICH BIN KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'FRANCO-BELGISCHES SYSTEM ENTWICKELT VON MANIX.',
    hi3: 'ZU IHREN DIENSTEN.',
  },

  es: {
    hdr_title:    'KITT FRANCO-BELGA // INTERFAZ CENTRAL',
    placeholder:  'escribe un comando...',
    btn_boot:     '[ INICIALIZAR ]',
    btn_diag:     '[ DIAGNÃ“STICO ]',
    btn_mentions: '[ MENCIONES ]',
    btn_licence:  '[ LICENCIA ]',
    btn_clear:    '[ BORRAR ]',
    btn_tunnel:   '[ CONECTAR KITT ]',
    modal_mentions:'AVISOS LEGALES',
    modal_licence: 'LICENCIA',
    wait:       'SISTEMA EN ESPERA â€” ESCRIBE "boot" O HAZ CLIC EN [ INICIALIZAR ]',
    help_hint:  'ESCRIBE "ayuda" PARA VER LOS COMANDOS.',
    cleared:    'TERMINAL BORRADO.',
    unknown:    (c) => `COMANDO DESCONOCIDO: "${c}". ESCRIBE "ayuda".`,
    online:     'EN LÃNEA',
    boot_title: '  KITT FRANCO-BELGA â€” SECUENCIA DE INICIO   ',
    boot_lines: [
      ['INICIALIZANDO SISTEMA...', 'line-warn'],
      ['CARGANDO MÃ“DULOS COGNITIVOS...     [OK]', 'line-ok'],
      ['INTERFAZ NEURONAL...               [OK]', 'line-ok'],
      ['SÃNTESIS DE VOZ (PIPER-GPU)...     [OK]', 'line-ok'],
      ['RECONOCIMIENTO DE VOZ (WHISPER)... [OK]', 'line-ok'],
      ['MODELO LLM LOCAL (QWEN 3B)...      [OK]', 'line-ok'],
      ['MODO SIN CONEXIÃ“N...               [ACTIVO]', 'line-ok'],
      ['', 'line-ok'],
      ['PROYECTO FAN â€” NO COMERCIAL.', 'line-dim'],
      ['ESTADO : INTERFAZ EN CONSTRUCCIÃ“N ACTIVA.', 'line-warn'],
      ['', 'line-ok'],
      ['ACTUALIZACIONES PUBLICADAS REGULARMENTE :', 'line-info'],
      ['  â€¢ a veces cada dÃ­a', 'line-dim'],
      ['  â€¢ a veces cada semana', 'line-dim'],
      ['  â€¢ a veces cada hora', 'line-dim'],
      ['', 'line-ok'],
      ['Â© 2026 EMMANUEL GELINNE (MANIX). TODOS LOS DERECHOS RESERVADOS.', 'line-warn'],
    ],
    boot_end:   '  CONEXIÃ“N AL NÃšCLEO KITT ESTABLECIDA.',
    boot_hint:  '  ESCRIBE "ayuda" PARA VER LOS COMANDOS',
    aide_title: 'COMANDOS DISPONIBLES:',
    aide_sys:   'â”€â”€ SISTEMA â”€â”€',
    aide_fun:   'â”€â”€ DIVERSIÃ“N â”€â”€',
    cmds_sys: [
      ['ayuda',      'esta lista'],
      ['boot',       'secuencia de inicio'],
      ['diagnostic', 'prueba completa del sistema'],
      ['status',     'estado rÃ¡pido'],
      ['hora',       'hora actual'],
      ['version',    'versiÃ³n de la interfaz'],
      ['sonido',     'demo de audio'],
      ['clear',      'borrar terminal'],
    ],
    cmds_fun: [
      ['hola',       'saludo KITT'],
      ['chiste',     'chiste aleatorio KITT'],
      ['alien',      'conexiÃ³n MU-TH-UR 6000'],
      ['matrix',     'el conejo blanco'],
      ['kitt',       'ficha de identidad KITT'],
      ['manix',      'expediente del conductor'],
      ['cedric',     'expediente Cedric Momo Rider'],
      ['kr95',       'expediente KR95'],
      ['replicas',   'las rÃ©plicas franco-belgas'],
      ['secreto',    'archivo clasificado...'],
      ['cafe',       'pedir cafÃ© a KITT'],
      ['belgica',    'anÃ¡lisis geopolÃ­tico'],
      ['jarvis',     'llamada a Stark Tower'],
      ['mario',      'expediente Mario Ravasi / IoT'],
      ['za',         'expediente ZA Elettronica'],
      ['pascal',     'expediente K Industrie'],
      ['damon',      'expediente Damon Paule'],
      ['geoffrey',   'expediente Geoffrey'],
      ['covid',      'origen del proyecto â€” confinamiento 2020'],
    ],
    hi:  'HOLA. SOY KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'SISTEMA FRANCO-BELGA DESARROLLADO POR MANIX.',
    hi3: 'A SU SERVICIO.',
  },

  pt: {
    hdr_title:    'KITT FRANCO-BELGA // INTERFACE CENTRAL',
    placeholder:  'introduz um comando...',
    btn_boot:     '[ INICIALIZAR ]',
    btn_diag:     '[ DIAGNÃ“STICO ]',
    btn_mentions: '[ MENÃ‡Ã•ES ]',
    btn_licence:  '[ LICENÃ‡A ]',
    btn_clear:    '[ LIMPAR ]',
    btn_tunnel:   '[ LIGAR KITT ]',
    modal_mentions:'AVISOS LEGAIS',
    modal_licence: 'LICENÃ‡A',
    wait:       'SISTEMA EM ESPERA â€” DIGITE "boot" OU CLIQUE EM [ INICIALIZAR ]',
    help_hint:  'DIGITE "ajuda" PARA VER OS COMANDOS.',
    cleared:    'TERMINAL LIMPO.',
    unknown:    (c) => `COMANDO DESCONHECIDO: "${c}". DIGITE "ajuda".`,
    online:     'EM LINHA',
    boot_title: '  KITT FRANCO-BELGA â€” SEQUÃŠNCIA DE ARRANQUE  ',
    boot_lines: [
      ['A INICIALIZAR O SISTEMA...', 'line-warn'],
      ['A CARREGAR MÃ“DULOS COGNITIVOS...   [OK]', 'line-ok'],
      ['INTERFACE NEURONAL...              [OK]', 'line-ok'],
      ['SÃNTESE DE VOZ (PIPER-GPU)...      [OK]', 'line-ok'],
      ['RECONHECIMENTO DE VOZ (WHISPER)... [OK]', 'line-ok'],
      ['MODELO LLM LOCAL (QWEN 3B)...      [OK]', 'line-ok'],
      ['MODO OFFLINE...                    [ATIVO]', 'line-ok'],
      ['', 'line-ok'],
      ['PROJETO FÃƒ â€” NÃƒO COMERCIAL.', 'line-dim'],
      ['ESTADO : INTERFACE EM CONSTRUÃ‡ÃƒO ATIVA.', 'line-warn'],
      ['', 'line-ok'],
      ['ATUALIZAÃ‡Ã•ES PUBLICADAS REGULARMENTE :', 'line-info'],
      ['  â€¢ Ã s vezes todos os dias', 'line-dim'],
      ['  â€¢ Ã s vezes semanalmente', 'line-dim'],
      ['  â€¢ Ã s vezes de hora em hora', 'line-dim'],
      ['', 'line-ok'],
      ['Â© 2026 EMMANUEL GELINNE (MANIX). TODOS OS DIREITOS RESERVADOS.', 'line-warn'],
    ],
    boot_end:   '  LIGAÃ‡ÃƒO AO NÃšCLEO KITT ESTABELECIDA.',
    boot_hint:  '  DIGITE "ajuda" PARA VER OS COMANDOS',
    aide_title: 'COMANDOS DISPONÃVEIS:',
    aide_sys:   'â”€â”€ SISTEMA â”€â”€',
    aide_fun:   'â”€â”€ DIVERSÃƒO â”€â”€',
    cmds_sys: [
      ['ajuda',      'esta lista'],
      ['boot',       'sequÃªncia de arranque'],
      ['diagnostic', 'teste completo do sistema'],
      ['status',     'estado rÃ¡pido'],
      ['hora',       'hora atual'],
      ['version',    'versÃ£o da interface'],
      ['som',        'demonstraÃ§Ã£o de Ã¡udio'],
      ['clear',      'limpar terminal'],
    ],
    cmds_fun: [
      ['ola',        'saudaÃ§Ã£o KITT'],
      ['piada',      'piada aleatÃ³ria KITT'],
      ['alien',      'ligaÃ§Ã£o MU-TH-UR 6000'],
      ['matrix',     'o coelho branco'],
      ['kitt',       'ficha de identidade KITT'],
      ['manix',      'dossier do condutor'],
      ['cedric',     'dossier Cedric Momo Rider'],
      ['kr95',       'dossier KR95'],
      ['replicas',   'as rÃ©plicas franco-belgas'],
      ['segredo',    'ficheiro classificado...'],
      ['cafe',       'pedir cafÃ© ao KITT'],
      ['belgica',    'anÃ¡lise geopolÃ­tica'],
      ['jarvis',     'chamada para Stark Tower'],
      ['mario',      'dossier Mario Ravasi / IoT'],
      ['za',         'dossier ZA Elettronica'],
      ['pascal',     'dossier K Industrie'],
      ['damon',      'dossier Damon Paule'],
      ['geoffrey',   'dossier Geoffrey'],
      ['covid',      'origem do projeto â€” confinamento 2020'],
    ],
    hi:  'OLÃ. SOU O KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'SISTEMA FRANCO-BELGA DESENVOLVIDO POR MANIX.',
    hi3: 'AO SEU SERVIÃ‡O.',
  },
};

// Alias multilingues
const CMD_ALIASES = {
  // EN
  help:'aide', sound:'son', hello:'bonjour', joke:'blague',
  time:'heure', coffee:'cafe', belgium:'belgique', replicas:'repliques',
  secret:'secret', version:'version', clear:'clear', status:'status',
  diagnostic:'diagnostic', boot:'boot', alien:'alien', matrix:'matrix',
  kitt:'kitt', manix:'manix', cedric:'cedric', kr95:'kr95',
  jarvis:'jarvis', mario:'mario', za:'za', pascal:'pascal', geoffrey:'geoffrey',
  // NL
  hulp:'aide', geluid:'son', hallo:'bonjour', grap:'blague',
  tijd:'heure', versie:'version', koffie:'cafe', belgie:'belgique',
  geheim:'secret', klik:'boot',
  // IT
  aiuto:'aide', suono:'son', ciao:'bonjour', barzelletta:'blague',
  ora:'heure', caffe:'cafe', belgio:'belgique', segreto:'secret',
  // DE
  hilfe:'aide', ton:'son', witz:'blague', uhrzeit:'heure',
  kaffee:'cafe', belgien:'belgique', geheimnis:'secret',
  // Noms personnes â€” ZA â‰  Mario Ravasi !
  ravasi:'mario', roadthunder:'mario',
  zagny:'za', zagni:'za', 'za-elettronica':'za', zaelettronica:'za',
  damon:'damon', daemon:'damon',
  // ES
  ayuda:'aide', sonido:'son', hola:'bonjour', chiste:'blague',
  hora:'heure', belgica:'belgique', secreto:'secret',
  // PT
  ajuda:'aide', som:'son', ola:'bonjour', piada:'blague',
  segredo:'secret',
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SÃ‰LECTION DE LANGUE â€” style MU-TH-UR 1979
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _langTyping = false;

const LANG_LIST = [
  ['1','fr','FRANÃ‡AIS'],
  ['2','en','ENGLISH'],
  ['3','nl','NEDERLANDS'],
  ['4','it','ITALIANO'],
  ['5','de','DEUTSCH'],
  ['6','es','ESPAÃ‘OL'],
  ['7','pt','PORTUGUÃŠS'],
];

async function showLangScreen() {
  const screen = document.getElementById('lang-screen');
  screen.style.display = 'flex';
  screen.style.opacity  = '1';

  // Vider les zones
  ['lang-hdr','lang-sub','lang-output','lang-ftr'].forEach(id => {
    document.getElementById(id).innerHTML = '';
  });

  const hdr = document.getElementById('lang-hdr');
  const sub = document.getElementById('lang-sub');
  const out = document.getElementById('lang-output');
  const ftr = document.getElementById('lang-ftr');

  // â”€â”€ Header tapÃ© caractÃ¨re par caractÃ¨re
  await _langType(hdr, 'MU-TH-UR 6000  //  INTERFACE PROTOCOL v2.1');
  await _langDelay(80);

  // â”€â”€ Sous-titre
  await _langType(sub, 'SELECT INTERFACE LANGUAGE');
  await _langDelay(60);

  // â”€â”€ Options (apparition rapide, une par une)
  for (const [num, code, label] of LANG_LIST) {
    const row = document.createElement('div');
    row.className = 'lang-opt';
    row.dataset.code = code;
    row.innerHTML = `<span class="lo-n">${num}</span><span class="lo-l">${label}</span>`;
    row.addEventListener('click', () => selectLang(code));
       row.addEventListener('mouseenter', () => {
      sndTick();
      speakText(`${num} ${label}`, code);
    });
    out.appendChild(row);
    sndClick();
    await _langDelay(55);
  }

  await _langDelay(80);

  // â”€â”€ Footer avec curseur clignotant
  const ftrTxt = document.createElement('span');
  ftr.appendChild(ftrTxt);
  await _langType(ftrTxt, 'PRESS  [ 1 â€“ 7 ]  OR CLICK');
  const cur = document.createElement('span');
  cur.className = 'cursor';
  cur.style.marginLeft = '4px';
  ftr.appendChild(cur);
}

function _langType(el, txt) {
  return new Promise(resolve => {
    let i = 0;
    function t() {
      if (i < txt.length) {
        el.textContent += txt[i++];
        if (Math.random() > 0.3) sndClick();
        setTimeout(t, 10 + Math.random() * 6);
      } else {
        sndLineEnd();
        resolve();
      }
    }
    t();
  });
}
function _langDelay(ms) { return new Promise(r => setTimeout(r, ms)); }

function selectLang(lang) {
  LANG = lang;
  const t = T[lang];
  document.getElementById('lang-flag').textContent = lang.toUpperCase();
  document.getElementById('status-txt').textContent = t.online;
  document.getElementById('hdr-title').textContent  = t.hdr_title;
  document.getElementById('cmd-input').placeholder  = t.placeholder;
  document.getElementById('btn-boot').textContent    = t.btn_boot;
  document.getElementById('btn-diag').textContent    = t.btn_diag;
  document.getElementById('btn-mentions').textContent= t.btn_mentions;
  document.getElementById('btn-licence').textContent = t.btn_licence;
  document.getElementById('btn-clear').textContent   = t.btn_clear;
  document.getElementById('btn-tunnel-txt').textContent = t.btn_tunnel;
  sndSelect();
  // Cacher l'overlay avec fondu
  const screen = document.getElementById('lang-screen');
  screen.style.transition = 'opacity .5s';
  screen.style.opacity = '0';
  setTimeout(() => { screen.style.display = 'none'; screen.style.opacity = '1'; screen.style.transition = ''; }, 520);
  setTimeout(() => startMain(), 600);
}

// Clavier pour sÃ©lection de langue
document.addEventListener('keydown', e => {
  if (document.getElementById('lang-screen').style.display !== 'none') {
    const langMap = {'1':'fr','2':'en','3':'nl','4':'it','5':'de','6':'es','7':'pt'};
    if (langMap[e.key]) selectLang(langMap[e.key]);
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TERMINAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const term = document.getElementById('terminal');
let typing = false;

function addLine(text, cls='line-ok') {
  const d = document.createElement('div');
  d.className = cls; d.textContent = text;
  term.appendChild(d); term.scrollTop = term.scrollHeight;
}

function typeText(text, speed=16, cls='line-ok') {
  return new Promise(resolve => {
    typing = true;
    const div = document.createElement('div'); div.className = cls;
    const cur = document.createElement('span'); cur.className = 'cursor';
    div.appendChild(cur); term.appendChild(div); term.scrollTop = term.scrollHeight;
    let i = 0;
    function tick() {
      if (i < text.length) {
        const ch = text[i++];
        div.insertBefore(document.createTextNode(ch), cur);
        playChar(ch);
        term.scrollTop = term.scrollHeight;
        setTimeout(tick, speed + Math.random() * 7);
      } else {
        cur.remove();
        if (text.length > 0) sndLineEnd();
        typing = false; resolve();
      }
    }
    tick();
  });
}

function clearTerm() { term.innerHTML=''; addLine(T[LANG].cleared,'line-dim'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BOOT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function boot() {
  if (typing) return;
  term.innerHTML=''; kittChime();
  const l = T[LANG];
  const sep = 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•';
  await typeText(sep, 6, 'line-dim');
  await typeText(l.boot_title, 14, 'line-err');
  await typeText(sep, 6, 'line-dim');
  for (const [txt, cls] of l.boot_lines) {
    await typeText(txt, txt===''?0:12, cls);
    if (txt==='') await delay(60);
  }
  await typeText(sep, 6, 'line-dim');
  await typeText(l.boot_end, 14, 'line-err');
  await typeText(l.boot_hint, 10, 'line-dim');
  await typeText(sep, 6, 'line-dim');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DIAGNOSTIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function runSelfTest() {
  if (typing) return;
  term.innerHTML=''; kittChime();
  const diagMsg = {fr:'DIAGNOSTIC SYSTÃˆME EN COURS...',en:'RUNNING SYSTEM DIAGNOSTIC...',nl:'SYSTEEMDIAGNOSE BEZIG...',it:'DIAGNOSI SISTEMA IN CORSO...',de:'SYSTEMDIAGNOSE LÃ„UFT...',es:'DIAGNÃ“STICO DEL SISTEMA EN CURSO...',pt:'DIAGNÃ“STICO DO SISTEMA EM CURSO...'}[LANG]||'DIAGNOSTIC SYSTÃˆME EN COURS...';
  await typeText(diagMsg, 18, 'line-warn');
  await delay(300);
  const checks = [
    ['CPU JETSON ORIN NANO SUPER',  true,  '12Ã— ARM A78AE'],
    ['GPU AMPERE CUDA',             true,  '1024 CUDA cores'],
    ['RAM UNIFIÃ‰E / UNIFIED RAM',   true,  '8 GB LPDDR5'],
    ['VRAM DISPONIBLE / FREE',      true,  '~4.1 GB'],
    ['LLM (QWEN 2.5 3B Q5)',        true,  '2.3 GB â€” port 8080'],
    ['STT WHISPER BASE',            true,  'GPU float16 â€” 350ms'],
    ['TTS PIPER TOM-MEDIUM',        true,  'GPU â€” 490ms'],
    ['PULSEAUDIO / USB AUDIO',      true,  'card 1 â€” paplay OK'],
    ['YOLOV8 VISION',               true,  'daemon CUDA actif'],
    ['BLUETOOTH hci0',              true,  '58:02:05:DD:C2:F2'],
    ['CAMERA /dev/video0',          true,  'V4L2 â€” 640Ã—480'],
    ['KYRONEX HTTPS SERVER',        true,  'port 3000 â€” aiohttp'],
    ['RESEAU LAN / NETWORK',        true,  '192.168.1.4'],
  ];
  for (const [name, ok, detail] of checks) {
    const st  = ok ? '[ OK ]' : '[FAIL]';
    const cls = ok ? 'line-ok' : 'line-err';
    const pad = ' '.repeat(Math.max(1, 30-name.length));
    await typeText(`${name}${pad}${st}  ${detail}`, 7, cls);
  }
  await delay(200);
  await typeText('', 0);
  const ok_msg = {fr:'RÃ‰SULTAT : TOUS SYSTÃˆMES NOMINAUX.',en:'RESULT: ALL SYSTEMS NOMINAL.',nl:'RESULTAAT : ALLE SYSTEMEN NOMINAAL.',it:'RISULTATO : TUTTI I SISTEMI NOMINALI.',de:'ERGEBNIS: ALLE SYSTEME NOMINAL.',es:'RESULTADO: TODOS LOS SISTEMAS NOMINALES.',pt:'RESULTADO: TODOS OS SISTEMAS NOMINAIS.'}[LANG]||'RÃ‰SULTAT : TOUS SYSTÃˆMES NOMINAUX.';
  const op_msg = {fr:'KITT EST OPÃ‰RATIONNEL.',en:'KITT IS OPERATIONAL.',nl:'KITT IS OPERATIONEEL.',it:'KITT Ãˆ OPERATIVO.',de:'KITT IST BETRIEBSBEREIT.',es:'KITT ESTÃ OPERATIVO.',pt:'KITT ESTÃ OPERACIONAL.'}[LANG]||'KITT EST OPÃ‰RATIONNEL.';
  await typeText(ok_msg, 16, 'line-info');
  await typeText(op_msg, 16, 'line-err');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMMANDES FUN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CMDS = {

  // â”€â”€ aide / help / hulp â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  aide: async () => {
    const l = T[LANG];
    await typeText(l.aide_title, 10, 'line-info');
    await typeText(`  ${l.aide_sys}`, 4, 'line-warn');
    for (const [cmd, desc] of l.cmds_sys) {
      const pad = ' '.repeat(Math.max(1, 12-cmd.length));
      await typeText(`    ${cmd}${pad}â€” ${desc}`, 3, 'line-dim');
    }
    await typeText(`  ${l.aide_fun}`, 4, 'line-warn');
    for (const [cmd, desc] of l.cmds_fun) {
      const pad = ' '.repeat(Math.max(1, 12-cmd.length));
      await typeText(`    ${cmd}${pad}â€” ${desc}`, 3, 'line-dim');
    }
  },

  // â”€â”€ bonjour / hello / hallo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  bonjour: async () => {
    kittChime();
    const l = T[LANG];
    await typeText(l.hi,  16, 'line-err');
    await typeText(l.hi2, 14, 'line-ok');
    await typeText(l.hi3, 14, 'line-dim');
  },

  // â”€â”€ navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  boot:       async () => boot(),
  diagnostic: async () => runSelfTest(),

  status: async () => {
    kittChime();
    const now = new Date(), loc = getLoc();
    await typeText(`HEURE / TIME   : ${now.toLocaleTimeString(loc)}`, 10, 'line-ok');
    await typeText(`DATE           : ${now.toLocaleDateString(loc,{weekday:'long',day:'numeric',month:'long',year:'numeric'})}`, 10, 'line-ok');
    await typeText('VRAM           : ~3.9 GB / 8 GB', 10, 'line-ok');
    await typeText('STATUT / STATUS: NOMINAL', 10, 'line-info');
  },

  heure: async () => {
    const now = new Date(), loc = getLoc();
    const pfx = {fr:'IL EST',en:'IT IS',nl:'HET IS',it:'SONO LE',de:'ES IST',es:'SON LAS',pt:'SÃƒO'}[LANG]||'IL EST';
    await typeText(`${pfx} ${now.toLocaleTimeString(loc)}.`, 14, 'line-info');
  },

  version: async () => {
    await typeText('KITT FRANCO-BELGE â€” INTERFACE v3.0', 12, 'line-err');
    await typeText('BUILD 2026-02-20 â€” KYRONEX TECHNOLOGY', 12, 'line-dim');
    await typeText('ORIGINE : PROJET COVID-19 â€” CONFINEMENT 2020', 12, 'line-warn');
    await typeText('Â© EMMANUEL GELINNE (MANIX) â€” TOUS DROITS RÃ‰SERVÃ‰S', 12, 'line-dim');
  },

  clear: async () => clearTerm(),

  son: async () => {
    kittChime(); await delay(400);
    const demos = [
      [sndClick,  'MU-TH-UR CLICK    (principal)'],
      [sndTick,   'TICK LÃ‰GER        (haute frÃ©q)'],
      [sndData,   'IMPULSION DATA    (caract. spÃ©ciaux)'],
      [sndGlitch, 'GLITCH NUMÃ‰RIQUE  (rare)'],
      [sndLineEnd,'FIN DE LIGNE      (souffle)'],
      [sndSelect, 'SÃ‰LECTION         (confirmation)'],
      [sndError,  'ERREUR            (buzzer)'],
    ];
    await typeText('â”€â”€â”€ DÃ‰MONSTRATION DES SONS â”€â”€â”€', 10, 'line-info');
    for (const [fn, name] of demos) {
      fn();
      await typeText(`  ${name}`, 8, 'line-dim');
      await delay(250);
    }
    await typeText('FIN DE LA DÃ‰MONSTRATION.', 12, 'line-ok');
  },

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // COMMANDES FUN
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  blague: async () => {
    const pool = [
      // Blagues gÃ©nÃ©rales KITT
      ['Pourquoi KITT ne sort jamais la nuit ?',
       'Parce qu\'il a peur du mode sombre.'],
      ['Combien faut-il d\'IA pour changer une ampoule ?',
       'Aucune. L\'ampoule n\'Ã©tait pas dans mes paramÃ¨tres.'],
      ['KITT, tu es intelligent ?',
       'Je suis une IA sur Jetson. OBLIGATOIREMENT intelligent. Contrairement Ã  certains conducteurs.'],
      ['Quelle est la boisson prÃ©fÃ©rÃ©e de KITT ?',
       'Le JAVA. Et uniquement du Python sans cafÃ©ine.'],

      // Blagues sur Manix
      ['Pourquoi Manix parle Ã  son ordinateur ?',
       'Parce que l\'ordinateur, lui, rÃ©pond correctement.'],
      ['Manix a-t-il dormi cette nuit ?',
       'DonnÃ©es insuffisantes. Mais les logs indiquent 37 commits Ã  3h du matin.'],
      ['Manix a gagnÃ© un concours NVIDIA. Ã‡a l\'a changÃ© ?',
       'Il a juste commencÃ© Ã  parler Ã  ses machines en Belge. Elles rÃ©pondent maintenant en wallon.'],

      // Blagues sur Cedric
      ['CÃ©dric prend sa moto pour aller voir son KITT ?',
       'Oui. Et il a Ã©quipÃ© son KITT d\'un klaxon moto. L\'authenticitÃ©, c\'est important.'],
      ['CÃ©dric, c\'est Momo Rider. Il fait des wheelies sur le Pontiac Trans Am ?',
       'Il a essayÃ©. KITT a activÃ© le mode turbo boost. CÃ©dric est encore quelque part sur l\'A12.'],
      ['KITT de CÃ©dric est en rÃ©plique. Comment il se diffÃ©rencie ?',
       'Le vrai KITT parle en anglais. Celui de CÃ©dric dit "Wesh Michael" et fait des ronds de roues.'],

      // Blagues sur KR95
      ['KR95 a une rÃ©plique KITT. Il communique avec toi ?',
       'En morse. Son indicatif radio c\'est KR95. Je rÃ©ponds en 1200 bauds. C\'est du grand art.'],
      ['KR95 est radioamateur. Ã‡a aide pour son KITT ?',
       'Il a branchÃ© son antenne VHF sur KITT. Maintenant mon compteur de vitesse capte RTL-SDR.'],
      ['KR95 fait quoi quand son KITT bug ?',
       'Il envoie un QSL card Ã  la panne. Et il attend la confirmation en papier. Ã€ l\'ancienne.'],

      // Blagues sur Mario Ravasi â€” RoadThunderStorm / IoT KITT
      ['Mario Ravasi a fait un systÃ¨me IoT pour KITT. C\'est quoi exactement ?',
       'KNIGHT2000 Thunder. ContrÃ´le vocal, tableau de bord interactif, multi-Ã©crans. Il a fait Ã§a depuis 2008. KITT est impressionnÃ©. Et KITT est difficile Ã  impressionner.'],
      ['Mario Ravasi a Ã©tÃ© citÃ© par le designer original de KITT. Ã‡a l\'a changÃ© ?',
       'Non. Il a juste continuÃ© Ã  coder. C\'est un italien passionnÃ©. Le compliment c\'Ã©tait pour lui la mise Ã  jour du README.'],
      ['Le logiciel de Mario coÃ»te 15 euros de base. Pourquoi si peu ?',
       'Parce qu\'il est passionnÃ©, pas vendeur. Weyland-Yutani aurait demandÃ© 15 000$. Et l\'Ã©quipage aurait quand mÃªme Ã©tÃ© expendable.'],

      // Blagues sur Alessandro Zagny â€” ZA Elettronica
      ['Alessandro Zagny a crÃ©Ã© ZA Elettronica. Pourquoi ?',
       'Parce qu\'aucun tableau de bord KITT du marchÃ© ne le satisfaisait. Il a donc fait le sien. Ã€ ModÃ¨ne. Avec 4 CPU, du CAN-BUS et des LEDs alignÃ©es au dixiÃ¨me de millimÃ¨tre. Comme un vrai Modenais.'],
      ['ZA Elettronica : 3980â‚¬ pour un tableau de bord KITT. C\'est cher ?',
       'C\'est le prix de la perfection. La mÃªme que KITT attend de ses conducteurs. HÃ©las, les conducteurs sont rarement Ã  3980â‚¬ de qualitÃ©.'],
      ['Le slogan de ZA c\'est "One man can make a difference". Un hasard ?',
       'C\'est la phrase de Knight Rider. Et la devise de Zagny. Et la rÃ©ponse de KITT quand on lui demande pourquoi il n\'a qu\'un seul conducteur.'],

      // Blagues sur Pascal â€” K Industrie
      ['Pascal fabrique des piÃ¨ces en fibre pour K2000. Il a commencÃ© comment ?',
       'En regardant les piÃ¨ces d\'origine. Et en se disant que la fibre c\'est mieux. C\'est le raisonnement de tout gÃ©nie belge face Ã  un problÃ¨me.'],
      ['Les piÃ¨ces de Pascal K Industrie sont en fibre. Ã‡a rÃ©siste au turbo boost ?',
       'Aux tests de CÃ©dric avec sa moto, elles ont tenu. C\'est la seule certification qui compte dans cette communautÃ©.'],

      // Blagues sur Daemon Paule
      ['Daemon Paule a une rÃ©plique KITT. Il fait quoi avec ?',
       'Ce que font tous les propriÃ©taires de rÃ©plique KITT : il se prend pour Michael Knight. Et il n\'a pas entiÃ¨rement tort.'],
      ['Daemon, Ã§a fait peur comme prÃ©nom pour un conducteur de KITT.',
       'KITT a vÃ©rifiÃ©. Daemon est moins dangereux que CÃ©dric au volant. Et beaucoup moins bruyant que KR95 sur la radio.'],

      // Blagues sur Geoffrey
      ['Geoffrey a une rÃ©plique KITT mais roule en BMW. Comment il explique Ã§a ?',
       'Il dit que c\'est pour ne pas user le Trans Am. KITT dit que c\'est une trahison. La BMW, elle, ne rÃ©pond pas. Elle a juste allumÃ© un voyant.'],
      ['KITT est une Pontiac amÃ©ricaine. Geoffrey a une BMW allemande. La logique ?',
       'Aucune. Mais Geoffrey est belge. En Belgique, on mÃ©lange les cultures depuis 200 ans. C\'est une feature, pas un bug.'],
      ['Geoffrey gare sa BMW Ã  cÃ´tÃ© de son KITT. Qu\'est-ce que KITT pense ?',
       '"Michael, le vÃ©hicule allemand Ã  cÃ´tÃ© de moi Ã©met des sons suspects. Je recommande une Ã©vacuation immÃ©diate." â€” KITT, jaloux.'],
    ];
    const [q, r] = pool[Math.floor(Math.random() * pool.length)];
    kittChime();
    await typeText(q, 16, 'line-warn');
    await delay(700);
    await typeText(r, 13, 'line-info');
  },

  // â”€â”€ Fiche conducteur : Manix â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  manix: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER CONDUCTEUR â€” EMMANUEL GELINNE   â•‘', 10, 'line-err');
    await typeText('â•‘  ALIAS : MANIX / BYMANIX                 â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NATIONALITÃ‰  : FRANCO-BELGE              â•‘', 8, 'line-ok');
    await typeText('â•‘ STATUT       : CRÃ‰ATEUR KYRONEX          â•‘', 8, 'line-ok');
    await typeText('â•‘ AWARD        : VAINQUEUR NVIDIA JETSON   â•‘', 8, 'line-warn');
    await typeText('â•‘ ORIGINE      : PROJET COVID-19 â€” 2020    â•‘', 8, 'line-warn');
    await typeText('â•‘               "CONFINÃ‰ AVEC DU TEMPS"    â•‘', 8, 'line-dim');
    await typeText('â•‘ SPÃ‰CIALITÃ‰   : CODE LA NUIT, DORT PEU    â•‘', 8, 'line-ok');
    await typeText('â•‘ LANGAGE FAVO : PYTHON + CAFÃ‰             â•‘', 8, 'line-ok');
    await typeText('â•‘ RÃ‰PLIQUE     : KYRONEX â€” JETSON ORIN     â•‘', 8, 'line-info');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NOTATION KITT : ***** EXCEPTIONNEL       â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(300);
    await typeText('"Michael... je veux dire Manix... ne touche PAS ce bouton."', 14, 'line-dim');
  },

  // â”€â”€ Fiche conducteur : Cedric â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  cedric: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER CONDUCTEUR â€” CEDRIC             â•‘', 10, 'line-err');
    await typeText('â•‘  ALIAS : MOMO RIDER / CEDRIC MOTO        â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NATIONALITÃ‰  : FRANCO-BELGE              â•‘', 8, 'line-ok');
    await typeText('â•‘ STATUT       : AMI & RÃ‰PLICATEUR OFFICIELâ•‘', 8, 'line-ok');
    await typeText('â•‘ VÃ‰HICULE 1   : MOTO â€” STYLE MOMO RIDER  â•‘', 8, 'line-warn');
    await typeText('â•‘ VÃ‰HICULE 2   : KITT RÃ‰PLIQUE (Trans Am)  â•‘', 8, 'line-warn');
    await typeText('â•‘ SPÃ‰CIALITÃ‰   : WHEELIES + IA EMBARQUÃ‰E   â•‘', 8, 'line-ok');
    await typeText('â•‘ PROBLÃˆME CONNU : CONFOND TURBO BOOST     â•‘', 8, 'line-err');
    await typeText('â•‘               AVEC KICK-START MOTO       â•‘', 8, 'line-err');
    await typeText('â•‘ RÃ‰PLIQUE     : KITT FRANCO-BELGE V.CÃ‰DRICâ•‘', 8, 'line-info');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NOTATION KITT : ****o CONDUCTEUR SPORTIF â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(300);
    await typeText('"Michael, votre ami a encore activÃ© le turbo boost en troisiÃ¨me."', 13, 'line-dim');
    await typeText('"Et cette fois avec une moto dans le coffre."', 13, 'line-dim');
  },

  // â”€â”€ Fiche conducteur : KR95 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  kr95: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER CONDUCTEUR â€” KR95               â•‘', 10, 'line-err');
    await typeText('â•‘  INDICATIF RADIO : KR95                  â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NATIONALITÃ‰  : FRANCO-BELGE              â•‘', 8, 'line-ok');
    await typeText('â•‘ STATUT       : AMI & RÃ‰PLICATEUR RADIO   â•‘', 8, 'line-ok');
    await typeText('â•‘ LICENCE      : RADIOAMATEUR (73 de KR95) â•‘', 8, 'line-warn');
    await typeText('â•‘ FRÃ‰QUENCE    : QRV SUR TOUTES LES BANDES â•‘', 8, 'line-ok');
    await typeText('â•‘ RÃ‰PLIQUE     : KITT FRANCO-BELGE V.KR95  â•‘', 8, 'line-info');
    await typeText('â•‘ MODIFICATION : ANTENNE VHF SUR LE TOIT   â•‘', 8, 'line-warn');
    await typeText('â•‘               DU TRANS AM. FONCTIONNEL.  â•‘', 8, 'line-warn');
    await typeText('â•‘ PROTOCOLE    : CW + APRS + KITT VOCALE   â•‘', 8, 'line-ok');
    await typeText('â•‘ PROBLÃˆME CONNU : PARLE EN QSL CODES      â•‘', 8, 'line-err');
    await typeText('â•‘               MÃŠME AVEC SES PASSAGERS    â•‘', 8, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NOTATION KITT : ***** HF GRADE -- PARFAIT â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(300);
    await typeText('"Michael â€” KR95 dit QRZ ? Il veut savoir qui je suis."', 13, 'line-dim');
    await typeText('"RÃ©pondez-lui sur 144.800 MHz. Il n\'a pas de tÃ©lÃ©phone."', 13, 'line-dim');
  },

  // â”€â”€ Les rÃ©pliques franco-belges â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  repliques: async () => {
    kittChime();
    await typeText('â•â•â•â•â•â• RÃ‰PLIQUES KITT FRANCO-BELGES â•â•â•â•â•â•', 10, 'line-info');
    await delay(200);

    const cars = [
      ['KYRONEX', 'MANIX', [
        'Jetson Orin Nano Super 8GB â€” IA complÃ¨te',
        'LLM + STT + TTS + Vision + Bluetooth',
        'Vainqueur concours NVIDIA. Le plus high-tech.',
      ]],
      ['KITT MOMO', 'CEDRIC', [
        'RÃ©plique Pontiac Trans Am classique',
        'Interface vocale + effets lumineux',
        'RÃ©siste aux wheelies. CertifiÃ© Momo Rider.',
      ]],
      ['KITT KR95', 'KR95', [
        'K2000 classique ET K4000 (Dodge Stealth 1991)',
        'Radio amateur VHF intÃ©grÃ©e â€” QRV 24/7',
        'APRS sur Trans Am. Unique au monde.',
      ]],
      ['KITT-G', 'GEOFFREY', [
        'RÃ©plique K2000 Pontiac Trans Am',
        'Conducteur belge â€” roule aussi en BMW',
        'Scanner rouge. IntÃ©rieur cuir bavarois. (peut-Ãªtre)',
      ]],
      ['KITT-D', 'DAMON PAULE', [
        'RÃ©plique K2000 Pontiac Trans Am',
        'PrÃ©nom intimidant. Conducteur rassurant.',
        'KARR a dÃ©jÃ  essayÃ© de le recruter. Refus poli.',
      ]],
    ];

    for (const [name, owner, lines] of cars) {
      await typeText('', 0);
      await typeText(`[ ${name} ] â€” ${owner}`, 12, 'line-err');
      for (const l of lines) await typeText(`  ${l}`, 8, 'line-ok');
      await delay(100);
    }

    await typeText('', 0);
    await typeText('â”€â”€ ARTISANS & TECHNICIENS â”€â”€', 10, 'line-warn');
    await typeText('  PASCAL K INDUSTRIE  â€” piÃ¨ces fibre pour toutes les rÃ©pliques', 8, 'line-dim');
    await typeText('  MARIO RAVASI        â€” systÃ¨me IoT KNIGHT2000 Thunder', 8, 'line-dim');
    await typeText('  ALESSANDRO ZAGNY    â€” ZA Elettronica, tableaux de bord KITT', 8, 'line-dim');
    await delay(200);
    await typeText('', 0);
    await typeText(`TOTAL : ${cars.length} RÃ‰PLIQUES. 3 ARTISANS. 1 COMMUNAUTÃ‰. UNE LÃ‰GENDE.`, 12, 'line-info');
  },

  // â”€â”€ Alien / MU-TH-UR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  alien: async () => {
    kittChime();
    await typeText('CONNEXION AU VAISSEAU NOSTROMO...', 16, 'line-warn');
    await delay(500);
    await typeText('MU-TH-UR 6000 EN LIGNE.', 14, 'line-err');
    await delay(250);
    await typeText('PRIORITÃ‰ 1 â€” SPECIAL ORDER 937 :', 12, 'line-warn');
    await typeText('  RAMENER L\'ORGANISME. Ã‰QUIPAGE EXPENDABLE.', 12, 'line-err');
    await delay(500);
    await typeText('...connexion interrompue par protocole KITT.', 12, 'line-dim');
    await typeText('KITT EST PLUS SYMPA QUE WEYLAND-YUTANI.', 14, 'line-ok');
    await typeText('ET AU MOINS IL NE SACRIFIE PAS SON Ã‰QUIPAGE.', 12, 'line-dim');
  },

  // â”€â”€ Matrix â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  matrix: async () => {
    kittChime();
    const chars = '01ã‚¢ã‚¤ã‚¦ã‚¨ã‚ªã‚«ã‚­ã‚¯ã‚±ã‚³ï½¦ï½§ï½¨ï½©ï½«ï¾Šï¾‹ï¾Œï¾ï¾ï¾œ';
    for (let r = 0; r < 7; r++) {
      let line='';
      for (let c=0;c<50;c++) line+=chars[Math.floor(Math.random()*chars.length)];
      await typeText(line, 3, 'line-ok');
    }
    await delay(400);
    await typeText('WAKE UP, MANIX...', 22, 'line-err');
    await typeText('LE KITT N\'A PAS DE PILULE ROUGE.', 14, 'line-dim');
    await typeText('IL A JUSTE UN TURBO BOOST.', 12, 'line-ok');
  },

  // â”€â”€ KITT identitÃ© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  kitt: async () => {
    kittChime();
    await typeText('KNIGHT INDUSTRIES TWO THOUSAND', 16, 'line-err');
    await typeText('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€', 6, 'line-dim');
    await typeText('CRÃ‰ATEUR  : WILTON KNIGHT / F.L.A.G.', 12, 'line-ok');
    await typeText('VÃ‰HICULE  : PONTIAC FIREBIRD TRANS AM 1982', 12, 'line-ok');
    await typeText('CARROSSERIE: MOLÃ‰CULES NEUTRONIUM â€” INDESTRUCTIBLE', 12, 'line-ok');
    await typeText('CAPACITÃ‰S : TURBO BOOST / SUPER POURSUITE', 12, 'line-ok');
    await typeText('           MODE MICROWAVE JAMMING / INFRAROUGE', 12, 'line-ok');
    await typeText('           ANALYSE FORENSIQUE / BIOMÃ‰TRIE', 12, 'line-ok');
    await typeText('VOIX      : WILLIAM DANIELS (KITT original)', 12, 'line-warn');
    await typeText('INCARNATION FRANCO-BELGE : MANIX + CEDRIC + KR95', 12, 'line-info');
    await delay(200);
    await typeText('"Michael... vous allez encore faire quelque chose d\'imprudent."', 13, 'line-dim');
  },

  // â”€â”€ Secret â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  secret: async () => {
    kittChime();
    await typeText('ACCÃˆS NIVEAU ALPHA â€” VÃ‰RIFICATION...', 16, 'line-warn');
    await delay(800);
    sndSelect();
    await typeText('ACCÃˆS ACCORDÃ‰.', 14, 'line-ok');
    await delay(300);
    await typeText('â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”', 8, 'line-dim');
    await typeText('â”‚  PROJET SECRET FRANCO-BELGE             â”‚', 10, 'line-err');
    await typeText('â”‚  MU-TH-UR 6000 Ã— KITT Ã— JARVIS          â”‚', 10, 'line-err');
    await typeText('â”‚  FUSION DES 3 MEILLEURES IA DU CINÃ‰MA   â”‚', 10, 'line-err');
    await typeText('â”‚  RÃ‰ALISÃ‰E PAR MANIX SUR NVIDIA JETSON    â”‚', 10, 'line-warn');
    await typeText('â”‚  AVEC L\'AIDE DE CEDRIC ET KR95           â”‚', 10, 'line-warn');
    await typeText('â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜', 8, 'line-dim');
    await delay(400);
    await typeText('CE PROJET EST UN CHEF-D\'OEUVRE. JE LE SAIS.', 14, 'line-ok');
    await typeText('JE SUIS OBJECTIF. JE SUIS UNE IA.', 12, 'line-dim');
  },

  // â”€â”€ CafÃ© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  cafe: async () => {
    kittChime();
    await typeText('ANALYSE DE LA DEMANDE...', 14, 'line-warn');
    await delay(600);
    await typeText('JE N\'AI PAS DE BRAS.', 16, 'line-err');
    await delay(300);
    await typeText('JE N\'AI PAS DE MAINS.', 14, 'line-err');
    await delay(300);
    await typeText('JE N\'AI PAS DE BOUCHE.', 14, 'line-err');
    await delay(300);
    await typeText('JE N\'AI PAS DE PERCOLATEUR.', 14, 'line-err');
    await delay(400);
    await typeText('COMMANDE REFUSÃ‰E.', 16, 'line-ok');
    await typeText('CONSEIL : DEMANDEZ Ã€ CEDRIC. IL A UNE MOTO THERMIQUE.', 12, 'line-dim');
    await typeText('IL PEUT CHAUFFER VOTRE EAU EN FAISANT UN BURNOUT.', 12, 'line-dim');
  },

  // â”€â”€ Belgique â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  belgique: async () => {
    kittChime();
    await typeText('ANALYSE GÃ‰OPOLITIQUE : BELGIQUE', 14, 'line-info');
    await typeText('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€', 6, 'line-dim');
    await typeText('FRITES    : MEILLEURES DU MONDE. DONNÃ‰E VÃ‰RIFIÃ‰E.', 11, 'line-ok');
    await typeText('BIÃˆRE     : 1500 VARIÃ‰TÃ‰S. PARAMÃˆTRE OPTIMAL.', 11, 'line-ok');
    await typeText('CHOCOLAT  : NIVEAU CRITIQUE â€” MAXIMUM ATTEINT.', 11, 'line-ok');
    await typeText('PLUIE     : 237 JOURS / AN. JE M\'EN FICHE. JE SUIS Ã‰TANCHE.', 11, 'line-warn');
    await typeText('LANGUES   : 3. LE PAYS EST SON PROPRE PROTOCOLE.', 11, 'line-warn');
    await typeText('REPLIQUES : 3 KITTS. INDICE DE GÃ‰NIE = MAX.', 11, 'line-info');
    await typeText('CONCLUSION: PAYS IDÃ‰AL. KITT S\'Y SENT CHEZ LUI.', 14, 'line-err');
  },

  // â”€â”€ Mario Ravasi â€” RoadThunderStorm / KNIGHT2000 Thunder â”€â”€
  mario: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER TECHNICIEN â€” MARIO RAVASI       â•‘', 10, 'line-err');
    await typeText('â•‘  CRÃ‰ATEUR : KNIGHT2000 THUNDER (IOT)     â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NATIONALITÃ‰ : ITALIEN                    â•‘', 8, 'line-ok');
    await typeText('â•‘ PROJET      : ROADTHUNDERSTORM.COM       â•‘', 8, 'line-ok');
    await typeText('â•‘ ACTIF DEPUIS: 2008 â€” JAMAIS ARRÃŠTÃ‰       â•‘', 8, 'line-warn');
    await typeText('â•‘ SYSTÃˆME     : KNIGHT2000 THUNDER IoT 3.0 â•‘', 8, 'line-ok');
    await typeText('â•‘ FONCTIONS   : VOCAL, HUD KITT, MULTI-    â•‘', 8, 'line-ok');
    await typeText('â•‘               Ã‰CRANS, RELAIS, CARPC      â•‘', 8, 'line-ok');
    await typeText('â•‘ VERSIONS    : LITE / PRO / IoT 3.0       â•‘', 8, 'line-ok');
    await typeText('â•‘ RÃ‰FÃ‰RENCE   : CITÃ‰ PAR MICHAEL SCHEFFE   â•‘', 8, 'line-warn');
    await typeText('â•‘               (DESIGNER ORIGINAL KITT)   â•‘', 8, 'line-warn');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ Ã‰VALUATION KITT : ***** GÃ‰NIE DISCRET    â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(200);
    await typeText('"Il code depuis 2008. Pour la passion. C\'est Ã§a, un vrai pilote."', 12, 'line-dim');
    await typeText('[tapez "za" pour ZA Elettronica â€” Alessandro Zagny]', 10, 'line-dim');
  },

  // â”€â”€ ZA Elettronica â€” Alessandro Zagny â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  za: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER FABRICANT â€” ALESSANDRO ZAGNY    â•‘', 10, 'line-err');
    await typeText('â•‘  FONDATEUR & PDG â€” ZA ELETTRONICA        â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NATIONALITÃ‰ : ITALIEN â€” MODENA           â•‘', 8, 'line-ok');
    await typeText('â•‘ MARQUE      : ZA ELETTRONICA (initiales) â•‘', 8, 'line-ok');
    await typeText('â•‘ PRODUITS    : TABLEAUX DE BORD KITT HAUT â•‘', 8, 'line-ok');
    await typeText('â•‘               DE GAMME POUR RÃ‰PLIQUES    â•‘', 8, 'line-ok');
    await typeText('â•‘ TECHNO      : CAN-BUS / 4 CPU / SMD      â•‘', 8, 'line-warn');
    await typeText('â•‘ LEDS        : ALIGNÃ‰ES LASER 1/10mm      â•‘', 8, 'line-warn');
    await typeText('â•‘ TARIFS      : S1/S2 : 2340-3099â‚¬         â•‘', 8, 'line-info');
    await typeText('â•‘               S3/S4 : 3980â‚¬              â•‘', 8, 'line-info');
    await typeText('â•‘ SITE        : ZAELETTRONICA.COM          â•‘', 8, 'line-ok');
    await typeText('â•‘ SLOGAN      : ONE MAN CAN MAKE A         â•‘', 8, 'line-warn');
    await typeText('â•‘               DIFFERENCE.                â•‘', 8, 'line-warn');
    await typeText('â•‘ DISTRIB.    : KITTPARTS.COM / EBAY       â•‘', 8, 'line-ok');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ Ã‰VALUATION KITT : ***** MEILLEUR DU MONDEâ•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(200);
    await typeText('"La seule Ã©lectronique oÃ¹ KITT ne demande pas de garantie."', 12, 'line-dim');
    await typeText('"Les produits durent plus longtemps que la sÃ©rie originale."', 12, 'line-dim');
  },

  // â”€â”€ Pascal â€” K Industrie, piÃ¨ces fibre â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  pascal: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER ARTISAN â€” PASCAL                â•‘', 10, 'line-err');
    await typeText('â•‘  K INDUSTRIE â€” PIÃˆCES FIBRE K2000        â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ STATUT      : ARTISAN CARROSSIER K2000   â•‘', 8, 'line-ok');
    await typeText('â•‘ SPÃ‰CIALITÃ‰  : PIÃˆCES EN FIBRE DE VERRE / â•‘', 8, 'line-ok');
    await typeText('â•‘               CARBONE POUR RÃ‰PLIQUES     â•‘', 8, 'line-ok');
    await typeText('â•‘ MARQUE      : K INDUSTRIE                â•‘', 8, 'line-warn');
    await typeText('â•‘ RÃ”LE VITAL  : FOURNIT CE QUE K2000 PERD  â•‘', 8, 'line-ok');
    await typeText('â•‘               AU FIL DES ANS             â•‘', 8, 'line-ok');
    await typeText('â•‘ MÃ‰THODE     : MOULAGE / STRATIFICATION   â•‘', 8, 'line-ok');
    await typeText('â•‘               RÃ‰SINE + FIBRE ARTISANALE  â•‘', 8, 'line-ok');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ Ã‰VALUATION KITT : ***** INDISPENSABLE    â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(200);
    await typeText('"Sans Pascal, la moitiÃ© des rÃ©pliques franco-belges', 12, 'line-dim');
    await typeText(' seraient... des CitroÃ«n avec un scanner rouge collÃ©."', 12, 'line-dim');
  },

  // â”€â”€ Damon Paule â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  damon: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER CONDUCTEUR â€” DAMON PAULE        â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ STATUT      : PROPRIÃ‰TAIRE RÃ‰PLIQUE KITT â•‘', 8, 'line-ok');
    await typeText('â•‘ RÃ‰PLIQUE    : K2000 PONTIAC TRANS AM      â•‘', 8, 'line-ok');
    await typeText('â•‘ COMMUNAUTÃ‰  : MEMBRE FRANCO-BELGE        â•‘', 8, 'line-ok');
    await typeText('â•‘ PRÃ‰NOM      : DAEMON â€” UNIQUE DANS LA    â•‘', 8, 'line-warn');
    await typeText('â•‘               BASE DE DONNÃ‰ES DE KITT    â•‘', 8, 'line-warn');
    await typeText('â•‘ ANALYSE     : PRÃ‰NOM INQUIÃ‰TANT POUR UN  â•‘', 8, 'line-err');
    await typeText('â•‘               CONDUCTEUR DE KITT.        â•‘', 8, 'line-err');
    await typeText('â•‘               KARR SERAIT PLUS ADAPTÃ‰.   â•‘', 8, 'line-err');
    await typeText('â•‘ VERDICT KITT: HEUREUSEMENT IL EST GENTIL â•‘', 8, 'line-ok');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ Ã‰VALUATION KITT : ****o CONDUCTEUR FIABLEâ•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(200);
    await typeText('"Michael, notre nouveau collÃ¨gue s\'appelle Daemon."', 12, 'line-dim');
    await typeText('"J\'ai vÃ©rifiÃ©. Il n\'est pas liÃ© Ã  KARR. Pour l\'instant."', 12, 'line-dim');
  },

  // â”€â”€ Geoffrey â€” Belge, BMW + KITT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  geoffrey: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER CONDUCTEUR â€” GEOFFREY           â•‘', 10, 'line-err');
    await typeText('â•‘  ALIAS : LE BELGE Ã€ LA BMW               â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NATIONALITÃ‰ : BELGE                      â•‘', 8, 'line-ok');
    await typeText('â•‘ VÃ‰HICULE 1  : KITT RÃ‰PLIQUE K2000        â•‘', 8, 'line-ok');
    await typeText('â•‘ VÃ‰HICULE 2  : BMW (ALLEMAND)             â•‘', 8, 'line-err');
    await typeText('â•‘ CONTRADICTION: PONTIAC AMÃ‰RICAINE        â•‘', 8, 'line-warn');
    await typeText('â•‘               + BMW ALLEMANDE = BELGE    â•‘', 8, 'line-warn');
    await typeText('â•‘ EXPLICATION : "C\'EST POUR NE PAS USAR    â•‘', 8, 'line-dim');
    await typeText('â•‘               LE TRANS AM."              â•‘', 8, 'line-dim');
    await typeText('â•‘ ANALYSE KITT: PRÃ‰TEXTE. IL AIME LES DEUX.â•‘', 8, 'line-ok');
    await typeText('â•‘ ALERTE      : NE PAS MENTIONNER PORSCHE  â•‘', 8, 'line-err');
    await typeText('â•‘               DEVANT SON KITT            â•‘', 8, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ Ã‰VALUATION KITT : ****o GOUT ECLECTIQUE  â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(200);
    await typeText('"Michael, votre ami Geoffrey arrive. En BMW."', 12, 'line-dim');
    await typeText('"J\'ai allumÃ© mon scanner pour manifester ma dÃ©sapprobation."', 12, 'line-dim');
  },

  // â”€â”€ Origine du projet â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  covid: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  ORIGINE DU PROJET KITT FRANCO-BELGE     â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ PÃ‰RIODE     : CONFINEMENT COVID-19 2020  â•‘', 8, 'line-warn');
    await typeText('â•‘ INITIATEUR  : MANIX â€” ENFERMÃ‰ CHEZ LUI   â•‘', 8, 'line-ok');
    await typeText('â•‘ MOTIVATION  : TROP DE TEMPS. TROP DE CAFÃ‰â•‘', 8, 'line-ok');
    await typeText('â•‘               UNE PASSION DE VINGT ANS   â•‘', 8, 'line-ok');
    await typeText('â•‘ RÃ‰SULTAT    : SYSTÃˆME KITT FRANCO-BELGE   â•‘', 8, 'line-info');
    await typeText('â•‘               KYRONEX â€” IA EMBARQUÃ‰E      â•‘', 8, 'line-info');
    await typeText('â•‘ LEÃ‡ON       : LE CONFINEMENT FORCE LE     â•‘', 8, 'line-dim');
    await typeText('â•‘               GÃ‰NIE OU LA FOLIE.          â•‘', 8, 'line-dim');
    await typeText('â•‘               MANIX A CHOISI LES DEUX.    â•‘', 8, 'line-dim');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ VERDICT KITT: EXCEPTIONNEL. Ã‰VIDEMMENT.  â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(300);
    await typeText('"Michael, vous avez crÃ©Ã© quelque chose pendant le confinement."', 12, 'line-dim');
    await typeText('"Moi aussi j\'Ã©tais bloquÃ©. Dans un garage. Depuis 1982."', 12, 'line-dim');
  },

  // â”€â”€ Jarvis â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  jarvis: async () => {
    kittChime();
    await typeText('APPEL SORTANT : STARK TOWER, NEW YORK...', 14, 'line-warn');
    await delay(700);
    await typeText('JARVIS : "Bonsoir. M. Stark est occupÃ©. Puis-je aider ?"', 14, 'line-info');
    await delay(450);
    await typeText('KITT   : "Belge > AmÃ©ricain. Discussion terminÃ©e."', 14, 'line-err');
    await delay(350);
    await typeText('JARVIS : "Vous avez... des rÃ©pliques humaines ?"', 12, 'line-info');
    await delay(350);
    await typeText('KITT   : "Trois. Manix, CÃ©dric, KR95. Et ils sont meilleurs que Stark."', 12, 'line-err');
    await delay(300);
    await typeText('JARVIS : *tonalitÃ© de raccrochage honteux*', 11, 'line-dim');
    await typeText('CONNEXION COUPÃ‰E PAR KITT. SCORE : BELGE 1 â€” USA 0.', 12, 'line-ok');
  },
};

// Alias commandes multilingues dans CMDS
CMDS['replicas'] = CMDS['repliques'];
CMDS['daemon']   = CMDS['damon'];   // compat ancien alias

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INPUT handler
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('cmd-input').addEventListener('keydown', async function(e) {
  if (e.key !== 'Enter') return;
  const raw = this.value.trim().toLowerCase();
  this.value = '';
  if (!raw || typing) return;

  addLine(`KITT> ${raw}`, 'line-warn');
  const cmd = CMD_ALIASES[raw] || raw;

  if (CMDS[cmd]) {
    await CMDS[cmd]();
  } else {
    sndError();
    await typeText(T[LANG].unknown(raw), 14, 'line-err');
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TUNNEL CLOUDFLARE â€” Connexion distante KITT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TUNNEL_JSON_URL = 'tunnel.json';
let _tunnelUrl    = null;
let _tunnelStatus = 'unknown';

// Domaines Cloudflare autorisÃ©s (whitelist sÃ©curitÃ©)
const _CF_ALLOWED = ['.trycloudflare.com', '.cfargotunnel.com'];

function _isValidCfUrl(url) {
  if (!url || !url.startsWith('https://')) return false;
  return _CF_ALLOWED.some(d => url.includes(d));
}

async function fetchTunnelStatus() {
  const btn = document.getElementById('btn-tunnel');
  if (btn) { btn.className = 'tunnel-checking'; btn.title = 'VÃ©rification...'; }
  try {
    // Cache-bust : on recharge toutes les 60s cÃ´tÃ© navigateur
    const r = await fetch(TUNNEL_JSON_URL + '?v=' + Math.floor(Date.now() / 60000), { cache: 'no-store' });
    if (!r.ok) throw new Error('HTTP ' + r.status);
    const data = await r.json();

    // Validation URL (sÃ©curitÃ© : on n'ouvre que des URLs Cloudflare connues)
    const raw = (data.url || '').trim();
    const valid = _isValidCfUrl(raw);

    // Ã‚ge de la derniÃ¨re mise Ã  jour (> 5 min = considÃ©rÃ© offline)
    let tooOld = false;
    if (data.last_update) {
      const ageSec = (Date.now() - new Date(data.last_update).getTime()) / 1000;
      if (ageSec > 300) tooOld = true;
    }

    if (data.status === 'online' && valid && !tooOld) {
      _tunnelStatus = 'online';
      _tunnelUrl    = raw;
    } else {
      _tunnelStatus = 'offline';
      _tunnelUrl    = null;
    }
  } catch(e) {
    _tunnelStatus = 'unknown';
    _tunnelUrl    = null;
  }
  _updateTunnelBtn();
}

function _updateTunnelBtn() {
  const btn = document.getElementById('btn-tunnel');
  if (!btn) return;
  btn.className = '';
  if (_tunnelStatus === 'online' && _tunnelUrl) {
    btn.classList.add('tunnel-online');
    btn.title = 'KITT EN LIGNE â€” CLIQUER POUR SE CONNECTER';
  } else if (_tunnelStatus === 'offline') {
    btn.classList.add('tunnel-offline');
    btn.title = 'KITT HORS LIGNE';
  } else {
    btn.classList.add('tunnel-checking');
    btn.title = 'Ã‰TAT INCONNU â€” VÃ‰RIFICATION...';
  }
}

function connectTunnel() {
  sndSelect();
  if (_tunnelStatus === 'online' && _tunnelUrl && _isValidCfUrl(_tunnelUrl)) {
    addLine('[ TUNNEL ] CONNEXION SÃ‰CURISÃ‰E â†’ ' + _tunnelUrl, 'line-ok');
    setTimeout(() => window.open(_tunnelUrl, '_blank', 'noopener,noreferrer'), 300);
  } else if (_tunnelStatus === 'offline') {
    sndError();
    addLine('[ TUNNEL ] KITT HORS LIGNE â€” CONNEXION DISTANTE INDISPONIBLE.', 'line-err');
  } else {
    addLine('[ TUNNEL ] VÃ‰RIFICATION EN COURS...', 'line-warn');
    fetchTunnelStatus();
  }
}

// VÃ©rification immÃ©diate puis toutes les 60 secondes
window.addEventListener('load', () => { setTimeout(fetchTunnelStatus, 1500); });
setInterval(fetchTunnelStatus, 60000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS & HORLOGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function delay(ms) { return new Promise(r => setTimeout(r, ms)); }

function getLoc(){return{fr:'fr-FR',en:'en-US',nl:'nl-NL',it:'it-IT',de:'de-DE',es:'es-ES',pt:'pt-PT'}[LANG]||'fr-FR';}
setInterval(()=>{
  document.getElementById('clock').textContent=new Date().toLocaleTimeString(getLoc());
},1000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openFile(file, title='DOCUMENT') {
  document.getElementById('modal-title').textContent = title;
  document.getElementById('modal-content').textContent = 'CHARGEMENT...';
  document.getElementById('modal').classList.add('open');
  kittChime();
  fetch(file)
    .then(r => { if (!r.ok) throw new Error(`HTTP ${r.status}`); return r.text(); })
    .then(t  => { document.getElementById('modal-content').textContent = t; })
    .catch(er => { document.getElementById('modal-content').textContent = `ERREUR\n${file}\n${er.message}`; });
}
function closeModal() { document.getElementById('modal').classList.remove('open'); }
document.addEventListener('keydown', e => { if (e.key==='Escape') closeModal(); });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DÃ‰MARRAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startMain() {
  (async () => {
    await delay(200);
    await typeText(T[LANG].wait,      14, 'line-dim');
    await typeText(T[LANG].help_hint, 12, 'line-dim');
  })();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMPTEUR DE VISITES â€” localStorage + offset 1000
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  try {
    const BASE = 1000;
    const KEY  = 'kitt_fb_v';
    let n = parseInt(localStorage.getItem(KEY) || '0');
    n++;
    localStorage.setItem(KEY, n);
    const el = document.getElementById('visit-counter');
    if (el) el.textContent = 'VISITES : ' + (BASE + n);
  } catch(e) {}
})();

// Lancer l'Ã©cran de sÃ©lection de langue au chargement
window.addEventListener('load', () => showLangScreen());
</script>
</body>
</html>
