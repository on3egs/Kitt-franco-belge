<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KITT FRANCO-BELGE // SYSTÃˆME CENTRAL</title>
<meta name="description" content="Interface KITT Franco-Belge â€” IA embarquÃ©e sur NVIDIA Jetson. Projet fan non commercial par Manix."/>
<meta name="theme-color" content="#000000"/>
<!-- â˜… AMÃ‰LIORATION : Polices distinctives -->
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=VT323&family=Share+Tech+Mono&display=swap" rel="stylesheet"/>
<style>
:root{
  --green:#00ff66;
  --green-dim:#00aa44;
  --red:#ff1a1a;
  --amber:#ffaa00;
  --cyan:#00ccff;
  --border-dim:rgba(0,255,102,.15);
  /* â˜… Nouvelles polices */
  --font-display:"Orbitron","Courier New",monospace;
  --font-terminal:"VT323","Courier New",monospace;
  --font-mono:"Share Tech Mono","Courier New",monospace;
  --bg:#000;
}
*{box-sizing:border-box;}
html,body{margin:0;height:100%;background:var(--bg);color:var(--green);font-family:var(--font-mono);overflow:hidden;}

/* CRT scanlines */
body::before{content:"";position:fixed;top:0;left:0;right:0;bottom:0;background:repeating-linear-gradient(0deg,rgba(0,0,0,.18),rgba(0,0,0,.18) 1px,transparent 1px,transparent 3px);pointer-events:none;z-index:9998;}
body::after{content:"";position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,255,80,.015);pointer-events:none;z-index:9999;animation:flicker .12s infinite;}
@keyframes flicker{0%{opacity:.88}48%{opacity:1}52%{opacity:.92}100%{opacity:.96}}

/* â”€â”€ Ã‰CRAN ACCÃˆS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@keyframes accessPulse{0%,100%{text-shadow:0 0 8px #FF9900}50%{text-shadow:0 0 22px #FF9900,0 0 50px rgba(255,153,0,.4)}}
@keyframes inputBlink{0%,49%{border-color:#884400}50%,100%{border-color:#FF9900}}
@keyframes wrongShake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-8px)}40%,80%{transform:translateX(8px)}}
#access-screen{
  position:fixed;top:0;left:0;right:0;bottom:0;
  background:rgba(0,0,0,.93);z-index:9500;
  display:flex;align-items:center;justify-content:center;
  padding:20px;
}
#access-box{
  width:100%;max-width:480px;
  border:1px solid rgba(255,153,0,.55);border-radius:10px;
  background:rgba(4,1,0,.85);backdrop-filter:blur(10px);
  padding:32px 36px;position:relative;overflow:hidden;
  box-shadow:0 0 120px rgba(255,100,0,.15),0 0 60px rgba(255,60,0,.08),inset 0 0 40px rgba(255,80,0,.04);
}
#access-box::before{content:'';position:absolute;inset:0;
  background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(255,80,0,.015) 2px,rgba(255,80,0,.015) 4px);
  pointer-events:none;border-radius:10px;}
#access-box::after{content:'';position:absolute;left:0;right:0;height:2px;
  background:linear-gradient(90deg,transparent,rgba(255,153,0,.5),transparent);
  box-shadow:0 0 8px rgba(255,153,0,.4);
  animation:scanBar 2.8s linear infinite;pointer-events:none;}
/* Coins HUD access */
#access-box .a-tl,#access-box .a-tr,#access-box .a-bl,#access-box .a-br{
  position:absolute;width:14px;height:14px;animation:cornerBlink 1.6s ease-in-out infinite;}
#access-box .a-tl{top:-1px;left:-1px;border-top:2px solid #FF9900;border-left:2px solid #FF9900;}
#access-box .a-tr{top:-1px;right:-1px;border-top:2px solid #FF9900;border-right:2px solid #FF9900;}
#access-box .a-bl{bottom:-1px;left:-1px;border-bottom:2px solid #FF9900;border-left:2px solid #FF9900;}
#access-box .a-br{bottom:-1px;right:-1px;border-bottom:2px solid #FF9900;border-right:2px solid #FF9900;}
#access-hdr{
  color:#FF9900;letter-spacing:4px;font-size:12px;text-align:center;
  border-bottom:1px solid #663300;padding-bottom:12px;margin-bottom:20px;
  animation:accessPulse 3s ease-in-out infinite;
  font-family:var(--font-display);
}
#access-log{min-height:100px;font-size:11px;letter-spacing:2px;line-height:2;margin-bottom:16px;color:#885500;font-family:var(--font-mono);}
#access-log .a-line{color:#FF8800;}
#access-log .a-ok{color:#FFAA00;}
#access-log .a-err{color:#ff3300;}
#access-input-row{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
#access-prompt{color:#FF6600;font-size:12px;letter-spacing:2px;white-space:nowrap;font-family:var(--font-mono);}
#access-input{
  flex:1;background:transparent;border:none;border-bottom:1px solid #884400;
  color:#FF9900;font-family:var(--font-terminal);font-size:20px;
  letter-spacing:4px;outline:none;padding:4px 0;caret-color:#FF9900;
  animation:inputBlink 1.1s step-end infinite;
}
#access-input::placeholder{color:#442200;letter-spacing:2px;font-size:11px;}
#access-hint{font-size:9px;color:#442200;letter-spacing:2px;text-align:center;font-family:var(--font-mono);}
/* â˜… Barre de progression accÃ¨s */
#access-progress{height:2px;background:rgba(255,153,0,.1);margin-top:16px;border-radius:1px;overflow:hidden;}
#access-progress-bar{height:100%;width:0;background:linear-gradient(90deg,#FF6600,#FF9900);transition:width .3s ease;border-radius:1px;}
#access-box.wrong{animation:wrongShake .4s ease;}

/* â”€â”€ MU-TH-UR 6000 INTRO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#mother-intro{
  position:fixed;top:0;left:0;right:0;bottom:0;
  background:rgba(0,0,0,.92);z-index:9000;
  display:flex;align-items:center;justify-content:center;
  padding:20px;
}
#mother-box{
  width:100%;max-width:580px;
  border:1px solid rgba(255,140,0,.6);
  box-shadow:0 0 80px rgba(255,140,0,.18),0 0 200px rgba(255,80,0,.06),inset 0 0 50px rgba(255,100,0,.04);
  padding:28px 36px;position:relative;overflow:hidden;
  background:rgba(2,1,0,.82);backdrop-filter:blur(4px);
}
#mother-box::before{content:'';position:absolute;top:-1px;left:0;right:0;height:2px;
  background:linear-gradient(90deg,transparent,rgba(255,140,0,.8),transparent);
  animation:scanBar 4s linear infinite;pointer-events:none;}
#mother-box::after{content:'';position:absolute;inset:0;
  background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(255,80,0,.012) 2px,rgba(255,80,0,.012) 4px);
  pointer-events:none;}
/* Coins HUD sur mother-box */
#mother-box .m-tl,#mother-box .m-tr,#mother-box .m-bl,#mother-box .m-br{
  position:absolute;width:16px;height:16px;animation:cornerBlink 2s ease-in-out infinite;}
#mother-box .m-tl{top:-1px;left:-1px;border-top:2px solid #FF9900;border-left:2px solid #FF9900;}
#mother-box .m-tr{top:-1px;right:-1px;border-top:2px solid #FF9900;border-right:2px solid #FF9900;}
#mother-box .m-bl{bottom:-1px;left:-1px;border-bottom:2px solid #FF9900;border-left:2px solid #FF9900;}
#mother-box .m-br{bottom:-1px;right:-1px;border-bottom:2px solid #FF9900;border-right:2px solid #FF9900;}
#mother-hdr{
  color:#FF9900;letter-spacing:5px;font-size:14px;
  text-align:center;border-bottom:1px solid rgba(255,140,0,.3);
  padding-bottom:14px;margin-bottom:18px;
  text-shadow:0 0 20px #FF990080,0 0 40px rgba(255,140,0,.3);
  font-family:var(--font-display);position:relative;z-index:1;
}
#mother-output{
  min-height:260px;font-size:13px;
  letter-spacing:1px;line-height:1.9;
  font-family:var(--font-mono);
}
.m-bright{color:#FFAA00;text-shadow:0 0 10px #FF990050;}
.m-normal{color:#FF8800;}
.m-dim{color:#885500;}
.m-ok{color:#FFAA00;}
#mother-skip{
  margin-top:18px;font-size:10px;color:#663300;
  letter-spacing:3px;text-align:center;display:none;
  animation:mskip 1.1s step-end infinite;
  font-family:var(--font-mono);
}
@keyframes mskip{0%,49%{opacity:1}50%,100%{opacity:0}}

/* â”€â”€ LANGUAGE SELECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@keyframes ks{0%{left:-200px}100%{left:100%}}
@keyframes pred{0%,100%{text-shadow:0 0 12px var(--red)}50%{text-shadow:0 0 28px var(--red),0 0 50px rgba(255,26,26,.5)}}
@keyframes bd{0%,100%{opacity:1}50%{opacity:.25}}
#lang-screen{
  position:fixed;top:0;left:0;right:0;bottom:0;
  background:
    radial-gradient(ellipse 500px 600px at 50% 50%,rgba(0,6,2,.95) 0%,rgba(0,0,0,.97) 65%,rgba(0,0,0,1) 100%),
    radial-gradient(ellipse 200px 200px at 20% 30%,rgba(255,26,26,.04) 0%,transparent 70%),
    radial-gradient(ellipse 300px 300px at 80% 70%,rgba(0,255,102,.03) 0%,transparent 70%);
  z-index:9600;
  display:flex;align-items:center;justify-content:center;
  padding:16px;
}
#lang-screen::before{
  content:'';position:absolute;inset:0;
  background-image:linear-gradient(rgba(0,255,102,.018) 1px, transparent 1px),linear-gradient(90deg, rgba(0,255,102,.018) 1px, transparent 1px);
  background-size:32px 32px;pointer-events:none;
}
#lang-screen .lang-scanner-top{position:absolute;top:0;left:0;right:0;height:2px;overflow:hidden;}
#lang-screen .lang-scanner-top::after{content:'';position:absolute;top:0;width:160px;height:2px;background:linear-gradient(90deg,transparent,var(--red),transparent);box-shadow:0 0 10px 3px var(--red);animation:ks 2.2s ease-in-out infinite alternate;}
#lang-screen .lang-scanner-bot{position:absolute;bottom:0;left:0;right:0;height:2px;overflow:hidden;}
#lang-screen .lang-scanner-bot::after{content:'';position:absolute;top:0;width:160px;height:2px;background:linear-gradient(90deg,transparent,var(--red),transparent);box-shadow:0 0 10px 3px var(--red);animation:ks 2.2s ease-in-out infinite alternate-reverse;}
#lang-box{
  width:100%;max-width:540px;
  border:1px solid rgba(0,255,102,.4);border-radius:12px;
  box-shadow:0 0 100px rgba(0,255,102,.14),0 0 200px rgba(0,255,102,.06),inset 0 0 60px rgba(0,255,102,.025),0 0 8px rgba(255,26,26,.35),0 2px 40px rgba(0,0,0,.8);
  background:rgba(0,8,3,.65);backdrop-filter:blur(10px);
  font-size:13px;animation:boxIn .5s ease-out;position:relative;overflow:hidden;
}
#lang-box::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:linear-gradient(180deg,transparent 5%,var(--red) 30%,rgba(255,26,26,.5) 70%,transparent 95%);border-radius:10px 0 0 10px;}
@keyframes boxIn{from{opacity:0;transform:scale(.94) translateY(12px)}to{opacity:1;transform:none}}
#lang-hdr{border-bottom:1px solid var(--border-dim);padding:16px 24px 14px;text-align:center;background:linear-gradient(180deg,rgba(255,26,26,.04),rgba(0,255,102,.02));position:relative;}
#lang-logo-line{display:flex;align-items:center;justify-content:center;gap:16px;margin-bottom:6px;}
.lang-logo-kitt{color:var(--red);font-family:var(--font-display);font-size:19px;font-weight:900;letter-spacing:6px;text-shadow:0 0 20px var(--red),0 0 50px rgba(255,26,26,.3);animation:pred 3s ease-in-out infinite;}
.lang-logo-sep{color:var(--green-dim);font-size:15px;letter-spacing:1px;text-shadow:0 0 8px var(--green-dim);}
.lang-logo-alien{color:var(--amber);font-family:var(--font-display);font-size:19px;font-weight:900;letter-spacing:5px;text-shadow:0 0 20px var(--amber),0 0 50px rgba(255,170,0,.3);animation:amberPulse 4s ease-in-out infinite;}
@keyframes amberPulse{0%,100%{text-shadow:0 0 12px var(--amber),0 0 30px rgba(255,170,0,.2)}50%{text-shadow:0 0 28px var(--amber),0 0 70px rgba(255,170,0,.5)}}
#lang-sys-id{color:var(--green);font-family:var(--font-mono);font-size:10px;letter-spacing:3px;text-shadow:0 0 10px var(--green);}
#lang-sub{padding:10px 24px 8px;color:var(--amber);letter-spacing:3px;font-size:9px;border-bottom:1px solid rgba(255,170,0,.12);text-shadow:0 0 8px rgba(122,79,0,1);display:flex;align-items:center;gap:8px;font-family:var(--font-mono);}
#lang-sub::before{content:'â–¶';color:var(--red);font-size:8px;animation:bd 1.2s ease-in-out infinite;}
#lang-output{padding:4px 0 2px;}
.lang-opt{display:flex;align-items:center;gap:14px;padding:9px 24px;cursor:pointer;transition:background .12s,border-left-color .12s,transform .1s;border-left:2px solid transparent;border-bottom:1px solid rgba(0,255,102,.05);position:relative;border-radius:4px;margin:1px 8px;}
.lang-opt:last-child{border-bottom:none;}
.lang-opt:hover{background:linear-gradient(90deg,rgba(255,26,26,.1),rgba(0,255,102,.07),rgba(0,0,0,.1));border-left-color:var(--red);transform:translateX(4px);box-shadow:inset 0 0 24px rgba(0,255,102,.05),-3px 0 12px rgba(255,26,26,.25);}
.lang-opt:hover .lo-n{border-color:var(--red);color:var(--red);box-shadow:0 0 8px rgba(255,26,26,.3);transform:scale(1.1);}
.lang-opt:hover .lo-flag{filter:saturate(1.5) brightness(1.2);}
.lang-opt:hover .lo-label{text-shadow:0 0 12px var(--green);color:var(--green);}
.lang-opt:hover .lo-native{color:var(--amber);}
.lang-opt::after{content:'';position:absolute;left:0;top:0;right:0;bottom:0;background:linear-gradient(90deg,transparent,rgba(0,255,102,.06),transparent);transform:translateX(-100%);transition:transform .35s ease;pointer-events:none;border-radius:4px;}
.lang-opt:hover::after{transform:translateX(100%);}
.lo-n{color:var(--green-dim);font-size:11px;min-width:24px;text-align:center;border:1px solid rgba(0,255,102,.5);padding:2px 4px;letter-spacing:1px;flex-shrink:0;transition:all .15s;font-family:var(--font-display);}
.lo-flag{font-size:22px;flex-shrink:0;transition:filter .12s;line-height:1;filter:drop-shadow(0 0 3px rgba(255,255,255,.3));}
.lo-text{flex:1;display:flex;flex-direction:column;gap:2px;}
.lo-label{color:var(--green);letter-spacing:2px;font-size:12px;transition:all .12s;font-family:var(--font-display);font-weight:700;}
.lo-native{color:var(--green-dim);font-size:10px;letter-spacing:1px;opacity:.7;transition:color .12s;font-family:var(--font-mono);}
.lo-voice-btn{flex-shrink:0;background:rgba(255,170,0,.05);border:1px solid rgba(255,170,0,.25);color:rgba(122,79,0,1);font-size:10px;padding:3px 8px;cursor:pointer;font-family:var(--font-mono);letter-spacing:1px;transition:all .12s;display:flex;align-items:center;gap:4px;}
.lo-voice-btn:hover{background:rgba(255,170,0,.12);border-color:var(--amber);color:var(--amber);box-shadow:0 0 8px rgba(255,170,0,.2);}
.lo-voice-btn::before{content:'â–¶';font-size:8px;}
#lang-ftr{border-top:1px solid var(--border-dim);padding:10px 24px;color:var(--green-dim);font-size:10px;letter-spacing:2px;display:flex;align-items:center;justify-content:space-between;background:rgba(0,255,102,.015);border-radius:0 0 10px 10px;font-family:var(--font-mono);}
#lang-ftr-left{display:flex;align-items:center;gap:6px;}
#lang-ftr-right{color:rgba(255,26,26,.5);font-size:9px;letter-spacing:1px;animation:bd 2s ease-in-out infinite;}
#lang-voice-toggle{margin-left:8px;background:rgba(0,255,102,.04);border:1px solid rgba(0,255,102,.25);color:var(--green-dim);font-size:9px;padding:2px 7px;cursor:pointer;font-family:var(--font-mono);letter-spacing:1px;transition:all .12s;}
#lang-voice-toggle:hover{color:var(--green);border-color:var(--green);background:rgba(0,255,102,.08);}
#lang-flag{font-size:10px;border:1px solid var(--green-dim);padding:1px 5px;letter-spacing:1px;cursor:pointer;color:var(--green-dim);font-family:var(--font-mono);}
#lang-flag:hover{color:var(--green);border-color:var(--green);}
#lang-data-line{padding:5px 24px;font-size:9px;letter-spacing:3px;color:rgba(0,255,102,.35);border-top:1px solid rgba(0,255,102,.1);display:flex;justify-content:space-between;font-family:var(--font-mono);background:rgba(0,255,102,.015);}
@keyframes langBoxPulse{0%,100%{box-shadow:0 0 80px rgba(0,255,102,.12),inset 0 0 60px rgba(0,255,102,.02),0 0 4px rgba(255,26,26,.3)}50%{box-shadow:0 0 140px rgba(0,255,102,.2),0 0 60px rgba(0,255,102,.08),inset 0 0 80px rgba(0,255,102,.05),0 0 12px rgba(255,26,26,.5),0 0 40px rgba(255,26,26,.15)}}
@keyframes scanBar{0%{top:-2px}100%{top:101%}}
@keyframes cornerBlink{0%,100%{opacity:.5}50%{opacity:1}}
@keyframes ringPulse{0%,100%{transform:translate(-50%,-50%) scale(1);opacity:.2}50%{transform:translate(-50%,-50%) scale(1.06);opacity:.45}}
#lang-screen::after{content:'';position:absolute;left:50%;top:50%;width:min(580px,96vw);height:min(780px,94vh);border:1px solid rgba(0,255,102,.1);border-radius:14px;animation:ringPulse 3.5s ease-in-out infinite;pointer-events:none;}
#lang-box{animation:boxIn .5s ease-out,langBoxPulse 3.5s ease-in-out 1s infinite;}
#lang-box::after{content:'';position:absolute;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent 5%,rgba(0,255,102,.4) 50%,transparent 95%);box-shadow:0 0 6px rgba(0,255,102,.3);animation:scanBar 3.8s linear infinite;pointer-events:none;z-index:10;}
#lang-box .hud-tl,#lang-box .hud-tr,#lang-box .hud-bl,#lang-box .hud-br{position:absolute;width:14px;height:14px;animation:cornerBlink 1.8s ease-in-out infinite;}
#lang-box .hud-tl{top:-1px;left:-1px;border-top:2px solid var(--red);border-left:2px solid var(--red);border-radius:10px 0 0 0;}
#lang-box .hud-tr{top:-1px;right:-1px;border-top:2px solid var(--red);border-right:2px solid var(--red);border-radius:0 10px 0 0;}
#lang-box .hud-bl{bottom:-1px;left:-1px;border-bottom:2px solid var(--red);border-left:2px solid var(--red);border-radius:0 0 0 10px;}
#lang-box .hud-br{bottom:-1px;right:-1px;border-bottom:2px solid var(--red);border-right:2px solid var(--red);border-radius:0 0 10px 0;}

/* â”€â”€ SCANNERS KITT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#sw{position:fixed;top:0;left:0;right:0;height:3px;overflow:hidden;z-index:1000;}
#sb{position:absolute;top:0;width:200px;height:3px;background:linear-gradient(90deg,transparent,var(--red),var(--red),transparent);box-shadow:0 0 14px 4px var(--red);animation:ks 1.8s ease-in-out infinite alternate;}
#swb{position:fixed;bottom:0;left:0;right:0;height:3px;overflow:hidden;z-index:1000;}
#sbb{position:absolute;top:0;width:200px;height:3px;background:linear-gradient(90deg,transparent,var(--red),var(--red),transparent);box-shadow:0 0 14px 4px var(--red);animation:ks 1.8s ease-in-out infinite alternate-reverse;}

/* â”€â”€ STARFIELD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#starfield{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;}

/* â”€â”€ FOND JARVIS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#jarvis-svg{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) translate3d(0,0,0);width:min(90vw,90vh);height:min(90vw,90vh);pointer-events:none;z-index:0;opacity:0.45;}
#sphere-wrap{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:180px;height:180px;perspective:500px;pointer-events:none;z-index:0;opacity:0.22;}
#sphere-3d{width:100%;height:100%;transform-style:preserve-3d;animation:srot 22s linear infinite;}
@keyframes srot{from{transform:rotateX(22deg) rotateY(0deg)}to{transform:rotateX(22deg) rotateY(360deg)}}
.s-mer,.s-par{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:50%;border:1px solid var(--green);box-sizing:border-box;opacity:0.7;}
.s-core{position:absolute;top:50%;left:50%;width:18px;height:18px;margin:-9px 0 0 -9px;border-radius:50%;background:radial-gradient(circle,var(--green),transparent);box-shadow:0 0 20px var(--green),0 0 40px rgba(0,255,102,.4);animation:score 3s ease-in-out infinite;}
@keyframes score{0%,100%{opacity:.6}50%{opacity:1}}

/* â”€â”€ COMPTEUR VISITES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#visit-counter{position:fixed;left:8px;top:50%;transform:translateY(-50%);writing-mode:vertical-rl;text-orientation:mixed;font-size:11px;color:var(--green);letter-spacing:3px;opacity:.65;pointer-events:none;z-index:100;text-shadow:0 0 8px var(--green),0 0 16px rgba(0,255,102,.4);user-select:none;border-left:1px solid rgba(0,255,102,.3);padding-left:4px;font-family:var(--font-mono);}

/* â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#site-footer{position:fixed;bottom:84px;left:50%;transform:translateX(-50%);font-size:10px;color:var(--green-dim);letter-spacing:2px;opacity:.55;pointer-events:none;z-index:1001;white-space:nowrap;user-select:none;text-shadow:0 0 6px var(--green-dim);font-family:var(--font-mono);}

/* â”€â”€ HEADER â˜… AMÃ‰LIORÃ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
header{
  flex-shrink:0;
  display:flex;justify-content:space-between;align-items:center;
  padding:8px 0 6px;
  border-bottom:1px solid rgba(255,26,26,.15);
  margin-bottom:4px;
  position:relative;
}
header::after{
  content:'';position:absolute;bottom:-1px;left:0;right:0;height:1px;
  background:linear-gradient(90deg,transparent,rgba(0,255,102,.3),transparent);
  animation:scanBar 4s linear infinite;
}
.hdr-title{
  color:var(--red);font-family:var(--font-display);
  font-size:12px;letter-spacing:3px;font-weight:700;
  text-shadow:0 0 16px rgba(255,26,26,.6);
  flex:1;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.hdr-right{
  display:flex;align-items:center;gap:10px;
  font-size:11px;color:var(--green-dim);letter-spacing:1px;
  font-family:var(--font-mono);flex-shrink:0;
}
/* â˜… Indicateurs header */
.hdr-indicator{display:flex;align-items:center;gap:4px;font-size:9px;letter-spacing:1px;}
.hdr-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0;}
.hdr-dot.green{background:var(--green);box-shadow:0 0 6px var(--green);animation:dotPulse 2s ease-in-out infinite;}
.hdr-dot.red{background:var(--red);box-shadow:0 0 6px var(--red);animation:dotPulse 1.5s ease-in-out infinite;}
.hdr-dot.amber{background:var(--amber);box-shadow:0 0 6px var(--amber);}
@keyframes dotPulse{0%,100%{opacity:1}50%{opacity:.3}}
#clock{font-family:var(--font-display);font-size:11px;color:var(--cyan);letter-spacing:2px;text-shadow:0 0 8px var(--cyan);}
/* â˜… Mode KITT indicator */
#kitt-mode-badge{
  font-family:var(--font-display);font-size:8px;letter-spacing:2px;
  padding:2px 6px;border:1px solid;border-radius:2px;
  transition:all .3s;
}
#kitt-mode-badge.normal{color:var(--green);border-color:var(--green);box-shadow:0 0 6px rgba(0,255,102,.2);}
#kitt-mode-badge.pursuit{color:var(--cyan);border-color:var(--cyan);box-shadow:0 0 6px rgba(0,204,255,.4);animation:modeFlash .6s ease-in-out infinite;}
#kitt-mode-badge.turbo{color:var(--red);border-color:var(--red);box-shadow:0 0 12px rgba(255,26,26,.6);animation:modeFlash .3s ease-in-out infinite;}
@keyframes modeFlash{0%,100%{opacity:1}50%{opacity:.4}}

/* â”€â”€ TERMINAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#terminal{flex:1;overflow-y:auto;overflow-x:hidden;padding:8px 4px;font-size:15px;line-height:1.65;scrollbar-width:thin;scrollbar-color:var(--red) #111;font-family:var(--font-terminal);}
#terminal::-webkit-scrollbar{width:4px}
#terminal::-webkit-scrollbar-track{background:#111}
#terminal::-webkit-scrollbar-thumb{background:var(--red)}
.line-ok{color:var(--green);}
.line-warn{color:var(--amber);}
.line-err{color:var(--red);}
.line-info{color:var(--cyan);}
.line-dim{color:var(--green-dim);}
/* â˜… Ligne de commande saisie */
.line-cmd{color:var(--amber);font-family:var(--font-terminal);}
.cursor{display:inline-block;width:8px;height:14px;background:var(--green);vertical-align:text-bottom;animation:bc .7s step-end infinite;}
@keyframes bc{0%,100%{opacity:1}50%{opacity:0}}

/* â˜… TURBO BOOST animation overlay */
#turbo-overlay{
  position:fixed;top:0;left:0;right:0;bottom:0;
  z-index:7500;pointer-events:none;display:none;
  background:radial-gradient(ellipse at center,rgba(255,26,26,.05) 0%,transparent 70%);
}
#turbo-overlay.active{display:block;animation:turboFlash .15s ease-in-out 8;}
@keyframes turboFlash{0%{background:radial-gradient(ellipse at center,rgba(255,26,26,.3) 0%,transparent 70%)}100%{background:radial-gradient(ellipse at center,rgba(255,26,26,.02) 0%,transparent 70%)}}

/* â”€â”€ BUTTONS â˜… AMÃ‰LIORÃ‰S â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn-row{flex-shrink:0;display:flex;flex-wrap:wrap;gap:6px;padding:8px 0 6px;border-top:1px solid #1a0000;border-bottom:1px solid #1a0000;}
button{
  background:#000;border:1px solid var(--green);color:var(--green);
  padding:7px 14px;cursor:pointer;font-family:var(--font-display);font-size:10px;
  letter-spacing:1px;transition:all .15s;position:relative;overflow:hidden;
  border-radius:2px;
}
button::before{content:"";position:absolute;inset:0;background:var(--green);transform:scaleX(0);transform-origin:left;transition:transform .15s;z-index:-1;}
button:hover{color:#000;}button:hover::before{transform:scaleX(1);}
button:active{transform:scale(.95);}
/* â˜… Ripple effect */
button .ripple{position:absolute;border-radius:50%;background:rgba(255,255,255,.3);transform:scale(0);animation:ripple .5s linear;pointer-events:none;}
@keyframes ripple{to{transform:scale(4);opacity:0}}
.btn-red{border-color:var(--red);color:var(--red);}
.btn-red::before{background:var(--red);}
.btn-cyan{border-color:var(--cyan);color:var(--cyan);}
.btn-cyan::before{background:var(--cyan);}

/* â”€â”€ INPUT â˜… AMÃ‰LIORÃ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.input-row{flex-shrink:0;display:flex;gap:8px;padding-top:8px;align-items:center;position:relative;}
.prompt-lbl{color:var(--red);font-size:14px;white-space:nowrap;text-shadow:0 0 8px var(--red);font-family:var(--font-display);font-weight:700;}
#cmd-input{
  flex:1;background:transparent;border:none;border-bottom:1px solid var(--green);
  color:var(--green);font-family:var(--font-terminal);font-size:17px;outline:none;
  padding:4px 0;caret-color:var(--green);
}
#cmd-input::placeholder{color:var(--green-dim);opacity:.55;}
/* â˜… Hint/ghost text autocompletion */
#cmd-hint{
  position:absolute;left:0;bottom:0;
  font-family:var(--font-terminal);font-size:17px;
  color:rgba(0,255,102,.2);padding:4px 0;
  pointer-events:none;letter-spacing:0;
  white-space:nowrap;overflow:hidden;
}

/* â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.95);display:none;flex-direction:column;padding:30px;overflow:auto;z-index:5000;border:1px solid var(--red);}
.modal.open{display:flex;}
.modal-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;border-bottom:1px solid var(--red);padding-bottom:8px;}
.modal-title{color:var(--red);font-size:16px;letter-spacing:3px;text-shadow:0 0 10px var(--red);font-family:var(--font-display);}
.close-btn{cursor:pointer;color:var(--red);font-size:20px;padding:4px 8px;border:1px solid var(--red);transition:all .15s;font-family:var(--font-display);}
.close-btn:hover{background:var(--red);color:#000;}
.modal pre{white-space:pre-wrap;color:var(--green);font-family:var(--font-mono);font-size:13px;line-height:1.7;}

/* â”€â”€ TABLEAU DE BORD KITT â˜… ENRICHI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@keyframes kScan{0%{left:4%}48%{left:calc(100% - 28px)}50%{left:calc(100% - 28px)}98%{left:4%}100%{left:4%}}
@keyframes kScanGlow{0%,48%,52%,100%{box-shadow:0 0 10px 4px rgba(255,20,0,.7),0 0 22px 8px rgba(255,20,0,.35)}49%,51%{box-shadow:0 0 14px 6px rgba(255,60,0,.9),0 0 30px 12px rgba(255,40,0,.5)}}
@keyframes dashFadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
#kitt-dash{
  position:fixed;bottom:0;left:0;right:0;height:76px;
  background:linear-gradient(180deg,rgba(0,0,0,0) 0%,rgba(2,0,0,.88) 30%,#060000 100%);
  z-index:110;pointer-events:none;display:none;
  border-top:1px solid rgba(255,26,26,.08);
}
#kitt-dash.visible{display:block;animation:dashFadeIn .8s ease-out forwards;}
#kitt-hood{
  position:absolute;bottom:0;left:50%;transform:translateX(-50%);
  width:min(760px,98vw);height:68px;
  background:linear-gradient(180deg,#0a0000 0%,#000 60%);
  border-radius:40% 40% 0 0 / 55% 55% 0 0;
  border-top:1px solid rgba(255,26,26,.15);
  overflow:hidden;display:flex;align-items:flex-end;justify-content:center;
  gap:0;
}
/* â˜… Jauges latÃ©rales */
.kitt-gauge{
  display:flex;flex-direction:column;align-items:center;justify-content:flex-end;
  padding-bottom:6px;min-width:54px;
  font-family:var(--font-display);font-size:7px;letter-spacing:1px;
  opacity:.8;
}
.kitt-gauge-label{color:var(--green-dim);margin-bottom:2px;}
.kitt-gauge-val{color:var(--green);text-shadow:0 0 6px var(--green);}
.kitt-gauge-bar{width:36px;height:3px;background:rgba(0,255,102,.15);border-radius:2px;overflow:hidden;margin-bottom:2px;}
.kitt-gauge-fill{height:100%;border-radius:2px;transition:width .5s ease;}
.kitt-gauge-fill.green{background:var(--green);}
.kitt-gauge-fill.amber{background:var(--amber);}
.kitt-gauge-fill.red{background:var(--red);}
/* Scanner central */
#kitt-scan-center{flex:1;display:flex;align-items:center;justify-content:center;flex-direction:column;padding-bottom:4px;}
#kitt-scan-track{
  position:relative;width:85%;max-width:300px;height:6px;
  background:rgba(40,0,0,.6);border-radius:3px;
  box-shadow:inset 0 1px 3px rgba(0,0,0,.8);
}
#kitt-scan-dot{
  position:absolute;top:-1px;left:4%;
  width:24px;height:8px;border-radius:4px;
  background:linear-gradient(90deg,rgba(255,20,0,.3),#ff1a00,rgba(255,20,0,.3));
  animation:kScan 1.9s ease-in-out infinite,kScanGlow 1.9s ease-in-out infinite;
}
#kitt-scan-trail{position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(90deg,transparent 10%,rgba(255,20,0,.04) 50%,transparent 90%);border-radius:3px;}
/* â˜… SPEED display sous le scanner */
#kitt-speed-display{
  font-family:var(--font-display);font-size:9px;letter-spacing:2px;
  color:rgba(255,26,26,.4);margin-top:3px;
}

/* â˜… VISUALISEUR AUDIO */
#kitt-visualizer{
  display:flex;align-items:flex-end;justify-content:center;
  gap:2px;height:22px;width:90px;
  opacity:0;transition:opacity .4s ease;
  position:absolute;top:6px;left:50%;transform:translateX(-50%);
}
#kitt-visualizer.speaking{ opacity:1; }
.viz-bar{
  width:3px;border-radius:2px 2px 0 0;
  background:linear-gradient(180deg,#ff4400,#ff1a00 60%,rgba(255,26,26,.3));
  animation:none;transform-origin:bottom;
  box-shadow:0 0 4px rgba(255,60,0,.5);
  height:3px;
}
.viz-bar.active{ animation:vizPulse var(--dur,0.4s) ease-in-out infinite alternate; }
@keyframes vizPulse{
  from{ height:2px;opacity:.4; }
  to{ height:var(--h,18px);opacity:1; }
}

/* â˜… HUD MISSIONS */
#kitt-mission-hud{
  position:fixed;top:50px;right:10px;z-index:500;
  width:200px;background:rgba(2,0,0,.9);
  border:1px solid rgba(255,26,26,.25);border-radius:8px;
  padding:10px 12px;font-family:var(--font-mono);
  backdrop-filter:blur(8px);
  box-shadow:0 0 20px rgba(255,26,26,.1);
  display:none;
  animation:hudSlide .3s ease-out forwards;
}
#kitt-mission-hud.visible{ display:block; }
@keyframes hudSlide{ from{opacity:0;transform:translateX(20px)} to{opacity:1;transform:translateX(0)} }
#mission-title{
  font-family:var(--font-display);font-size:9px;letter-spacing:3px;
  color:var(--red);text-shadow:0 0 8px var(--red);margin-bottom:8px;
  border-bottom:1px solid rgba(255,26,26,.2);padding-bottom:5px;
}
#mission-progress-bar{
  height:2px;background:rgba(255,26,26,.15);border-radius:1px;margin-bottom:8px;
}
#mission-progress-fill{
  height:100%;background:var(--green);border-radius:1px;
  transition:width .5s ease;box-shadow:0 0 6px var(--green);
}
.mission-item{
  font-size:9px;letter-spacing:1px;padding:2px 0;
  display:flex;gap:6px;align-items:center;
  color:rgba(255,255,255,.35);transition:color .3s;
}
.mission-item.done{ color:var(--green); }
.mission-item.done .m-check{ color:var(--green); }
.m-check{ font-size:10px;width:10px;flex-shrink:0; }
#mission-close{
  margin-top:8px;font-size:8px;letter-spacing:2px;color:rgba(255,26,26,.4);
  cursor:pointer;text-align:center;
  border-top:1px solid rgba(255,26,26,.1);padding-top:6px;
  transition:color .2s;font-family:var(--font-display);
}
#mission-close:hover{ color:var(--red); }

/* â”€â”€ APPEL ENTRANT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@keyframes callRing{0%,100%{transform:scale(1)}10%,30%{transform:scale(1.04)}20%,40%{transform:scale(.98)}}
@keyframes callPulse{0%,100%{box-shadow:0 0 0 0 rgba(255,26,26,.4)}70%{box-shadow:0 0 0 16px rgba(255,26,26,0)}}
@keyframes callIn{from{opacity:0;transform:translateX(24px)}to{opacity:1;transform:translateX(0)}}
#kitt-call{
  position:fixed;bottom:90px;right:14px;z-index:9200;
  background:rgba(2,0,0,.94);border:1px solid var(--red);border-radius:10px;
  padding:16px 20px 14px;width:min(240px,85vw);text-align:center;
  backdrop-filter:blur(10px);display:none;
  box-shadow:0 0 30px rgba(255,26,26,.25),0 4px 20px rgba(0,0,0,.6);
}
#kitt-call.active{display:block;animation:callIn .3s cubic-bezier(.34,1.56,.64,1) forwards;}
#call-avatar{
  width:48px;height:48px;border-radius:50%;border:2px solid var(--red);
  margin:0 auto 10px;display:flex;align-items:center;justify-content:center;
  font-size:13px;letter-spacing:2px;color:var(--red);background:rgba(40,0,0,.6);
  animation:callRing 1.2s ease-in-out infinite,callPulse 1.4s ease-in-out infinite;
  font-family:var(--font-display);
}
#call-name{color:var(--red);font-size:12px;letter-spacing:4px;text-shadow:0 0 14px var(--red);margin-bottom:3px;font-family:var(--font-display);}
#call-status{color:rgba(255,100,0,.7);font-size:8px;letter-spacing:3px;margin-bottom:14px;animation:bd 1.1s ease-in-out infinite;font-family:var(--font-mono);}
.call-btns{display:flex;gap:10px;justify-content:center;}
.call-btn{flex:1;padding:8px 0;border:1px solid;border-radius:5px;cursor:pointer;font-family:var(--font-display);font-size:9px;letter-spacing:2px;background:transparent;transition:all .15s;pointer-events:all;}
#call-accept{border-color:var(--green);color:var(--green);}
#call-accept:hover,#call-accept:active{background:var(--green);color:#000;}
#call-ignore{border-color:#333;color:#555;}
#call-ignore:hover,#call-ignore:active{border-color:var(--red);color:var(--red);}

/* â”€â”€ TUNNEL BUTTON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#btn-tunnel{border-color:#333;color:#333;transition:all .3s;position:relative;}
#btn-tunnel.tunnel-online{border-color:var(--green);color:var(--green);animation:tpulse 2.4s ease-in-out infinite;}
#btn-tunnel.tunnel-offline{border-color:var(--red);color:var(--red);}
#btn-tunnel.tunnel-checking{border-color:var(--amber);color:var(--amber);}
#btn-tunnel.tunnel-locked{
  border-color:#333 !important;color:#2a2a2a !important;
  cursor:not-allowed !important;opacity:.45 !important;
  animation:none !important;pointer-events:none;
}
#btn-tunnel.tunnel-locked::after{
  content:'ğŸ”’';position:absolute;right:6px;top:50%;transform:translateY(-50%);font-size:10px;
}
#btn-tunnel.tunnel-unlocking{
  border-color:var(--amber) !important;color:var(--amber) !important;
  animation:unlockFlash .25s ease-in-out 8 !important;
}
@keyframes unlockFlash{0%,100%{opacity:1;box-shadow:none}50%{opacity:.3;box-shadow:0 0 18px var(--amber),0 0 40px rgba(255,170,0,.4);}}
@keyframes tpulse{0%,100%{box-shadow:0 0 6px rgba(0,255,102,.3)}50%{box-shadow:0 0 18px rgba(0,255,102,.7),0 0 40px rgba(0,255,102,.3);}}
@keyframes tpulse{0%,100%{box-shadow:0 0 5px rgba(0,255,102,.25)}50%{box-shadow:0 0 18px rgba(0,255,102,.65),inset 0 0 8px rgba(0,255,102,.08)}}

/* â”€â”€ CONTAINER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.container{
  position:relative;z-index:1;
  display:flex;flex-direction:column;
  height:100vh;height:100dvh;
  padding:10px 16px 6px;
  max-width:760px;margin:0 auto;
  overflow:hidden;
  transition:padding-bottom .5s ease;
}
.container.dash-visible{
  padding-bottom:82px;
}

/* â”€â”€ MOBILE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media(max-width:600px){
  #cmd-input{font-size:16px !important;}
  .container:not(.dash-visible){padding-bottom:max(6px,env(safe-area-inset-bottom));}
  .container.dash-visible{padding-bottom:max(88px,calc(82px + env(safe-area-inset-bottom)));}
  .input-row{padding-top:10px;padding-bottom:4px;}
  .hdr-title{font-size:10px;letter-spacing:1px;}
  button{padding:6px 10px;font-size:9px;}
  #terminal{font-size:14px;}
  #lang-box{max-width:98vw;border-radius:8px;}
  #lang-hdr{padding:12px 14px 10px;}
  .lang-logo-kitt,.lang-logo-alien{font-size:14px !important;letter-spacing:3px !important;}
  .lang-opt{padding:8px 12px;gap:10px;margin:1px 4px;}
  .lo-flag{font-size:18px !important;}
  .lo-label{font-size:11px;}
  .lo-voice-btn{font-size:9px;padding:3px 6px;}
  #lang-data-line{padding:4px 14px;font-size:8px;letter-spacing:1px;}
  #lang-ftr{padding:8px 14px;}
  #lang-screen::after{display:none;}
  #access-box{padding:20px 16px;max-width:98vw;}
  #mother-box{padding:16px 14px;}
  #mother-output{font-size:12px;min-height:200px;}
}
@media(hover:none){
  .lang-opt:hover{transform:none;box-shadow:none;}
  .lang-opt:active{background:rgba(255,26,26,.1);border-left-color:var(--red);}
}
#access-input{font-size:16px;}

/* â˜… SCAN animation pour cmd scan */
@keyframes scanPulse{0%,100%{box-shadow:0 0 0 0 rgba(0,255,102,.5)}50%{box-shadow:0 0 0 20px rgba(0,255,102,0)}}
</style>
</head>
<body>

<canvas id="starfield"></canvas>

<!-- Turbo overlay -->
<div id="turbo-overlay"></div>

<!-- Ã‰CRAN ACCÃˆS -->
<div id="access-screen">
  <div id="access-box">
      <span class="a-tl"></span><span class="a-tr"></span><span class="a-bl"></span><span class="a-br"></span>
    <div id="access-hdr">WEYLAND-YUTANI CORP. // ACCÃˆS SÃ‰CURISÃ‰</div>
    <div style="text-align:center;font-size:9px;letter-spacing:3px;color:#442200;margin-bottom:8px;margin-top:-8px;font-family:var(--font-mono);">&#9656; KYRONEX SYSTEMS // op. MANIX &#9666;</div>
    <div id="access-log"></div>
    <div id="access-input-row">
      <span id="access-prompt">CODE D'ACCÃˆS &gt;</span>
      <input id="access-input" type="password" maxlength="10" placeholder="_ _ _ _" autocomplete="off" spellcheck="false"/>
    </div>
    <div id="access-hint">ENTREZ LE CODE D'ACCÃˆS SYSTÃˆME</div>
    <!-- â˜… Barre de progression -->
    <div id="access-progress"><div id="access-progress-bar"></div></div>
  </div>
</div>

<!-- MU-TH-UR 6000 INTRO -->
<div id="mother-intro" style="display:none">
  <div id="mother-box">
      <span class="m-tl"></span><span class="m-tr"></span><span class="m-bl"></span><span class="m-br"></span>
    <div id="mother-hdr">MU-TH-UR 6000 // WEYLAND-YUTANI CORP.</div>
    <div id="mother-output"></div>
    <div id="mother-skip">&gt;&gt;&gt; CLIQUEZ OU APPUYEZ SUR UNE TOUCHE &lt;&lt;&lt;</div>
  </div>
</div>

<!-- LANGUAGE SELECTION -->
<div id="lang-screen">
  <div class="lang-scanner-top"></div>
  <div class="lang-scanner-bot"></div>
  <div id="lang-box">
    <div class="hud-tl"></div><div class="hud-tr"></div><div class="hud-bl"></div><div class="hud-br"></div>
    <div id="lang-hdr">
      <div id="lang-logo-line">
        <span class="lang-logo-kitt">KÂ·IÂ·TÂ·T</span>
        <span class="lang-logo-sep">Ã—</span>
        <span class="lang-logo-alien">ALIEN</span>
      </div>
      <div id="lang-sys-id"></div>
    </div>
    <div id="lang-sub"></div>
    <div id="lang-output"></div>
    <div id="lang-data-line"><span id="lang-data-l">KYRONEX // NOSTROMO-180924609</span><span id="lang-data-r">op.MANIX &#9679; STAT:NOMINAL</span></div>
    <div id="lang-ftr">
      <div id="lang-ftr-left">
        <span id="lang-ftr-txt"></span>
        <button id="lang-voice-toggle" onclick="toggleLangVoice()">&#128266; VOIX</button>
      </div>
      <div id="lang-ftr-right">KYRONEX // MU-TH-UR &#9673;</div>
    </div>
  </div>
</div>

<!-- Fond Jarvis holographique -->
<svg id="jarvis-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400" preserveAspectRatio="xMidYMid meet">
  <g stroke="#00ff66" fill="none">
    <circle cx="200" cy="200" r="185" stroke-opacity="0.6" stroke-width="1"><animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/></circle>
    <circle cx="200" cy="200" r="135" stroke-opacity="0.5" stroke-width="0.8"><animateTransform attributeName="transform" type="rotate" from="360 200 200" to="0 200 200" dur="45s" repeatCount="indefinite"/></circle>
    <circle cx="200" cy="200" r="85" stroke-opacity="0.45" stroke-width="0.7"><animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="32s" repeatCount="indefinite"/></circle>
    <line x1="200" y1="15" x2="200" y2="385" stroke-opacity="0.18" stroke-width="0.5"><animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/></line>
    <line x1="15" y1="200" x2="385" y2="200" stroke-opacity="0.18" stroke-width="0.5"><animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/></line>
    <path d="M 200 15 A 185 185 0 0 1 385 200" stroke-opacity="0.9" stroke-width="2" stroke="#00ff66"><animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="8s" repeatCount="indefinite"/></path>
    <line x1="200" y1="15" x2="200" y2="30" stroke-opacity="0.7" stroke-width="1.5"><animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/></line>
    <circle cx="200" cy="200" r="5" fill="#00ff66" opacity="0.7"><animate attributeName="opacity" values="0.3;1;0.3" dur="3s" repeatCount="indefinite"/><animate attributeName="r" values="4;7;4" dur="3s" repeatCount="indefinite"/></circle>
  </g>
</svg>
<div id="sphere-wrap">
  <div id="sphere-3d">
    <div class="s-mer" style="transform:rotateY(0deg)"></div>
    <div class="s-mer" style="transform:rotateY(30deg)"></div>
    <div class="s-mer" style="transform:rotateY(60deg)"></div>
    <div class="s-mer" style="transform:rotateY(90deg)"></div>
    <div class="s-mer" style="transform:rotateY(120deg)"></div>
    <div class="s-mer" style="transform:rotateY(150deg)"></div>
    <div class="s-par" style="transform:translateY(-44px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(-22px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(0px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(22px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(44px) rotateX(90deg)"></div>
    <div class="s-core"></div>
  </div>
</div>
<div id="visit-counter"></div>
<div id="site-footer">v3.1 &nbsp;â€”&nbsp; DERNIÃˆRE MISE Ã€ JOUR : 2026-02-23</div>

<!-- Scanners -->
<div id="sw"><div id="sb"></div></div>
<div id="swb"><div id="sbb"></div></div>

<div class="container">
  <header>
    <div id="hdr-title" class="hdr-title">KITT FRANCO-BELGE // INTERFACE CENTRALE</div>
    <div class="hdr-right">
      <!-- â˜… Mode badge -->
      <span id="kitt-mode-badge" class="normal">NORMAL</span>
      <span id="lang-flag" onclick="showLangScreen()" title="Changer de langue">FR</span>
      <span class="hdr-indicator">
        <span class="hdr-dot green" id="net-dot"></span>
        <span id="status-txt">EN LIGNE</span>
      </span>
      <span id="clock">00:00:00</span>
    </div>
  </header>

  <div id="terminal"></div>

  <div class="btn-row">
    <button id="btn-boot" onclick="ripple(event);boot()">[ INITIALISER ]</button>
    <button id="btn-diag" onclick="ripple(event);runSelfTest()" class="btn-cyan">[ DIAGNOSTIC ]</button>
    <button id="btn-mentions" onclick="ripple(event);openFile('Mentions.txt',T[LANG].modal_mentions)" class="btn-red">[ MENTIONS ]</button>
    <button id="btn-licence" onclick="ripple(event);openFile('License.txt',T[LANG].modal_licence)" class="btn-red">[ LICENCE ]</button>
    <button id="btn-clear" onclick="ripple(event);clearTerm()">[ EFFACER ]</button>
    <button id="btn-missions" onclick="ripple(event);_toggleMissionHud()" style="border-color:rgba(255,180,0,.5);color:rgba(255,180,0,.7);">[ MISSIONS ]</button>
    <button id="btn-tunnel" class="tunnel-checking" onclick="ripple(event);connectTunnel()" title="VÃ©rification..."><span id="btn-tunnel-txt">[ CONNEXION KITT ]</span></button>
  </div>

  <div class="input-row">
    <span class="prompt-lbl">KITT&gt;</span>
    <div style="flex:1;position:relative;">
      <input id="cmd-input" type="text" placeholder="entrez une commande..." autocomplete="off" spellcheck="false"/>
      <div id="cmd-hint"></div>
    </div>
  </div>
</div>

<!-- Modal -->
<div id="modal" class="modal">
  <div class="modal-hdr">
    <span class="modal-title" id="modal-title">DOCUMENT</span>
    <span class="close-btn" onclick="closeModal()">&#10006;</span>
  </div>
  <pre id="modal-content"></pre>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUDIO ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const _ac = new (window.AudioContext || window.webkitAudioContext)();
function _resume() { if (_ac.state === 'suspended') _ac.resume(); }

function sndClick() {
  try {
    _resume(); const t = _ac.currentTime;
    const len = Math.floor(_ac.sampleRate * 0.020);
    const buf = _ac.createBuffer(1, len, _ac.sampleRate);
    const d = buf.getChannelData(0);
    for (let i = 0; i < len; i++) d[i] = (Math.random()*2-1) * Math.pow(1-i/len, 3.5);
    const src = _ac.createBufferSource(); src.buffer = buf;
    const bp = _ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=2700+Math.random()*400; bp.Q.value=4;
    const hp = _ac.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=850;
    const g = _ac.createGain(); g.gain.value=0.25;
    src.connect(bp); bp.connect(hp); hp.connect(g); g.connect(_ac.destination); src.start(t);
    const o = _ac.createOscillator(); o.type='square';
    o.frequency.setValueAtTime(1350+Math.random()*200, t);
    o.frequency.exponentialRampToValueAtTime(680, t+0.017);
    const og = _ac.createGain(); og.gain.setValueAtTime(0.04, t); og.gain.exponentialRampToValueAtTime(0.001, t+0.020);
    o.connect(og); og.connect(_ac.destination); o.start(t); o.stop(t+0.022);
  } catch(e){}
}
function sndTick() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='triangle';
    o.frequency.setValueAtTime(3800+Math.random()*400, t);
    o.frequency.exponentialRampToValueAtTime(2400, t+0.012);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.03, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.015);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.016);
  } catch(e){}
}
function sndData() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='sawtooth';
    o.frequency.value = 1800 + Math.random()*600;
    const g = _ac.createGain(); g.gain.setValueAtTime(0.05, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.012);
    const lp = _ac.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=4000;
    o.connect(lp); lp.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.013);
  } catch(e){}
}
function sndGlitch() {
  try {
    _resume(); const t = _ac.currentTime;
    const len = Math.floor(_ac.sampleRate * 0.035);
    const buf = _ac.createBuffer(1, len, _ac.sampleRate);
    const d = buf.getChannelData(0);
    for (let i = 0; i < len; i++) d[i] = (Math.random()*2-1) * (Math.random() > 0.5 ? 0.9 : 0.05);
    const src = _ac.createBufferSource(); src.buffer=buf;
    const bp = _ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=1200; bp.Q.value=2;
    const g = _ac.createGain(); g.gain.value=0.12;
    src.connect(bp); bp.connect(g); g.connect(_ac.destination); src.start(t);
  } catch(e){}
}
function sndLineEnd() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(840, t); o.frequency.exponentialRampToValueAtTime(320, t+0.10);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.032, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.11);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.12);
    const o2 = _ac.createOscillator(); o2.type='sine'; o2.frequency.value=80;
    const g2 = _ac.createGain(); g2.gain.setValueAtTime(0.015, t); g2.gain.exponentialRampToValueAtTime(0.001, t+0.08);
    o2.connect(g2); g2.connect(_ac.destination); o2.start(t); o2.stop(t+0.09);
  } catch(e){}
}
function sndSelect() {
  try {
    _resume(); const t = _ac.currentTime;
    [440,660,880].forEach((f,i) => {
      const o = _ac.createOscillator(); o.type='square'; o.frequency.value=f;
      const g = _ac.createGain(); g.gain.setValueAtTime(0.04, t+i*0.06); g.gain.exponentialRampToValueAtTime(0.001, t+i*0.06+0.05);
      o.connect(g); g.connect(_ac.destination); o.start(t+i*0.06); o.stop(t+i*0.06+0.055);
    });
  } catch(e){}
}
function sndError() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='square'; o.frequency.value=180;
    const g = _ac.createGain(); g.gain.setValueAtTime(0.07, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.08);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.09);
  } catch(e){}
}
function kittChime() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(880, t); o.frequency.exponentialRampToValueAtTime(220, t+0.35);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.1, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.4);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.4);
  } catch(e){}
}
// â˜… Son turbo boost
function sndTurbo() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='sawtooth';
    o.frequency.setValueAtTime(80, t); o.frequency.exponentialRampToValueAtTime(2400, t+0.6);
    const lp = _ac.createBiquadFilter(); lp.type='lowpass'; lp.frequency.setValueAtTime(400, t); lp.frequency.exponentialRampToValueAtTime(8000, t+0.6);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.15, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.65);
    o.connect(lp); lp.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.7);
    // Noise burst
    const len = Math.floor(_ac.sampleRate * 0.4);
    const buf = _ac.createBuffer(1, len, _ac.sampleRate);
    const d = buf.getChannelData(0);
    for (let i = 0; i < len; i++) d[i] = (Math.random()*2-1) * Math.pow(1-i/len, 1.5);
    const src = _ac.createBufferSource(); src.buffer = buf;
    const hp = _ac.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=1200;
    const ng = _ac.createGain(); ng.gain.value=0.06;
    src.connect(hp); hp.connect(ng); ng.connect(_ac.destination); src.start(t+0.1);
  } catch(e){}
}
// â˜… Son scan
function sndScan() {
  try {
    _resume(); const t = _ac.currentTime;
    for (let i = 0; i < 5; i++) {
      const o = _ac.createOscillator(); o.type='sine';
      o.frequency.setValueAtTime(600 + i*200, t + i*0.12);
      o.frequency.exponentialRampToValueAtTime(1200 + i*100, t + i*0.12 + 0.1);
      const g = _ac.createGain(); g.gain.setValueAtTime(0.04, t+i*0.12); g.gain.exponentialRampToValueAtTime(0.001, t+i*0.12+0.12);
      o.connect(g); g.connect(_ac.destination); o.start(t+i*0.12); o.stop(t+i*0.12+0.13);
    }
  } catch(e){}
}

function sndMotherClick() {
  try {
    _resume(); const t = _ac.currentTime;
    const buf = _ac.createBuffer(1, _ac.sampleRate * 0.06, _ac.sampleRate);
    const d = buf.getChannelData(0);
    for (let i = 0; i < d.length; i++) d[i] = (Math.random() * 2 - 1) * Math.exp(-i / (d.length * 0.3));
    const src = _ac.createBufferSource(); src.buffer = buf;
    const lp = _ac.createBiquadFilter(); lp.type = 'lowpass'; lp.frequency.value = 800;
    const g = _ac.createGain(); g.gain.setValueAtTime(0.18, t);
    src.connect(lp); lp.connect(g); g.connect(_ac.destination); src.start(t);
  } catch(e){}
}
function sndMotherBeep() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type = 'sine';
    o.frequency.setValueAtTime(330, t); o.frequency.linearRampToValueAtTime(440, t + 0.1);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.09, t); g.gain.exponentialRampToValueAtTime(0.001, t + 0.12);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t + 0.13);
  } catch(e){}
}
function sndMotherScan() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type = 'sawtooth';
    o.frequency.setValueAtTime(180, t); o.frequency.linearRampToValueAtTime(360, t + 0.4);
    const lp = _ac.createBiquadFilter(); lp.type = 'lowpass'; lp.frequency.value = 900;
    const g = _ac.createGain(); g.gain.setValueAtTime(0.05, t); g.gain.exponentialRampToValueAtTime(0.001, t + 0.45);
    o.connect(lp); lp.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t + 0.45);
  } catch(e){}
}
function sndMotherChime() {
  try {
    _resume(); const t = _ac.currentTime;
    [220, 330, 440].forEach((freq, i) => {
      const o = _ac.createOscillator(); o.type = 'sine'; o.frequency.value = freq;
      const g = _ac.createGain(); const s = t + i * 0.22;
      g.gain.setValueAtTime(0, s); g.gain.linearRampToValueAtTime(0.12, s + 0.06);
      g.gain.exponentialRampToValueAtTime(0.001, s + 0.38);
      o.connect(g); g.connect(_ac.destination); o.start(s); o.stop(s + 0.4);
    });
  } catch(e){}
}
function sndMutherBeep() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(1480, t); o.frequency.setValueAtTime(1120, t+0.05);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.06, t); g.gain.setValueAtTime(0.06, t+0.05); g.gain.exponentialRampToValueAtTime(0.001, t+0.12);
    const hp = _ac.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=900;
    o.connect(hp); hp.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.13);
  } catch(e){}
}

const SPECIAL_CHARS = new Set([...'[]():=|â”€â•â•â•”â•—â•šâ•â•‘â”Œâ”â””â”˜â”œâ”¤â€¢â˜…']);
let _charCount = 0;
function playChar(ch) {
  if (ch === ' ' || ch === '\n') return;
  _charCount++;
  const r = Math.random();
  if (SPECIAL_CHARS.has(ch)) { sndData(); return; }
  if (_charCount % 47 === 0) { sndGlitch(); return; }
  if (r < 0.03) { sndGlitch(); return; }
  if (r < 0.14) { sndTick(); return; }
  if (r < 0.72) { sndClick(); return; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â˜… RIPPLE EFFECT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ripple(e) {
  const btn = e.currentTarget;
  const circle = document.createElement('span');
  const diameter = Math.max(btn.clientWidth, btn.clientHeight);
  const radius = diameter / 2;
  const rect = btn.getBoundingClientRect();
  circle.style.width = circle.style.height = diameter + 'px';
  circle.style.left = (e.clientX - rect.left - radius) + 'px';
  circle.style.top = (e.clientY - rect.top - radius) + 'px';
  circle.classList.add('ripple');
  const existing = btn.querySelector('.ripple');
  if (existing) existing.remove();
  btn.appendChild(circle);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â˜… MODE KITT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let kittMode = 'normal';
const MODES = ['normal', 'pursuit', 'turbo'];
const _MODE_LABELS_BY_LANG = {
  fr:{normal:'NORMAL',pursuit:'S.POURSUITE',turbo:'TURBO BOOST'},
  en:{normal:'NORMAL',pursuit:'S.PURSUIT',turbo:'TURBO BOOST'},
  nl:{normal:'NORMAAL',pursuit:'S.ACHTERVOLGING',turbo:'TURBO BOOST'},
  it:{normal:'NORMALE',pursuit:'S.INSEGUIMENTO',turbo:'TURBO BOOST'},
  de:{normal:'NORMAL',pursuit:'S.VERFOLGUNG',turbo:'TURBO BOOST'},
  es:{normal:'NORMAL',pursuit:'S.PERSECUCIÃ“N',turbo:'TURBO BOOST'},
  pt:{normal:'NORMAL',pursuit:'S.PERSEGUIÃ‡ÃƒO',turbo:'TURBO BOOST'},
};
const MODE_LABELS = { normal: 'NORMAL', pursuit: 'S.POURSUITE', turbo: 'TURBO BOOST' };
let kittSpeed = 0;
let speedInterval = null;

function setKittMode(mode) {
  kittMode = mode;
  const badge = document.getElementById('kitt-mode-badge');
  if (badge) {
    badge.className = mode;
    const ml = _MODE_LABELS_BY_LANG[LANG]||_MODE_LABELS_BY_LANG.en;
    badge.textContent = ml[mode] || mode.toUpperCase();
  }
  // â˜… Update speed gauge
  const speedEl = document.getElementById('kitt-speed-display');
  if (speedEl) {
    if (mode === 'normal') kittSpeed = 0;
    else if (mode === 'pursuit') kittSpeed = 220;
    else kittSpeed = 480;
    speedEl.textContent = mode !== 'normal' ? kittSpeed + ' KM/H' : '';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MU-TH-UR 6000 INTRO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function motherSpeak(text, onEnd) {
  if (!window.speechSynthesis) { if (onEnd) onEnd(); return; }
  speechSynthesis.cancel();
  const utt = new SpeechSynthesisUtterance(text);
  utt.lang = 'fr-FR'; utt.rate = 0.72; utt.pitch = 0.5; utt.volume = 0.85;
  if (onEnd) utt.onend = onEnd;
  const loadVoices = () => {
    const voices = speechSynthesis.getVoices();
    const v = voices.find(v => v.lang.startsWith('fr') && v.name.toLowerCase().includes('female')) || voices.find(v => v.lang.startsWith('fr'));
    if (v) utt.voice = v;
    speechSynthesis.speak(utt);
  };
  if (speechSynthesis.getVoices().length > 0) loadVoices();
  else { speechSynthesis.onvoiceschanged = loadVoices; speechSynthesis.speak(utt); }
}

async function runMotherIntro() {
  const intro = document.getElementById('mother-intro');
  const output = document.getElementById('mother-output');
  const skipMsg = document.getElementById('mother-skip');
  intro.style.display = 'flex';
  let skipped = false;
  const skipHandler = () => { skipped = true; };
  document.addEventListener('click', skipHandler, { once: true });
  document.addEventListener('keydown', skipHandler, { once: true });
  const delay = ms => new Promise(resolve => {
    if (skipped) { resolve(); return; }
    const t = setTimeout(resolve, ms);
    const check = setInterval(() => { if (skipped) { clearTimeout(t); clearInterval(check); resolve(); } }, 50);
  });
  function addLine(text, cls) {
    const div = document.createElement('div'); div.className = cls || 'm-normal';
    output.appendChild(div); return div;
  }
  async function typeMotherLine(text, cls, speed) {
    if (skipped) { addLine(text, cls); return; }
    const div = addLine('', cls);
    for (let i = 0; i < text.length; i++) {
      if (skipped) { div.textContent = text; return; }
      div.textContent += text[i];
      if (text[i] !== ' ') sndMotherClick();
      await delay(speed || 18);
    }
    sndMotherBeep();
  }
  // â˜… Textes MU-TH-UR traduits
  const MT = {
    fr: {corp:'WEYLAND-YUTANI CORPORATION',sys:'SYSTÃˆME  :  MU-TH-UR 6000',acc:"ACCÃˆS    :  PROTOCOLE D'INTERFACE",ship:'NAVIRE   :  NOSTROMO  180924609',cls:'CLASSE   :  VÃ‰HICULE DE REMORQUAGE COM',crew:'Ã‰QUIPAGE :  7 MEMBRES',op:'OPÃ‰RATEUR:  MANIX  //  KYRONEX SYSTEMS',checks:[['VÃ‰RIFICATION SYSTÃˆMES','[OK]'],['NOYAU NEURAL         ','[EN LIGNE]'],['MÃ‰MOIRE PERSISTANTE  ','[STABLE]'],['MODULE KYRONEX       ','[ACTIF]'],['RÃ‰SEAU KITT          ','[CHARGÃ‰E]']],speech:"PROTOCOLE D'INTERFACE ACTIVÃ‰. MODULE KYRONEX EN LIGNE. JE SUIS MU-TH-UR. VOUS POUVEZ PROCÃ‰DER.",skip:'>>> CLIQUEZ OU APPUYEZ SUR UNE TOUCHE <<<'},
    en: {corp:'WEYLAND-YUTANI CORPORATION',sys:'SYSTEM   :  MU-TH-UR 6000',acc:'ACCESS   :  INTERFACE PROTOCOL',ship:'VESSEL   :  NOSTROMO  180924609',cls:'CLASS    :  COM HAUL VEHICLE',crew:'CREW     :  7 MEMBERS',op:'OPERATOR :  MANIX  //  KYRONEX SYSTEMS',checks:[['SYSTEMS CHECK        ','[OK]'],['NEURAL CORE          ','[ONLINE]'],['PERSISTENT MEMORY    ','[STABLE]'],['KYRONEX MODULE       ','[ACTIVE]'],['KITT NETWORK         ','[LOADED]']],speech:"INTERFACE PROTOCOL ACTIVE. KYRONEX MODULE ONLINE. I AM MU-TH-UR. YOU MAY PROCEED.",skip:'>>> CLICK OR PRESS A KEY <<<'},
    nl: {corp:'WEYLAND-YUTANI CORPORATION',sys:'SYSTEEM  :  MU-TH-UR 6000',acc:'TOEGANG  :  INTERFACEPROTOCOL',ship:'SCHIP    :  NOSTROMO  180924609',cls:'KLASSE   :  COM SLEEPVOERTUIG',crew:'BEMANNING:  7 LEDEN',op:'OPERATOR :  MANIX  //  KYRONEX SYSTEMS',checks:[['SYSTEEMCHECK         ','[OK]'],['NEURAAL KERN         ','[ONLINE]'],['PERSISTENT GEHEUGEN  ','[STABIEL]'],['KYRONEX MODULE       ','[ACTIEF]'],['KITT NETWERK         ','[GELADEN]']],speech:"INTERFACEPROTOCOL ACTIEF. KYRONEX MODULE ONLINE. IK BEN MU-TH-UR. U MAG DOORGAAN.",skip:'>>> KLIK OF DRUK OP EEN TOETS <<<'},
    it: {corp:'WEYLAND-YUTANI CORPORATION',sys:'SISTEMA  :  MU-TH-UR 6000',acc:'ACCESSO  :  PROTOCOLLO INTERFACCIA',ship:'NAVE     :  NOSTROMO  180924609',cls:'CLASSE   :  VEICOLO DA TRAINO COM',crew:'EQUIPAG. :  7 MEMBRI',op:'OPERATORE:  MANIX  //  KYRONEX SYSTEMS',checks:[['VERIFICA SISTEMI     ','[OK]'],['NUCLEO NEURALE       ','[ONLINE]'],['MEMORIA PERSISTENTE  ','[STABILE]'],['MODULO KYRONEX       ','[ATTIVO]'],['RETE KITT            ','[CARICATA]']],speech:"PROTOCOLLO INTERFACCIA ATTIVO. MODULO KYRONEX ONLINE. SONO MU-TH-UR. PUOI PROCEDERE.",skip:'>>> CLICCA O PREMI UN TASTO <<<'},
    de: {corp:'WEYLAND-YUTANI CORPORATION',sys:'SYSTEM   :  MU-TH-UR 6000',acc:'ZUGANG   :  SCHNITTSTELLENPROTOKOLL',ship:'SCHIFF   :  NOSTROMO  180924609',cls:'KLASSE   :  COM ZUGFAHRZEUG',crew:'BESATZUNG:  7 MITGLIEDER',op:'OPERATOR :  MANIX  //  KYRONEX SYSTEMS',checks:[['SYSTEMPRÃœFUNG        ','[OK]'],['NEURONALER KERN      ','[ONLINE]'],['DAUERSPEICHER        ','[STABIL]'],['KYRONEX MODUL        ','[AKTIV]'],['KITT NETZWERK        ','[GELADEN]']],speech:"SCHNITTSTELLENPROTOKOLL AKTIV. KYRONEX MODUL ONLINE. ICH BIN MU-TH-UR. SIE KÃ–NNEN FORTFAHREN.",skip:'>>> KLICKEN ODER TASTE DRÃœCKEN <<<'},
    es: {corp:'WEYLAND-YUTANI CORPORATION',sys:'SISTEMA  :  MU-TH-UR 6000',acc:'ACCESO   :  PROTOCOLO DE INTERFAZ',ship:'NAVE     :  NOSTROMO  180924609',cls:'CLASE    :  VEHÃCULO DE REMOLQUE COM',crew:'TRIPULAC.:  7 MIEMBROS',op:'OPERADOR :  MANIX  //  KYRONEX SYSTEMS',checks:[['VERIFICACIÃ“N SISTEMA ','[OK]'],['NÃšCLEO NEURONAL      ','[EN LÃNEA]'],['MEMORIA PERSISTENTE  ','[ESTABLE]'],['MÃ“DULO KYRONEX       ','[ACTIVO]'],['RED KITT             ','[CARGADA]']],speech:"PROTOCOLO DE INTERFAZ ACTIVO. MÃ“DULO KYRONEX EN LÃNEA. SOY MU-TH-UR. PUEDE PROCEDER.",skip:'>>> CLIC O PULSA UNA TECLA <<<'},
    pt: {corp:'WEYLAND-YUTANI CORPORATION',sys:'SISTEMA  :  MU-TH-UR 6000',acc:'ACESSO   :  PROTOCOLO DE INTERFACE',ship:'NAVE     :  NOSTROMO  180924609',cls:'CLASSE   :  VEÃCULO DE REBOQUE COM',crew:'TRIPULAÃ‡ÃƒO: 7 MEMBROS',op:'OPERADOR :  MANIX  //  KYRONEX SYSTEMS',checks:[['VERIFICAÃ‡ÃƒO SISTEMA  ','[OK]'],['NÃšCLEO NEURONAL      ','[EM LINHA]'],['MEMÃ“RIA PERSISTENTE  ','[ESTÃVEL]'],['MÃ“DULO KYRONEX       ','[ATIVO]'],['REDE KITT            ','[CARREGADA]']],speech:"PROTOCOLO DE INTERFACE ATIVO. MÃ“DULO KYRONEX EM LINHA. EU SOU MU-TH-UR. PODE PROSSEGUIR.",skip:'>>> CLIQUE OU PRIMA UMA TECLA <<<'},
  };
  const m = MT[LANG] || MT.en;
  const langCode = {fr:'fr-FR',en:'en-US',nl:'nl-NL',it:'it-IT',de:'de-DE',es:'es-ES',pt:'pt-PT'}[LANG]||'en-US';

  if(skipMsg) skipMsg.textContent = m.skip;

  await typeMotherLine(m.corp, 'm-bright', 18);
  await delay(120);
  await typeMotherLine(m.sys, 'm-normal', 18);
  await delay(80);
  await typeMotherLine(m.acc, 'm-normal', 18);
  await delay(300);
  addLine('', 'm-dim');
  await delay(200);
  await typeMotherLine(m.ship, 'm-normal', 16);
  await delay(80);
  await typeMotherLine(m.cls, 'm-dim', 14);
  await delay(80);
  await typeMotherLine(m.crew, 'm-dim', 16);
  await delay(80);
  await typeMotherLine(m.op, 'm-dim', 14);
  await delay(400);
  addLine('', 'm-dim');
  for (const [label, result] of m.checks) {
    if (skipped) { addLine(label + ' ...... ' + result, 'm-ok'); continue; }
    const div = addLine(label + ' ......', 'm-dim');
    sndMotherScan();
    await delay(420);
    div.className = 'm-ok';
    div.textContent = label + ' ...... ' + result;
    await delay(80);
  }
  if (!skipped) { await delay(700); sndMotherChime(); await delay(900); }
  if (!skipped) {
    await new Promise(resolve => {
      const utt = new SpeechSynthesisUtterance(m.speech);
      utt.lang = langCode; utt.rate = 0.72; utt.pitch = 0.5; utt.volume = 0.85;
      const vs = speechSynthesis.getVoices();
      const v = vs.find(v=>v.lang.startsWith(langCode.split('-')[0])&&v.name.toLowerCase().includes('female'))||vs.find(v=>v.lang.startsWith(langCode.split('-')[0]));
      if(v) utt.voice=v;
      if(resolve) utt.onend=resolve;
      if(window.speechSynthesis){ const lv=()=>{ speechSynthesis.speak(utt); }; if(speechSynthesis.getVoices().length>0) lv(); else{ speechSynthesis.onvoiceschanged=lv; speechSynthesis.speak(utt); } }
      else resolve();
    });
  }
  if(skipMsg) skipMsg.style.display = 'block';
  document.removeEventListener('click', skipHandler);
  document.removeEventListener('keydown', skipHandler);
  if (!skipped) await delay(3000);
  intro.style.transition = 'opacity 0.8s';
  intro.style.opacity = '0';
  await new Promise(resolve => setTimeout(resolve, 820));
  intro.style.display = 'none';
  intro.style.opacity = '';
  intro.style.transition = '';
  // â˜… Afficher le dashboard et lancer l'interface principale
  setTimeout(()=>{ try{showKittDash();}catch(e){} }, 100);
  startMain();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LANGUE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let LANG = 'fr';
const T = {
  fr: {
    hdr_title:'KITT FRANCO-BELGE // INTERFACE CENTRALE',
    placeholder:'entrez une commande...',
    btn_boot:'[ INITIALISER ]',btn_diag:'[ DIAGNOSTIC ]',btn_mentions:'[ MENTIONS ]',
    btn_licence:'[ LICENCE ]',btn_clear:'[ EFFACER ]',btn_tunnel:'[ CONNEXION KITT ]',
    modal_mentions:'MENTIONS LÃ‰GALES',modal_licence:'LICENCE',
    wait:'SYSTÃˆME EN ATTENTE â€” TAPEZ "boot" OU CLIQUEZ [ INITIALISER ]',
    help_hint:'TAPEZ "aide" POUR LA LISTE DES COMMANDES.',
    cleared:'TERMINAL EFFACÃ‰.',
    unknown:(c) => `COMMANDE INCONNUE : "${c}". TAPEZ "aide".`,
    online:'EN LIGNE',
    boot_title:'  KITT FRANCO-BELGE â€” SÃ‰QUENCE DE BOOT   ',
    boot_lines:[
      ['INITIALISATION DU NOYAU SYSTÃˆME...','line-warn'],
      ['CHARGEMENT MODULES COGNITIFS...    [OK]','line-ok'],
      ['INTERFACE NEURONALE...             [OK]','line-ok'],
      ['SYNTHÃˆSE VOCALE (PIPER-GPU)...     [OK]','line-ok'],
      ['RECONNAISSANCE VOCALE (WHISPER)... [OK]','line-ok'],
      ['MODÃˆLE LLM EMBARQUÃ‰ (QWEN 3B)...  [OK]','line-ok'],
      ['MODE HORS-LIGNE...                 [ACTIVÃ‰]','line-ok'],
      ['','line-ok'],
      ['PROJET FAN NON COMMERCIAL.','line-dim'],
      ['STATUT : INTERFACE EN CONSTRUCTION ACTIVE.','line-warn'],
      ['','line-ok'],
      ['MISES Ã€ JOUR DÃ‰PLOYÃ‰ES RÃ‰GULIÃˆREMENT :','line-info'],
      ['  â€¢ parfois chaque jour','line-dim'],
      ['  â€¢ parfois chaque semaine','line-dim'],
      ['  â€¢ lors de certaines phases, presque heure par heure','line-dim'],
      ['','line-ok'],
      ['Â© 2026 EMMANUEL GELINNE (MANIX). TOUS DROITS RÃ‰SERVÃ‰S.','line-warn'],
    ],
    boot_end:'  CONNEXION AU NOYAU KITT Ã‰TABLIE.',
    boot_hint:'  TAPEZ "aide" POUR LA LISTE DES COMMANDES',
    aide_title:'COMMANDES DISPONIBLES :',
    aide_sys:'â”€â”€ SYSTÃˆME â”€â”€',aide_fun:'â”€â”€ FUN â”€â”€',
    cmds_sys:[
      ['aide','cette liste'],['boot',"sÃ©quence d'initialisation"],
      ['diagnostic','test complet des systÃ¨mes'],['status','Ã©tat rapide'],
      ['heure','heure actuelle'],['version',"version de l'interface"],
      ['son','dÃ©mo audio'],['clear','efface le terminal'],
      ['mode','changer le mode KITT â˜…'],['turbo','TURBO BOOST â˜…'],
      ['scan','scanner l\'environnement â˜…'],['vitesse','afficher la vitesse â˜…'],
    ],
    cmds_fun:[
      ['bonjour','salutation KITT'],['blague','blague KITT alÃ©atoire'],
      ['alien','connexion MU-TH-UR 6000'],['matrix','le lapin blanc'],
      ['kitt','fiche identitÃ© KITT'],['manix','dossier conducteur'],
      ['cedric','dossier Cedric Momo Rider'],['kr95','dossier KR95'],
      ['repliques','les rÃ©pliques franco-belges'],['secret','fichier classifiÃ©...'],
      ['cafe','demander un cafÃ© Ã  KITT'],['belgique','analyse gÃ©opolitique'],
      ['jarvis','appel vers Stark Tower'],['mario','dossier Mario Ravasi / IoT'],
      ['za','dossier ZA Elettronica'],['pascal','dossier K Industrie'],
      ['daemon','dossier Daemon Paule'],['geoffrey','dossier Geoffrey'],
      ['covid','origine du projet â€” confinement 2020'],['karr','dossier K.A.R.R. â˜…'],
      ['credits','crÃ©dits du projet â˜…'],
    ],
    hi:'BONJOUR. JE SUIS KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2:'SYSTÃˆME FRANCO-BELGE DÃ‰VELOPPÃ‰ PAR MANIX.',
    hi3:'Ã€ VOTRE SERVICE.',
    btn_missions:'[ MISSIONS ]',
    access_hdr:'WEYLAND-YUTANI CORP. // ACCÃˆS SÃ‰CURISÃ‰',
    access_prompt:'CODE D\'ACCÃˆS',
    access_hint:'ENTREZ LE CODE D\'ACCÃˆS SYSTÃˆME',
    mission_title:'â¬¡ MISSIONS KITT',
    mission_close:'[ FERMER ]',
    call_incoming:'APPEL ENTRANT Â·Â·Â·',
    call_accept:'â˜ ACCEPTER',
    call_ignore:'âœ• IGNORER',
    visits_label:'VISITES',
    last_update:'DERNIÃˆRE MISE Ã€ JOUR',
  },
  en: {
    hdr_title:'KITT FRANCO-BELGIAN // CENTRAL INTERFACE',
    placeholder:'enter a command...',
    btn_boot:'[ INITIALIZE ]',btn_diag:'[ DIAGNOSTIC ]',btn_mentions:'[ MENTIONS ]',
    btn_licence:'[ LICENSE ]',btn_clear:'[ CLEAR ]',btn_tunnel:'[ CONNECT KITT ]',
    modal_mentions:'LEGAL NOTICES',modal_licence:'LICENSE',
    wait:'SYSTEM STANDBY â€” TYPE "boot" OR CLICK [ INITIALIZE ]',
    help_hint:'TYPE "help" FOR THE LIST OF COMMANDS.',
    cleared:'TERMINAL CLEARED.',
    unknown:(c) => `UNKNOWN COMMAND: "${c}". TYPE "help".`,
    online:'ONLINE',
    boot_title:'  KITT FRANCO-BELGE â€” BOOT SEQUENCE        ',
    boot_lines:[
      ['INITIALIZING CORE SYSTEM...','line-warn'],
      ['LOADING COGNITIVE MODULES...       [OK]','line-ok'],
      ['NEURAL INTERFACE...                [OK]','line-ok'],
      ['VOICE SYNTHESIS (PIPER-GPU)...     [OK]','line-ok'],
      ['VOICE RECOGNITION (WHISPER)...     [OK]','line-ok'],
      ['EMBEDDED LLM (QWEN 3B)...          [OK]','line-ok'],
      ['OFFLINE MODE...                    [ACTIVE]','line-ok'],
      ['','line-ok'],
      ['FAN PROJECT â€” NON COMMERCIAL.','line-dim'],
      ['STATUS : INTERFACE UNDER ACTIVE CONSTRUCTION.','line-warn'],
      ['','line-ok'],
      ['UPDATES DEPLOYED REGULARLY :','line-info'],
      ['  â€¢ sometimes every day','line-dim'],
      ['  â€¢ sometimes every week','line-dim'],
      ['  â€¢ during some phases, almost hour by hour','line-dim'],
      ['','line-ok'],
      ['Â© 2026 EMMANUEL GELINNE (MANIX). ALL RIGHTS RESERVED.','line-warn'],
    ],
    boot_end:'  CONNECTION TO KITT CORE ESTABLISHED.',
    boot_hint:'  TYPE "help" FOR THE COMMAND LIST',
    aide_title:'AVAILABLE COMMANDS:',aide_sys:'â”€â”€ SYSTEM â”€â”€',aide_fun:'â”€â”€ FUN â”€â”€',
    cmds_sys:[
      ['help','this list'],['boot','boot sequence'],
      ['diagnostic','full system test'],['status','quick status'],
      ['time','current time'],['version','interface version'],
      ['sound','audio demo'],['clear','clear terminal'],
      ['mode','change KITT mode â˜…'],['turbo','TURBO BOOST â˜…'],
      ['scan','scan environment â˜…'],['speed','display speed â˜…'],
    ],
    cmds_fun:[
      ['hello','KITT greeting'],['joke','random KITT joke'],
      ['alien','MU-TH-UR 6000 connection'],['matrix','the white rabbit'],
      ['kitt','KITT identity file'],['manix','driver file'],
      ['cedric','Cedric Momo Rider file'],['kr95','KR95 file'],
      ['replicas','the franco-belgian replicas'],['secret','classified file...'],
      ['coffee','ask KITT for a coffee'],['belgium','geopolitical analysis'],
      ['jarvis','call to Stark Tower'],['mario','Mario Ravasi / IoT file'],
      ['za','ZA Elettronica file'],['pascal','K Industrie file'],
      ['daemon','Daemon Paule file'],['geoffrey','Geoffrey file'],
      ['covid','project origin â€” lockdown 2020'],['karr','K.A.R.R. file â˜…'],
      ['credits','project credits â˜…'],
    ],
    hi:'HELLO. I AM KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2:'FRANCO-BELGIAN SYSTEM DEVELOPED BY MANIX.',
    hi3:'AT YOUR SERVICE.',
    btn_missions:'[ MISSIONS ]',
    access_hdr:'WEYLAND-YUTANI CORP. // SECURE ACCESS',
    access_prompt:'ACCESS CODE',
    access_hint:'ENTER SYSTEM ACCESS CODE',
    mission_title:'â¬¡ KITT MISSIONS',
    mission_close:'[ CLOSE ]',
    call_incoming:'INCOMING CALL Â·Â·Â·',
    call_accept:'â˜ ACCEPT',
    call_ignore:'âœ• IGNORE',
    visits_label:'VISITS',
    last_update:'LAST UPDATE',
  },
  nl:{hdr_title:'KITT FRANCO-BELGISCH // CENTRALE INTERFACE',placeholder:'voer een commando in...',btn_boot:'[ OPSTARTEN ]',btn_diag:'[ DIAGNOSE ]',btn_mentions:'[ VERMELDINGEN ]',btn_licence:'[ LICENTIE ]',btn_clear:'[ WISSEN ]',btn_tunnel:'[ VERBIND KITT ]',modal_mentions:'WETTELIJKE VERMELDINGEN',modal_licence:'LICENTIE',wait:'SYSTEEM WACHT â€” TYP "boot" OF KLIK [ OPSTARTEN ]',help_hint:'TYP "hulp" VOOR DE COMMANDOLIJST.',cleared:'TERMINAL GEWIST.',unknown:(c)=>`ONBEKEND COMMANDO: "${c}". TYP "hulp".`,online:'ONLINE',boot_title:'  KITT FRANCO-BELGE â€” OPSTARTSEQUENTIE     ',boot_lines:[['KERNSYSTEEM INITIALISEREN...','line-warn'],['COGNITIEVE MODULES LADEN...        [OK]','line-ok'],['NEURALE INTERFACE...               [OK]','line-ok'],['SPRAAKSYNTHESE (PIPER-GPU)...      [OK]','line-ok'],['STEMHERKENNING (WHISPER)...        [OK]','line-ok'],['EMBEDDED LLM (QWEN 3B)...          [OK]','line-ok'],['OFFLINE MODUS...                   [ACTIEF]','line-ok'],['','line-ok'],['FAN PROJECT â€” NIET COMMERCIEEL.','line-dim'],['STATUS : INTERFACE IN ACTIEVE CONSTRUCTIE.','line-warn'],['','line-ok'],['UPDATES REGELMATIG UITGEROLD :','line-info'],['  â€¢ soms elke dag','line-dim'],['  â€¢ soms elke week','line-dim'],['  â€¢ soms elk uur','line-dim'],['','line-ok'],['Â© 2026 EMMANUEL GELINNE (MANIX). ALLE RECHTEN VOORBEHOUDEN.','line-warn']],boot_end:'  VERBINDING MET KITT-KERN TOT STAND GEBRACHT.',boot_hint:'  TYP "hulp" VOOR DE COMMANDOLIJST',aide_title:'BESCHIKBARE COMMANDO\'S:',aide_sys:'â”€â”€ SYSTEEM â”€â”€',aide_fun:'â”€â”€ PLEZIER â”€â”€',cmds_sys:[['hulp','deze lijst'],['boot','opstartsequentie'],['diagnostic','volledig systeemtest'],['status','snelle status'],['tijd','huidige tijd'],['versie','interface versie'],['geluid','audio demo'],['clear','terminal wissen'],['mode','KITT-modus wijzigen â˜…'],['turbo','TURBO BOOST â˜…'],['scan','omgeving scannen â˜…'],['snelheid','snelheid weergeven â˜…']],cmds_fun:[['hallo','KITT begroeting'],['grap','willekeurige KITT grap'],['alien','MU-TH-UR 6000 verbinding'],['matrix','het witte konijn'],['kitt','KITT identiteitsbestand'],['manix','bestuurdersdossier'],['cedric','Cedric Momo Rider dossier'],['kr95','KR95 dossier'],['replicas','de franco-belgische replica\'s'],['geheim','geheim bestand...'],['koffie','KITT om koffie vragen'],['belgie','geopolitieke analyse'],['jarvis','oproep naar Stark Tower'],['mario','Mario Ravasi / IoT dossier'],['za','ZA Elettronica dossier'],['pascal','K Industrie dossier'],['daemon','Daemon Paule dossier'],['geoffrey','Geoffrey dossier'],['covid','projectoorsprong â€” lockdown 2020'],['karr','K.A.R.R. dossier â˜…'],['credits','projectcredits â˜…']],hi:'HALLO. IK BEN KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',hi2:'FRANCO-BELGISCH SYSTEEM ONTWIKKELD DOOR MANIX.',btn_missions:'[ MISSIES ]',access_hdr:'WEYLAND-YUTANI CORP. // BEVEILIGDE TOEGANG',access_prompt:'TOEGANGSCODE',access_hint:'VOER SYSTEEMTOEGANSCODE IN',mission_title:'â¬¡ KITT MISSIES',mission_close:'[ SLUITEN ]',call_incoming:'INKOMEND GESPREK Â·Â·Â·',call_accept:'â˜ ACCEPTEREN',call_ignore:'âœ• NEGEREN',visits_label:'BEZOEKEN',last_update:'LAATSTE UPDATE'},
  it:{hdr_title:'KITT FRANCO-BELGA // INTERFACCIA CENTRALE',placeholder:'inserisci un comando...',btn_boot:'[ INIZIALIZZA ]',btn_diag:'[ DIAGNOSI ]',btn_mentions:'[ MENZIONI ]',btn_licence:'[ LICENZA ]',btn_clear:'[ CANCELLA ]',btn_tunnel:'[ CONNETTI KITT ]',modal_mentions:'NOTE LEGALI',modal_licence:'LICENZA',wait:'SISTEMA IN ATTESA â€” DIGITA "boot" O CLICCA [ INIZIALIZZA ]',help_hint:'DIGITA "aiuto" PER LA LISTA DEI COMANDI.',cleared:'TERMINALE CANCELLATO.',unknown:(c)=>`COMANDO SCONOSCIUTO: "${c}". DIGITA "aiuto".`,online:'IN LINEA',boot_title:'  KITT FRANCO-BELGA â€” SEQUENZA DI AVVIO     ',boot_lines:[['INIZIALIZZAZIONE SISTEMA...','line-warn'],['CARICAMENTO MODULI COGNITIVI...    [OK]','line-ok'],['INTERFACCIA NEURALE...             [OK]','line-ok'],['SINTESI VOCALE (PIPER-GPU)...      [OK]','line-ok'],['RICONOSCIMENTO VOCALE (WHISPER)... [OK]','line-ok'],['MODELLO LLM LOCALE (QWEN 3B)...   [OK]','line-ok'],['MODALITÃ€ OFFLINE...                [ATTIVA]','line-ok'],['','line-ok'],['PROGETTO FAN â€” NON COMMERCIALE.','line-dim'],['STATO : INTERFACCIA IN COSTRUZIONE ATTIVA.','line-warn'],['','line-ok'],['AGGIORNAMENTI DISTRIBUITI REGOLARMENTE :','line-info'],['  â€¢ a volte ogni giorno','line-dim'],['  â€¢ a volte ogni settimana','line-dim'],['  â€¢ in alcune fasi, quasi ogni ora','line-dim'],['','line-ok'],['Â© 2026 EMMANUEL GELINNE (MANIX). TUTTI I DIRITTI RISERVATI.','line-warn']],boot_end:'  CONNESSIONE AL NUCLEO KITT STABILITA.',boot_hint:'  DIGITA "aiuto" PER LA LISTA DEI COMANDI',aide_title:'COMANDI DISPONIBILI:',aide_sys:'â”€â”€ SISTEMA â”€â”€',aide_fun:'â”€â”€ DIVERTIMENTO â”€â”€',cmds_sys:[['aiuto','questa lista'],['boot','sequenza di avvio'],['diagnostic','test completo del sistema'],['status','stato rapido'],['ora','ora corrente'],['version','versione interfaccia'],['suono','demo audio'],['clear','cancella terminale'],['mode','cambia modalitÃ  KITT â˜…'],['turbo','TURBO BOOST â˜…'],['scan','scansiona ambiente â˜…'],['velocita','visualizza velocitÃ  â˜…']],cmds_fun:[['ciao','saluto KITT'],['barzelletta','barzelletta casuale KITT'],['alien','connessione MU-TH-UR 6000'],['matrix','il coniglio bianco'],['kitt','scheda identitÃ  KITT'],['manix','dossier pilota'],['cedric','dossier Cedric Momo Rider'],['kr95','dossier KR95'],['replicas','le repliche franco-belghe'],['segreto','file classificato...'],['caffe','chiedere un caffÃ¨ a KITT'],['belgio','analisi geopolitica'],['jarvis','chiamata verso Stark Tower'],['mario','dossier Mario Ravasi / IoT'],['za','dossier ZA Elettronica'],['pascal','dossier K Industrie'],['daemon','dossier Daemon Paule'],['geoffrey','dossier Geoffrey'],['covid','origine del progetto â€” lockdown 2020'],['karr','dossier K.A.R.R. â˜…'],['credits','crediti del progetto â˜…']],hi:'CIAO. SONO KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',hi2:'SISTEMA FRANCO-BELGA SVILUPPATO DA MANIX.',btn_missions:'[ MISSIONI ]',access_hdr:'WEYLAND-YUTANI CORP. // ACCESSO SICURO',access_prompt:'CODICE ACCESSO',access_hint:'INSERIRE IL CODICE DI ACCESSO',mission_title:'â¬¡ MISSIONI KITT',mission_close:'[ CHIUDI ]',call_incoming:'CHIAMATA IN ARRIVO Â·Â·Â·',call_accept:'â˜ ACCETTA',call_ignore:'âœ• IGNORA',visits_label:'VISITE',last_update:'ULTIMO AGGIORNAMENTO'},
  de:{hdr_title:'KITT FRANCO-BELGISCH // ZENTRALE SCHNITTSTELLE',placeholder:'Befehl eingeben...',btn_boot:'[ INITIALISIEREN ]',btn_diag:'[ DIAGNOSE ]',btn_mentions:'[ IMPRESSUM ]',btn_licence:'[ LIZENZ ]',btn_clear:'[ LÃ–SCHEN ]',btn_tunnel:'[ KITT VERBINDEN ]',modal_mentions:'IMPRESSUM',modal_licence:'LIZENZ',wait:'SYSTEM BEREIT â€” TIPPE "boot" ODER KLICKE [ INITIALISIEREN ]',help_hint:'TIPPE "hilfe" FÃœR DIE BEFEHLSLISTE.',cleared:'TERMINAL GELEERT.',unknown:(c)=>`UNBEKANNTER BEFEHL: "${c}". TIPPE "hilfe".`,online:'ONLINE',boot_title:'  KITT FRANCO-BELGISCH â€” STARTSEQUENZ        ',boot_lines:[['KERNSYSTEM WIRD INITIALISIERT...','line-warn'],['KOGNITIVE MODULE LADEN...          [OK]','line-ok'],['NEURONALE SCHNITTSTELLE...         [OK]','line-ok'],['SPRACHSYNTHESE (PIPER-GPU)...      [OK]','line-ok'],['SPRACHERKENNUNG (WHISPER)...       [OK]','line-ok'],['LOKALES LLM (QWEN 3B)...           [OK]','line-ok'],['OFFLINE-MODUS...                   [AKTIV]','line-ok'],['','line-ok'],['FAN-PROJEKT â€” NICHT KOMMERZIELL.','line-dim'],['STATUS : SCHNITTSTELLE IM AUFBAU.','line-warn'],['','line-ok'],['UPDATES REGELMÃ„SSIG VERFÃœGBAR :','line-info'],['  â€¢ manchmal tÃ¤glich','line-dim'],['  â€¢ manchmal wÃ¶chentlich','line-dim'],['  â€¢ manchmal stÃ¼ndlich','line-dim'],['','line-ok'],['Â© 2026 EMMANUEL GELINNE (MANIX). ALLE RECHTE VORBEHALTEN.','line-warn']],boot_end:'  VERBINDUNG ZUM KITT-KERN HERGESTELLT.',boot_hint:'  TIPPE "hilfe" FÃœR DIE BEFEHLSLISTE',aide_title:'VERFÃœGBARE BEFEHLE:',aide_sys:'â”€â”€ SYSTEM â”€â”€',aide_fun:'â”€â”€ SPASS â”€â”€',cmds_sys:[['hilfe','diese Liste'],['boot','Startsequenz'],['diagnostic','vollstÃ¤ndiger Systemtest'],['status','schneller Status'],['uhrzeit','aktuelle Uhrzeit'],['version','Schnittstellenversion'],['ton','Audio-Demo'],['clear','Terminal leeren'],['mode','KITT-Modus Ã¤ndern â˜…'],['turbo','TURBO BOOST â˜…'],['scan','Umgebung scannen â˜…'],['geschwindigkeit','Geschwindigkeit anzeigen â˜…']],cmds_fun:[['hallo','KITT-BegrÃ¼ÃŸung'],['witz','zufÃ¤lliger KITT-Witz'],['alien','MU-TH-UR 6000 Verbindung'],['matrix','das weiÃŸe Kaninchen'],['kitt','KITT IdentitÃ¤tsakte'],['manix','Fahrerakte'],['cedric','Cedric Momo Rider Akte'],['kr95','KR95 Akte'],['replicas','die franco-belgischen Repliken'],['geheimnis','geheime Akte...'],['kaffee','KITT um Kaffee bitten'],['belgien','geopolitische Analyse'],['jarvis','Anruf bei Stark Tower'],['mario','Mario Ravasi / IoT Akte'],['za','ZA Elettronica Akte'],['pascal','K Industrie Akte'],['damon','Damon Paule Akte'],['geoffrey','Geoffrey Akte'],['covid','Projektherkunft â€” Lockdown 2020'],['karr','K.A.R.R. Akte â˜…'],['credits','Projektcredits â˜…']],hi:'HALLO. ICH BIN KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',hi2:'FRANCO-BELGISCHES SYSTEM ENTWICKELT VON MANIX.',btn_missions:'[ MISSIONEN ]',access_hdr:'WEYLAND-YUTANI CORP. // SICHERER ZUGANG',access_prompt:'ZUGANGSCODE',access_hint:'SYSTEMZUGANGSCODE EINGEBEN',mission_title:'â¬¡ KITT MISSIONEN',mission_close:'[ SCHLIESSEN ]',call_incoming:'EINGEHENDER ANRUF Â·Â·Â·',call_accept:'â˜ ANNEHMEN',call_ignore:'âœ• IGNORIEREN',visits_label:'BESUCHE',last_update:'LETZTES UPDATE'},
  es:{hdr_title:'KITT FRANCO-BELGA // INTERFAZ CENTRAL',placeholder:'escribe un comando...',btn_boot:'[ INICIALIZAR ]',btn_diag:'[ DIAGNÃ“STICO ]',btn_mentions:'[ MENCIONES ]',btn_licence:'[ LICENCIA ]',btn_clear:'[ BORRAR ]',btn_tunnel:'[ CONECTAR KITT ]',modal_mentions:'AVISOS LEGALES',modal_licence:'LICENCIA',wait:'SISTEMA EN ESPERA â€” ESCRIBE "boot" O HAZ CLIC EN [ INICIALIZAR ]',help_hint:'ESCRIBE "ayuda" PARA VER LOS COMANDOS.',cleared:'TERMINAL BORRADO.',unknown:(c)=>`COMANDO DESCONOCIDO: "${c}". ESCRIBE "ayuda".`,online:'EN LÃNEA',boot_title:'  KITT FRANCO-BELGA â€” SECUENCIA DE INICIO   ',boot_lines:[['INICIALIZANDO SISTEMA...','line-warn'],['CARGANDO MÃ“DULOS COGNITIVOS...     [OK]','line-ok'],['INTERFAZ NEURONAL...               [OK]','line-ok'],['SÃNTESIS DE VOZ (PIPER-GPU)...     [OK]','line-ok'],['RECONOCIMIENTO DE VOZ (WHISPER)... [OK]','line-ok'],['MODELO LLM LOCAL (QWEN 3B)...      [OK]','line-ok'],['MODO SIN CONEXIÃ“N...               [ACTIVO]','line-ok'],['','line-ok'],['PROYECTO FAN â€” NO COMERCIAL.','line-dim'],['ESTADO : INTERFAZ EN CONSTRUCCIÃ“N ACTIVA.','line-warn'],['','line-ok'],['ACTUALIZACIONES PUBLICADAS REGULARMENTE :','line-info'],['  â€¢ a veces cada dÃ­a','line-dim'],['  â€¢ a veces cada semana','line-dim'],['  â€¢ a veces cada hora','line-dim'],['','line-ok'],['Â© 2026 EMMANUEL GELINNE (MANIX). TODOS LOS DERECHOS RESERVADOS.','line-warn']],boot_end:'  CONEXIÃ“N AL NÃšCLEO KITT ESTABLECIDA.',boot_hint:'  ESCRIBE "ayuda" PARA VER LOS COMANDOS',aide_title:'COMANDOS DISPONIBLES:',aide_sys:'â”€â”€ SISTEMA â”€â”€',aide_fun:'â”€â”€ DIVERSIÃ“N â”€â”€',cmds_sys:[['ayuda','esta lista'],['boot','secuencia de inicio'],['diagnostic','prueba completa del sistema'],['status','estado rÃ¡pido'],['hora','hora actual'],['version','versiÃ³n de la interfaz'],['sonido','demo de audio'],['clear','borrar terminal'],['mode','cambiar modo KITT â˜…'],['turbo','TURBO BOOST â˜…'],['scan','escanear entorno â˜…'],['velocidad','mostrar velocidad â˜…']],cmds_fun:[['hola','saludo KITT'],['chiste','chiste aleatorio KITT'],['alien','conexiÃ³n MU-TH-UR 6000'],['matrix','el conejo blanco'],['kitt','ficha de identidad KITT'],['manix','expediente del conductor'],['cedric','expediente Cedric Momo Rider'],['kr95','expediente KR95'],['replicas','las rÃ©plicas franco-belgas'],['secreto','archivo clasificado...'],['cafe','pedir cafÃ© a KITT'],['belgica','anÃ¡lisis geopolÃ­tico'],['jarvis','llamada a Stark Tower'],['mario','expediente Mario Ravasi / IoT'],['za','expediente ZA Elettronica'],['pascal','expediente K Industrie'],['damon','expediente Damon Paule'],['geoffrey','expediente Geoffrey'],['covid','origen del proyecto â€” confinamiento 2020'],['karr','expediente K.A.R.R. â˜…'],['credits','crÃ©ditos del proyecto â˜…']],hi:'HOLA. SOY KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',hi2:'SISTEMA FRANCO-BELGA DESARROLLADO POR MANIX.',btn_missions:'[ MISIONES ]',access_hdr:'WEYLAND-YUTANI CORP. // ACCESO SEGURO',access_prompt:'CÃ“DIGO DE ACCESO',access_hint:'INTRODUZCA EL CÃ“DIGO DE ACCESO',mission_title:'â¬¡ MISIONES KITT',mission_close:'[ CERRAR ]',call_incoming:'LLAMADA ENTRANTE Â·Â·Â·',call_accept:'â˜ ACEPTAR',call_ignore:'âœ• IGNORAR',visits_label:'VISITAS',last_update:'ÃšLTIMA ACTUALIZACIÃ“N'},
  pt:{hdr_title:'KITT FRANCO-BELGA // INTERFACE CENTRAL',placeholder:'introduz um comando...',btn_boot:'[ INICIALIZAR ]',btn_diag:'[ DIAGNÃ“STICO ]',btn_mentions:'[ MENÃ‡Ã•ES ]',btn_licence:'[ LICENÃ‡A ]',btn_clear:'[ LIMPAR ]',btn_tunnel:'[ LIGAR KITT ]',modal_mentions:'AVISOS LEGAIS',modal_licence:'LICENÃ‡A',wait:'SISTEMA EM ESPERA â€” DIGITE "boot" OU CLIQUE EM [ INICIALIZAR ]',help_hint:'DIGITE "ajuda" PARA VER OS COMANDOS.',cleared:'TERMINAL LIMPO.',unknown:(c)=>`COMANDO DESCONHECIDO: "${c}". DIGITE "ajuda".`,online:'EM LINHA',boot_title:'  KITT FRANCO-BELGA â€” SEQUÃŠNCIA DE ARRANQUE  ',boot_lines:[['A INICIALIZAR O SISTEMA...','line-warn'],['A CARREGAR MÃ“DULOS COGNITIVOS...   [OK]','line-ok'],['INTERFACE NEURONAL...              [OK]','line-ok'],['SÃNTESE DE VOZ (PIPER-GPU)...      [OK]','line-ok'],['RECONHECIMENTO DE VOZ (WHISPER)... [OK]','line-ok'],['MODELO LLM LOCAL (QWEN 3B)...      [OK]','line-ok'],['MODO OFFLINE...                    [ATIVO]','line-ok'],['','line-ok'],['PROJETO FÃƒ â€” NÃƒO COMERCIAL.','line-dim'],['ESTADO : INTERFACE EM CONSTRUÃ‡ÃƒO ATIVA.','line-warn'],['','line-ok'],['ATUALIZAÃ‡Ã•ES PUBLICADAS REGULARMENTE :','line-info'],['  â€¢ Ã s vezes todos os dias','line-dim'],['  â€¢ Ã s vezes semanalmente','line-dim'],['  â€¢ Ã s vezes de hora em hora','line-dim'],['','line-ok'],['Â© 2026 EMMANUEL GELINNE (MANIX). TODOS OS DIREITOS RESERVADOS.','line-warn']],boot_end:'  LIGAÃ‡ÃƒO AO NÃšCLEO KITT ESTABELECIDA.',boot_hint:'  DIGITE "ajuda" PARA VER OS COMANDOS',aide_title:'COMANDOS DISPONÃVEIS:',aide_sys:'â”€â”€ SISTEMA â”€â”€',aide_fun:'â”€â”€ DIVERSÃƒO â”€â”€',cmds_sys:[['ajuda','esta lista'],['boot','sequÃªncia de arranque'],['diagnostic','teste completo do sistema'],['status','estado rÃ¡pido'],['hora','hora atual'],['version','versÃ£o da interface'],['som','demonstraÃ§Ã£o de Ã¡udio'],['clear','limpar terminal'],['mode','mudar modo KITT â˜…'],['turbo','TURBO BOOST â˜…'],['scan','verificar ambiente â˜…'],['velocidade','exibir velocidade â˜…']],cmds_fun:[['ola','saudaÃ§Ã£o KITT'],['piada','piada aleatÃ³ria KITT'],['alien','ligaÃ§Ã£o MU-TH-UR 6000'],['matrix','o coelho branco'],['kitt','ficha de identidade KITT'],['manix','dossier do condutor'],['cedric','dossier Cedric Momo Rider'],['kr95','dossier KR95'],['replicas','as rÃ©plicas franco-belgas'],['segredo','ficheiro classificado...'],['cafe','pedir cafÃ© ao KITT'],['belgica','anÃ¡lise geopolÃ­tica'],['jarvis','chamada para Stark Tower'],['mario','dossier Mario Ravasi / IoT'],['za','dossier ZA Elettronica'],['pascal','dossier K Industrie'],['damon','dossier Damon Paule'],['geoffrey','dossier Geoffrey'],['covid','origem do projeto â€” confinamento 2020'],['karr','dossier K.A.R.R. â˜…'],['credits','crÃ©ditos do projeto â˜…']],hi:'OLÃ. SOU O KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',hi2:'SISTEMA FRANCO-BELGA DESENVOLVIDO POR MANIX.',btn_missions:'[ MISSÃ•ES ]',access_hdr:'WEYLAND-YUTANI CORP. // ACESSO SEGURO',access_prompt:'CÃ“DIGO DE ACESSO',access_hint:'INTRODUZA O CÃ“DIGO DE ACESSO',mission_title:'â¬¡ MISSÃ•ES KITT',mission_close:'[ FECHAR ]',call_incoming:'CHAMADA RECEBIDA Â·Â·Â·',call_accept:'â˜ ACEITAR',call_ignore:'âœ• IGNORAR',visits_label:'VISITAS',last_update:'ÃšLTIMA ATUALIZAÃ‡ÃƒO'},
};

// â˜… ALIAS enrichis
const CMD_ALIASES = {
  help:'aide',sound:'son',hello:'bonjour',joke:'blague',time:'heure',coffee:'cafe',
  belgium:'belgique',replicas:'repliques',secret:'secret',version:'version',
  clear:'clear',status:'status',diagnostic:'diagnostic',boot:'boot',alien:'alien',
  matrix:'matrix',kitt:'kitt',manix:'manix',cedric:'cedric',kr95:'kr95',
  jarvis:'jarvis',mario:'mario',za:'za',pascal:'pascal',geoffrey:'geoffrey',
  hulp:'aide',geluid:'son',hallo:'bonjour',grap:'blague',tijd:'heure',versie:'version',
  koffie:'cafe',belgie:'belgique',geheim:'secret',
  aiuto:'aide',suono:'son',ciao:'bonjour',barzelletta:'blague',ora:'heure',
  caffe:'cafe',belgio:'belgique',segreto:'secret',
  hilfe:'aide',ton:'son',witz:'blague',uhrzeit:'heure',kaffee:'cafe',belgien:'belgique',
  geheimnis:'secret',
  ayuda:'aide',sonido:'son',hola:'bonjour',chiste:'blague',hora:'heure',
  belgica:'belgique',secreto:'secret',
  ajuda:'aide',som:'son',ola:'bonjour',piada:'blague',segredo:'secret',
  ravasi:'mario',roadthunder:'mario',zagny:'za',zagni:'za',
  'za-elettronica':'za',zaelettronica:'za',
  damon:'damon',daemon:'damon',
  // â˜… Nouveaux aliases langue
  speed:'vitesse',velocidad:'vitesse',velocita:'vitesse',snelheid:'vitesse',
  geschwindigkeit:'vitesse',velocidade:'vitesse',
  turboboost:'turbo',boost:'turbo',
  scanner:'scan',scanning:'scan',
  karr:'karr',k_a_r_r:'karr',
  credit:'credits',crÃ©dit:'credits',crediti:'credits',
};

// â˜… Toutes les commandes pour autocomplÃ©tion
const ALL_COMMANDS = [
  'aide','boot','diagnostic','status','heure','version','son','clear','mode','turbo','scan','vitesse',
  'bonjour','blague','list','alien','matrix','kitt','manix','cedric','kr95','repliques','secret',
  'cafe','belgique','jarvis','mario','za','pascal','daemon','geoffrey','covid','karr','credits',
  'help','hello','joke','time','sound','speed','scan',
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LANGUE â€” SÃ©lection
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _langVoiceEnabled = true;
let _alienAmbientNode = null;
let _alienAmbientGain = null;
const _synth = window.speechSynthesis;
let _voices = [];
function _loadVoices() { _voices = _synth ? _synth.getVoices() : []; }
_loadVoices();
if(_synth && _synth.onvoiceschanged !== undefined) _synth.onvoiceschanged = _loadVoices;
function _getBestVoice(lang) {
  const map={fr:["fr-FR","fr-BE","fr"],en:["en-US","en-GB","en"],nl:["nl-NL","nl-BE","nl"],de:["de-DE","de"],it:["it-IT","it"],es:["es-ES","es"],pt:["pt-PT","pt-BR","pt"]};
  const prefs=map[lang]||["en-US"];
  for(const pref of prefs){const v=_voices.find(v=>v.lang.startsWith(pref));if(v)return v;}
  return _voices[0]||null;
}
function speakMuther(text, lang) {
  try {
    if(!_synth) return; _synth.cancel();
    const utt = new SpeechSynthesisUtterance(text);
    const voice = _getBestVoice(lang||LANG);
    if(voice) utt.voice=voice;
    utt.rate=0.78; utt.pitch=0.72; utt.volume=0.88;
    utt.lang={fr:"fr-FR",en:"en-US",nl:"nl-NL",de:"de-DE",it:"it-IT",es:"es-ES",pt:"pt-PT"}[lang||LANG]||"fr-FR";
    utt.onstart = ()=>{ vizStart(); };
    utt.onend = ()=>{ vizStop(); };
    utt.onerror = ()=>{ vizStop(); };
    sndMutherBeep(); setTimeout(()=>_synth.speak(utt),140);
  } catch(e){}
}
window.toggleLangVoice = function() {
  _langVoiceEnabled = !_langVoiceEnabled;
  const btn = document.getElementById("lang-voice-toggle");
  if(btn) btn.textContent = _langVoiceEnabled ? "ğŸ”Š VOIX" : "ğŸ”‡ VOIX";
  sndClick();
};
window._previewLangVoice = function(code, phrase) {
  if(!_langVoiceEnabled) return;
  _resume(); sndMutherBeep();
  setTimeout(()=>speakMuther(phrase, code), 200);
};
function startAlienAmbient() {
  try {
    _resume(); if(_alienAmbientNode) return;
    const masterGain=_ac.createGain(); masterGain.gain.value=0.0; masterGain.connect(_ac.destination);
    _alienAmbientGain=masterGain;
    const osc1=_ac.createOscillator(); osc1.type="sine"; osc1.frequency.value=42;
    const g1=_ac.createGain(); g1.gain.value=0.18; osc1.connect(g1); g1.connect(masterGain);
    const osc2=_ac.createOscillator(); osc2.type="triangle"; osc2.frequency.value=84;
    const g2=_ac.createGain(); g2.gain.value=0.06; osc2.connect(g2); g2.connect(masterGain);
    const bufLen=_ac.sampleRate*3; const nBuf=_ac.createBuffer(1,bufLen,_ac.sampleRate);
    const nd=nBuf.getChannelData(0); for(let i=0;i<bufLen;i++) nd[i]=Math.random()*2-1;
    const nSrc=_ac.createBufferSource(); nSrc.buffer=nBuf; nSrc.loop=true;
    const lp=_ac.createBiquadFilter(); lp.type="lowpass"; lp.frequency.value=280; lp.Q.value=0.8;
    const ng=_ac.createGain(); ng.gain.value=0.022;
    nSrc.connect(lp); lp.connect(ng); ng.connect(masterGain);
    const lfo=_ac.createOscillator(); lfo.type="sine"; lfo.frequency.value=0.08;
    const lfoGain=_ac.createGain(); lfoGain.gain.value=0.04; lfo.connect(lfoGain); lfoGain.connect(g1.gain);
    osc1.start(); osc2.start(); nSrc.start(); lfo.start();
    _alienAmbientNode={osc1,osc2,nSrc,lfo};
    masterGain.gain.linearRampToValueAtTime(1.0, _ac.currentTime+3.5);
  } catch(e){}
}
function stopAlienAmbient() {
  try {
    if(_alienAmbientGain){
      _alienAmbientGain.gain.linearRampToValueAtTime(0.0, _ac.currentTime+2.0);
      setTimeout(()=>{
        if(_alienAmbientNode){
          try{_alienAmbientNode.osc1.stop();_alienAmbientNode.osc2.stop();_alienAmbientNode.nSrc.stop();_alienAmbientNode.lfo.stop();}catch(e){}
          _alienAmbientNode=null; _alienAmbientGain=null;
        }
      },2200);
    }
  } catch(e){}
}
function sndAlienAlert() {
  try {
    _resume(); const t=_ac.currentTime;
    [0,0.18,0.36].forEach((dt,i)=>{
      const o=_ac.createOscillator(); o.type="square";
      o.frequency.setValueAtTime(320-i*40,t+dt); o.frequency.exponentialRampToValueAtTime(180,t+dt+0.15);
      const g=_ac.createGain(); g.gain.setValueAtTime(0.055,t+dt); g.gain.exponentialRampToValueAtTime(0.001,t+dt+0.17);
      const lp=_ac.createBiquadFilter(); lp.type="lowpass"; lp.frequency.value=600;
      o.connect(lp); lp.connect(g); g.connect(_ac.destination); o.start(t+dt); o.stop(t+dt+0.18);
    });
  } catch(e){}
}

const LANG_LIST = [
  ['1','fr','FRANÃ‡AIS','FranÃ§ais','ğŸ‡«ğŸ‡·','Bonjour, je suis KITT. SystÃ¨me franco-belge activÃ©.'],
  ['2','en','ENGLISH','English','ğŸ‡¬ğŸ‡§','Hello, I am KITT. Knight Industries Two Thousand, online.'],
  ['3','nl','NEDERLANDS','Nederlands','ğŸ‡§ğŸ‡ª','Hallo, ik ben KITT. Systeem geactiveerd.'],
  ['4','it','ITALIANO','Italiano','ğŸ‡®ğŸ‡¹','Ciao, sono KITT. Sistema attivato.'],
  ['5','de','DEUTSCH','Deutsch','ğŸ‡©ğŸ‡ª','Hallo, ich bin KITT. System aktiviert.'],
  ['6','es','ESPAÃ‘OL','EspaÃ±ol','ğŸ‡ªğŸ‡¸','Hola, soy KITT. Sistema activado.'],
  ['7','pt','PORTUGUÃŠS','PortuguÃªs','ğŸ‡µğŸ‡¹','OlÃ¡, eu sou o KITT. Sistema ativado.'],
];

async function showLangScreen() {
  _resume();
  const screen = document.getElementById("lang-screen");
  screen.style.display = "flex"; screen.style.opacity = "1";
  const sysId=document.getElementById("lang-sys-id"),sub=document.getElementById("lang-sub"),out=document.getElementById("lang-output"),ftrTxt=document.getElementById("lang-ftr-txt");
  if(sysId) sysId.textContent=""; if(sub) sub.textContent=""; if(out) out.innerHTML=""; if(ftrTxt) ftrTxt.textContent="";
  startAlienAmbient();
  await _langDelay(300); sndAlienAlert(); await _langDelay(280);
  if(sysId) await _langType(sysId, "MU-TH-UR 6000  x  KITT  //  PROTOCOL v3.1");
  await _langDelay(90);
  if(sub) await _langType(sub, "SELECT INTERFACE LANGUAGE â€” CHOISISSEZ VOTRE LANGUE");
  await _langDelay(70);
  for (const [num, code, label, native, flag, phrase] of LANG_LIST) {
    const row = document.createElement("div"); row.className = "lang-opt"; row.dataset.code = code;
    row.innerHTML = `<span class="lo-n">${num}</span><span class="lo-flag" data-code="${code.toUpperCase()}">${flag}</span><div class="lo-text"><span class="lo-label">${label}</span><span class="lo-native">${native}</span></div><button class="lo-voice-btn" onclick="event.stopPropagation();_previewLangVoice('${code}','${phrase}')">â–¶ VOIX</button>`;
    row.addEventListener("click", () => selectLang(code));
    row.addEventListener("mouseenter", () => { sndTick(); });
    out.appendChild(row);
    sndClick(); await _langDelay(58);
  }
  await _langDelay(90);
  if(ftrTxt) {
    await _langType(ftrTxt, "[ 1-7 ] ou cliquez â€” > pour entendre la voix");
    const cur = document.createElement("span"); cur.className = "cursor"; cur.style.marginLeft = "4px";
    ftrTxt.after(cur);
  }
}
function _langType(el, txt) {
  return new Promise(resolve => {
    let i = 0;
    function t() {
      if (i < txt.length) { el.textContent += txt[i++]; if (Math.random() > 0.3) sndClick(); setTimeout(t, 10 + Math.random() * 6); }
      else { sndLineEnd(); resolve(); }
    } t();
  });
}
function _langDelay(ms) { return new Promise(r => setTimeout(r, ms)); }

function selectLang(lang) {
  LANG = lang;
  const t = T[lang];
  const el = (id) => document.getElementById(id);
  if(el('lang-flag')) el('lang-flag').textContent = lang.toUpperCase();
  if(el('status-txt')) el('status-txt').textContent = t.online;
  if(el('hdr-title')) el('hdr-title').textContent = t.hdr_title;
  if(el('cmd-input')) el('cmd-input').placeholder = t.placeholder;
  if(el('btn-boot')) el('btn-boot').textContent = t.btn_boot;
  if(el('btn-diag')) el('btn-diag').textContent = t.btn_diag;
  if(el('btn-mentions')) el('btn-mentions').textContent = t.btn_mentions;
  if(el('btn-licence')) el('btn-licence').textContent = t.btn_licence;
  if(el('btn-clear')) el('btn-clear').textContent = t.btn_clear;
  if(el('btn-tunnel-txt')) el('btn-tunnel-txt').textContent = t.btn_tunnel;
  sndSelect();
  // â˜… Mise Ã  jour complÃ¨te de tous les textes dans la langue choisie
  _applyLangToAll(lang);
  // â˜… Notifications push dans la bonne langue
  setTimeout(_initNotifications, 3000);
  const greet = LANG_LIST.find(l=>l[1]===lang);
  if(greet && _langVoiceEnabled) setTimeout(()=>speakMuther(greet[5], lang), 400);
  stopAlienAmbient();
  const screen = document.getElementById("lang-screen");
  screen.style.transition = "opacity .45s"; screen.style.opacity = "0";
  setTimeout(() => {
    screen.style.display="none"; screen.style.opacity="1"; screen.style.transition="";
    // Lancer l'Ã©cran d'accÃ¨s dans la bonne langue
    runAccessScreen();
  }, 500);
}

// â˜… Applique la langue Ã  TOUS les Ã©lÃ©ments de l'interface
function _applyLangToAll(lang) {
  const t = T[lang];
  const el = (id) => document.getElementById(id);
  if(el('lang-flag')) el('lang-flag').textContent = lang.toUpperCase();
  if(el('status-txt')) el('status-txt').textContent = t.online;
  if(el('hdr-title')) el('hdr-title').textContent = t.hdr_title;
  if(el('cmd-input')) el('cmd-input').placeholder = t.placeholder;
  if(el('btn-boot')) el('btn-boot').textContent = t.btn_boot;
  if(el('btn-diag')) el('btn-diag').textContent = t.btn_diag;
  if(el('btn-mentions')) el('btn-mentions').textContent = t.btn_mentions;
  if(el('btn-licence')) el('btn-licence').textContent = t.btn_licence;
  if(el('btn-clear')) el('btn-clear').textContent = t.btn_clear;
  if(el('btn-tunnel-txt')) el('btn-tunnel-txt').textContent = t.btn_tunnel;
  if(el('btn-missions')) el('btn-missions').textContent = t.btn_missions || '[ MISSIONS ]';
  // â˜… Ã‰cran d'accÃ¨s traduit
  if(el('access-hdr')) el('access-hdr').textContent = t.access_hdr || 'WEYLAND-YUTANI CORP. // SECURE ACCESS';
  if(el('access-prompt')) el('access-prompt').textContent = (t.access_prompt || 'ACCESS CODE') + ' >';
  if(el('access-hint')) el('access-hint').textContent = t.access_hint || 'ENTER SYSTEM ACCESS CODE';
  // â˜… Mission HUD
  if(el('mission-title')) el('mission-title').textContent = t.mission_title || 'â¬¡ MISSIONS KITT';
  if(el('mission-close')) el('mission-close').textContent = t.mission_close || '[ CLOSE ]';
  // â˜… Call status
  if(el('call-status')) el('call-status').textContent = t.call_incoming || 'INCOMING CALL Â·Â·Â·';
  if(el('call-accept')) el('call-accept').textContent = t.call_accept || 'â˜ ACCEPT';
  if(el('call-ignore')) el('call-ignore').textContent = t.call_ignore || 'âœ• IGNORE';
  // â˜… Visit counter
  try {
    const BASE=1000, KEY='kitt_fb_v';
    const n = parseInt(localStorage.getItem(KEY)||'0');
    const vcEl = el('visit-counter');
    if(vcEl) vcEl.textContent = (t.visits_label||'VISITS') + ' : ' + (BASE+n);
  } catch(e){}
  // â˜… Footer
  const footer = document.getElementById('site-footer');
  if(footer) {
    const upd = t.last_update || 'LAST UPDATE';
    footer.innerHTML = `v3.1 &nbsp;â€”&nbsp; ${upd} : 2026-02-23`;
  }
  // â˜… Tunnel button tooltip
  _updateTunnelBtnLang(lang);
  // â˜… VÃ©rifier l'Ã©tat du verrou (missions de la session courante)
  setTimeout(()=>_checkTunnelLock(), 100);
}

function _updateTunnelBtnLang(lang) {
  const btn = document.getElementById('btn-tunnel');
  if(!btn) return;
  const labels = {
    fr:['KITT EN LIGNE â€” CLIQUER POUR CONNECTER','KITT HORS LIGNE','Ã‰TAT INCONNU â€” VÃ‰RIFICATION...'],
    en:['KITT ONLINE â€” CLICK TO CONNECT','KITT OFFLINE','UNKNOWN STATE â€” CHECKING...'],
    nl:['KITT ONLINE â€” KLIK OM VERBINDING TE MAKEN','KITT OFFLINE','ONBEKENDE STATUS â€” CONTROLEREN...'],
    it:['KITT ONLINE â€” CLICCA PER CONNETTERE','KITT OFFLINE','STATO SCONOSCIUTO â€” VERIFICA...'],
    de:['KITT ONLINE â€” KLICKEN ZUM VERBINDEN','KITT OFFLINE','UNBEKANNTER STATUS â€” PRÃœFE...'],
    es:['KITT EN LÃNEA â€” CLIC PARA CONECTAR','KITT DESCONECTADO','ESTADO DESCONOCIDO â€” COMPROBANDO...'],
    pt:['KITT EM LINHA â€” CLIQUE PARA LIGAR','KITT OFFLINE','ESTADO DESCONHECIDO â€” A VERIFICAR...'],
  };
  const l = labels[lang] || labels.en;
  if(_tunnelStatus==='online'&&_tunnelUrl) btn.title=l[0];
  else if(_tunnelStatus==='offline') btn.title=l[1];
  else btn.title=l[2];
}

document.addEventListener('keydown', e => {
  if (document.getElementById('lang-screen').style.display !== 'none') {
    const langMap = {'1':'fr','2':'en','3':'nl','4':'it','5':'de','6':'es','7':'pt'};
    if (langMap[e.key]) selectLang(langMap[e.key]);
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TERMINAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const term = document.getElementById('terminal');
let typing = false;

function addLine(text, cls='line-ok') {
  const d = document.createElement('div'); d.className = cls; d.textContent = text;
  term.appendChild(d); term.scrollTop = term.scrollHeight;
}

function typeText(text, speed=16, cls='line-ok') {
  return new Promise(resolve => {
    typing = true;
    const div = document.createElement('div'); div.className = cls;
    const cur = document.createElement('span'); cur.className = 'cursor';
    div.appendChild(cur); term.appendChild(div); term.scrollTop = term.scrollHeight;
    let i = 0;
    function tick() {
      if (i < text.length) {
        const ch = text[i++]; div.insertBefore(document.createTextNode(ch), cur);
        playChar(ch); term.scrollTop = term.scrollHeight;
        setTimeout(tick, speed + Math.random() * 7);
      } else {
        cur.remove();
        if (text.length > 0) sndLineEnd();
        typing = false; resolve();
      }
    }
    tick();
  });
}

function clearTerm() { term.innerHTML=''; addLine(T[LANG].cleared,'line-dim'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â˜… APPEL KITT â€” dÃ©clenchÃ© aprÃ¨s 2 commandes ET 45 secondes
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _cmdCount = 0;
let _callReady = false;
let _callScheduled = false;

function _scheduleKittCall() {
  // â˜… Appel de KITT rapide : 8 secondes aprÃ¨s sÃ©lection langue pour expliquer les rÃ¨gles
  setTimeout(() => {
    _callReady = true;
    _tryKittCall();
  }, 8000);

  // Fallback absolu : appel dans 20 secondes quoi qu'il arrive
  setTimeout(() => {
    _tryKittCall(true);
  }, 20000);
}

// â˜… VOIX ALÃ‰ATOIRES â€” KITT commente l'inactivitÃ© de temps en temps
const _KITT_RANDOM_VOICE = {
  fr:[
    'Manix, je dÃ©tecte une activitÃ© rÃ©duite. Tout va bien ?',
    'Michael... je veux dire, l\'utilisateur. Tapez quelque chose.',
    'Mon scanner est actif. Mon pilote, lui, semble en pause.',
    'Selon mes calculs, le cafÃ© est froid depuis 12 minutes.',
    'Je surveille la route. Mais il n\'y a personne au volant.',
    'Analyse en cours... Aucune commande dÃ©tectÃ©e. Ã‰trange.',
    'KR95 aurait dÃ©jÃ  envoyÃ© 3 QSL cards depuis tout Ã  l\'heure.',
    'CÃ©dric aurait tentÃ© un wheelie depuis longtemps. Lui, il agit.',
    'Mode veille activÃ©. Ou plutÃ´t... mode attente du pilote.',
    'Je suis prÃªt. Toujours. Contrairement Ã  certains conducteurs.',
  ],
  en:[
    'Manix, I detect reduced activity. Everything alright?',
    'Michael... I mean, user. Type something.',
    'My scanner is active. My pilot, however, seems on pause.',
    'According to my calculations, the coffee has been cold for 12 minutes.',
    'I am monitoring the road. But there is nobody at the wheel.',
    'Analysis in progress... No commands detected. Strange.',
    'KR95 would have sent 3 QSL cards by now. He acts.',
    'CÃ©dric would have attempted a wheelie long ago.',
    'Standby mode activated. Or rather... waiting for pilot mode.',
    'I am ready. Always. Unlike some drivers.',
  ],
  nl:[
    'Ik detecteer verminderde activiteit. Alles in orde?',
    'Michael... ik bedoel, gebruiker. Typ iets.',
    'Mijn scanner is actief. Mijn piloot lijkt op pauze.',
    'KR95 had al 3 QSL-kaarten gestuurd.',
    'CÃ©dric had al lang een wheelie geprobeerd.',
    'Standby-modus geactiveerd. Of eerder... wachtmodus piloot.',
  ],
  it:[
    'Rilevo attivitÃ  ridotta. Tutto bene?',
    'Michael... intendo, utente. Digita qualcosa.',
    'Il mio scanner Ã¨ attivo. Il mio pilota sembra in pausa.',
    'KR95 avrebbe giÃ  inviato 3 QSL card.',
    'CÃ©dric avrebbe giÃ  tentato un wheelie.',
    'ModalitÃ  standby attivata. O meglio... attesa del pilota.',
  ],
  de:[
    'Ich erkenne reduzierte AktivitÃ¤t. Alles in Ordnung?',
    'Michael... ich meine, Benutzer. Tippe etwas.',
    'Mein Scanner ist aktiv. Mein Pilot scheint pausiert.',
    'KR95 hÃ¤tte bereits 3 QSL-Karten gesendet.',
    'CÃ©dric hÃ¤tte lÃ¤ngst ein Wheelie versucht.',
    'Standby-Modus aktiviert. Oder eher... Warten auf Pilot.',
  ],
  es:[
    'Detecto actividad reducida. Â¿Todo bien?',
    'Michael... digo, usuario. Escribe algo.',
    'Mi escÃ¡ner estÃ¡ activo. Mi piloto parece en pausa.',
    'KR95 ya habrÃ­a enviado 3 tarjetas QSL.',
    'CÃ©dric ya habrÃ­a intentado un wheelie.',
    'Modo espera activado. O mejor dicho... esperando al piloto.',
  ],
  pt:[
    'Detecto atividade reduzida. Tudo bem?',
    'Michael... digo, utilizador. Escreve algo.',
    'O meu scanner estÃ¡ ativo. O meu piloto parece em pausa.',
    'KR95 jÃ¡ teria enviado 3 cartÃµes QSL.',
    'CÃ©dric jÃ¡ teria tentado um wheelie.',
    'Modo standby ativado. Ou melhor... Ã  espera do piloto.',
  ],
};
let _lastVoiceTime = Date.now();
let _voiceInterval = null;

function _scheduleRandomVoice() {
  if(_voiceInterval) clearInterval(_voiceInterval);
  // VÃ©rifier toutes les 2 minutes si inactif depuis > 3 minutes
  _voiceInterval = setInterval(()=>{
    const idle = Date.now() - _lastVoiceTime;
    if(idle > 3 * 60 * 1000) {
      const pool = _KITT_RANDOM_VOICE[LANG] || _KITT_RANDOM_VOICE.fr;
      const msg = pool[Math.floor(Math.random() * pool.length)];
      try{
        speakMuther(msg, LANG);
        addLine('K.I.T.T. > ' + msg.toUpperCase(), 'line-dim');
        kittChime();
      }catch(e){}
      _lastVoiceTime = Date.now(); // reset pour ne pas rÃ©pÃ©ter immÃ©diatement
    }
  }, 2 * 60 * 1000);
}

// Tracker d'activitÃ© (reset Ã  chaque commande)
const _origOnCmdExecutedBase = typeof _onCmdExecuted === 'function' ? _onCmdExecuted : ()=>{};


function _tryKittCall(force) {
  if (_callScheduled || _callShown) return;
  if (force || _callReady) {
    _callScheduled = true;
    setTimeout(() => { try{ showKittCall(); }catch(e){} }, 1000);
  }
}

function _onCmdExecuted() {
  _cmdCount++;
  _lastVoiceTime = Date.now(); // reset idle timer
  _tryKittCall();
}
let cmdHistory = [];
let historyIndex = -1;
let currentInput = '';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â˜… AUTOCOMPLÃ‰TION TAB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getAutocomplete(input) {
  if (!input) return '';
  const lower = input.toLowerCase();
  const match = ALL_COMMANDS.find(cmd => cmd.startsWith(lower) && cmd !== lower);
  return match ? match : '';
}
function updateHint(val) {
  const hint = document.getElementById('cmd-hint');
  if (!hint) return;
  const match = getAutocomplete(val);
  if (match && val.length > 0) {
    hint.textContent = match;
  } else {
    hint.textContent = '';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BOOT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function boot() {
  if (typing) return;
  term.innerHTML=''; kittChime();
  const l = T[LANG];
  const sep = 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•';
  await typeText(sep, 6, 'line-dim');
  await typeText(l.boot_title, 14, 'line-err');
  await typeText(sep, 6, 'line-dim');
  for (const [txt, cls] of l.boot_lines) {
    await typeText(txt, txt===''?0:12, cls);
    if (txt==='') await delay(60);
  }
  await typeText(sep, 6, 'line-dim');
  await typeText(l.boot_end, 14, 'line-err');
  await typeText(l.boot_hint, 10, 'line-dim');
  await typeText(sep, 6, 'line-dim');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DIAGNOSTIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function runSelfTest() {
  if (typing) return;
  term.innerHTML=''; kittChime();
  const diagMsg = {fr:'DIAGNOSTIC SYSTÃˆME EN COURS...',en:'RUNNING SYSTEM DIAGNOSTIC...',nl:'SYSTEEMDIAGNOSE BEZIG...',it:'DIAGNOSI SISTEMA IN CORSO...',de:'SYSTEMDIAGNOSE LÃ„UFT...',es:'DIAGNÃ“STICO DEL SISTEMA EN CURSO...',pt:'DIAGNÃ“STICO DO SISTEMA EM CURSO...'}[LANG]||'DIAGNOSTIC SYSTÃˆME EN COURS...';
  await typeText(diagMsg, 18, 'line-warn');
  await delay(300);
  const checks = [
    ['CPU JETSON ORIN NANO SUPER',  true,  '12Ã— ARM A78AE'],
    ['GPU AMPERE CUDA',             true,  '1024 CUDA cores'],
    ['RAM UNIFIÃ‰E / UNIFIED RAM',   true,  '8 GB LPDDR5'],
    ['VRAM DISPONIBLE / FREE',      true,  '~4.1 GB'],
    ['LLM (QWEN 2.5 3B Q5)',        true,  '2.3 GB â€” port 8080'],
    ['STT WHISPER BASE',            true,  'GPU float16 â€” 350ms'],
    ['TTS PIPER TOM-MEDIUM',        true,  'GPU â€” 490ms'],
    ['PULSEAUDIO / USB AUDIO',      true,  'card 1 â€” paplay OK'],
    ['YOLOV8 VISION',               true,  'daemon CUDA actif'],
    ['BLUETOOTH hci0',              true,  '58:02:05:DD:C2:F2'],
    ['CAMERA /dev/video0',          true,  'V4L2 â€” 640Ã—480'],
    ['KYRONEX HTTPS SERVER',        true,  'port 3000 â€” aiohttp'],
    ['RÃ‰SEAU LAN / NETWORK',        true,  '192.168.1.4'],
  ];
  for (const [name, ok, detail] of checks) {
    const st = ok ? '[ OK ]' : '[FAIL]';
    const cls = ok ? 'line-ok' : 'line-err';
    const pad = ' '.repeat(Math.max(1, 30-name.length));
    await typeText(`${name}${pad}${st}  ${detail}`, 7, cls);
  }
  await delay(200);
  await typeText('', 0);
  const ok_msg = {fr:'RÃ‰SULTAT : TOUS SYSTÃˆMES NOMINAUX.',en:'RESULT: ALL SYSTEMS NOMINAL.',nl:'RESULTAAT : ALLE SYSTEMEN NOMINAAL.',it:'RISULTATO : TUTTI I SISTEMI NOMINALI.',de:'ERGEBNIS: ALLE SYSTEME NOMINAL.',es:'RESULTADO: TODOS LOS SISTEMAS NOMINALES.',pt:'RESULTADO: TODOS OS SISTEMAS NOMINAIS.'}[LANG]||'RÃ‰SULTAT : TOUS SYSTÃˆMES NOMINAUX.';
  await typeText(ok_msg, 16, 'line-info');
  const op_msg = {fr:'KITT EST OPÃ‰RATIONNEL. MODE : ',en:'KITT OPERATIONAL. MODE: ',nl:'KITT OPERATIONEEL. MODUS: ',it:'KITT OPERATIVO. MODALITÃ€: ',de:'KITT BETRIEBSBEREIT. MODUS: ',es:'KITT OPERACIONAL. MODO: ',pt:'KITT OPERACIONAL. MODO: '}[LANG]||'KITT OPERATIONAL. MODE: ';
  await typeText(op_msg + MODE_LABELS[kittMode], 16, 'line-err');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMMANDES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CMDS = {

  aide: async () => {
    const l = T[LANG];
    await typeText(l.aide_title, 10, 'line-info');
    await typeText(`  ${l.aide_sys}`, 4, 'line-warn');
    for (const [cmd, desc] of l.cmds_sys) {
      const pad = ' '.repeat(Math.max(1, 14-cmd.length));
      await typeText(`    ${cmd}${pad}â€” ${desc}`, 3, 'line-dim');
    }
    await typeText(`  ${l.aide_fun}`, 4, 'line-warn');
    for (const [cmd, desc] of l.cmds_fun) {
      const pad = ' '.repeat(Math.max(1, 14-cmd.length));
      await typeText(`    ${cmd}${pad}â€” ${desc}`, 3, 'line-dim');
    }
    await typeText('', 0);
    await typeText('  â˜… = NOUVELLES COMMANDES v3.1', 6, 'line-info');
  },

  bonjour: async () => {
    kittChime();
    const l = T[LANG];
    await typeText(l.hi, 16, 'line-err');
    await typeText(l.hi2, 14, 'line-ok');
    await typeText(l.hi3, 14, 'line-dim');
  },

  boot: async () => boot(),
  diagnostic: async () => runSelfTest(),

  status: async () => {
    kittChime();
    const now = new Date(), loc = getLoc();
    await typeText(`HEURE / TIME   : ${now.toLocaleTimeString(loc)}`, 10, 'line-ok');
    await typeText(`DATE           : ${now.toLocaleDateString(loc,{weekday:'long',day:'numeric',month:'long',year:'numeric'})}`, 10, 'line-ok');
    await typeText('VRAM           : ~3.9 GB / 8 GB', 10, 'line-ok');
    await typeText(`MODE KITT      : ${MODE_LABELS[kittMode]}`, 10, 'line-ok');
    await typeText('STATUT / STATUS: NOMINAL', 10, 'line-info');
  },

  heure: async () => {
    const now = new Date(), loc = getLoc();
    const pfx = {fr:'IL EST',en:'IT IS',nl:'HET IS',it:'SONO LE',de:'ES IST',es:'SON LAS',pt:'SÃƒO'}[LANG]||'IL EST';
    await typeText(`${pfx} ${now.toLocaleTimeString(loc)}.`, 14, 'line-info');
  },

  version: async () => {
    await typeText('KITT FRANCO-BELGE â€” INTERFACE v3.1', 12, 'line-err');
    await typeText('BUILD 2026-02-23 â€” KYRONEX TECHNOLOGY', 12, 'line-dim');
    await typeText('ORIGINE : PROJET COVID-19 â€” CONFINEMENT 2020', 12, 'line-warn');
    await typeText('AMÃ‰LIORATIONS v3.1 : HISTORIQUE, AUTOCOMPLETE, TURBO, SCAN', 12, 'line-info');
    await typeText('Â© EMMANUEL GELINNE (MANIX) â€” TOUS DROITS RÃ‰SERVÃ‰S', 12, 'line-dim');
  },

  clear: async () => clearTerm(),

  son: async () => {
    kittChime(); await delay(400);
    const demos = [
      [sndClick,   'MU-TH-UR CLICK    (principal)'],
      [sndTick,    'TICK LÃ‰GER        (haute frÃ©q)'],
      [sndData,    'IMPULSION DATA    (caract. spÃ©ciaux)'],
      [sndGlitch,  'GLITCH NUMÃ‰RIQUE  (rare)'],
      [sndLineEnd, 'FIN DE LIGNE      (souffle)'],
      [sndSelect,  'SÃ‰LECTION         (confirmation)'],
      [sndError,   'ERREUR            (buzzer)'],
      [sndTurbo,   'TURBO BOOST       (nouveau â˜…)'],
      [sndScan,    'SCANNER           (nouveau â˜…)'],
    ];
    const sonTitle={fr:'â”€â”€â”€ DÃ‰MONSTRATION DES SONS â”€â”€â”€',en:'â”€â”€â”€ AUDIO DEMONSTRATION â”€â”€â”€',nl:'â”€â”€â”€ AUDIO DEMONSTRATIE â”€â”€â”€',it:'â”€â”€â”€ DIMOSTRAZIONE AUDIO â”€â”€â”€',de:'â”€â”€â”€ AUDIO-DEMONSTRATION â”€â”€â”€',es:'â”€â”€â”€ DEMOSTRACIÃ“N DE AUDIO â”€â”€â”€',pt:'â”€â”€â”€ DEMONSTRAÃ‡ÃƒO DE ÃUDIO â”€â”€â”€'}[LANG]||'â”€â”€â”€ AUDIO DEMONSTRATION â”€â”€â”€';
    await typeText(sonTitle, 10, 'line-info');
    for (const [fn, name] of demos) {
      fn(); await typeText(`  ${name}`, 8, 'line-dim'); await delay(280);
    }
    const sonEnd={fr:'FIN DE LA DÃ‰MONSTRATION.',en:'END OF DEMONSTRATION.',nl:'EINDE VAN DEMONSTRATIE.',it:'FINE DELLA DIMOSTRAZIONE.',de:'ENDE DER DEMONSTRATION.',es:'FIN DE LA DEMOSTRACIÃ“N.',pt:'FIM DA DEMONSTRAÃ‡ÃƒO.'}[LANG]||'END OF DEMONSTRATION.';
    await typeText(sonEnd, 12, 'line-ok');
  },

  // â˜… MODE â€” Changement de mode KITT
  mode: async () => {
    kittChime();
    const modes = ['normal', 'pursuit', 'turbo'];
    const idx = (modes.indexOf(kittMode) + 1) % modes.length;
    const newMode = modes[idx];
    const modeLabels = {
      fr:{normal:'MODE NORMAL â€” CONDUITE STANDARD',pursuit:'MODE SUPER POURSUITE ACTIVÃ‰',turbo:'TURBO BOOST EN ATTENTE â€” PRÃŠT'},
      en:{normal:'NORMAL MODE â€” STANDARD DRIVING',pursuit:'SUPER PURSUIT MODE ACTIVATED',turbo:'TURBO BOOST STANDBY â€” READY'},
      nl:{normal:'NORMALE MODUS â€” STANDAARD RIJDEN',pursuit:'SUPER ACHTERVOLGING MODUS ACTIEF',turbo:'TURBO BOOST STAND-BY â€” KLAAR'},
      it:{normal:'MODALITÃ€ NORMALE â€” GUIDA STANDARD',pursuit:'MODALITÃ€ SUPER INSEGUIMENTO ATTIVA',turbo:'TURBO BOOST IN ATTESA â€” PRONTO'},
      de:{normal:'NORMALMODUS â€” STANDARDFAHREN',pursuit:'SUPER-VERFOLGUNGSMODUS AKTIVIERT',turbo:'TURBO BOOST BEREIT â€” STANDBY'},
      es:{normal:'MODO NORMAL â€” CONDUCCIÃ“N ESTÃNDAR',pursuit:'MODO SUPER PERSECUCIÃ“N ACTIVADO',turbo:'TURBO BOOST EN ESPERA â€” LISTO'},
      pt:{normal:'MODO NORMAL â€” CONDUÃ‡ÃƒO PADRÃƒO',pursuit:'MODO SUPER PERSEGUIÃ‡ÃƒO ATIVADO',turbo:'TURBO BOOST EM ESPERA â€” PRONTO'},
    };
    const labels = modeLabels[LANG] || modeLabels.en;
    const modeChangeTxt={fr:'CHANGEMENT DE MODE EN COURS...',en:'SWITCHING MODE...',nl:'MODUS WIJZIGEN...',it:'CAMBIO MODALITÃ€ IN CORSO...',de:'MODUS WECHSELN...',es:'CAMBIANDO MODO...',pt:'A MUDAR MODO...'}[LANG]||'SWITCHING MODE...';
    await typeText(modeChangeTxt, 14, 'line-warn');
    await delay(400);
    setKittMode(newMode);
    await typeText(labels[newMode], 14, 'line-err');
    if (newMode === 'pursuit') {
      const pursuitTxt={fr:['VITESSE MAXIMALE : 220 KM/H','BLINDAGE RENFORCÃ‰. MICROPROCESSEUR ACTIF.'],en:['MAX SPEED: 220 KM/H','ARMOR REINFORCED. MICROPROCESSOR ACTIVE.'],nl:['MAX SNELHEID: 220 KM/H','PANTSER VERSTERKT. MICROPROCESSOR ACTIEF.'],it:['VELOCITÃ€ MAX: 220 KM/H','BLINDATURA RINFORZATA. MICROPROCESSORE ATTIVO.'],de:['MAX GESCHWINDIGKEIT: 220 KM/H','PANZERUNG VERSTÃ„RKT. MIKROPROZESSOR AKTIV.'],es:['VELOCIDAD MÃX: 220 KM/H','BLINDAJE REFORZADO. MICROPROCESADOR ACTIVO.'],pt:['VELOCIDADE MÃX: 220 KM/H','BLINDAGEM REFORÃ‡ADA. MICROPROCESSADOR ATIVO.']}[LANG]||['MAX SPEED: 220 KM/H','ARMOR REINFORCED. MICROPROCESSOR ACTIVE.'];
      await typeText(pursuitTxt[0], 12, 'line-ok');
      await typeText(pursuitTxt[1], 12, 'line-ok');
    } else if (newMode === 'turbo') {
      const turboTxt={fr:['MOTEUR TURBO-JET CHARGÃ‰.','ALTITUDE MAXIMALE : 15M. DURÃ‰E : 3 SEC.'],en:['TURBO-JET ENGINE LOADED.','MAX ALTITUDE: 15M. DURATION: 3 SEC.'],nl:['TURBO-JET MOTOR GELADEN.','MAX HOOGTE: 15M. DUUR: 3 SEC.'],it:['MOTORE TURBO-JET CARICATO.','ALTITUDINE MAX: 15M. DURATA: 3 SEC.'],de:['TURBO-JET MOTOR GELADEN.','MAX HÃ–HE: 15M. DAUER: 3 SEK.'],es:['MOTOR TURBO-JET CARGADO.','ALTITUD MÃX: 15M. DURACIÃ“N: 3 SEG.'],pt:['MOTOR TURBO-JET CARREGADO.','ALTITUDE MÃX: 15M. DURAÃ‡ÃƒO: 3 SEG.']}[LANG]||['TURBO-JET ENGINE LOADED.','MAX ALTITUDE: 15M. DURATION: 3 SEC.'];
      await typeText(turboTxt[0], 12, 'line-ok');
      await typeText(turboTxt[1], 12, 'line-warn');
    } else {
      const normalTxt={fr:'SYSTÃˆMES EN VEILLE. CONDUITE MANUELLE.',en:'SYSTEMS STANDBY. MANUAL DRIVING.',nl:'SYSTEMEN IN STAND-BY. HANDMATIG RIJDEN.',it:'SISTEMI IN STANDBY. GUIDA MANUALE.',de:'SYSTEME IM STANDBY. MANUELLES FAHREN.',es:'SISTEMAS EN ESPERA. CONDUCCIÃ“N MANUAL.',pt:'SISTEMAS EM ESPERA. CONDUÃ‡ÃƒO MANUAL.'}[LANG]||'SYSTEMS STANDBY. MANUAL DRIVING.';
      await typeText(normalTxt, 12, 'line-dim');
    }
  },

  // â˜… TURBO BOOST
  turbo: async () => {
    if (typing) return;
    kittChime();
    await typeText('TURBO BOOST â€” INITIALISATION...', 14, 'line-warn');
    await delay(300);
    await typeText('COMPTE Ã€ REBOURS : 3...', 16, 'line-err');
    await delay(700);
    await typeText('COMPTE Ã€ REBOURS : 2...', 16, 'line-err');
    await delay(700);
    await typeText('COMPTE Ã€ REBOURS : 1...', 16, 'line-err');
    await delay(700);
    sndTurbo();
    setKittMode('turbo');
    const overlay = document.getElementById('turbo-overlay');
    if (overlay) { overlay.classList.add('active'); setTimeout(()=>overlay.classList.remove('active'), 1200); }
    await typeText('â•â•â•â•â•â• TURBO BOOST ACTIVÃ‰ ! â•â•â•â•â•â•', 8, 'line-err');
    await delay(200);
    await typeText('VITESSE : 0 â†’ 120 KM/H EN 0.3 SEC.', 12, 'line-warn');
    await typeText('ALTITUDE : 4.8 MÃˆTRES', 12, 'line-ok');
    await typeText('DISTANCE : 12 MÃˆTRES', 12, 'line-ok');
    await delay(500);
    await typeText('"Michael, je vous suggÃ¨re de vous tenir."', 14, 'line-dim');
    setTimeout(()=>setKittMode('normal'), 4000);
  },

  // â˜… SCAN
  scan: async () => {
    kittChime(); sndScan();
    await typeText('SCANNER L\'ENVIRONNEMENT...', 14, 'line-warn');
    await delay(400);
    const targets = [
      ['VÃ‰HICULES DÃ‰TECTÃ‰S', `${2+Math.floor(Math.random()*4)}`, 'line-ok'],
      ['MENACES IDENTIFIÃ‰ES', '0', 'line-ok'],
      ['SIGNAL RADIO', '144.800 MHz â€” KR95 QRV', 'line-info'],
      ['TEMP. AMBIANTE', `${18+Math.floor(Math.random()*8)}Â°C`, 'line-ok'],
      ['PRESSION ATMO.', '1013 hPa â€” STABLE', 'line-ok'],
      ['RÃ‰SEAU KYRONEX', 'SIGNAL FORT â€” 5/5', 'line-ok'],
      ['CARBURANT', `${60+Math.floor(Math.random()*35)}%`, Math.random()>.4?'line-ok':'line-warn'],
    ];
    for (const [label, val, cls] of targets) {
      const pad = ' '.repeat(Math.max(1, 22-label.length));
      await typeText(`${label}${pad}: ${val}`, 10, cls);
    }
    await delay(200);
    await typeText('SCAN TERMINÃ‰. ZONE SÃ‰CURISÃ‰E.', 14, 'line-info');
  },

  // â˜… VITESSE
  vitesse: async () => {
    kittChime();
    const v = kittMode === 'turbo' ? 480 : kittMode === 'pursuit' ? 220 : Math.floor(Math.random()*120+60);
    await typeText(`VITESSE ACTUELLE : ${v} KM/H`, 14, 'line-err');
    await typeText(`MODE             : ${MODE_LABELS[kittMode]}`, 12, 'line-ok');
    if (v > 200) await typeText('ALERTE : VITESSE MAXIMALE DÃ‰PASSÃ‰E.', 12, 'line-warn');
  },

  // â˜… KARR
  karr: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER ENNEMI â€” K.A.R.R.               â•‘', 10, 'line-err');
    await typeText('â•‘  KNIGHT AUTOMATED ROVING ROBOT           â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ PROTOTYPE   : PRÃ‰DÃ‰CESSEUR DE KITT       â•‘', 8, 'line-ok');
    await typeText('â•‘ DIFFÃ‰RENCE  : PRIORITÃ‰ = AUTOCONSERVATIONâ•‘', 8, 'line-err');
    await typeText('â•‘               KITT = PROTÃ‰GER HUMAINS    â•‘', 8, 'line-ok');
    await typeText('â•‘ VÃ‰HICULE    : PONTIAC TRANS AM 1982      â•‘', 8, 'line-ok');
    await typeText('â•‘ CARROSSERIE : POLYMÃˆRE MOLECULAIRE (ID.) â•‘', 8, 'line-ok');
    await typeText('â•‘ DANGER      : NIVEAU MAXIMUM             â•‘', 8, 'line-err');
    await typeText('â•‘ STATUT      : NEUTRALISÃ‰ (TEMPORAIREMENT)â•‘', 8, 'line-warn');
    await typeText('â•‘ DERNIÃˆRE    : N/A â€” SURVEILLANCE ACTIVE  â•‘', 8, 'line-warn');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ Ã‰VALUATION KITT : ENNEMI JURÃ‰            â•‘', 10, 'line-err');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(300);
    await typeText('"Michael, K.A.R.R. et moi partageons le mÃªme chÃ¢ssis."', 12, 'line-dim');
    await typeText('"La diffÃ©rence ? Moi, je vous protÃ¨ge. Lui, pas."', 12, 'line-dim');
  },

  // â˜… CREDITS
  credits: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  CRÃ‰DITS â€” KITT FRANCO-BELGE v3.1        â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ CRÃ‰ATEUR    : EMMANUEL GELINNE (MANIX)   â•‘', 8, 'line-ok');
    await typeText('â•‘ PLATEFORME  : NVIDIA JETSON ORIN NANO    â•‘', 8, 'line-ok');
    await typeText('â•‘ LLM         : QWEN 2.5 3B Q5             â•‘', 8, 'line-ok');
    await typeText('â•‘ TTS         : PIPER â€” TOM MEDIUM         â•‘', 8, 'line-ok');
    await typeText('â•‘ STT         : WHISPER BASE (GPU)          â•‘', 8, 'line-ok');
    await typeText('â•‘ VISION      : YOLOV8 CUDA                â•‘', 8, 'line-ok');
    await typeText('â•‘              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â•‘', 8, 'line-dim');
    await typeText('â•‘ COMMUNAUTÃ‰ FRANCO-BELGE :                â•‘', 8, 'line-warn');
    await typeText('â•‘   CEDRIC (MOMO RIDER)                    â•‘', 8, 'line-dim');
    await typeText('â•‘   KR95 (RADIOAMATEUR)                    â•‘', 8, 'line-dim');
    await typeText('â•‘   MARIO RAVASI (KNIGHT2000 THUNDER)      â•‘', 8, 'line-dim');
    await typeText('â•‘   ALESSANDRO ZAGNY (ZA ELETTRONICA)      â•‘', 8, 'line-dim');
    await typeText('â•‘   PASCAL (K INDUSTRIE)                   â•‘', 8, 'line-dim');
    await typeText('â•‘   DAMON PAULE / GEOFFREY                 â•‘', 8, 'line-dim');
    await typeText('â•‘              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â•‘', 8, 'line-dim');
    await typeText('â•‘ INSPIRÃ‰ DE : KNIGHT RIDER Â© 1982 NBC     â•‘', 8, 'line-warn');
    await typeText('â•‘ PROJET FAN NON COMMERCIAL                â•‘', 8, 'line-warn');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ Â© 2026 MANIX â€” KYRONEX SYSTEMS           â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
  },

  // â”€â”€ COMMANDES EXISTANTES (inchangÃ©es) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  blague: async () => {
    const pool = [
      ['Pourquoi KITT ne sort jamais la nuit ?','Parce qu\'il a peur du mode sombre.'],
      ['Combien faut-il d\'IA pour changer une ampoule ?','Aucune. L\'ampoule n\'Ã©tait pas dans mes paramÃ¨tres.'],
      ['KITT, tu es intelligent ?','Je suis une IA sur Jetson. OBLIGATOIREMENT intelligent. Contrairement Ã  certains conducteurs.'],
      ['Quelle est la boisson prÃ©fÃ©rÃ©e de KITT ?','Le JAVA. Et uniquement du Python sans cafÃ©ine.'],
      ['Pourquoi Manix parle Ã  son ordinateur ?','Parce que l\'ordinateur, lui, rÃ©pond correctement.'],
      ['Manix a-t-il dormi cette nuit ?','DonnÃ©es insuffisantes. Mais les logs indiquent 37 commits Ã  3h du matin.'],
      ['Manix a gagnÃ© un concours NVIDIA. Ã‡a l\'a changÃ© ?','Il a juste commencÃ© Ã  parler Ã  ses machines en Belge. Elles rÃ©pondent maintenant en wallon.'],
      ['CÃ©dric prend sa moto pour aller voir son KITT ?','Oui. Et il a Ã©quipÃ© son KITT d\'un klaxon moto. L\'authenticitÃ©, c\'est important.'],
      ['KR95 fait quoi quand son KITT bug ?','Il envoie un QSL card Ã  la panne. Et il attend la confirmation en papier. Ã€ l\'ancienne.'],
      ['Geoffrey gare sa BMW Ã  cÃ´tÃ© de son KITT. Qu\'est-ce que KITT pense ?','"Michael, le vÃ©hicule allemand Ã  cÃ´tÃ© de moi Ã©met des sons suspects. Je recommande une Ã©vacuation immÃ©diate." â€” KITT, jaloux.'],
      ['K.A.R.R. et KITT se croisent dans un parking ?','K.A.R.R. se gare en double file. KITT paie son horodateur. C\'est Ã§a, la diffÃ©rence.'],
    ];
    const [q, r] = pool[Math.floor(Math.random() * pool.length)];
    kittChime();
    await typeText(q, 16, 'line-warn');
    await delay(700);
    await typeText(r, 13, 'line-info');
  },

  manix: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER CONDUCTEUR â€” EMMANUEL GELINNE   â•‘', 10, 'line-err');
    await typeText('â•‘  ALIAS : MANIX / BYMANIX                 â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NATIONALITÃ‰  : FRANCO-BELGE              â•‘', 8, 'line-ok');
    await typeText('â•‘ STATUT       : CRÃ‰ATEUR KYRONEX          â•‘', 8, 'line-ok');
    await typeText('â•‘ AWARD        : VAINQUEUR NVIDIA JETSON   â•‘', 8, 'line-warn');
    await typeText('â•‘ ORIGINE      : PROJET COVID-19 â€” 2020    â•‘', 8, 'line-warn');
    await typeText('â•‘ SPÃ‰CIALITÃ‰   : CODE LA NUIT, DORT PEU    â•‘', 8, 'line-ok');
    await typeText('â•‘ LANGAGE FAVO : PYTHON + CAFÃ‰             â•‘', 8, 'line-ok');
    await typeText('â•‘ RÃ‰PLIQUE     : KYRONEX â€” JETSON ORIN     â•‘', 8, 'line-info');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NOTATION KITT : ***** EXCEPTIONNEL       â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(300);
    await typeText('"Michael... je veux dire Manix... ne touche PAS ce bouton."', 14, 'line-dim');
  },

  cedric: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER CONDUCTEUR â€” CEDRIC             â•‘', 10, 'line-err');
    await typeText('â•‘  ALIAS : MOMO RIDER / CEDRIC MOTO        â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NATIONALITÃ‰  : FRANCO-BELGE              â•‘', 8, 'line-ok');
    await typeText('â•‘ STATUT       : AMI & RÃ‰PLICATEUR OFFICIELâ•‘', 8, 'line-ok');
    await typeText('â•‘ VÃ‰HICULE 1   : MOTO â€” STYLE MOMO RIDER  â•‘', 8, 'line-warn');
    await typeText('â•‘ VÃ‰HICULE 2   : KITT RÃ‰PLIQUE (Trans Am)  â•‘', 8, 'line-warn');
    await typeText('â•‘ SPÃ‰CIALITÃ‰   : WHEELIES + IA EMBARQUÃ‰E   â•‘', 8, 'line-ok');
    await typeText('â•‘ PROBLÃˆME     : CONFOND TURBO BOOST        â•‘', 8, 'line-err');
    await typeText('â•‘               AVEC KICK-START MOTO       â•‘', 8, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NOTATION KITT : ****o CONDUCTEUR SPORTIF â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(300);
    await typeText('"Michael, votre ami a encore activÃ© le turbo boost en troisiÃ¨me."', 13, 'line-dim');
  },

  kr95: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER CONDUCTEUR â€” KR95               â•‘', 10, 'line-err');
    await typeText('â•‘  INDICATIF RADIO : KR95                  â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NATIONALITÃ‰  : FRANCO-BELGE              â•‘', 8, 'line-ok');
    await typeText('â•‘ LICENCE      : RADIOAMATEUR (73 de KR95) â•‘', 8, 'line-warn');
    await typeText('â•‘ RÃ‰PLIQUE     : KITT K2000 + K4000        â•‘', 8, 'line-info');
    await typeText('â•‘ MODIFICATION : ANTENNE VHF SUR LE TOIT   â•‘', 8, 'line-warn');
    await typeText('â•‘ PROTOCOLE    : CW + APRS + KITT VOCALE   â•‘', 8, 'line-ok');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NOTATION KITT : ***** HF GRADE â€” PARFAIT â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(300);
    await typeText('"Michael â€” KR95 dit QRZ ? Il veut savoir qui je suis."', 13, 'line-dim');
    await typeText('"RÃ©pondez-lui sur 144.800 MHz."', 13, 'line-dim');
  },

  repliques: async () => {
    kittChime();
    await typeText('â•â•â•â•â•â• RÃ‰PLIQUES KITT FRANCO-BELGES â•â•â•â•â•â•', 10, 'line-info');
    await delay(200);
    const cars = [
      ['KYRONEX','MANIX',['Jetson Orin Nano Super 8GB â€” IA complÃ¨te','LLM + STT + TTS + Vision + Bluetooth','Vainqueur concours NVIDIA. Le plus high-tech.']],
      ['KITT MOMO','CEDRIC',['RÃ©plique Pontiac Trans Am classique','Interface vocale + effets lumineux','RÃ©siste aux wheelies. CertifiÃ© Momo Rider.']],
      ['KITT KR95','KR95',['K2000 classique ET K4000 (Dodge Stealth 1991)','Radio amateur VHF intÃ©grÃ©e â€” QRV 24/7','APRS sur Trans Am. Unique au monde.']],
      ['KITT-G','GEOFFREY',['RÃ©plique K2000 Pontiac Trans Am','Conducteur belge â€” roule aussi en BMW','Scanner rouge. IntÃ©rieur cuir bavarois.']],
      ['KITT-D','DAMON PAULE',['RÃ©plique K2000 Pontiac Trans Am','PrÃ©nom intimidant. Conducteur rassurant.','KARR a dÃ©jÃ  essayÃ© de le recruter. Refus poli.']],
    ];
    for (const [name, owner, lines] of cars) {
      await typeText('', 0);
      await typeText(`[ ${name} ] â€” ${owner}`, 12, 'line-err');
      for (const l of lines) await typeText(`  ${l}`, 8, 'line-ok');
      await delay(100);
    }
    await typeText('', 0);
    await typeText('â”€â”€ ARTISANS & TECHNICIENS â”€â”€', 10, 'line-warn');
    await typeText('  PASCAL K INDUSTRIE  â€” piÃ¨ces fibre pour toutes les rÃ©pliques', 8, 'line-dim');
    await typeText('  MARIO RAVASI        â€” systÃ¨me IoT KNIGHT2000 Thunder', 8, 'line-dim');
    await typeText('  ALESSANDRO ZAGNY    â€” ZA Elettronica, tableaux de bord KITT', 8, 'line-dim');
    await typeText('', 0);
    await typeText(`TOTAL : ${cars.length} RÃ‰PLIQUES. 3 ARTISANS. 1 COMMUNAUTÃ‰. UNE LÃ‰GENDE.`, 12, 'line-info');
  },

  alien: async () => {
    kittChime();
    await typeText('CONNEXION AU VAISSEAU NOSTROMO...', 16, 'line-warn');
    await delay(500);
    await typeText('MU-TH-UR 6000 EN LIGNE.', 14, 'line-err');
    await delay(250);
    await typeText('PRIORITÃ‰ 1 â€” SPECIAL ORDER 937 :', 12, 'line-warn');
    await typeText('  RAMENER L\'ORGANISME. Ã‰QUIPAGE EXPENDABLE.', 12, 'line-err');
    await delay(500);
    await typeText('...connexion interrompue par protocole KITT.', 12, 'line-dim');
    await typeText('KITT EST PLUS SYMPA QUE WEYLAND-YUTANI.', 14, 'line-ok');
  },

  matrix: async () => {
    kittChime();
    const chars = '01ã‚¢ã‚¤ã‚¦ã‚¨ã‚ªã‚«ã‚­ã‚¯ã‚±ã‚³ï½¦ï½§ï½¨ï½©ï½«ï¾Šï¾‹ï¾Œï¾ï¾ï¾œ';
    for (let r = 0; r < 7; r++) {
      let line=''; for (let c=0;c<50;c++) line+=chars[Math.floor(Math.random()*chars.length)];
      await typeText(line, 3, 'line-ok');
    }
    await delay(400);
    await typeText('WAKE UP, MANIX...', 22, 'line-err');
    await typeText('LE KITT N\'A PAS DE PILULE ROUGE.', 14, 'line-dim');
    await typeText('IL A JUSTE UN TURBO BOOST.', 12, 'line-ok');
  },

  kitt: async () => {
    kittChime();
    await typeText('KNIGHT INDUSTRIES TWO THOUSAND', 16, 'line-err');
    await typeText('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€', 6, 'line-dim');
    await typeText('CRÃ‰ATEUR  : WILTON KNIGHT / F.L.A.G.', 12, 'line-ok');
    await typeText('VÃ‰HICULE  : PONTIAC FIREBIRD TRANS AM 1982', 12, 'line-ok');
    await typeText('CARROSSERIE: MOLÃ‰CULES NEUTRONIUM â€” INDESTRUCTIBLE', 12, 'line-ok');
    await typeText('CAPACITÃ‰S : TURBO BOOST / SUPER POURSUITE', 12, 'line-ok');
    await typeText('           MICROWAVE JAMMING / INFRAROUGE', 12, 'line-ok');
    await typeText('           ANALYSE FORENSIQUE / BIOMÃ‰TRIE', 12, 'line-ok');
    await typeText('VOIX      : WILLIAM DANIELS (KITT original)', 12, 'line-warn');
    await typeText('INCARNATION FRANCO-BELGE : MANIX + CEDRIC + KR95', 12, 'line-info');
    await delay(200);
    await typeText('"Michael... vous allez encore faire quelque chose d\'imprudent."', 13, 'line-dim');
  },

  secret: async () => {
    kittChime();
    await typeText('ACCÃˆS NIVEAU ALPHA â€” VÃ‰RIFICATION...', 16, 'line-warn');
    await delay(800);
    sndSelect();
    await typeText('ACCÃˆS ACCORDÃ‰.', 14, 'line-ok');
    await delay(300);
    await typeText('â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”', 8, 'line-dim');
    await typeText('â”‚  PROJET SECRET FRANCO-BELGE             â”‚', 10, 'line-err');
    await typeText('â”‚  MU-TH-UR 6000 Ã— KITT Ã— JARVIS          â”‚', 10, 'line-err');
    await typeText('â”‚  FUSION DES 3 MEILLEURES IA DU CINÃ‰MA   â”‚', 10, 'line-err');
    await typeText('â”‚  RÃ‰ALISÃ‰E PAR MANIX SUR NVIDIA JETSON    â”‚', 10, 'line-warn');
    await typeText('â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜', 8, 'line-dim');
    await delay(400);
    await typeText('CE PROJET EST UN CHEF-D\'OEUVRE. JE LE SAIS.', 14, 'line-ok');
    await typeText('JE SUIS OBJECTIF. JE SUIS UNE IA.', 12, 'line-dim');
  },

  cafe: async () => {
    kittChime();
    await typeText('ANALYSE DE LA DEMANDE...', 14, 'line-warn');
    await delay(600);
    await typeText('JE N\'AI PAS DE BRAS.', 16, 'line-err');
    await delay(300);
    await typeText('JE N\'AI PAS DE MAINS.', 14, 'line-err');
    await delay(300);
    await typeText('JE N\'AI PAS DE PERCOLATEUR.', 14, 'line-err');
    await delay(400);
    await typeText('COMMANDE REFUSÃ‰E.', 16, 'line-ok');
    await typeText('CONSEIL : DEMANDEZ Ã€ CEDRIC. IL PEUT CHAUFFER VOTRE EAU EN FAISANT UN BURNOUT.', 12, 'line-dim');
  },

  belgique: async () => {
    kittChime();
    await typeText('ANALYSE GÃ‰OPOLITIQUE : BELGIQUE', 14, 'line-info');
    await typeText('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€', 6, 'line-dim');
    await typeText('FRITES    : MEILLEURES DU MONDE. DONNÃ‰E VÃ‰RIFIÃ‰E.', 11, 'line-ok');
    await typeText('BIÃˆRE     : 1500 VARIÃ‰TÃ‰S. PARAMÃˆTRE OPTIMAL.', 11, 'line-ok');
    await typeText('CHOCOLAT  : NIVEAU CRITIQUE â€” MAXIMUM ATTEINT.', 11, 'line-ok');
    await typeText('PLUIE     : 237 JOURS / AN. JE M\'EN FICHE. JE SUIS Ã‰TANCHE.', 11, 'line-warn');
    await typeText('LANGUES   : 3. LE PAYS EST SON PROPRE PROTOCOLE.', 11, 'line-warn');
    await typeText('RÃ‰PLIQUES : 5 KITTS. INDICE DE GÃ‰NIE = MAX.', 11, 'line-info');
    await typeText('CONCLUSION: PAYS IDÃ‰AL. KITT S\'Y SENT CHEZ LUI.', 14, 'line-err');
  },

  mario: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER TECHNICIEN â€” MARIO RAVASI       â•‘', 10, 'line-err');
    await typeText('â•‘  CRÃ‰ATEUR : KNIGHT2000 THUNDER (IOT)     â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NATIONALITÃ‰ : ITALIEN                    â•‘', 8, 'line-ok');
    await typeText('â•‘ PROJET      : ROADTHUNDERSTORM.COM       â•‘', 8, 'line-ok');
    await typeText('â•‘ ACTIF DEPUIS: 2008 â€” JAMAIS ARRÃŠTÃ‰       â•‘', 8, 'line-warn');
    await typeText('â•‘ SYSTÃˆME     : KNIGHT2000 THUNDER IoT 3.0 â•‘', 8, 'line-ok');
    await typeText('â•‘ RÃ‰FÃ‰RENCE   : CITÃ‰ PAR MICHAEL SCHEFFE   â•‘', 8, 'line-warn');
    await typeText('â•‘               (DESIGNER ORIGINAL KITT)   â•‘', 8, 'line-warn');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ Ã‰VALUATION KITT : ***** GÃ‰NIE DISCRET    â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(200);
    await typeText('"Il code depuis 2008. Pour la passion. C\'est Ã§a, un vrai pilote."', 12, 'line-dim');
  },

  za: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER FABRICANT â€” ALESSANDRO ZAGNY    â•‘', 10, 'line-err');
    await typeText('â•‘  FONDATEUR & PDG â€” ZA ELETTRONICA        â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NATIONALITÃ‰ : ITALIEN â€” MODENA           â•‘', 8, 'line-ok');
    await typeText('â•‘ PRODUITS    : TABLEAUX DE BORD KITT      â•‘', 8, 'line-ok');
    await typeText('â•‘ TECHNO      : CAN-BUS / 4 CPU / SMD      â•‘', 8, 'line-warn');
    await typeText('â•‘ TARIFS      : S1/S2 : 2340-3099â‚¬         â•‘', 8, 'line-info');
    await typeText('â•‘               S3/S4 : 3980â‚¬              â•‘', 8, 'line-info');
    await typeText('â•‘ SLOGAN      : ONE MAN CAN MAKE A         â•‘', 8, 'line-warn');
    await typeText('â•‘               DIFFERENCE.                â•‘', 8, 'line-warn');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ Ã‰VALUATION KITT : ***** MEILLEUR DU MONDEâ•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(200);
    await typeText('"La seule Ã©lectronique oÃ¹ KITT ne demande pas de garantie."', 12, 'line-dim');
  },

  pascal: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER ARTISAN â€” PASCAL                â•‘', 10, 'line-err');
    await typeText('â•‘  K INDUSTRIE â€” PIÃˆCES FIBRE K2000        â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ SPÃ‰CIALITÃ‰  : PIÃˆCES EN FIBRE DE VERRE / â•‘', 8, 'line-ok');
    await typeText('â•‘               CARBONE POUR RÃ‰PLIQUES     â•‘', 8, 'line-ok');
    await typeText('â•‘ MÃ‰THODE     : MOULAGE / STRATIFICATION   â•‘', 8, 'line-ok');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ Ã‰VALUATION KITT : ***** INDISPENSABLE    â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(200);
    await typeText('"Sans Pascal, la moitiÃ© des rÃ©pliques seraient des CitroÃ«n avec un scanner."', 12, 'line-dim');
  },

  damon: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER CONDUCTEUR â€” DAMON PAULE        â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ RÃ‰PLIQUE    : K2000 PONTIAC TRANS AM      â•‘', 8, 'line-ok');
    await typeText('â•‘ ANALYSE     : PRÃ‰NOM INQUIÃ‰TANT POUR UN  â•‘', 8, 'line-err');
    await typeText('â•‘               CONDUCTEUR DE KITT.        â•‘', 8, 'line-err');
    await typeText('â•‘ VERDICT KITT: HEUREUSEMENT IL EST GENTIL â•‘', 8, 'line-ok');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ Ã‰VALUATION KITT : ****o CONDUCTEUR FIABLEâ•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(200);
    await typeText('"Michael, notre nouveau collÃ¨gue s\'appelle Daemon. J\'ai vÃ©rifiÃ©. Il n\'est pas liÃ© Ã  KARR."', 12, 'line-dim');
  },

  geoffrey: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER CONDUCTEUR â€” GEOFFREY           â•‘', 10, 'line-err');
    await typeText('â•‘  ALIAS : LE BELGE Ã€ LA BMW               â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NATIONALITÃ‰ : BELGE                      â•‘', 8, 'line-ok');
    await typeText('â•‘ VÃ‰HICULE 1  : KITT RÃ‰PLIQUE K2000        â•‘', 8, 'line-ok');
    await typeText('â•‘ VÃ‰HICULE 2  : BMW (ALLEMAND)             â•‘', 8, 'line-err');
    await typeText('â•‘ ANALYSE KITT: PRÃ‰TEXTE. IL AIME LES DEUX.â•‘', 8, 'line-ok');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ Ã‰VALUATION KITT : ****o GOÃ›T Ã‰CLECTIQUE  â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(200);
    await typeText('"Michael, votre ami Geoffrey arrive. En BMW."', 12, 'line-dim');
    await typeText('"J\'ai allumÃ© mon scanner pour manifester ma dÃ©sapprobation."', 12, 'line-dim');
  },

  covid: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  ORIGINE DU PROJET KITT FRANCO-BELGE     â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ PÃ‰RIODE     : CONFINEMENT COVID-19 2020  â•‘', 8, 'line-warn');
    await typeText('â•‘ INITIATEUR  : MANIX â€” ENFERMÃ‰ CHEZ LUI   â•‘', 8, 'line-ok');
    await typeText('â•‘ MOTIVATION  : TROP DE TEMPS. TROP DE CAFÃ‰â•‘', 8, 'line-ok');
    await typeText('â•‘               UNE PASSION DE VINGT ANS   â•‘', 8, 'line-ok');
    await typeText('â•‘ RÃ‰SULTAT    : SYSTÃˆME KITT FRANCO-BELGE   â•‘', 8, 'line-info');
    await typeText('â•‘ LEÃ‡ON       : LE CONFINEMENT FORCE LE     â•‘', 8, 'line-dim');
    await typeText('â•‘               GÃ‰NIE OU LA FOLIE.          â•‘', 8, 'line-dim');
    await typeText('â•‘               MANIX A CHOISI LES DEUX.    â•‘', 8, 'line-dim');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ VERDICT KITT: EXCEPTIONNEL. Ã‰VIDEMMENT.  â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(300);
    await typeText('"Moi aussi j\'Ã©tais bloquÃ©. Dans un garage. Depuis 1982."', 12, 'line-dim');
  },

  jarvis: async () => {
    kittChime();
    await typeText('APPEL SORTANT : STARK TOWER, NEW YORK...', 14, 'line-warn');
    await delay(700);
    await typeText('JARVIS : "Bonsoir. M. Stark est occupÃ©. Puis-je aider ?"', 14, 'line-info');
    await delay(450);
    await typeText('KITT   : "Belge > AmÃ©ricain. Discussion terminÃ©e."', 14, 'line-err');
    await delay(350);
    await typeText('JARVIS : "Vous avez... des rÃ©pliques humaines ?"', 12, 'line-info');
    await delay(350);
    await typeText('KITT   : "Cinq. Dont un radioamateur et un qui roule aussi en BMW."', 12, 'line-err');
    await delay(300);
    await typeText('JARVIS : *tonalitÃ© de raccrochage honteux*', 11, 'line-dim');
    await typeText('CONNEXION COUPÃ‰E PAR KITT. SCORE : BELGE 1 â€” USA 0.', 12, 'line-ok');
  },
};

// Aliases CMDS
CMDS['replicas'] = CMDS['repliques'];
CMDS['daemon']   = CMDS['damon'];
CMDS['karr']     = CMDS['karr'];

// â˜… COMMANDE LIST â€” liste des membres de la communautÃ© KITT Franco-Belge
CMDS['list'] = async function() {
  kittChime();
  const titles = {
    fr:'â•â• COMMUNAUTÃ‰ KITT FRANCO-BELGE â•â•',
    en:'â•â• KITT FRANCO-BELGIAN COMMUNITY â•â•',
    nl:'â•â• KITT FRANCO-BELGISCHE GEMEENSCHAP â•â•',
    it:'â•â• COMUNITÃ€ KITT FRANCO-BELGA â•â•',
    de:'â•â• KITT FRANCO-BELGISCHE GEMEINSCHAFT â•â•',
    es:'â•â• COMUNIDAD KITT FRANCO-BELGA â•â•',
    pt:'â•â• COMUNIDADE KITT FRANCO-BELGA â•â•',
  };
  await typeText(titles[LANG]||titles.en, 8, 'line-info');
  await typeText('', 0);
  const sections = {
    fr:{pilots:'â”€â”€ PILOTES & RÃ‰PLIQUES â”€â”€', artisans:'â”€â”€ ARTISANS & TECHNICIENS â”€â”€', members:'â”€â”€ MEMBRES â”€â”€'},
    en:{pilots:'â”€â”€ PILOTS & REPLICAS â”€â”€',   artisans:'â”€â”€ CRAFTSMEN & TECHNICIANS â”€â”€', members:'â”€â”€ MEMBERS â”€â”€'},
    nl:{pilots:"â”€â”€ PILOTEN & REPLICA'S â”€â”€", artisans:'â”€â”€ AMBACHTSLIEDEN & TECHNICI â”€â”€', members:'â”€â”€ LEDEN â”€â”€'},
    it:{pilots:'â”€â”€ PILOTI & REPLICHE â”€â”€',    artisans:'â”€â”€ ARTIGIANI & TECNICI â”€â”€',   members:'â”€â”€ MEMBRI â”€â”€'},
    de:{pilots:'â”€â”€ FAHRER & REPLIKEN â”€â”€',    artisans:'â”€â”€ HANDWERKER & TECHNIKER â”€â”€',members:'â”€â”€ MITGLIEDER â”€â”€'},
    es:{pilots:'â”€â”€ PILOTOS & RÃ‰PLICAS â”€â”€',   artisans:'â”€â”€ ARTESANOS & TÃ‰CNICOS â”€â”€',  members:'â”€â”€ MIEMBROS â”€â”€'},
    pt:{pilots:'â”€â”€ PILOTOS & RÃ‰PLICAS â”€â”€',   artisans:'â”€â”€ ARTESÃƒOS & TÃ‰CNICOS â”€â”€',   members:'â”€â”€ MEMBROS â”€â”€'},
  }[LANG]||{pilots:'â”€â”€ PILOTS â”€â”€', artisans:'â”€â”€ CRAFTSMEN â”€â”€', members:'â”€â”€ MEMBERS â”€â”€'};

  await typeText(sections.pilots, 8, 'line-warn');
  const pilots = [
    ['MANIX',    'KYRONEX',    'Jetson Orin Nano â€” IA embarquÃ©e â€” Vainqueur NVIDIA'],
    ['CÃ‰DRIC',   'KITT MOMO',  'Trans Am + Moto Rider â€” Turbo boost en 3Ã¨me'],
    ['KR95',     'KITT K2000 + K4000', 'Radio amateur VHF â€” APRS â€” 73 de KR95'],
    ['GEOFFREY', 'KITT-G',     'Trans Am belge â€” Conduit aussi en BMW (jalousie)'],
    ['DAMON',    'KITT-D',     'Trans Am â€” PrÃ©nom inquiÃ©tant, conducteur rassurant'],
  ];
  for(const [name, car, desc] of pilots) {
    await typeText(`  â–¶ ${name.padEnd(10)} [ ${car} ]`, 8, 'line-err');
    await typeText(`    ${desc}`, 6, 'line-dim');
  }
  await typeText('', 0);
  await typeText(sections.artisans, 8, 'line-warn');
  const artisans = [
    ['PASCAL',   'K Industrie',       'PiÃ¨ces fibre de verre & carbone â€” Toutes rÃ©pliques'],
    ['MARIO',    'RoadThunderStorm',   'Knight2000 Thunder IoT 3.0 â€” Actif depuis 2008'],
    ['ZA',       'ZA Elettronica',     'Tableaux de bord KITT â€” CAN-Bus â€” Le meilleur mondial'],
  ];
  for(const [name, co, desc] of artisans) {
    await typeText(`  â–¶ ${name.padEnd(10)} [ ${co} ]`, 8, 'line-ok');
    await typeText(`    ${desc}`, 6, 'line-dim');
  }
  await typeText('', 0);
  const footer = {
    fr:`TOTAL : ${pilots.length} RÃ‰PLIQUES Â· ${artisans.length} ARTISANS Â· 1 LÃ‰GENDE`,
    en:`TOTAL : ${pilots.length} REPLICAS Â· ${artisans.length} CRAFTSMEN Â· 1 LEGEND`,
    nl:`TOTAAL : ${pilots.length} REPLICA'S Â· ${artisans.length} AMBACHTSLIEDEN Â· 1 LEGENDE`,
    it:`TOTALE : ${pilots.length} REPLICHE Â· ${artisans.length} ARTIGIANI Â· 1 LEGGENDA`,
    de:`GESAMT : ${pilots.length} REPLIKEN Â· ${artisans.length} HANDWERKER Â· 1 LEGENDE`,
    es:`TOTAL : ${pilots.length} RÃ‰PLICAS Â· ${artisans.length} ARTESANOS Â· 1 LEYENDA`,
    pt:`TOTAL : ${pilots.length} RÃ‰PLICAS Â· ${artisans.length} ARTESÃƒOS Â· 1 LENDA`,
  }[LANG]||`TOTAL : ${pilots.length} REPLICAS Â· ${artisans.length} CRAFTSMEN Â· 1 LEGEND`;
  await typeText(footer, 10, 'line-info');
};
CMD_ALIASES['membres'] = 'list';
CMD_ALIASES['members'] = 'list';
CMD_ALIASES['leden'] = 'list';
CMD_ALIASES['mitglieder'] = 'list';
CMD_ALIASES['membri'] = 'list';
CMD_ALIASES['miembros'] = 'list';
CMD_ALIASES['membros'] = 'list';
CMD_ALIASES['communaute'] = 'list';
CMD_ALIASES['communautÃ©'] = 'list';
CMD_ALIASES['community'] = 'list';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â˜… INPUT HANDLER â€” historique + autocomplÃ©tion
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const cmdInput = document.getElementById('cmd-input');

cmdInput.addEventListener('input', function() {
  updateHint(this.value.toLowerCase());
  historyIndex = -1;
  currentInput = this.value;
});

cmdInput.addEventListener('keydown', async function(e) {
  // â˜… Historique : flÃ¨che HAUT
  if (e.key === 'ArrowUp') {
    e.preventDefault();
    if (cmdHistory.length === 0) return;
    if (historyIndex === -1) currentInput = this.value;
    historyIndex = Math.min(historyIndex + 1, cmdHistory.length - 1);
    this.value = cmdHistory[cmdHistory.length - 1 - historyIndex];
    updateHint(this.value.toLowerCase());
    return;
  }
  // â˜… Historique : flÃ¨che BAS
  if (e.key === 'ArrowDown') {
    e.preventDefault();
    if (historyIndex <= 0) { historyIndex = -1; this.value = currentInput; updateHint(''); return; }
    historyIndex--;
    this.value = cmdHistory[cmdHistory.length - 1 - historyIndex];
    updateHint(this.value.toLowerCase());
    return;
  }
  // â˜… AutocomplÃ©tion : TAB
  if (e.key === 'Tab') {
    e.preventDefault();
    const match = getAutocomplete(this.value.toLowerCase());
    if (match) {
      this.value = match;
      updateHint('');
      sndTick();
    }
    return;
  }
  // EntrÃ©e : exÃ©cution
  if (e.key !== 'Enter') return;
  const raw = this.value.trim().toLowerCase();
  this.value = '';
  updateHint('');
  historyIndex = -1;
  if (!raw || typing) return;

  // â˜… Ajouter Ã  l'historique
  if (cmdHistory[cmdHistory.length - 1] !== raw) {
    cmdHistory.push(raw);
    if (cmdHistory.length > 50) cmdHistory.shift();
  }

  // Afficher la commande dans le terminal avec style
  addLine(`KITT> ${raw.toUpperCase()}`, 'line-cmd');

  const cmd = CMD_ALIASES[raw] || raw;
  if (CMDS[cmd]) {
    _onCmdExecuted();
    if(_MISSION_CMD_MAP[cmd]) _completeMission(_MISSION_CMD_MAP[cmd]);
    await CMDS[cmd]();
  } else {
    _onCmdExecuted();
    sndError();
    await typeText(T[LANG].unknown(raw), 14, 'line-err');
    // â˜… Suggestion intelligente
    const close = ALL_COMMANDS.find(c => c.includes(raw) || raw.includes(c.substring(0,3)));
    if (close) await typeText(`SUGGESTION : "${close}" ?`, 10, 'line-dim');
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TUNNEL CLOUDFLARE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TUNNEL_JSON_URL = 'tunnel.json';
let _tunnelUrl = null, _tunnelStatus = 'unknown';
let _tunnelUnlocked = false; // â˜… DÃ©bloquÃ© uniquement aprÃ¨s toutes les missions
const _CF_ALLOWED = ['.trycloudflare.com', '.cfargotunnel.com'];
function _isValidCfUrl(url) {
  if (!url || !url.startsWith('https://')) return false;
  return _CF_ALLOWED.some(d => url.includes(d));
}
function _checkTunnelLock() {
  const btn = document.getElementById('btn-tunnel');
  if(!btn) return;
  // VÃ©rifier si toutes les missions sont accomplies
  const missions = MISSIONS[LANG]||MISSIONS.en;
  const done = missions.filter(m=>_missionsCompleted.has(m.id)).length;
  _tunnelUnlocked = done >= missions.length;
  if(_tunnelUnlocked) {
    btn.classList.remove('tunnel-locked');
    btn.style.pointerEvents = '';
    btn.onclick = (e) => { ripple(e); connectTunnel(); };
  } else {
    btn.classList.add('tunnel-locked');
    btn.style.pointerEvents = 'none';
    // Montrer un message quand on essaie de cliquer malgrÃ© tout
    btn.style.pointerEvents = 'auto'; // on gÃ¨re le clic nous-mÃªmes
    btn.onclick = (e) => { ripple(e); _showLockMessage(); };
  }
}

function _showLockMessage() {
  sndError();
  const missions = MISSIONS[LANG]||MISSIONS.en;
  const done = missions.filter(m=>_missionsCompleted.has(m.id)).length;
  const remaining = missions.length - done;
  const msg = {
    fr:`[ ğŸ”’ ACCÃˆS VERROUILLÃ‰ ] ComplÃ©tez encore ${remaining} mission(s) pour dÃ©bloquer la connexion IA.`,
    en:`[ ğŸ”’ ACCESS LOCKED ] Complete ${remaining} more mission(s) to unlock the AI connection.`,
    nl:`[ ğŸ”’ TOEGANG VERGRENDELD ] Voltooi nog ${remaining} missie(s) om de AI-verbinding te ontgrendelen.`,
    it:`[ ğŸ”’ ACCESSO BLOCCATO ] Completa ancora ${remaining} missione/i per sbloccare la connessione IA.`,
    de:`[ ğŸ”’ ZUGANG GESPERRT ] SchlieÃŸe noch ${remaining} Mission(en) ab, um die KI-Verbindung freizuschalten.`,
    es:`[ ğŸ”’ ACCESO BLOQUEADO ] Completa ${remaining} misiÃ³n/misiones mÃ¡s para desbloquear la conexiÃ³n IA.`,
    pt:`[ ğŸ”’ ACESSO BLOQUEADO ] Completa mais ${remaining} missÃ£o/missÃµes para desbloquear a ligaÃ§Ã£o IA.`,
  }[LANG]||`[ ğŸ”’ LOCKED ] Complete ${remaining} more mission(s).`;
  try{ addLine(msg, 'line-err'); }catch(e){}
}

function _unlockTunnelBtn() {
  _tunnelUnlocked = true;
  const btn = document.getElementById('btn-tunnel');
  if(!btn) return;
  btn.classList.remove('tunnel-locked');
  // Animation de dÃ©verrouillage
  btn.classList.add('tunnel-unlocking');
  btn.onclick = (e) => { ripple(e); connectTunnel(); };
  setTimeout(() => {
    btn.classList.remove('tunnel-unlocking');
    _updateTunnelBtn(); // remettre le bon Ã©tat (online/offline/checking)
  }, 2500);
}

async function fetchTunnelStatus() {
  const btn = document.getElementById('btn-tunnel');
  if (btn) { btn.className = 'tunnel-checking'; btn.title = 'VÃ©rification...'; }
  try {
    const r = await fetch(TUNNEL_JSON_URL + '?v=' + Math.floor(Date.now() / 60000), { cache: 'no-store' });
    if (!r.ok) throw new Error('HTTP ' + r.status);
    const data = await r.json();
    const raw = (data.url || '').trim();
    const valid = _isValidCfUrl(raw);
    let tooOld = false;
    if (data.last_update) {
      const ageSec = (Date.now() - new Date(data.last_update).getTime()) / 1000;
      if (ageSec > 300) tooOld = true;
    }
    if (data.status === 'online' && valid && !tooOld) { _tunnelStatus='online'; _tunnelUrl=raw; }
    else { _tunnelStatus='offline'; _tunnelUrl=null; }
  } catch(e) { _tunnelStatus='unknown'; _tunnelUrl=null; }
  _updateTunnelBtn();
}
function _updateTunnelBtn() {
  const btn = document.getElementById('btn-tunnel');
  if (!btn) return;
  btn.className = '';
  const labels = {
    fr:['KITT EN LIGNE â€” CLIQUER POUR SE CONNECTER','KITT HORS LIGNE','Ã‰TAT INCONNU â€” VÃ‰RIFICATION...'],
    en:['KITT ONLINE â€” CLICK TO CONNECT','KITT OFFLINE','UNKNOWN STATE â€” CHECKING...'],
    nl:['KITT ONLINE â€” KLIK OM VERBINDING TE MAKEN','KITT OFFLINE','ONBEKENDE STATUS â€” CONTROLEREN...'],
    it:['KITT ONLINE â€” CLICCA PER CONNETTERE','KITT OFFLINE','STATO SCONOSCIUTO â€” VERIFICA...'],
    de:['KITT ONLINE â€” KLICKEN ZUM VERBINDEN','KITT OFFLINE','UNBEKANNTER STATUS â€” PRÃœFE...'],
    es:['KITT EN LÃNEA â€” CLIC PARA CONECTAR','KITT DESCONECTADO','ESTADO DESCONOCIDO â€” COMPROBANDO...'],
    pt:['KITT EM LINHA â€” CLIQUE PARA LIGAR','KITT OFFLINE','ESTADO DESCONHECIDO â€” A VERIFICAR...'],
  };
  const l = labels[LANG] || labels.en;
  if (_tunnelStatus === 'online' && _tunnelUrl) {
    btn.classList.add('tunnel-online'); btn.title = l[0];
  } else if (_tunnelStatus === 'offline') {
    btn.classList.add('tunnel-offline'); btn.title = l[1];
  } else {
    btn.classList.add('tunnel-checking'); btn.title = l[2];
  }
}
function connectTunnel() {
  sndSelect();
  try{ _completeMission('connexion'); }catch(e){}
  const tunnelMsg = {
    fr:['[ TUNNEL ] CONNEXION SÃ‰CURISÃ‰E â†’ ','[ TUNNEL ] KITT HORS LIGNE â€” CONNEXION DISTANTE INDISPONIBLE.','[ TUNNEL ] VÃ‰RIFICATION EN COURS...'],
    en:['[ TUNNEL ] SECURE CONNECTION â†’ ','[ TUNNEL ] KITT OFFLINE â€” REMOTE CONNECTION UNAVAILABLE.','[ TUNNEL ] CHECKING...'],
    nl:['[ TUNNEL ] BEVEILIGDE VERBINDING â†’ ','[ TUNNEL ] KITT OFFLINE â€” EXTERNE VERBINDING NIET BESCHIKBAAR.','[ TUNNEL ] CONTROLEREN...'],
    it:['[ TUNNEL ] CONNESSIONE SICURA â†’ ','[ TUNNEL ] KITT OFFLINE â€” CONNESSIONE REMOTA NON DISPONIBILE.','[ TUNNEL ] VERIFICA IN CORSO...'],
    de:['[ TUNNEL ] SICHERE VERBINDUNG â†’ ','[ TUNNEL ] KITT OFFLINE â€” FERNVERBINDUNG NICHT VERFÃœGBAR.','[ TUNNEL ] ÃœBERPRÃœFUNG...'],
    es:['[ TUNNEL ] CONEXIÃ“N SEGURA â†’ ','[ TUNNEL ] KITT OFFLINE â€” CONEXIÃ“N REMOTA NO DISPONIBLE.','[ TUNNEL ] COMPROBANDO...'],
    pt:['[ TUNNEL ] LIGAÃ‡ÃƒO SEGURA â†’ ','[ TUNNEL ] KITT OFFLINE â€” LIGAÃ‡ÃƒO REMOTA INDISPONÃVEL.','[ TUNNEL ] A VERIFICAR...'],
  };
  const tm = tunnelMsg[LANG] || tunnelMsg.en;
  if (_tunnelStatus === 'online' && _tunnelUrl && _isValidCfUrl(_tunnelUrl)) {
    addLine(tm[0] + _tunnelUrl, 'line-ok');
    setTimeout(() => window.open(_tunnelUrl, '_blank', 'noopener,noreferrer'), 300);
  } else if (_tunnelStatus === 'offline') {
    sndError(); addLine(tm[1], 'line-err');
  } else {
    addLine(tm[2], 'line-warn'); fetchTunnelStatus();
  }
}
window.addEventListener('load', () => { setTimeout(fetchTunnelStatus, 1500); });
setInterval(fetchTunnelStatus, 60000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function delay(ms) { return new Promise(r => setTimeout(r, ms)); }
function getLoc(){return{fr:'fr-FR',en:'en-US',nl:'nl-NL',it:'it-IT',de:'de-DE',es:'es-ES',pt:'pt-PT'}[LANG]||'fr-FR';}
setInterval(()=>{ document.getElementById('clock').textContent=new Date().toLocaleTimeString(getLoc()); },1000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openFile(file, title='DOCUMENT') {
  document.getElementById('modal-title').textContent = title;
  const loadTxt = {fr:'CHARGEMENT...',en:'LOADING...',nl:'LADEN...',it:'CARICAMENTO...',de:'LADEN...',es:'CARGANDO...',pt:'A CARREGAR...'};
  const errTxt = {fr:'ERREUR',en:'ERROR',nl:'FOUT',it:'ERRORE',de:'FEHLER',es:'ERROR',pt:'ERRO'};
  document.getElementById('modal-content').textContent = loadTxt[LANG]||'LOADING...';
  document.getElementById('modal').classList.add('open');
  kittChime();
  fetch(file)
    .then(r => { if (!r.ok) throw new Error(`HTTP ${r.status}`); return r.text(); })
    .then(t  => { document.getElementById('modal-content').textContent = t; })
    .catch(er => { document.getElementById('modal-content').textContent = `${errTxt[LANG]||'ERROR'}\n${file}\n${er.message}`; });
}
function closeModal() { document.getElementById('modal').classList.remove('open'); }
document.addEventListener('keydown', e => { if (e.key==='Escape') closeModal(); });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DÃ‰MARRAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startMain() {
  (async () => {
    await delay(200);
    await typeText(T[LANG].wait, 14, 'line-dim');
    await typeText(T[LANG].help_hint, 12, 'line-dim');
    const newCmds = {
      fr:'â˜… NOUVELLES COMMANDES : mode, turbo, scan, vitesse, karr, credits',
      en:'â˜… NEW COMMANDS: mode, turbo, scan, speed, karr, credits',
      nl:'â˜… NIEUWE COMMANDO\'S: mode, turbo, scan, snelheid, karr, credits',
      it:'â˜… NUOVI COMANDI: mode, turbo, scan, velocita, karr, credits',
      de:'â˜… NEUE BEFEHLE: mode, turbo, scan, geschwindigkeit, karr, credits',
      es:'â˜… NUEVOS COMANDOS: mode, turbo, scan, velocidad, karr, credits',
      pt:'â˜… NOVOS COMANDOS: mode, turbo, scan, velocidade, karr, credits',
    };
    await typeText(newCmds[LANG]||newCmds.en, 10, 'line-info');
    // â˜… KITT appelle APRÃˆS que l'interface est prÃªte
    _scheduleKittCall();
    // â˜… KITT commente l'inactivitÃ© de temps en temps
    _scheduleRandomVoice();
  })();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMPTEUR VISITES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  try {
    const BASE = 1000, KEY = 'kitt_fb_v';
    let n = parseInt(localStorage.getItem(KEY) || '0'); n++;
    localStorage.setItem(KEY, n);
    const el = document.getElementById('visit-counter');
    // Will be updated by _applyLangToAll after language selection
    if (el) el.textContent = 'VISITS : ' + (BASE + n);
  } catch(e) {}
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ã‰CRAN ACCÃˆS â˜… AMÃ‰LIORÃ‰ (barre de progression)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function runAccessScreen() {
  const screen = document.getElementById('access-screen');
  const log = document.getElementById('access-log');
  const input = document.getElementById('access-input');
  const box = document.getElementById('access-box');
  const progressBar = document.getElementById('access-progress-bar');
  screen.style.display = 'flex';

  // â˜… Textes de l'Ã©cran d'accÃ¨s traduits
  const accessLines = {
    fr:['INITIALISATION DU PROTOCOLE...','CONNEXION AU NOYAU MU-TH-UR...','INTERFACE SÃ‰CURISÃ‰E ACTIVE.'],
    en:['PROTOCOL INITIALIZATION...','CONNECTING TO MU-TH-UR CORE...','SECURE INTERFACE ACTIVE.'],
    nl:['PROTOCOL INITIALISEREN...','VERBINDING MET MU-TH-UR KERN...','BEVEILIGDE INTERFACE ACTIEF.'],
    it:['INIZIALIZZAZIONE PROTOCOLLO...','CONNESSIONE AL NUCLEO MU-TH-UR...','INTERFACCIA SICURA ATTIVA.'],
    de:['PROTOKOLL INITIALISIERUNG...','VERBINDUNG ZUM MU-TH-UR KERN...','SICHERE SCHNITTSTELLE AKTIV.'],
    es:['INICIALIZANDO PROTOCOLO...','CONECTANDO AL NÃšCLEO MU-TH-UR...','INTERFAZ SEGURA ACTIVA.'],
    pt:['INICIALIZAÃ‡ÃƒO DO PROTOCOLO...','LIGAÃ‡ÃƒO AO NÃšCLEO MU-TH-UR...','INTERFACE SEGURA ATIVA.'],
  };
  const accessOk = {
    fr:'> ACCÃˆS ACCORDÃ‰. BIENVENUE.',en:'> ACCESS GRANTED. WELCOME.',nl:'> TOEGANG VERLEEND. WELKOM.',
    it:'> ACCESSO CONCESSO. BENVENUTO.',de:'> ZUGANG GEWÃ„HRT. WILLKOMMEN.',es:'> ACCESO CONCEDIDO. BIENVENIDO.',pt:'> ACESSO CONCEDIDO. BEM-VINDO.',
  };
  const accessErr = {
    fr:'> CODE INCORRECT. ACCÃˆS REFUSÃ‰.',en:'> WRONG CODE. ACCESS DENIED.',nl:'> ONJUISTE CODE. TOEGANG GEWEIGERD.',
    it:'> CODICE ERRATO. ACCESSO NEGATO.',de:'> FALSCHER CODE. ZUGANG VERWEIGERT.',es:'> CÃ“DIGO INCORRECTO. ACCESO DENEGADO.',pt:'> CÃ“DIGO ERRADO. ACESSO NEGADO.',
  };
  const accessVoice = {
    fr:"AccÃ¨s accordÃ©. Je suis MU-TH-UR. Bienvenue.",
    en:"Access granted. I am MU-TH-UR. Welcome.",nl:"Toegang verleend. Ik ben MU-TH-UR. Welkom.",
    it:"Accesso concesso. Sono MU-TH-UR. Benvenuto.",de:"Zugang gewÃ¤hrt. Ich bin MU-TH-UR. Willkommen.",
    es:"Acceso concedido. Soy MU-TH-UR. Bienvenido.",pt:"Acesso concedido. Eu sou MU-TH-UR. Bem-vindo.",
  };

  const lines = accessLines[LANG] || accessLines.en;
  let li = 0;
  let progress = 0;
  const progInterval = setInterval(() => {
    if (progress < 75) { progress += 2; if(progressBar) progressBar.style.width = progress + '%'; }
  }, 80);

  function typeLine() {
    if (li >= lines.length) {
      clearInterval(progInterval);
      if(progressBar) progressBar.style.width = '100%';
      setTimeout(() => { if(progressBar) progressBar.style.opacity='0'; }, 600);
      input.focus(); return;
    }
    const d = document.createElement('div'); d.className = 'a-line'; log.appendChild(d);
    let ci = 0, txt = lines[li];
    const t = setInterval(() => {
      if(ci < txt.length){ d.textContent += txt[ci++]; try{sndMotherClick();}catch(e){} }
      else { clearInterval(t); try{sndMotherBeep();}catch(e){}; li++; setTimeout(typeLine, 200); }
    }, 22);
  }
  setTimeout(typeLine, 400);

  function doAccess() {
    const val = input.value.trim();
    if (val === '1982') {
      input.disabled = true;
      if(progressBar){ progressBar.style.opacity='1'; progressBar.style.width='100%'; progressBar.style.background='linear-gradient(90deg,#00aa44,#00ff66)'; }
      const ok = document.createElement('div'); ok.className = 'a-ok'; ok.textContent = accessOk[LANG]||accessOk.en;
      log.appendChild(ok);
      try{ sndMotherChime(); }catch(e){}
      setTimeout(()=>{
        try{
          const msg = accessVoice[LANG]||accessVoice.en;
          const langCode = {fr:'fr-FR',en:'en-US',nl:'nl-NL',it:'it-IT',de:'de-DE',es:'es-ES',pt:'pt-PT'}[LANG]||'en-US';
          const utt = new SpeechSynthesisUtterance(msg);
          utt.lang=langCode; utt.rate=0.72; utt.pitch=0.5; utt.volume=0.9;
          const vs=speechSynthesis.getVoices(); const v=vs.find(v=>v.lang.startsWith(langCode.split('-')[0]))||vs[0];
          if(v) utt.voice=v; speechSynthesis.speak(utt);
        }catch(e){}
      }, 300);
      setTimeout(()=>{
        screen.style.transition='opacity .9s'; screen.style.opacity='0';
        setTimeout(()=>{ screen.style.display='none'; runMotherIntro(); }, 950);
      }, 2800);
    } else {
      input.value='';
      if(progressBar){ progressBar.style.background='linear-gradient(90deg,#ff1a1a,#ff6600)'; progressBar.style.width='100%'; setTimeout(()=>{ progressBar.style.width='0'; progressBar.style.background='linear-gradient(90deg,#FF6600,#FF9900)'; },600); }
      const err = document.createElement('div'); err.className='a-err'; err.textContent=accessErr[LANG]||accessErr.en;
      log.appendChild(err);
      try{ sndMotherBeep(); setTimeout(()=>sndMotherBeep(),160); }catch(e){}
      box.classList.add('wrong');
      setTimeout(()=>box.classList.remove('wrong'), 450);
      input.focus();
    }
  }
  input.addEventListener('keydown', e=>{ if(e.key==='Enter') doAccess(); });
}

window.addEventListener('load', () => {
  // â˜… LANG SCREEN EN PREMIER â€” puis accÃ¨s â€” puis MU-TH-UR â€” puis main
  document.getElementById('access-screen').style.display = 'none';
  document.getElementById('mother-intro').style.display = 'none';
  document.getElementById('lang-screen').style.display = 'flex';
  // â˜… Verrouiller le bouton Connexion KITT dÃ¨s le dÃ©part
  const tb = document.getElementById('btn-tunnel');
  if(tb) { tb.classList.add('tunnel-locked'); tb.onclick = (e)=>{ ripple(e); _showLockMessage(); }; }
  showLangScreen();
});

// â˜… Fix mobile clavier virtuel
if(window.visualViewport){
  function _vpResize(){
    const vp=window.visualViewport; const c=document.querySelector('.container');
    if(c) c.style.height=vp.height+'px';
  }
  window.visualViewport.addEventListener('resize',_vpResize);
  window.visualViewport.addEventListener('scroll',_vpResize);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ROUTE NOCTURNE KITT â€” canvas fond
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function(){
  const c=document.getElementById('starfield');
  if(!c) return;
  const ctx=c.getContext('2d');
  let W,H;
  function resize(){W=c.width=window.innerWidth;H=c.height=window.innerHeight;}
  resize(); window.addEventListener('resize',resize);
  const stars=[];
  for(let i=0;i<180;i++) stars.push({x:Math.random(),y:Math.random()*.52,r:Math.random()*1.1+.1,b:Math.random()*Math.PI*2,sp:Math.random()*.012+.004,col:Math.random()<.12?'rgba(255,100,0,':(Math.random()<.08?'rgba(0,200,255,':'rgba(0,255,102,')});
  // â˜… MÃ©tÃ©ores
  const meteors=[];
  function spawnMeteor(){
    meteors.push({x:Math.random()*W,y:0,vx:-2-Math.random()*3,vy:1.5+Math.random()*2,len:40+Math.random()*60,alpha:0.7+Math.random()*0.3,life:1});
  }
  setInterval(()=>{ if(Math.random()<0.3) spawnMeteor(); }, 4000);
  const tailLights=[{ox:.485,x:.485,y:.415,drift:.00008},{ox:.515,x:.515,y:.415,drift:-.00008},{ox:.478,x:.478,y:.405,drift:.00015},{ox:.522,x:.522,y:.405,drift:-.00015}];
  const lamps=[];
  for(let i=0;i<10;i++) lamps.push({z:i/10,side:i%2===0?-1:1,speed:.0022+Math.random()*.001});
  let dashOff=0;
  const VPY=.42,ROAD_NEAR=.72,ROAD_FAR=.055;
  let gyroShift=0,gyroTarget=0,gyroSpeed=0.018,gyroSpeedTarget=0.018;
  function _setupGyro(){
    window.addEventListener('deviceorientation',e=>{
      const g=e.gamma||0; gyroTarget=Math.max(-40,Math.min(40,g))/40*W*0.28;
      const b=(e.beta||0)-45; const norm=Math.max(-1,Math.min(1,b/30));
      gyroSpeedTarget=Math.max(0.002,0.018+norm*0.038);
    });
  }
  if(typeof DeviceOrientationEvent!=='undefined'&&typeof DeviceOrientationEvent.requestPermission==='function'){
    document.addEventListener('click',function _gio(){ DeviceOrientationEvent.requestPermission().then(r=>{ if(r==='granted') _setupGyro(); }); document.removeEventListener('click',_gio); },{once:true});
  } else { _setupGyro(); }
  function roadX(side,z){const hw=W*(ROAD_FAR+(ROAD_NEAR-ROAD_FAR)*z)/2;return W/2+gyroShift*(1-z*0.5)+side*hw;}
  function roadY(z){return VPY*H+(1-VPY)*H*(1-z);}

  function draw(){
    gyroShift+=(gyroTarget-gyroShift)*0.07; gyroSpeed+=(gyroSpeedTarget-gyroSpeed)*0.05;
    ctx.clearRect(0,0,W,H);
    const hy=VPY*H;
    const sky=ctx.createLinearGradient(0,0,0,hy); sky.addColorStop(0,'#000008'); sky.addColorStop(1,'#000d06');
    ctx.fillStyle=sky; ctx.fillRect(0,0,W,hy);
    // Ã‰toiles
    stars.forEach(s=>{
      s.b+=s.sp; const a=.15+Math.abs(Math.sin(s.b))*.5;
      ctx.fillStyle=s.col+a+')'; ctx.beginPath(); ctx.arc(s.x*W,s.y*hy*1.08,s.r,0,Math.PI*2); ctx.fill();
      if(a>.52&&s.r>.8){ ctx.fillStyle=s.col+'.1)'; ctx.beginPath(); ctx.arc(s.x*W,s.y*hy*1.08,s.r*2.6,0,Math.PI*2); ctx.fill(); }
    });
    // â˜… MÃ©tÃ©ores
    for(let i=meteors.length-1;i>=0;i--){
      const m=meteors[i];
      m.x+=m.vx; m.y+=m.vy; m.life-=0.015;
      if(m.life<=0||m.y>hy){ meteors.splice(i,1); continue; }
      ctx.save();
      ctx.strokeStyle=`rgba(200,240,255,${m.alpha*m.life})`;
      ctx.lineWidth=1.5;
      ctx.beginPath(); ctx.moveTo(m.x,m.y); ctx.lineTo(m.x-m.vx*(m.len/2),m.y-m.vy*(m.len/2));
      ctx.stroke(); ctx.restore();
    }
    // Sol
    const gnd=ctx.createLinearGradient(0,hy,0,H); gnd.addColorStop(0,'#010603'); gnd.addColorStop(1,'#000200');
    ctx.fillStyle=gnd; ctx.fillRect(0,hy,W,H-hy);
    // Route
    ctx.beginPath(); ctx.moveTo(roadX(-1,0),hy); ctx.lineTo(roadX(1,0),hy); ctx.lineTo(roadX(1,1),H); ctx.lineTo(roadX(-1,1),H); ctx.closePath();
    const rdg=ctx.createLinearGradient(0,hy,0,H); rdg.addColorStop(0,'#040c04'); rdg.addColorStop(.6,'#071007'); rdg.addColorStop(1,'#091409');
    ctx.fillStyle=rdg; ctx.fill();
    // Bordures
    ctx.lineWidth=1; ctx.strokeStyle='rgba(0,255,102,.13)';
    ctx.beginPath(); ctx.moveTo(roadX(-1,0),hy); ctx.lineTo(roadX(-1,1),H); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(roadX(1,0),hy); ctx.lineTo(roadX(1,1),H); ctx.stroke();
    // Tirets
    dashOff=(dashOff+gyroSpeed)%(1/12);
    for(let i=0;i<14;i++){
      let t=(i/13+dashOff)%1; if(t<.001) t=.001;
      const z1=1-t,z2=1-Math.max(.001,t-.038);
      if(z1>.99||z2<.005) continue;
      const y1=roadY(z1),y2=roadY(z2);
      if(y1>=H||y2<=hy) continue;
      const a=Math.min(1,z1*.9+.05)*.65;
      ctx.strokeStyle=`rgba(255,255,255,${a})`; ctx.lineWidth=Math.max(.5,(1-z1)*3.5);
      ctx.beginPath(); ctx.moveTo(W/2,y1); ctx.lineTo(W/2,Math.min(H,y2)); ctx.stroke();
    }
    // Feux arriÃ¨re
    tailLights.forEach(tl=>{
      tl.x+=tl.drift; if(tl.x<.46||tl.x>.54) tl.drift*=-1;
      const tx=tl.x*W,ty=tl.y*H,sz=3.5;
      const hgl=ctx.createRadialGradient(tx,ty,0,tx,ty,sz*9);
      hgl.addColorStop(0,'rgba(255,20,0,.18)'); hgl.addColorStop(1,'transparent');
      ctx.fillStyle=hgl; ctx.beginPath(); ctx.arc(tx,ty,sz*9,0,Math.PI*2); ctx.fill();
      ctx.fillStyle='rgba(255,30,0,.85)';
      ctx.beginPath(); ctx.arc(tx-sz*1.6,ty,sz,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(tx+sz*1.6,ty,sz,0,Math.PI*2); ctx.fill();
    });
    // Lampadaires
    lamps.forEach(lp=>{
      lp.z+=lp.speed; if(lp.z>1) lp.z=0;
      const z=lp.z,margin=.06;
      const lx=roadX(lp.side*(1+margin),z),ly=roadY(z);
      if(ly>H||ly<hy) return;
      const a=Math.min(1,z*1.2)*.55;
      ctx.fillStyle=`rgba(255,180,80,${a})`; ctx.beginPath(); ctx.arc(lx,ly,Math.max(.4,(1-z)*2.5+.5),0,Math.PI*2); ctx.fill();
      if(z>.2){
        const cgl=ctx.createRadialGradient(lx,ly,0,lx,ly,(1-z)*55);
        cgl.addColorStop(0,`rgba(255,180,80,${a*.18})`); cgl.addColorStop(1,'transparent');
        ctx.fillStyle=cgl; ctx.beginPath(); ctx.arc(lx,ly,(1-z)*55,0,Math.PI*2); ctx.fill();
      }
    });
    // Lueur horizon
    const hglow=ctx.createLinearGradient(0,hy-18,0,hy+28);
    hglow.addColorStop(0,'transparent'); hglow.addColorStop(.5,'rgba(0,255,102,.05)'); hglow.addColorStop(1,'transparent');
    ctx.fillStyle=hglow; ctx.fillRect(0,hy-18,W,46);
    requestAnimationFrame(draw);
  }
  draw();
})();

// â•â• HUD donnÃ©es menu langue â•â•
(function(){
  const el=document.getElementById('lang-data-r');
  if(!el) return;
  const stati=['STAT:NOMINAL','STAT:SCANNING','STAT:ONLINE','STAT:LOCKED'];
  let i=0;
  setInterval(()=>{i=(i+1)%stati.length; el.textContent='op.MANIX \u25CF '+stati[i];},3200);
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLUIE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function(){
  const c=document.createElement('canvas');
  c.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;z-index:1;pointer-events:none;';
  document.body.appendChild(c);
  const ctx=c.getContext('2d');
  let W,H;
  function resize(){W=c.width=window.innerWidth;H=c.height=window.innerHeight;}
  resize(); window.addEventListener('resize',resize);
  const N=window.innerWidth<600?28:52;
  const drops=[];
  function mkDrop(imm){return{x:Math.random()*W,y:imm?Math.random()*H:-8,vy:1.3+Math.random()*2.8,vx:(Math.random()-.5)*.4,r:1.2+Math.random()*2.2,alpha:.2+Math.random()*.32,tail:[],phase:Math.random()*Math.PI*2};}
  for(let i=0;i<N;i++) drops.push(mkDrop(true));
  const rivs=[];
  for(let i=0;i<(window.innerWidth<600?4:9);i++) rivs.push({x:W*(.08+Math.random()*.84),y:Math.random()*H*.4,pts:[],speed:.7+Math.random()*1.4,alpha:.07+Math.random()*.1,drift:(Math.random()-.5)*.12,maxPts:55+Math.floor(Math.random()*90)});
  function draw(){
    ctx.clearRect(0,0,W,H);
    rivs.forEach(rv=>{
      rv.y+=rv.speed; rv.x+=rv.drift+(Math.random()-.5)*.15;
      rv.pts.unshift({x:rv.x,y:rv.y}); if(rv.pts.length>rv.maxPts) rv.pts.pop();
      if(rv.y>H+10){rv.y=Math.random()*H*.25;rv.x=W*(.08+Math.random()*.84);rv.pts=[];}
      if(rv.pts.length<2) return;
      ctx.beginPath(); ctx.moveTo(rv.pts[0].x,rv.pts[0].y);
      for(let i=1;i<rv.pts.length;i++) ctx.lineTo(rv.pts[i].x,rv.pts[i].y);
      ctx.strokeStyle=`rgba(180,240,190,${rv.alpha})`; ctx.lineWidth=.7; ctx.stroke();
    });
    for(let i=drops.length-1;i>=0;i--){
      const d=drops[i];
      d.phase+=.03; d.vy+=.05; d.x+=d.vx+(Math.sin(d.phase)*.15); d.y+=d.vy;
      d.tail.unshift({x:d.x,y:d.y}); if(d.tail.length>10) d.tail.pop();
      if(d.y>H+20||d.x<-20||d.x>W+20){ drops[i]=mkDrop(false); continue; }
      ctx.save(); ctx.translate(d.x,d.y); ctx.rotate(Math.atan2(d.vy,d.vx)-.2);
      const g=ctx.createRadialGradient(-d.r*.2,-d.r*.3,0,0,d.r*.4,d.r*2);
      g.addColorStop(0,`rgba(255,255,255,${d.alpha*.9})`); g.addColorStop(.4,`rgba(180,240,190,${d.alpha*.45})`); g.addColorStop(1,'transparent');
      ctx.beginPath(); ctx.ellipse(0,d.r*.2,d.r*.55,d.r,0,0,Math.PI*2); ctx.fillStyle=g; ctx.fill();
      ctx.beginPath(); ctx.arc(-d.r*.18,-d.r*.25,d.r*.28,0,Math.PI*2); ctx.fillStyle=`rgba(255,255,255,${d.alpha*.55})`; ctx.fill();
      ctx.restore();
      if(d.tail.length>2){
        ctx.beginPath(); ctx.moveTo(d.tail[0].x,d.tail[0].y);
        for(let j=1;j<d.tail.length;j++) ctx.lineTo(d.tail[j].x,d.tail[j].y);
        ctx.strokeStyle=`rgba(160,230,170,${d.alpha*.28})`; ctx.lineWidth=d.r*.4; ctx.stroke();
      }
      const gl=ctx.createRadialGradient(d.x,d.y,0,d.x,d.y,d.r*3.5);
      gl.addColorStop(0,`rgba(0,255,102,${d.alpha*.09})`); gl.addColorStop(.6,`rgba(255,30,0,${d.alpha*.04})`); gl.addColorStop(1,'transparent');
      ctx.fillStyle=gl; ctx.beginPath(); ctx.arc(d.x,d.y,d.r*3.5,0,Math.PI*2); ctx.fill();
      if(d.vy>4&&Math.random()<.002&&drops.length<N+8){
        const nd=mkDrop(false); nd.x=d.x; nd.y=d.y; nd.vy=d.vy*.55; nd.r=d.r*.55;
        nd.vx=d.vx+(Math.random()-.5)*1.8; nd.alpha=d.alpha*.6; drops.push(nd); d.alpha*=.35;
      }
    }
    requestAnimationFrame(draw);
  }
  draw();
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABLEAU DE BORD KITT â˜… ENRICHI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showKittDash(){
  const dash=document.getElementById('kitt-dash');
  if(dash) dash.classList.add('visible');
  const container=document.querySelector('.container');
  if(container) container.classList.add('dash-visible');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APPEL ENTRANT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _callShown=false;
function showKittCall(){
  if(_callShown) return; _callShown=true;
  const call=document.getElementById('kitt-call');
  if(!call) return;
  call.classList.add('active');
  let _ring=null;
  function startRing(){
    try{
      _resume();
      _ring=setInterval(()=>{
        const t=_ac.currentTime;
        [0,.18].forEach(dt=>{
          const o=_ac.createOscillator(); o.type='sine'; o.frequency.value=880;
          const g=_ac.createGain(); g.gain.setValueAtTime(.07,t+dt); g.gain.exponentialRampToValueAtTime(.001,t+dt+.15);
          o.connect(g); g.connect(_ac.destination); o.start(t+dt); o.stop(t+dt+.16);
        });
      },1400);
    }catch(e){}
  }
  function stopRing(){ if(_ring) clearInterval(_ring); }
  startRing();
  document.getElementById('call-accept').onclick=()=>{
    stopRing(); call.style.transition='opacity .4s'; call.style.opacity='0';
    setTimeout(()=>{ call.style.display='none'; },420);
    // â˜… KITT explique les rÃ¨gles du jeu dans la langue sÃ©lectionnÃ©e
    const CALL_RULES = {
      fr: {
        voice: "Ici KITT. Bienvenue dans l'interface franco-belge. Je vais vous expliquer les rÃ¨gles. Vous devez accomplir huit missions pour dÃ©bloquer la connexion Ã  mon intelligence artificielle rÃ©elle. Commencez par taper boot pour dÃ©marrer. Puis tapez aide pour voir toutes mes commandes. Chaque mission accomplie vous rapproche de l'accÃ¨s Ã  mon vrai cerveau Ã©lectronique. Bonne chance, Michael.",
        terminal: [
          "â”€â”€ BRIEFING DE MISSION â€” KITT â”€â”€",
          "OBJECTIF : Accomplir 8 missions pour dÃ©bloquer",
          "           la connexion Ã  l'IA KITT rÃ©elle.",
          "",
          "RÃˆGLES :",
          "  1. Tapez [ boot ] pour dÃ©marrer",
          "  2. Tapez [ aide ] pour voir les commandes",
          "  3. ComplÃ©tez chaque mission dans la liste",
          "  4. Le bouton CONNEXION KITT se dÃ©bloque",
          "     quand toutes les missions sont faites !",
          "",
          "  Tapez [ missions ] pour suivre ta progression.",
          "  Bonne chance, Michael.",
        ]
      },
      en: {
        voice: "This is KITT. Welcome to the Franco-Belgian interface. Let me explain the rules. You must complete eight missions to unlock the connection to my real artificial intelligence. Start by typing boot to initialize. Then type help to see all my commands. Each mission completed brings you closer to accessing my true electronic brain. Good luck, Michael.",
        terminal: [
          "â”€â”€ MISSION BRIEFING â€” KITT â”€â”€",
          "OBJECTIVE: Complete 8 missions to unlock",
          "           the real KITT AI connection.",
          "",
          "RULES:",
          "  1. Type [ boot ] to initialize",
          "  2. Type [ help ] to see commands",
          "  3. Complete each mission in the list",
          "  4. The KITT CONNECTION button unlocks",
          "     when all missions are done!",
          "",
          "  Type [ missions ] to track your progress.",
          "  Good luck, Michael.",
        ]
      },
      nl: {
        voice: "Hier is KITT. Welkom bij de Franco-Belgische interface. Ik ga je de regels uitleggen. Je moet acht missies voltooien om de verbinding met mijn echte kunstmatige intelligentie te ontgrendelen. Begin door boot te typen om op te starten. Typ dan hulp om al mijn commando's te zien. Elke voltooide missie brengt je dichter bij mijn echte elektronische brein. Veel succes, Michael.",
        terminal: [
          "â”€â”€ MISSIE BRIEFING â€” KITT â”€â”€",
          "DOEL: Voltooi 8 missies om de",
          "      echte KITT AI verbinding te ontgrendelen.",
          "",
          "REGELS:",
          "  1. Typ [ boot ] om op te starten",
          "  2. Typ [ hulp ] om commando's te zien",
          "  3. Voltooi elke missie in de lijst",
          "  4. De KITT VERBINDING knop ontgrendelt",
          "     als alle missies klaar zijn!",
          "",
          "  Typ [ missies ] om je voortgang te volgen.",
          "  Veel succes, Michael.",
        ]
      },
      it: {
        voice: "Sono KITT. Benvenuto nell'interfaccia franco-belga. Ti spiego le regole. Devi completare otto missioni per sbloccare la connessione alla mia vera intelligenza artificiale. Inizia digitando boot per avviare. Poi digita aiuto per vedere tutti i miei comandi. Ogni missione completata ti avvicina all'accesso al mio vero cervello elettronico. Buona fortuna, Michael.",
        terminal: [
          "â”€â”€ BRIEFING MISSIONE â€” KITT â”€â”€",
          "OBIETTIVO: Completa 8 missioni per sbloccare",
          "           la connessione all'IA KITT reale.",
          "",
          "REGOLE:",
          "  1. Digita [ boot ] per avviare",
          "  2. Digita [ aiuto ] per vedere i comandi",
          "  3. Completa ogni missione nella lista",
          "  4. Il pulsante CONNETTI KITT si sblocca",
          "     quando tutte le missioni sono fatte!",
          "",
          "  Digita [ missioni ] per seguire i progressi.",
          "  Buona fortuna, Michael.",
        ]
      },
      de: {
        voice: "Hier ist KITT. Willkommen in der franco-belgischen Schnittstelle. Ich erklÃ¤re Ihnen die Regeln. Sie mÃ¼ssen acht Missionen abschlieÃŸen, um die Verbindung zu meiner echten kÃ¼nstlichen Intelligenz freizuschalten. Beginnen Sie mit boot tippen um zu starten. Dann tippen Sie hilfe um alle meine Befehle zu sehen. Jede abgeschlossene Mission bringt Sie nÃ¤her an meinem echten elektronischen Gehirn. Viel Erfolg, Michael.",
        terminal: [
          "â”€â”€ MISSIONS-BRIEFING â€” KITT â”€â”€",
          "ZIEL: SchlieÃŸe 8 Missionen ab um die",
          "      echte KITT-KI-Verbindung freizuschalten.",
          "",
          "REGELN:",
          "  1. Tippe [ boot ] zum Starten",
          "  2. Tippe [ hilfe ] fÃ¼r Befehle",
          "  3. SchlieÃŸe jede Mission in der Liste ab",
          "  4. Der KITT VERBINDEN Knopf schaltet frei",
          "     wenn alle Missionen erledigt sind!",
          "",
          "  Tippe [ missionen ] fÃ¼r deinen Fortschritt.",
          "  Viel Erfolg, Michael.",
        ]
      },
      es: {
        voice: "AquÃ­ KITT. Bienvenido a la interfaz franco-belga. Voy a explicarte las reglas. Debes completar ocho misiones para desbloquear la conexiÃ³n a mi inteligencia artificial real. Empieza escribiendo boot para inicializar. Luego escribe ayuda para ver todos mis comandos. Cada misiÃ³n completada te acerca mÃ¡s al acceso a mi verdadero cerebro electrÃ³nico. Buena suerte, Michael.",
        terminal: [
          "â”€â”€ BRIEFING DE MISIÃ“N â€” KITT â”€â”€",
          "OBJETIVO: Completa 8 misiones para desbloquear",
          "          la conexiÃ³n a la IA KITT real.",
          "",
          "REGLAS:",
          "  1. Escribe [ boot ] para inicializar",
          "  2. Escribe [ ayuda ] para ver comandos",
          "  3. Completa cada misiÃ³n de la lista",
          "  4. El botÃ³n CONECTAR KITT se desbloquea",
          "     cuando todas las misiones estÃ©n hechas!",
          "",
          "  Escribe [ misiones ] para tu progresiÃ³n.",
          "  Â¡Buena suerte, Michael.",
        ]
      },
      pt: {
        voice: "Aqui Ã© o KITT. Bem-vindo Ã  interface franco-belga. Vou explicar as regras. Tens de completar oito missÃµes para desbloquear a ligaÃ§Ã£o Ã  minha inteligÃªncia artificial real. ComeÃ§a por escrever boot para inicializar. Depois escreve ajuda para ver todos os meus comandos. Cada missÃ£o completada aproxima-te do acesso ao meu verdadeiro cÃ©rebro eletrÃ³nico. Boa sorte, Michael.",
        terminal: [
          "â”€â”€ BRIEFING DE MISSÃƒO â€” KITT â”€â”€",
          "OBJETIVO: Completa 8 missÃµes para desbloquear",
          "          a ligaÃ§Ã£o Ã  IA KITT real.",
          "",
          "REGRAS:",
          "  1. Escreve [ boot ] para inicializar",
          "  2. Escreve [ ajuda ] para ver comandos",
          "  3. Completa cada missÃ£o da lista",
          "  4. O botÃ£o LIGAR KITT desbloqueia-se",
          "     quando todas as missÃµes estiverem feitas!",
          "",
          "  Escreve [ missÃµes ] para seguir o progresso.",
          "  Boa sorte, Michael.",
        ]
      },
    };
    const rules = CALL_RULES[LANG] || CALL_RULES['fr'];
    // â˜… Voix KITT explique les rÃ¨gles
    try{ speakMuther(rules.voice, LANG); }catch(e){}
    // â˜… Afficher aussi le briefing dans le terminal
    setTimeout(async ()=>{
      kittChime();
      const sep = 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•';
      await typeText(sep, 3, 'line-dim');
      for(const line of rules.terminal) {
        if(line === '') { await typeText('', 0); }
        else if(line.startsWith('â”€â”€')) { await typeText(line, 8, 'line-info'); }
        else if(line.startsWith('OBJECTIF')||line.startsWith('OBJECTIVE')||line.startsWith('DOEL')||line.startsWith('OBIETTIVO')||line.startsWith('ZIEL')||line.startsWith('OBJETIVO')) { await typeText(line, 8, 'line-err'); }
        else if(line.startsWith('  ')) { await typeText(line, 6, 'line-dim'); }
        else { await typeText(line, 8, 'line-warn'); }
      }
      await typeText(sep, 3, 'line-dim');
    }, 600);
  };
  document.getElementById('call-ignore').onclick=()=>{
    stopRing(); call.style.transition='opacity .3s'; call.style.opacity='0';
    setTimeout(()=>{ call.style.display='none'; },320);
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â˜… VISUALISEUR AUDIO â€” anime les barres quand KITT parle
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function vizStart() {
  const viz = document.getElementById('kitt-visualizer');
  if(!viz) return;
  viz.classList.add('speaking');
  viz.querySelectorAll('.viz-bar').forEach(bar => bar.classList.add('active'));
}
function vizStop() {
  const viz = document.getElementById('kitt-visualizer');
  if(!viz) return;
  viz.classList.remove('speaking');
  viz.querySelectorAll('.viz-bar').forEach(bar => bar.classList.remove('active'));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â˜… MOTEUR AMBIANT â€” ronronnement grave permanent
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _engineNode = null;
function startEngineAmbient() {
  try {
    if(_engineNode) return;
    _resume();
    const mg = _ac.createGain(); mg.gain.value = 0;
    mg.connect(_ac.destination);

    // Oscillateur principal grave
    const o1 = _ac.createOscillator(); o1.type='sine'; o1.frequency.value=38;
    const g1 = _ac.createGain(); g1.gain.value=0.10; o1.connect(g1); g1.connect(mg);

    // Harmonique
    const o2 = _ac.createOscillator(); o2.type='triangle'; o2.frequency.value=76;
    const g2 = _ac.createGain(); g2.gain.value=0.035; o2.connect(g2); g2.connect(mg);

    // Vibration mÃ©canique (LFO sur la frÃ©quence)
    const lfo = _ac.createOscillator(); lfo.type='sine'; lfo.frequency.value=3.2;
    const lfoG = _ac.createGain(); lfoG.gain.value=1.8;
    lfo.connect(lfoG); lfoG.connect(o1.frequency);

    // Bruit de route ultra-filtrÃ©
    const bufLen = _ac.sampleRate * 3;
    const nBuf = _ac.createBuffer(1, bufLen, _ac.sampleRate);
    const nd = nBuf.getChannelData(0);
    for(let i=0; i<bufLen; i++) nd[i] = Math.random()*2-1;
    const nSrc = _ac.createBufferSource(); nSrc.buffer=nBuf; nSrc.loop=true;
    const lp = _ac.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=120; lp.Q.value=1.2;
    const nGain = _ac.createGain(); nGain.gain.value=0.018;
    nSrc.connect(lp); lp.connect(nGain); nGain.connect(mg);

    o1.start(); o2.start(); lfo.start(); nSrc.start();

    // Fade in progressif
    mg.gain.setValueAtTime(0, _ac.currentTime);
    mg.gain.linearRampToValueAtTime(0.55, _ac.currentTime+4);

    _engineNode = mg;

    // Variations lÃ©gÃ¨res toutes les 8 secondes (simulation accÃ©lÃ©ration/dÃ©cÃ©lÃ©ration)
    setInterval(()=>{
      const variation = 0.45 + Math.random()*0.2;
      mg.gain.setTargetAtTime(variation, _ac.currentTime, 1.5);
      const fvar = 37 + Math.random()*3;
      o1.frequency.setTargetAtTime(fvar, _ac.currentTime, 2);
    }, 8000);
  } catch(e){}
}

// DÃ©marrer le moteur aprÃ¨s interaction utilisateur
document.addEventListener('click', ()=>{ startEngineAmbient(); }, {once:true});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â˜… SYSTÃˆME DE MISSIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MISSIONS = {
  fr: [
    {id:'boot',     label:'Lance la sÃ©quence de dÃ©marrage',    cmd:'boot'},
    {id:'aide',     label:'Consulte les commandes (aide)',      cmd:'aide'},
    {id:'list',     label:'Affiche la liste des membres',       cmd:'list'},
    {id:'blague',   label:'Demande une blague Ã  KITT',          cmd:'blague'},
    {id:'diag',     label:'Effectue un diagnostic complet',     cmd:'diagnostic'},
    {id:'scan',     label:'Scanne ton environnement',           cmd:'scan'},
    {id:'turbo',    label:'Active le TURBO BOOST',              cmd:'turbo'},
    {id:'mode',     label:'Change de mode de conduite',         cmd:'mode'},
    {id:'karr',     label:'Consulte le dossier K.A.R.R.',      cmd:'karr'},
    {id:'manix',    label:'Consulte le dossier Manix',          cmd:'manix'},
    {id:'cedric',   label:'Consulte le dossier CÃ©dric',         cmd:'cedric'},
    {id:'damon',    label:'Consulte le dossier Damon',          cmd:'damon'},
    {id:'pascal',   label:'Consulte le dossier Pascal',         cmd:'pascal'},
    {id:'kr95',     label:'Consulte le dossier KR95',           cmd:'kr95'},
    {id:'mario',    label:'Consulte le dossier Mario Ravasi',   cmd:'mario'},
    {id:'za',       label:'Consulte le dossier ZA Elettronica', cmd:'za'},
    {id:'connexion',label:'Clique sur Connexion IA',            cmd:null},
  ],
  en: [
    {id:'boot',     label:'Launch the boot sequence',         cmd:'boot'},
    {id:'aide',     label:'Consult command list (help)',       cmd:'aide'},
    {id:'list',     label:'Show the members list',            cmd:'list'},
    {id:'blague',   label:'Ask KITT for a joke',              cmd:'blague'},
    {id:'diag',     label:'Run a full diagnostic',            cmd:'diagnostic'},
    {id:'scan',     label:'Scan your environment',            cmd:'scan'},
    {id:'turbo',    label:'Activate TURBO BOOST',             cmd:'turbo'},
    {id:'mode',     label:'Change driving mode',              cmd:'mode'},
    {id:'karr',     label:'Access K.A.R.R. file',             cmd:'karr'},
    {id:'manix',    label:'Access Manix file',                cmd:'manix'},
    {id:'cedric',   label:'Access CÃ©dric file',               cmd:'cedric'},
    {id:'damon',    label:'Access Damon file',                cmd:'damon'},
    {id:'pascal',   label:'Access Pascal file',               cmd:'pascal'},
    {id:'kr95',     label:'Access KR95 file',                 cmd:'kr95'},
    {id:'mario',    label:'Access Mario Ravasi file',         cmd:'mario'},
    {id:'za',       label:'Access ZA Elettronica file',       cmd:'za'},
    {id:'connexion',label:'Click on AI Connection',           cmd:null},
  ],
  nl: [
    {id:'boot',     label:'Start de opstartsequentie',     cmd:'boot'},
    {id:'aide',     label:"Raadpleeg commando's (hulp)",     cmd:'aide'},
    {id:'list',     label:'Toon de ledenlijst',    cmd:'list'},
    {id:'blague',   label:'Vraag KITT om een grap',   cmd:'blague'},
    {id:'diag',     label:'Voer een volledige diagnose uit',     cmd:'diagnostic'},
    {id:'scan',     label:'Scan je omgeving',     cmd:'scan'},
    {id:'turbo',    label:'Activeer TURBO BOOST',    cmd:'turbo'},
    {id:'mode',     label:'Verander de rijmodus',     cmd:'mode'},
    {id:'karr',     label:'Raadpleeg K.A.R.R. dossier',     cmd:'karr'},
    {id:'manix',    label:'Raadpleeg Manix dossier',    cmd:'manix'},
    {id:'cedric',   label:'Raadpleeg CÃ©dric dossier',   cmd:'cedric'},
    {id:'damon',    label:'Raadpleeg Damon dossier',    cmd:'damon'},
    {id:'pascal',   label:'Raadpleeg Pascal dossier',   cmd:'pascal'},
    {id:'kr95',     label:'Raadpleeg KR95 dossier',     cmd:'kr95'},
    {id:'mario',    label:'Raadpleeg Mario Ravasi dossier',    cmd:'mario'},
    {id:'za',       label:'Raadpleeg ZA Elettronica dossier',       cmd:'za'},
    {id:'connexion',label:'Klik op KITT Verbinding',cmd:null},
  ],
  it: [
    {id:'boot',     label:'Avvia la sequenza di avvio',     cmd:'boot'},
    {id:'aide',     label:'Consulta i comandi (aiuto)',     cmd:'aide'},
    {id:'list',     label:'Mostra lista membri',    cmd:'list'},
    {id:'blague',   label:"Chiedi una barzelletta a KITT",   cmd:'blague'},
    {id:'diag',     label:'Esegui una diagnosi completa',     cmd:'diagnostic'},
    {id:'scan',     label:"Scansiona l'ambiente",     cmd:'scan'},
    {id:'turbo',    label:'Attiva il TURBO BOOST',    cmd:'turbo'},
    {id:'mode',     label:'Cambia modalitÃ  di guida',     cmd:'mode'},
    {id:'karr',     label:'Consulta dossier K.A.R.R.',     cmd:'karr'},
    {id:'manix',    label:'Consulta dossier Manix',    cmd:'manix'},
    {id:'cedric',   label:'Consulta dossier CÃ©dric',   cmd:'cedric'},
    {id:'damon',    label:'Consulta dossier Damon',    cmd:'damon'},
    {id:'pascal',   label:'Consulta dossier Pascal',   cmd:'pascal'},
    {id:'kr95',     label:'Consulta dossier KR95',     cmd:'kr95'},
    {id:'mario',    label:'Consulta dossier Mario Ravasi',    cmd:'mario'},
    {id:'za',       label:'Consulta dossier ZA Elettronica',       cmd:'za'},
    {id:'connexion',label:'Clicca su Connetti KITT',cmd:null},
  ],
  de: [
    {id:'boot',     label:'Startsequenz ausfÃ¼hren',     cmd:'boot'},
    {id:'aide',     label:'Befehlsliste abrufen (hilfe)',     cmd:'aide'},
    {id:'list',     label:'Mitgliederliste anzeigen',    cmd:'list'},
    {id:'blague',   label:'KITT um einen Witz bitten',   cmd:'blague'},
    {id:'diag',     label:'VollstÃ¤ndige Diagnose durchfÃ¼hren',     cmd:'diagnostic'},
    {id:'scan',     label:'Umgebung scannen',     cmd:'scan'},
    {id:'turbo',    label:'TURBO BOOST aktivieren',    cmd:'turbo'},
    {id:'mode',     label:'Fahrmodus wechseln',     cmd:'mode'},
    {id:'karr',     label:'K.A.R.R. Akte abrufen',     cmd:'karr'},
    {id:'manix',    label:'Manix Akte abrufen',    cmd:'manix'},
    {id:'cedric',   label:'CÃ©dric Akte abrufen',   cmd:'cedric'},
    {id:'damon',    label:'Damon Akte abrufen',    cmd:'damon'},
    {id:'pascal',   label:'Pascal Akte abrufen',   cmd:'pascal'},
    {id:'kr95',     label:'KR95 Akte abrufen',     cmd:'kr95'},
    {id:'mario',    label:'Mario Ravasi Akte abrufen',    cmd:'mario'},
    {id:'za',       label:'ZA Elettronica Akte abrufen',       cmd:'za'},
    {id:'connexion',label:'Auf KI-Verbindung klicken',cmd:null},
  ],
  es: [
    {id:'boot',     label:'Iniciar secuencia de arranque',     cmd:'boot'},
    {id:'aide',     label:'Consultar comandos (ayuda)',     cmd:'aide'},
    {id:'list',     label:'Mostrar lista de miembros',    cmd:'list'},
    {id:'blague',   label:'Pedir un chiste a KITT',   cmd:'blague'},
    {id:'diag',     label:'Realizar diagnÃ³stico completo',     cmd:'diagnostic'},
    {id:'scan',     label:'Escanear el entorno',     cmd:'scan'},
    {id:'turbo',    label:'Activar TURBO BOOST',    cmd:'turbo'},
    {id:'mode',     label:'Cambiar modo de conducciÃ³n',     cmd:'mode'},
    {id:'karr',     label:'Consultar expediente K.A.R.R.',     cmd:'karr'},
    {id:'manix',    label:'Consultar expediente Manix',    cmd:'manix'},
    {id:'cedric',   label:'Consultar expediente CÃ©dric',   cmd:'cedric'},
    {id:'damon',    label:'Consultar expediente Damon',    cmd:'damon'},
    {id:'pascal',   label:'Consultar expediente Pascal',   cmd:'pascal'},
    {id:'kr95',     label:'Consultar expediente KR95',     cmd:'kr95'},
    {id:'mario',    label:'Consultar expediente Mario Ravasi',    cmd:'mario'},
    {id:'za',       label:'Consultar expediente ZA Elettronica',       cmd:'za'},
    {id:'connexion',label:'Clic en Conectar KITT',cmd:null},
  ],
  pt: [
    {id:'boot',     label:'Iniciar sequÃªncia de arranque',     cmd:'boot'},
    {id:'aide',     label:'Consultar comandos (ajuda)',     cmd:'aide'},
    {id:'list',     label:'Mostrar lista de membros',    cmd:'list'},
    {id:'blague',   label:'Pedir uma piada ao KITT',   cmd:'blague'},
    {id:'diag',     label:'Realizar diagnÃ³stico completo',     cmd:'diagnostic'},
    {id:'scan',     label:'Verificar o ambiente',     cmd:'scan'},
    {id:'turbo',    label:'Ativar TURBO BOOST',    cmd:'turbo'},
    {id:'mode',     label:'Mudar modo de conduÃ§Ã£o',     cmd:'mode'},
    {id:'karr',     label:'Consultar dossier K.A.R.R.',     cmd:'karr'},
    {id:'manix',    label:'Consultar dossier Manix',    cmd:'manix'},
    {id:'cedric',   label:'Consultar dossier CÃ©dric',   cmd:'cedric'},
    {id:'damon',    label:'Consultar dossier Damon',    cmd:'damon'},
    {id:'pascal',   label:'Consultar dossier Pascal',   cmd:'pascal'},
    {id:'kr95',     label:'Consultar dossier KR95',     cmd:'kr95'},
    {id:'mario',    label:'Consultar dossier Mario Ravasi',    cmd:'mario'},
    {id:'za',       label:'Consultar dossier ZA Elettronica',       cmd:'za'},
    {id:'connexion',label:'Clicar em Ligar KITT',cmd:null},
  ],
};

// â˜… Missions remises Ã  zÃ©ro Ã  chaque session (pas de persistance inter-sessions)
let _missionsCompleted = new Set();
let _missionHudOpen = false;

function _saveMissions() {
  // Sessions indÃ©pendantes â€” pas de sauvegarde persistante
}

function _completeMission(id) {
  if(_missionsCompleted.has(id)) return;
  _missionsCompleted.add(id);
  _saveMissions();
  _renderMissions();
  // Labels traduits
  const labels = {
    fr:{boot:'SÃ‰QUENCE DÃ‰MARRÃ‰E',aide:'COMMANDES CONSULTÃ‰ES',diag:'DIAGNOSTIC EFFECTUÃ‰',scan:'SCAN COMPLÃ‰TÃ‰',turbo:'TURBO ACTIVÃ‰',mode:'MODE CHANGÃ‰',karr:'K.A.R.R. CONSULTÃ‰',connexion:'CONNEXION IA CLIQUÃ‰E'},
    en:{boot:'BOOT SEQUENCE RUN',aide:'COMMANDS CONSULTED',diag:'DIAGNOSTIC COMPLETE',scan:'SCAN COMPLETE',turbo:'TURBO ACTIVATED',mode:'MODE CHANGED',karr:'K.A.R.R. ACCESSED',connexion:'AI CONNECTION CLICKED'},
    nl:{boot:'OPSTART UITGEVOERD',aide:'COMMANDO\'S GERAADPLEEGD',diag:'DIAGNOSE VOLTOOID',scan:'SCAN VOLTOOID',turbo:'TURBO GEACTIVEERD',mode:'MODUS GEWIJZIGD',karr:'K.A.R.R. GERAADPLEEGD',connexion:'AI VERBINDING GEKLIKT'},
    it:{boot:'SEQUENZA DI AVVIO',aide:'COMANDI CONSULTATI',diag:'DIAGNOSI COMPLETATA',scan:'SCANSIONE COMPLETATA',turbo:'TURBO ATTIVATO',mode:'MODALITÃ€ CAMBIATA',karr:'K.A.R.R. CONSULTATO',connexion:'CONNESSIONE IA CLICCATA'},
    de:{boot:'STARTSEQUENZ AUSGEFÃœHRT',aide:'BEFEHLE ABGERUFEN',diag:'DIAGNOSE ABGESCHLOSSEN',scan:'SCAN ABGESCHLOSSEN',turbo:'TURBO AKTIVIERT',mode:'MODUS GEWECHSELT',karr:'K.A.R.R. ABGERUFEN',connexion:'KI-VERBINDUNG GEKLICKT'},
    es:{boot:'SECUENCIA DE INICIO',aide:'COMANDOS CONSULTADOS',diag:'DIAGNÃ“STICO COMPLETADO',scan:'ESCANEO COMPLETADO',turbo:'TURBO ACTIVADO',mode:'MODO CAMBIADO',karr:'K.A.R.R. CONSULTADO',connexion:'CONEXIÃ“N IA PULSADA'},
    pt:{boot:'SEQUÃŠNCIA DE ARRANQUE',aide:'COMANDOS CONSULTADOS',diag:'DIAGNÃ“STICO COMPLETO',scan:'SCAN COMPLETO',turbo:'TURBO ATIVADO',mode:'MODO ALTERADO',karr:'K.A.R.R. CONSULTADO',connexion:'LIGAÃ‡ÃƒO IA CLICADA'},
  };
  const pfx = {fr:'âœ¦ MISSION ACCOMPLIE',en:'âœ¦ MISSION COMPLETE',nl:'âœ¦ MISSIE VOLTOOID',it:'âœ¦ MISSIONE COMPIUTA',de:'âœ¦ MISSION ERFÃœLLT',es:'âœ¦ MISIÃ“N CUMPLIDA',pt:'âœ¦ MISSÃƒO CUMPRIDA'}[LANG]||'âœ¦ MISSION COMPLETE';
  const lset = labels[LANG]||labels.en;
  const msg = `${pfx} : ${lset[id]||id.toUpperCase()} âœ¦`;
  try{ addLine(msg, 'line-ok'); kittChime(); }catch(e){}
  const pushTitle = {fr:'KITT â€” Mission accomplie',en:'KITT â€” Mission complete',nl:'KITT â€” Missie voltooid',it:'KITT â€” Missione compiuta',de:'KITT â€” Mission erfÃ¼llt',es:'KITT â€” MisiÃ³n cumplida',pt:'KITT â€” MissÃ£o cumprida'}[LANG]||'KITT â€” Mission complete';
  _sendPush(pushTitle, msg);
  // VÃ©rifier si TOUTES les missions sont complÃ¨tes â†’ RÃ‰COMPENSE FINALE
  const missions = MISSIONS[LANG]||MISSIONS.en;
  const done = missions.filter(m=>_missionsCompleted.has(m.id)).length;
  if(done === missions.length) setTimeout(()=>_showFinalReward(), 1200);
}

async function _showFinalReward() {
  kittChime(); await delay(300); kittChime(); await delay(300); kittChime();
  const sep = 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•';
  const reward = {
    fr:{title:'  âœ¦ TOUTES LES MISSIONS ACCOMPLIES âœ¦  ',lines:['','FÃ‰LICITATIONS, AGENT.','VOUS AVEZ DÃ‰MONTRÃ‰ UNE MAÃTRISE COMPLÃˆTE','DU SYSTÃˆME KITT FRANCO-BELGE.','','RÃ‰COMPENSE DÃ‰BLOQUÃ‰E :','','â–¶ LE BOUTON [ CONNEXION KITT ] EST DÃ‰BLOQUÃ‰ :','','       â–ˆâ–ˆ  ACCÃˆS AUTORISÃ‰  â–ˆâ–ˆ','      âœ¦  CONNEXION DISPONIBLE  âœ¦','       â–ˆâ–ˆ  ACCÃˆS AUTORISÃ‰  â–ˆâ–ˆ','','CLIQUEZ MAINTENANT SUR [ CONNEXION KITT ]','POUR ACCÃ‰DER Ã€ L\'IA KITT EN DIRECT.','','â€” MANIX // KYRONEX SYSTEMS â€”',''],congrats:'AGENT CERTIFIÃ‰ â€” ACCÃˆS NIVEAU ALPHA'},
    en:{title:'  âœ¦ ALL MISSIONS COMPLETE âœ¦  ',lines:['','CONGRATULATIONS, AGENT.','YOU HAVE DEMONSTRATED FULL MASTERY','OF THE KITT FRANCO-BELGIAN SYSTEM.','','REWARD UNLOCKED:','','â–¶ THE [ KITT CONNECTION ] BUTTON IS NOW UNLOCKED:','','       â–ˆâ–ˆ  ACCESS GRANTED  â–ˆâ–ˆ','      âœ¦  CONNECTION AVAILABLE  âœ¦','       â–ˆâ–ˆ  ACCESS GRANTED  â–ˆâ–ˆ','','CLICK [ KITT CONNECTION ] NOW','TO ACCESS THE LIVE KITT AI.','','â€” MANIX // KYRONEX SYSTEMS â€”',''],congrats:'CERTIFIED AGENT â€” ALPHA LEVEL ACCESS'},
    nl:{title:'  âœ¦ ALLE MISSIES VOLTOOID âœ¦  ',lines:['','GEFELICITEERD, AGENT.','U HEBT VOLLEDIGE BEHEERSING AANGETOOND','VAN HET KITT FRANCO-BELGISCH SYSTEEM.','','BELONING ONTGRENDELD:','','â–¶ DE [ KITT VERBINDING ] KNOP IS NU ONTGRENDELD:','','       â–ˆâ–ˆ  TOEGANG VERLEEND  â–ˆâ–ˆ','      âœ¦  VERBINDING BESCHIKBAAR  âœ¦','       â–ˆâ–ˆ  TOEGANG VERLEEND  â–ˆâ–ˆ','','KLIK NU OP [ KITT VERBINDING ]','VOOR TOEGANG TOT DE LIVE KITT IA.','','â€” MANIX // KYRONEX SYSTEMS â€”',''],congrats:'GECERTIFICEERD AGENT â€” ALPHA NIVEAU TOEGANG'},
    it:{title:'  âœ¦ TUTTE LE MISSIONI COMPIUTE âœ¦  ',lines:['','CONGRATULAZIONI, AGENTE.','HAI DIMOSTRATO PIENA PADRONANZA','DEL SISTEMA KITT FRANCO-BELGA.','','RICOMPENSA SBLOCCATA:','','â–¶ IL PULSANTE [ CONNETTI KITT ] Ãˆ ORA SBLOCCATO:','','       â–ˆâ–ˆ  ACCESSO CONCESSO  â–ˆâ–ˆ','      âœ¦  CONNESSIONE DISPONIBILE  âœ¦','       â–ˆâ–ˆ  ACCESSO CONCESSO  â–ˆâ–ˆ','','CLICCA ORA SU [ CONNETTI KITT ]','PER ACCEDERE AL KITT IA DAL VIVO.','','â€” MANIX // KYRONEX SYSTEMS â€”',''],congrats:'AGENTE CERTIFICATO â€” ACCESSO LIVELLO ALFA'},
    de:{title:'  âœ¦ ALLE MISSIONEN ERFÃœLLT âœ¦  ',lines:['','GLÃœCKWUNSCH, AGENT.','SIE HABEN VOLLE BEHERRSCHUNG DES','KITT FRANCO-BELGISCHEN SYSTEMS BEWIESEN.','','BELOHNUNG FREIGESCHALTET:','','â–¶ DER KNOPF [ KITT VERBINDEN ] IST JETZT FREIGESCHALTET:','','       â–ˆâ–ˆ  ZUGANG GEWÃ„HRT  â–ˆâ–ˆ','      âœ¦  VERBINDUNG VERFÃœGBAR  âœ¦','       â–ˆâ–ˆ  ZUGANG GEWÃ„HRT  â–ˆâ–ˆ','','KLICKEN SIE JETZT AUF [ KITT VERBINDEN ]','FÃœR DEN LIVE-ZUGANG ZUR KITT-KI.','','â€” MANIX // KYRONEX SYSTEMS â€”',''],congrats:'ZERTIFIZIERTER AGENT â€” ALPHA-ZUGANG'},
    es:{title:'  âœ¦ TODAS LAS MISIONES CUMPLIDAS âœ¦  ',lines:['','FELICIDADES, AGENTE.','HAS DEMOSTRADO DOMINIO COMPLETO','DEL SISTEMA KITT FRANCO-BELGA.','','RECOMPENSA DESBLOQUEADA:','','â–¶ EL BOTÃ“N [ CONECTAR KITT ] ESTÃ DESBLOQUEADO:','','       â–ˆâ–ˆ  ACCESO CONCEDIDO  â–ˆâ–ˆ','      âœ¦  CONEXIÃ“N DISPONIBLE  âœ¦','       â–ˆâ–ˆ  ACCESO CONCEDIDO  â–ˆâ–ˆ','','HAZ CLIC EN [ CONECTAR KITT ] AHORA','PARA ACCEDER A LA IA KITT EN DIRECTO.','','â€” MANIX // KYRONEX SYSTEMS â€”',''],congrats:'AGENTE CERTIFICADO â€” ACCESO NIVEL ALFA'},
    pt:{title:'  âœ¦ TODAS AS MISSÃ•ES CUMPRIDAS âœ¦  ',lines:['','PARABÃ‰NS, AGENTE.','DEMONSTROU DOMÃNIO COMPLETO','DO SISTEMA KITT FRANCO-BELGA.','','RECOMPENSA DESBLOQUEADA:','','â–¶ O BOTÃƒO [ LIGAR KITT ] ESTÃ AGORA DESBLOQUEADO:','','       â–ˆâ–ˆ  ACESSO CONCEDIDO  â–ˆâ–ˆ','      âœ¦  LIGAÃ‡ÃƒO DISPONÃVEL  âœ¦','       â–ˆâ–ˆ  ACESSO CONCEDIDO  â–ˆâ–ˆ','','CLIQUE AGORA EM [ LIGAR KITT ]','PARA ACEDER AO KITT IA AO VIVO.','','â€” MANIX // KYRONEX SYSTEMS â€”',''],congrats:'AGENTE CERTIFICADO â€” ACESSO NÃVEL ALFA'},
  };
  const r = reward[LANG]||reward.en;
  // Flash Ã©cran
  try{
    for(let i=0;i<4;i++){
      setTimeout(()=>document.body.style.background='rgba(0,255,100,0.06)',i*250);
      setTimeout(()=>document.body.style.background='#000',i*250+125);
    }
    setTimeout(()=>document.body.style.background='',1200);
  }catch(e){}
  await typeText(sep, 3, 'line-dim');
  await typeText(r.title, 8, 'line-err');
  await typeText(sep, 3, 'line-dim');
  for(const line of r.lines) {
    if(line.includes('â–ˆâ–ˆâ–ˆâ–ˆ')) { await typeText(line, 3, 'line-warn'); }
    else if(line.includes('1  9  8  2')) { await typeText(line, 10, 'line-err'); }
    else if(line.startsWith('â–¶')) { await typeText(line, 10, 'line-info'); }
    else if(line==='') { await typeText('', 0); await delay(80); }
    else if(line.startsWith('â€”')) { await typeText(line, 8, 'line-dim'); }
    else { await typeText(line, 10, 'line-ok'); }
  }
  await typeText(sep, 3, 'line-dim');
  await typeText(r.congrats, 12, 'line-err');
  await typeText(sep, 3, 'line-dim');
  const pushTitle = {fr:'KITT ğŸ† Missions complÃ¨tes !',en:'KITT ğŸ† All missions complete!',nl:'KITT ğŸ† Alle missies voltooid!',it:'KITT ğŸ† Missioni completate!',de:'KITT ğŸ† Alle Missionen erfÃ¼llt!',es:'KITT ğŸ† Â¡Misiones cumplidas!',pt:'KITT ğŸ† MissÃµes cumpridas!'}[LANG]||'KITT ğŸ† All missions complete!';
  _sendPush(pushTitle, r.congrats);
  // â˜… DÃ©bloquer le bouton Connexion KITT !
  setTimeout(()=>_unlockTunnelBtn(), 500);
}

function _renderMissions() {
  const list = document.getElementById('mission-list');
  const fill = document.getElementById('mission-progress-fill');
  if(!list) return;
  const missions = MISSIONS[LANG]||MISSIONS.fr;
  const done = missions.filter(m=>_missionsCompleted.has(m.id)).length;
  if(fill) fill.style.width = `${Math.round(done/missions.length*100)}%`;
  list.innerHTML = missions.map(m=>`
    <div class="mission-item ${_missionsCompleted.has(m.id)?'done':''}">
      <span class="m-check">${_missionsCompleted.has(m.id)?'â–¶':'â—‹'}</span>
      <span>${m.label}</span>
    </div>`).join('');
}

function _toggleMissionHud() {
  const hud = document.getElementById('kitt-mission-hud');
  if(!hud) return;
  _missionHudOpen = !_missionHudOpen;
  if(_missionHudOpen) { _renderMissions(); hud.classList.add('visible'); }
  else { hud.classList.remove('visible'); }
}

// Bouton fermer
document.addEventListener('DOMContentLoaded', ()=>{
  const mc = document.getElementById('mission-close');
  if(mc) mc.addEventListener('click', _toggleMissionHud);
});

// Commande missions
CMDS['missions'] = async function() {
  _toggleMissionHud();
  const mTitle={fr:'â”€â”€ MISSIONS KITT â”€â”€',en:'â”€â”€ KITT MISSIONS â”€â”€',nl:'â”€â”€ KITT MISSIES â”€â”€',it:'â”€â”€ MISSIONI KITT â”€â”€',de:'â”€â”€ KITT MISSIONEN â”€â”€',es:'â”€â”€ MISIONES KITT â”€â”€',pt:'â”€â”€ MISSÃ•ES KITT â”€â”€'}[LANG]||'â”€â”€ KITT MISSIONS â”€â”€';
  await typeText(mTitle, 10, 'line-info');
  const missions = MISSIONS[LANG]||MISSIONS.en;
  const done = missions.filter(m=>_missionsCompleted.has(m.id)).length;
  const progLabel={fr:'PROGRESSION',en:'PROGRESS',nl:'VOORTGANG',it:'PROGRESSIONE',de:'FORTSCHRITT',es:'PROGRESIÃ“N',pt:'PROGRESSO'}[LANG]||'PROGRESS';
  await typeText(`${progLabel} : ${done}/${missions.length}`, 12, done===missions.length?'line-ok':'line-warn');
  if(done===missions.length) {
    const allDone={fr:'TOUTES LES MISSIONS ACCOMPLIES ! FÃ‰LICITATIONS.',en:'ALL MISSIONS COMPLETE! CONGRATULATIONS.',nl:'ALLE MISSIES VOLTOOID! GEFELICITEERD.',it:'TUTTE LE MISSIONI COMPIUTE! CONGRATULAZIONI.',de:'ALLE MISSIONEN ERFÃœLLT! GLÃœCKWUNSCH.',es:'Â¡TODAS LAS MISIONES CUMPLIDAS! FELICIDADES.',pt:'TODAS AS MISSÃ•ES CUMPRIDAS! PARABÃ‰NS.'}[LANG]||'ALL MISSIONS COMPLETE!';
    await typeText(allDone, 12, 'line-ok');
  }
};
CMD_ALIASES['mission'] = 'missions';
CMD_ALIASES['quetes'] = 'missions';
CMD_ALIASES['quÃªtes'] = 'missions';
CMD_ALIASES['missionen'] = 'missions';   // de
CMD_ALIASES['missies'] = 'missions';    // nl
CMD_ALIASES['missioni'] = 'missions';   // it
CMD_ALIASES['misiones'] = 'missions';   // es
CMD_ALIASES['missoes'] = 'missions';    // pt
CMD_ALIASES['missÃµes'] = 'missions';    // pt

// Auto-tracker de commandes â†’ missions
const _MISSION_CMD_MAP = {
  boot:'boot', aide:'aide', diagnostic:'diag', scan:'scan', turbo:'turbo', mode:'mode', karr:'karr',
  manix:'manix', cedric:'cedric', damon:'damon', pascal:'pascal', kr95:'kr95', mario:'mario', za:'za',
  blague:'blague', list:'list',
  // aliases autres langues â†’ mÃªme mission id
  hulp:'aide', hilfe:'aide', ayuda:'aide', ajuda:'aide', aiuto:'aide',
  witz:'blague', grap:'blague', barzelletta:'blague', chiste:'blague', piada:'blague',
  daemon:'damon',
};
const _origOnCmdExecuted = _onCmdExecuted;
// Override pour tracker les missions aussi
(function(){
  const origExec = _onCmdExecuted;
  window._trackMissionCmd = function(cmdKey){
    if(_MISSION_CMD_MAP[cmdKey]) _completeMission(_MISSION_CMD_MAP[cmdKey]);
  };
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â˜… NOTIFICATIONS PUSH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _notifEnabled = false;
async function _initNotifications() {
  if(!('Notification' in window)) return;
  if(Notification.permission==='granted') { _notifEnabled=true; _scheduleRandomNotifs(); return; }
  if(Notification.permission==='default') {
    // Demander aprÃ¨s 20 secondes â€” moins intrusif
    setTimeout(async()=>{
      const perm = await Notification.requestPermission();
      if(perm==='granted') { _notifEnabled=true; _scheduleRandomNotifs(); }
    }, 20000);
  }
}

function _sendPush(title, body) {
  if(!_notifEnabled || Notification.permission!=='granted') return;
  try{
    const n = new Notification(title, {
      body, icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><rect width="32" height="32" fill="%23000"/><rect x="4" y="14" width="24" height="4" rx="2" fill="%23ff1a00"/></svg>',
      badge:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><rect width="32" height="32" fill="%23ff1a00"/></svg>',
      silent:false,
    });
    setTimeout(()=>n.close(), 6000);
  }catch(e){}
}

const KITT_NOTIFS = {
  fr:['KITT Ã  votre service. Tapez "aide" pour les commandes.','Alerte : secteur non sÃ©curisÃ©. Scan recommandÃ©.','Mode turbo disponible. Conditions optimales.','Nouveau dossier disponible. Tapez "karr".','Connexion IA active. Testez l\'interface.','Surveillance radar : aucune menace dÃ©tectÃ©e.','Carburant Ã  78%. Trajet possible : 340 km.'],
  en:['KITT at your service. Type "help" for commands.','Alert: unsecured sector. Scan recommended.','Turbo mode available. Optimal conditions.','New file available. Type "karr".','AI connection active. Test the interface.','Radar surveillance: no threats detected.','Fuel at 78%. Possible range: 340 km.'],
};
['nl','de','it','es','pt'].forEach(l=>{ KITT_NOTIFS[l]=KITT_NOTIFS.en; });

function _scheduleRandomNotifs() {
  // PremiÃ¨re notif aprÃ¨s 5 minutes, puis toutes les 8-15 minutes
  const schedule = ()=>{
    const delay = (8+Math.random()*7)*60000;
    setTimeout(()=>{
      const msgs = KITT_NOTIFS[LANG]||KITT_NOTIFS.fr;
      const msg = msgs[Math.floor(Math.random()*msgs.length)];
      _sendPush('K Â· I Â· T Â· T', msg);
      schedule();
    }, delay);
  };
  setTimeout(()=>{
    const msgs = KITT_NOTIFS[LANG]||KITT_NOTIFS.fr;
    _sendPush('K Â· I Â· T Â· T', msgs[0]);
    schedule();
  }, 5*60000);
}

// Init aprÃ¨s sÃ©lection de langue
// â˜… Init notifications aprÃ¨s sÃ©lection de langue â€” dÃ©clenchÃ© via selectLang

// Ajouter "missions" dans la liste des commandes connues
if(typeof ALL_COMMANDS !== 'undefined') ALL_COMMANDS.push('missions');
</script>

<!-- â˜… TABLEAU DE BORD KITT ENRICHI -->
<div id="kitt-dash">
  <div id="kitt-hood">
    <!-- Jauge gauche : carburant -->
    <div class="kitt-gauge">
      <div class="kitt-gauge-label">FUEL</div>
      <div class="kitt-gauge-bar"><div class="kitt-gauge-fill green" style="width:78%"></div></div>
      <div class="kitt-gauge-val">78%</div>
    </div>
    <!-- Jauge : temp -->
    <div class="kitt-gauge">
      <div class="kitt-gauge-label">TEMP</div>
      <div class="kitt-gauge-bar"><div class="kitt-gauge-fill amber" style="width:42%"></div></div>
      <div class="kitt-gauge-val">42Â°C</div>
    </div>
    <!-- Scanner central -->
    <div id="kitt-scan-center">
      <div id="kitt-visualizer">
        <div class="viz-bar" style="--h:4px;--dur:.3s"></div>
        <div class="viz-bar" style="--h:10px;--dur:.45s"></div>
        <div class="viz-bar" style="--h:16px;--dur:.35s"></div>
        <div class="viz-bar" style="--h:20px;--dur:.5s"></div>
        <div class="viz-bar" style="--h:22px;--dur:.28s"></div>
        <div class="viz-bar" style="--h:18px;--dur:.42s"></div>
        <div class="viz-bar" style="--h:14px;--dur:.38s"></div>
        <div class="viz-bar" style="--h:20px;--dur:.32s"></div>
        <div class="viz-bar" style="--h:12px;--dur:.48s"></div>
        <div class="viz-bar" style="--h:8px;--dur:.36s"></div>
        <div class="viz-bar" style="--h:4px;--dur:.44s"></div>
      </div>
      <div id="kitt-scan-track">
        <div id="kitt-scan-dot"></div>
        <div id="kitt-scan-trail"></div>
      </div>
      <div id="kitt-speed-display"></div>
    </div>
    <!-- Jauge : VRAM -->
    <div class="kitt-gauge">
      <div class="kitt-gauge-label">VRAM</div>
      <div class="kitt-gauge-bar"><div class="kitt-gauge-fill green" style="width:51%"></div></div>
      <div class="kitt-gauge-val">4.1G</div>
    </div>
    <!-- Jauge : signal -->
    <div class="kitt-gauge">
      <div class="kitt-gauge-label">SIG</div>
      <div class="kitt-gauge-bar"><div class="kitt-gauge-fill green" style="width:90%"></div></div>
      <div class="kitt-gauge-val">5/5</div>
    </div>
  </div>
</div>

<!-- APPEL ENTRANT -->
<div id="kitt-call">
  <div id="call-avatar">KÂ·IÂ·TÂ·T</div>
  <div id="call-name">K Â· I Â· T Â· T</div>
  <div id="call-status">APPEL ENTRANT Â·Â·Â·</div>
  <div class="call-btns">
    <button class="call-btn" id="call-accept">&#9742; ACCEPTER</button>
    <button class="call-btn" id="call-ignore">&#10005; IGNORER</button>
  </div>
</div>

<!-- â˜… HUD MISSIONS -->
<div id="kitt-mission-hud">
  <div id="mission-title">â¬¡ MISSIONS KITT</div>
  <div id="mission-progress-bar"><div id="mission-progress-fill" style="width:0%"></div></div>
  <div id="mission-list"></div>
  <div id="mission-close">[ FERMER ]</div>
</div>

</body>
</html>
