<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KITT FRANCO-BELGE // SYSTÃˆME CENTRAL</title>
<meta name="description" content="Interface KITT Franco-Belge â€” IA embarquÃ©e sur NVIDIA Jetson. Projet fan non commercial par Manix."/>
<meta name="theme-color" content="#000000"/>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet"/>
<style>
:root{
  --green:#00ff66;
  --green-dim:#00aa44;
  --green-glow:rgba(0,255,102,.18);
  --green-faint:rgba(0,255,102,.06);
  --red:#ff1a1a;
  --red-glow:rgba(255,26,26,.22);
  --amber:#ffaa00;
  --amber-dim:#cc8800;
  --cyan:#00ccff;
  --cyan-dim:#0088bb;
  --bg:#000;
  --border-dim:rgba(0,255,102,.18);
  --border-mid:rgba(0,255,102,.35);
  --mono:'Share Tech Mono','Courier New',monospace;
  --display:'Orbitron',sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;background:var(--bg);color:var(--green);font-family:var(--mono);overflow:hidden;}

/* â”€â”€ CRT scanlines â€” INTOUCHÃ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body::before{content:"";position:fixed;top:0;left:0;right:0;bottom:0;background:repeating-linear-gradient(0deg,rgba(0,0,0,.18),rgba(0,0,0,.18) 1px,transparent 1px,transparent 3px);pointer-events:none;z-index:9998;}
body::after{content:"";position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,255,80,.015);pointer-events:none;z-index:9999;animation:flicker .12s infinite;}
@keyframes flicker{0%{opacity:.88}48%{opacity:1}52%{opacity:.92}100%{opacity:.96}}

/* â”€â”€ Grille HUD subtile (fond) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body{
  background-image:
    linear-gradient(rgba(0,255,102,.022) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,255,102,.022) 1px, transparent 1px),
    radial-gradient(ellipse at 30% 70%, rgba(255,170,0,.012) 0%, transparent 50%),
    radial-gradient(ellipse at 70% 30%, rgba(255,26,26,.008) 0%, transparent 50%);
  background-size: 40px 40px, 40px 40px, 100% 100%, 100% 100%;
}

/* â”€â”€ SCANNER KITT â€” INTOUCHÃ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#sw{position:fixed;top:0;left:0;right:0;height:3px;overflow:hidden;z-index:1000;}
#sb{position:absolute;top:0;width:200px;height:3px;background:linear-gradient(90deg,transparent,var(--red),var(--red),transparent);box-shadow:0 0 14px 4px var(--red);animation:ks 1.8s ease-in-out infinite alternate;}
#swb{position:fixed;bottom:0;left:0;right:0;height:3px;overflow:hidden;z-index:1000;}
#sbb{position:absolute;top:0;width:200px;height:3px;background:linear-gradient(90deg,transparent,var(--red),var(--red),transparent);box-shadow:0 0 14px 4px var(--red);animation:ks 1.8s ease-in-out infinite alternate-reverse;}
@keyframes ks{0%{left:-200px}100%{left:100%}}

/* â”€â”€ FOND JARVIS â€” INTOUCHÃ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.container{position:relative;z-index:1;}
#jarvis-svg{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%) translate3d(0,0,0);
  width:min(90vw,90vh);height:min(90vw,90vh);
  pointer-events:none;z-index:0;opacity:0.45;
}
#sphere-wrap{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%);
  width:180px;height:180px;
  perspective:500px;
  pointer-events:none;z-index:0;opacity:0.22;
}
#sphere-3d{
  width:100%;height:100%;
  transform-style:preserve-3d;
  animation:srot 22s linear infinite;
}
@keyframes srot{from{transform:rotateX(22deg) rotateY(0deg)}to{transform:rotateX(22deg) rotateY(360deg)}}
.s-mer,.s-par{
  position:absolute;top:0;left:0;width:100%;height:100%;
  border-radius:50%;border:1px solid var(--green);box-sizing:border-box;
  opacity:0.7;
}
.s-core{
  position:absolute;top:50%;left:50%;
  width:18px;height:18px;margin:-9px 0 0 -9px;
  border-radius:50%;
  background:radial-gradient(circle,var(--green),transparent);
  box-shadow:0 0 20px var(--green),0 0 40px rgba(0,255,102,.4);
  animation:score 3s ease-in-out infinite;
}
@keyframes score{0%,100%{opacity:.6}50%{opacity:1}}

/* â”€â”€ LANGUAGE SELECTION OVERLAY â€” ALIEN Ã— KITT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#lang-screen{
  position:fixed;top:0;left:0;right:0;bottom:0;
  background:rgba(0,0,0,.98);
  z-index:8000;
  display:flex;align-items:center;justify-content:center;
  padding:16px;
  backdrop-filter:blur(3px);
}

/* Grille HUD dans l'overlay langue */
#lang-screen::before{
  content:'';position:absolute;inset:0;
  background-image:
    linear-gradient(rgba(0,255,102,.018) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,255,102,.018) 1px, transparent 1px);
  background-size: 32px 32px;
  pointer-events:none;
}

/* Scanner rouge en haut et bas pendant la sÃ©lection de langue */
#lang-screen .lang-scanner-top{
  position:absolute;top:0;left:0;right:0;height:2px;overflow:hidden;
}
#lang-screen .lang-scanner-top::after{
  content:'';position:absolute;top:0;width:160px;height:2px;
  background:linear-gradient(90deg,transparent,var(--red),transparent);
  box-shadow:0 0 10px 3px var(--red);
  animation:ks 2.2s ease-in-out infinite alternate;
}
#lang-screen .lang-scanner-bot{
  position:absolute;bottom:0;left:0;right:0;height:2px;overflow:hidden;
}
#lang-screen .lang-scanner-bot::after{
  content:'';position:absolute;top:0;width:160px;height:2px;
  background:linear-gradient(90deg,transparent,var(--red),transparent);
  box-shadow:0 0 10px 3px var(--red);
  animation:ks 2.2s ease-in-out infinite alternate-reverse;
}

#lang-box{
  width:100%;max-width:520px;
  border:1px solid var(--green-dim);
  box-shadow:
    0 0 80px rgba(0,255,102,.08),
    0 0 160px rgba(0,255,102,.03),
    inset 0 0 60px rgba(0,255,102,.015),
    0 0 2px rgba(255,26,26,.2);
  background:rgba(0,6,2,.92);
  font-size:13px;
  animation:boxIn .5s ease-out;
  position:relative;
  overflow:hidden;
}

/* Ligne dÃ©co gauche rouge â€” style vaisseau */
#lang-box::before{
  content:'';position:absolute;left:0;top:0;bottom:0;width:2px;
  background:linear-gradient(180deg,transparent,var(--red),rgba(255,26,26,.3),transparent);
}

@keyframes boxIn{from{opacity:0;transform:scale(.94) translateY(12px)}to{opacity:1;transform:none}}

/* En-tÃªte avec double logo */
#lang-hdr{
  border-bottom:1px solid var(--border-dim);
  padding:16px 24px 14px;
  text-align:center;
  background:linear-gradient(180deg,rgba(255,26,26,.04),rgba(0,255,102,.02));
  position:relative;
}
#lang-logo-line{
  display:flex;align-items:center;justify-content:center;gap:16px;
  margin-bottom:6px;
}
.lang-logo-kitt{
  color:var(--red);font-family:var(--display);font-size:14px;font-weight:900;
  letter-spacing:5px;
  text-shadow:0 0 20px var(--red),0 0 50px rgba(255,26,26,.3);
  animation:pred 3s ease-in-out infinite;
}
.lang-logo-sep{
  color:var(--green-dim);font-size:11px;letter-spacing:1px;
  text-shadow:0 0 8px var(--green-dim);
}
.lang-logo-alien{
  color:var(--amber);font-family:var(--display);font-size:14px;font-weight:900;
  letter-spacing:4px;
  text-shadow:0 0 20px var(--amber),0 0 50px rgba(255,170,0,.3);
  animation:amberPulse 4s ease-in-out infinite;
}
@keyframes amberPulse{
  0%,100%{text-shadow:0 0 12px var(--amber),0 0 30px rgba(255,170,0,.2)}
  50%{text-shadow:0 0 28px var(--amber),0 0 70px rgba(255,170,0,.5)}
}
#lang-sys-id{
  color:var(--green);font-family:var(--mono);font-size:10px;letter-spacing:3px;
  text-shadow:0 0 10px var(--green);
}

#lang-sub{
  padding:10px 24px 8px;
  color:var(--amber);
  letter-spacing:3px;
  font-size:9px;
  border-bottom:1px solid rgba(255,170,0,.12);
  text-shadow:0 0 8px var(--amber-dim);
  display:flex;align-items:center;gap:8px;
}
#lang-sub::before{
  content:'â–¶';color:var(--red);font-size:8px;animation:bd 1.2s ease-in-out infinite;
}

#lang-output{padding:4px 0 2px;}

.lang-opt{
  display:flex;
  align-items:center;
  gap:14px;
  padding:9px 24px;
  cursor:pointer;
  transition:background .12s, border-left-color .12s, transform .1s;
  border-left:2px solid transparent;
  border-bottom:1px solid rgba(0,255,102,.05);
  position:relative;
}
.lang-opt:last-child{border-bottom:none;}
.lang-opt:hover{
  background:linear-gradient(90deg,rgba(255,26,26,.06),rgba(0,255,102,.04));
  border-left-color:var(--red);
  transform:translateX(2px);
}
.lang-opt:hover .lo-n{border-color:var(--red);color:var(--red);box-shadow:0 0 8px rgba(255,26,26,.3);}
.lang-opt:hover .lo-flag{filter:saturate(1.5) brightness(1.2);}
.lang-opt:hover .lo-label{text-shadow:0 0 12px var(--green);color:var(--green);}
.lang-opt:hover .lo-native{color:var(--amber);}

.lo-n{
  color:var(--green-dim);
  font-size:10px;
  min-width:22px;
  text-align:center;
  border:1px solid rgba(0,255,102,.4);
  padding:2px 4px;
  letter-spacing:1px;
  flex-shrink:0;
  transition:all .12s;
  font-family:var(--display);
}
.lo-flag{
  font-size:20px;
  flex-shrink:0;
  transition:filter .12s;
  line-height:1;
}
.lo-text{flex:1;display:flex;flex-direction:column;gap:2px;}
.lo-label{
  color:var(--green);
  letter-spacing:2px;
  font-size:12px;
  transition:all .12s;
  font-family:var(--display);
  font-weight:700;
}
.lo-native{
  color:var(--green-dim);
  font-size:10px;
  letter-spacing:1px;
  opacity:.7;
  transition:color .12s;
  font-family:var(--mono);
}
.lo-voice-btn{
  flex-shrink:0;
  background:rgba(255,170,0,.05);
  border:1px solid rgba(255,170,0,.25);
  color:var(--amber-dim);
  font-size:10px;
  padding:3px 8px;
  cursor:pointer;
  font-family:var(--mono);
  letter-spacing:1px;
  transition:all .12s;
  display:flex;align-items:center;gap:4px;
}
.lo-voice-btn:hover{
  background:rgba(255,170,0,.12);
  border-color:var(--amber);
  color:var(--amber);
  box-shadow:0 0 8px rgba(255,170,0,.2);
}
.lo-voice-btn::before{content:'â–¶';font-size:8px;}

#lang-ftr{
  border-top:1px solid var(--border-dim);
  padding:10px 24px;
  color:var(--green-dim);
  font-size:10px;
  letter-spacing:2px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:rgba(0,255,102,.015);
}
#lang-ftr-left{display:flex;align-items:center;gap:6px;}
#lang-ftr-right{
  color:rgba(255,26,26,.5);font-size:9px;letter-spacing:1px;
  animation:bd 2s ease-in-out infinite;
}
#lang-voice-toggle{
  margin-left:8px;
  background:rgba(0,255,102,.04);
  border:1px solid rgba(0,255,102,.25);
  color:var(--green-dim);
  font-size:9px;padding:2px 7px;
  cursor:pointer;font-family:var(--mono);letter-spacing:1px;
  transition:all .12s;
}
#lang-voice-toggle:hover{color:var(--green);border-color:var(--green);background:rgba(0,255,102,.08);}

/* â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.container{display:flex;flex-direction:column;height:100%;padding:14px 20px 18px;gap:0;}

/* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
header{
  flex-shrink:0;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:10px 0 10px;
  border-bottom:1px solid var(--red);
  position:relative;
}
header::after{
  content:'';position:absolute;bottom:-3px;left:0;right:0;height:1px;
  background:linear-gradient(90deg,transparent,rgba(255,26,26,.2),transparent);
}
.hdr-title{
  color:var(--red);
  font-size:16px;
  letter-spacing:5px;
  font-family:var(--display);
  font-weight:700;
  text-shadow:0 0 16px var(--red),0 0 40px rgba(255,26,26,.3);
  animation:pred 3s ease-in-out infinite;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
@keyframes pred{
  0%,100%{text-shadow:0 0 12px var(--red),0 0 30px rgba(255,26,26,.2)}
  50%{text-shadow:0 0 28px var(--red),0 0 60px rgba(255,26,26,.5),0 0 90px rgba(255,26,26,.15)}
}
.hdr-right{
  display:flex;gap:12px;font-size:10px;color:var(--green-dim);
  align-items:center;flex-shrink:0;margin-left:12px;
}
.status-pill{
  display:flex;align-items:center;gap:5px;
  border:1px solid var(--border-dim);
  padding:3px 8px;
  font-size:10px;
  letter-spacing:1px;
  background:var(--green-faint);
}
.sdot{
  display:inline-block;width:6px;height:6px;border-radius:50%;
  background:var(--green);box-shadow:0 0 6px var(--green);
  animation:bd 2s ease-in-out infinite;flex-shrink:0;
}
@keyframes bd{0%,100%{opacity:1;box-shadow:0 0 6px var(--green)}50%{opacity:.2;box-shadow:none}}
#clock{
  font-family:var(--display);font-size:12px;color:var(--cyan);
  letter-spacing:2px;text-shadow:0 0 8px var(--cyan-dim);
  border:1px solid rgba(0,204,255,.2);
  padding:3px 8px;
  background:rgba(0,204,255,.04);
}
#lang-flag{
  font-size:10px;border:1px solid var(--border-dim);padding:3px 7px;
  letter-spacing:2px;cursor:pointer;color:var(--green-dim);
  transition:all .15s;font-family:var(--display);
  background:var(--green-faint);
}
#lang-flag:hover{color:var(--green);border-color:var(--green);background:var(--green-glow);text-shadow:0 0 8px var(--green);}

/* â”€â”€ ASCII â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#kitt-ascii{
  flex-shrink:0;text-align:center;color:var(--red);
  font-size:9.5px;line-height:1.2;
  text-shadow:0 0 10px rgba(255,26,26,.6),0 0 25px rgba(255,26,26,.2);
  padding:5px 0 3px;opacity:.88;user-select:none;
  position:relative;
}
#kitt-ascii pre{
  display:inline-block;
  animation:asciiPulse 4s ease-in-out infinite;
}
@keyframes asciiPulse{
  0%,100%{opacity:.88;filter:blur(0)}
  50%{opacity:1;filter:drop-shadow(0 0 3px var(--red))}
}

/* â”€â”€ TERMINAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#terminal{
  flex:1;overflow-y:auto;overflow-x:hidden;
  padding:10px 8px 6px;
  font-size:12.5px;line-height:1.75;
  scrollbar-width:thin;scrollbar-color:rgba(255,26,26,.4) rgba(0,255,102,.05);
  position:relative;
}
#terminal::-webkit-scrollbar{width:3px;}
#terminal::-webkit-scrollbar-track{background:rgba(0,255,102,.04);}
#terminal::-webkit-scrollbar-thumb{background:rgba(255,26,26,.4);}
/* Ligne de terminal avec effet de fade-in subtil */
#terminal > div{
  animation:lineIn .15s ease-out;
  padding:0 2px;
}
@keyframes lineIn{from{opacity:0;transform:translateX(-4px)}to{opacity:1;transform:none}}

.line-ok{color:var(--green);}
.line-warn{color:var(--amber);text-shadow:0 0 6px rgba(255,170,0,.3);}
.line-err{color:var(--red);text-shadow:0 0 6px rgba(255,26,26,.3);}
.line-info{color:var(--cyan);text-shadow:0 0 6px rgba(0,204,255,.25);}
.line-dim{color:var(--green-dim);opacity:.75;}
.cursor{
  display:inline-block;width:7px;height:13px;background:var(--green);
  vertical-align:text-bottom;animation:bc .7s step-end infinite;
  box-shadow:0 0 6px var(--green);
}
@keyframes bc{0%,100%{opacity:1}50%{opacity:0}}

/* â”€â”€ SEPARATEUR TERMINAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.term-sep{
  height:1px;
  background:linear-gradient(90deg,transparent,var(--border-dim),transparent);
  margin:4px 0;
}

/* â”€â”€ BOUTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn-row{
  flex-shrink:0;display:flex;flex-wrap:wrap;gap:5px;
  padding:8px 0 6px;
  border-top:1px solid rgba(0,255,102,.1);
  border-bottom:1px solid rgba(0,255,102,.1);
}
button{
  background:rgba(0,255,102,.03);
  border:1px solid rgba(0,255,102,.3);
  color:var(--green-dim);
  padding:7px 13px;cursor:pointer;
  font-family:var(--mono);font-size:11px;letter-spacing:1.5px;
  transition:all .15s;position:relative;overflow:hidden;
  text-transform:uppercase;
}
button::before{
  content:"";position:absolute;inset:0;
  background:var(--green);
  transform:scaleX(0);transform-origin:left;
  transition:transform .2s ease;z-index:-1;
}
button:hover{
  color:#000;border-color:var(--green);
  text-shadow:none;
  box-shadow:0 0 12px rgba(0,255,102,.2);
}
button:hover::before{transform:scaleX(1);}
button:active{transform:scale(.96);filter:brightness(.85);}

.btn-red{border-color:rgba(255,26,26,.35);color:rgba(255,26,26,.7);}
.btn-red::before{background:var(--red);}
.btn-red:hover{border-color:var(--red);box-shadow:0 0 12px rgba(255,26,26,.25);}

.btn-cyan{border-color:rgba(0,204,255,.35);color:rgba(0,204,255,.7);}
.btn-cyan::before{background:var(--cyan);}
.btn-cyan:hover{border-color:var(--cyan);box-shadow:0 0 12px rgba(0,204,255,.25);}

/* â”€â”€ BOUTON TUNNEL CLOUDFLARE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#btn-tunnel{border-color:#222;color:#333;transition:all .3s;}
#btn-tunnel.tunnel-online{
  border-color:rgba(0,255,102,.5);color:var(--green);
  background:rgba(0,255,102,.05);
  animation:tpulse 2.4s ease-in-out infinite;}
#btn-tunnel.tunnel-offline{
  border-color:rgba(255,26,26,.35);color:rgba(255,26,26,.5);}
#btn-tunnel.tunnel-checking{
  border-color:rgba(255,170,0,.35);color:rgba(255,170,0,.5);}
@keyframes tpulse{
  0%,100%{box-shadow:0 0 5px rgba(0,255,102,.15)}
  50%{box-shadow:0 0 20px rgba(0,255,102,.5),inset 0 0 10px rgba(0,255,102,.06)}
}

/* â”€â”€ INPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.input-row{
  flex-shrink:0;display:flex;gap:10px;padding-top:9px;
  align-items:center;
  border-top:1px solid rgba(0,255,102,.08);
}
.prompt-lbl{
  color:var(--red);font-size:13px;white-space:nowrap;
  text-shadow:0 0 10px rgba(255,26,26,.5);
  font-family:var(--display);font-weight:700;letter-spacing:2px;
}
#cmd-input{
  flex:1;background:transparent;border:none;
  border-bottom:1px solid rgba(0,255,102,.3);
  color:var(--green);font-family:var(--mono);font-size:12.5px;
  outline:none;padding:5px 2px;caret-color:var(--green);
  transition:border-color .2s;
  letter-spacing:.5px;
}
#cmd-input::placeholder{color:var(--green-dim);opacity:.4;letter-spacing:1px;}
#cmd-input:focus{
  border-bottom-color:rgba(0,255,102,.65);
  text-shadow:0 0 8px rgba(0,255,102,.2);
}

/* â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.modal{
  position:fixed;top:0;left:0;right:0;bottom:0;
  background:rgba(0,0,0,.96);
  display:none;flex-direction:column;
  padding:0;overflow:hidden;z-index:5000;
  backdrop-filter:blur(4px);
}
.modal.open{display:flex;animation:modalIn .25s ease-out;}
@keyframes modalIn{from{opacity:0;transform:scale(.98)}to{opacity:1;transform:none}}
.modal-hdr{
  display:flex;justify-content:space-between;align-items:center;
  padding:14px 24px;
  border-bottom:1px solid rgba(255,26,26,.3);
  background:rgba(255,26,26,.04);
  flex-shrink:0;
}
.modal-title{
  color:var(--red);font-size:14px;letter-spacing:4px;
  text-shadow:0 0 12px var(--red);
  font-family:var(--display);font-weight:700;
}
.close-btn{
  cursor:pointer;color:rgba(255,26,26,.7);font-size:18px;
  padding:4px 10px;border:1px solid rgba(255,26,26,.3);
  transition:all .15s;font-family:var(--mono);
  background:rgba(255,26,26,.03);
}
.close-btn:hover{background:var(--red);color:#000;box-shadow:0 0 12px rgba(255,26,26,.3);}
.modal-body{
  flex:1;overflow:auto;padding:20px 28px;
  scrollbar-width:thin;scrollbar-color:rgba(255,26,26,.3) transparent;
}
.modal-body::-webkit-scrollbar{width:3px;}
.modal-body::-webkit-scrollbar-thumb{background:rgba(255,26,26,.3);}
.modal pre{
  white-space:pre-wrap;color:var(--green);
  font-family:var(--mono);font-size:12.5px;line-height:1.8;
}

/* â”€â”€ COMPTEUR VISITES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#visit-counter{
  position:fixed;left:8px;top:50%;transform:translateY(-50%);
  writing-mode:vertical-rl;text-orientation:mixed;
  font-size:10px;color:var(--green);letter-spacing:3px;
  opacity:.5;pointer-events:none;z-index:100;
  text-shadow:0 0 8px var(--green);
  user-select:none;
  border-left:1px solid rgba(0,255,102,.2);
  padding-left:5px;
}

/* â”€â”€ FOOTER VERSION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#site-footer{
  position:fixed;bottom:12px;left:50%;transform:translateX(-50%);
  font-size:9.5px;color:var(--green-dim);letter-spacing:2.5px;
  opacity:.45;pointer-events:none;z-index:1001;
  white-space:nowrap;user-select:none;
  text-shadow:0 0 6px rgba(0,255,102,.3);
}

/* â”€â”€ COIN HUD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hud-corner{
  position:fixed;pointer-events:none;z-index:100;
  width:20px;height:20px;opacity:.3;
}
.hud-corner.tl{top:8px;left:8px;border-top:1px solid var(--green);border-left:1px solid var(--green);}
.hud-corner.tr{top:8px;right:8px;border-top:1px solid var(--green);border-right:1px solid var(--green);}
.hud-corner.bl{bottom:8px;left:8px;border-bottom:1px solid var(--green);border-left:1px solid var(--green);}
.hud-corner.br{bottom:8px;right:8px;border-bottom:1px solid var(--green);border-right:1px solid var(--green);}

/* â”€â”€ MOBILE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media(max-width:600px){
  .hdr-title{font-size:11px;letter-spacing:2px;}
  #kitt-ascii{font-size:7.5px;}
  button{padding:6px 9px;font-size:10px;letter-spacing:1px;}
  #terminal{font-size:11.5px;}
  .container{padding:10px 12px 14px;}
  #lang-box{max-width:100%;}
  #clock{display:none;}
  .hud-corner{display:none;}
  #visit-counter{display:none;}
}
@media(max-width:380px){#kitt-ascii{display:none;}}
@media(max-width:480px){
  .btn-row{gap:4px;}
  button{padding:5px 8px;font-size:10px;}
}
</style>
</head>
<body>

<!-- Coins HUD dÃ©coratifs -->
<div class="hud-corner tl"></div>
<div class="hud-corner tr"></div>
<div class="hud-corner bl"></div>
<div class="hud-corner br"></div>

<!-- Language selection overlay -->
<div id="lang-screen">
  <div class="lang-scanner-top"></div>
  <div class="lang-scanner-bot"></div>
  <div id="lang-box">
    <div id="lang-hdr">
      <div id="lang-logo-line">
        <span class="lang-logo-kitt">KÂ·IÂ·TÂ·T</span>
        <span class="lang-logo-sep">Ã—</span>
        <span class="lang-logo-alien">ALIEN</span>
      </div>
      <div id="lang-sys-id"></div>
    </div>
    <div id="lang-sub"></div>
    <div id="lang-output"></div>
    <div id="lang-ftr">
      <div id="lang-ftr-left">
        <span id="lang-ftr-txt"></span>
        <button id="lang-voice-toggle" onclick="toggleLangVoice()">ğŸ”Š VOIX</button>
      </div>
      <div id="lang-ftr-right">MU-TH-UR 6000 â—‰</div>
    </div>
  </div>
</div>

<!-- Fond Jarvis holographique â€” INTOUCHÃ‰ -->
<svg id="jarvis-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400" preserveAspectRatio="xMidYMid meet">
  <g stroke="#00ff66" fill="none">
    <circle cx="200" cy="200" r="185" stroke-opacity="0.6" stroke-width="1">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </circle>
    <circle cx="200" cy="200" r="135" stroke-opacity="0.5" stroke-width="0.8">
      <animateTransform attributeName="transform" type="rotate" from="360 200 200" to="0 200 200" dur="45s" repeatCount="indefinite"/>
    </circle>
    <circle cx="200" cy="200" r="85" stroke-opacity="0.45" stroke-width="0.7">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="32s" repeatCount="indefinite"/>
    </circle>
    <line x1="200" y1="15" x2="200" y2="385" stroke-opacity="0.18" stroke-width="0.5">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <line x1="15" y1="200" x2="385" y2="200" stroke-opacity="0.18" stroke-width="0.5">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <path d="M 200 15 A 185 185 0 0 1 385 200" stroke-opacity="0.9" stroke-width="2" stroke="#00ff66">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="8s" repeatCount="indefinite"/>
    </path>
    <line x1="200" y1="15" x2="200" y2="30" stroke-opacity="0.7" stroke-width="1.5">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <line x1="200" y1="15" x2="200" y2="25" stroke-opacity="0.5" stroke-width="1">
      <animateTransform attributeName="transform" type="rotate" from="45 200 200" to="405 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <circle cx="200" cy="200" r="5" fill="#00ff66" opacity="0.7">
      <animate attributeName="opacity" values="0.3;1;0.3" dur="3s" repeatCount="indefinite"/>
      <animate attributeName="r" values="4;7;4" dur="3s" repeatCount="indefinite"/>
    </circle>
  </g>
</svg>
<div id="sphere-wrap">
  <div id="sphere-3d">
    <div class="s-mer" style="transform:rotateY(0deg)"></div>
    <div class="s-mer" style="transform:rotateY(30deg)"></div>
    <div class="s-mer" style="transform:rotateY(60deg)"></div>
    <div class="s-mer" style="transform:rotateY(90deg)"></div>
    <div class="s-mer" style="transform:rotateY(120deg)"></div>
    <div class="s-mer" style="transform:rotateY(150deg)"></div>
    <div class="s-par" style="transform:translateY(-44px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(-22px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(0px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(22px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(44px) rotateX(90deg)"></div>
    <div class="s-core"></div>
  </div>
</div>

<div id="visit-counter"></div>
<div id="site-footer">v3.0 &nbsp;â€”&nbsp; DERNIÃˆRE MISE Ã€ JOUR : 2026-02-20</div>

<!-- Scanners â€” INTOUCHÃ‰ -->
<div id="sw"><div id="sb"></div></div>
<div id="swb"><div id="sbb"></div></div>

<div class="container">
  <header>
    <div id="hdr-title" class="hdr-title">KITT FRANCO-BELGE // INTERFACE CENTRALE</div>
    <div class="hdr-right">
      <span id="lang-flag" onclick="showLangScreen()" title="Changer de langue">FR</span>
      <div class="status-pill">
        <span class="sdot"></span>
        <span id="status-txt">EN LIGNE</span>
      </div>
      <span id="clock">00:00:00</span>
    </div>
  </header>

  <div id="kitt-ascii"><pre>
  â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
  â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•
  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘      â–ˆâ–ˆâ•‘
  â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘      â–ˆâ–ˆâ•‘
  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘      â–ˆâ–ˆâ•‘
  â•šâ•â•  â•šâ•â•â•šâ•â•   â•šâ•â•      â•šâ•â•
    FRANCO-BELGE  //  BY MANIX</pre></div>

  <div id="terminal"></div>

  <div class="btn-row">
    <button id="btn-boot" onclick="boot()">[ INITIALISER ]</button>
    <button id="btn-diag" onclick="runSelfTest()" class="btn-cyan">[ DIAGNOSTIC ]</button>
    <button id="btn-mentions" onclick="openFile('Mentions.txt',T[LANG].modal_mentions)" class="btn-red">[ MENTIONS ]</button>
    <button id="btn-licence" onclick="openFile('License.txt',T[LANG].modal_licence)" class="btn-red">[ LICENCE ]</button>
    <button id="btn-clear" onclick="clearTerm()">[ EFFACER ]</button>
    <button id="btn-tunnel" class="tunnel-checking" onclick="connectTunnel()" title="VÃ©rification..."><span id="btn-tunnel-txt">[ CONNEXION KITT ]</span></button>
  </div>

  <div class="input-row">
    <span class="prompt-lbl">KITT&gt;</span>
    <input id="cmd-input" type="text" placeholder="entrez une commande..." autocomplete="off" spellcheck="false"/>
  </div>
</div>

<!-- Modal -->
<div id="modal" class="modal">
  <div class="modal-hdr">
    <span class="modal-title" id="modal-title">DOCUMENT</span>
    <span class="close-btn" onclick="closeModal()">&#10006;</span>
  </div>
  <div class="modal-body">
    <pre id="modal-content"></pre>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUDIO ENGINE â€” ALIEN Ã— KITT MIX by Manix
// Ambiance Nostromo + KITT Knight Rider
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const _ac = new (window.AudioContext || window.webkitAudioContext)();
let _alienAmbientNode = null;
let _alienAmbientGain = null;

function _resume() { if (_ac.state === 'suspended') _ac.resume(); }

// â”€â”€ REVERB helper (ambiance vaisseau spatial) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function _makeReverb(duration=1.2, decay=2.0) {
  const len = Math.floor(_ac.sampleRate * duration);
  const buf = _ac.createBuffer(2, len, _ac.sampleRate);
  for (let ch=0;ch<2;ch++){
    const d=buf.getChannelData(ch);
    for(let i=0;i<len;i++) d[i]=(Math.random()*2-1)*Math.pow(1-i/len,decay);
  }
  const conv = _ac.createConvolver(); conv.buffer=buf; return conv;
}

// â”€â”€ AMBIANTE NOSTROMO â€” bourdonnement rÃ©acteur â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startAlienAmbient() {
  try {
    _resume();
    if (_alienAmbientNode) return;
    const masterGain = _ac.createGain(); masterGain.gain.value = 0.0;
    masterGain.connect(_ac.destination);
    _alienAmbientGain = masterGain;

    // Bourdonnement grave du rÃ©acteur
    const osc1 = _ac.createOscillator(); osc1.type='sine'; osc1.frequency.value=42;
    const g1 = _ac.createGain(); g1.gain.value=0.18;
    osc1.connect(g1); g1.connect(masterGain);

    // Harmonique moteur
    const osc2 = _ac.createOscillator(); osc2.type='triangle'; osc2.frequency.value=84;
    const g2 = _ac.createGain(); g2.gain.value=0.06;
    osc2.connect(g2); g2.connect(masterGain);

    // Hiss bruit blanc filtrÃ© â€” ventilation vaisseau
    const bufLen = _ac.sampleRate * 3;
    const nBuf = _ac.createBuffer(1, bufLen, _ac.sampleRate);
    const nd = nBuf.getChannelData(0);
    for(let i=0;i<bufLen;i++) nd[i]=Math.random()*2-1;
    const nSrc = _ac.createBufferSource(); nSrc.buffer=nBuf; nSrc.loop=true;
    const lp = _ac.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=280; lp.Q.value=0.8;
    const ng = _ac.createGain(); ng.gain.value=0.022;
    nSrc.connect(lp); lp.connect(ng); ng.connect(masterGain);

    // LFO pulsation lente (respiration du vaisseau)
    const lfo = _ac.createOscillator(); lfo.type='sine'; lfo.frequency.value=0.08;
    const lfoGain = _ac.createGain(); lfoGain.gain.value=0.04;
    lfo.connect(lfoGain); lfoGain.connect(g1.gain);

    osc1.start(); osc2.start(); nSrc.start(); lfo.start();
    _alienAmbientNode = { osc1, osc2, nSrc, lfo };

    // Fade in progressif
    masterGain.gain.linearRampToValueAtTime(1.0, _ac.currentTime + 3.5);
  } catch(e){}
}

function stopAlienAmbient() {
  try {
    if (_alienAmbientGain) {
      _alienAmbientGain.gain.linearRampToValueAtTime(0.0, _ac.currentTime + 2.0);
      setTimeout(()=>{
        if(_alienAmbientNode){
          try{_alienAmbientNode.osc1.stop();_alienAmbientNode.osc2.stop();
            _alienAmbientNode.nSrc.stop();_alienAmbientNode.lfo.stop();}catch(e){}
          _alienAmbientNode=null; _alienAmbientGain=null;
        }
      }, 2200);
    }
  } catch(e){}
}

// â”€â”€ ALERTE NOSTROMO (danger signal) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function sndAlienAlert() {
  try {
    _resume(); const t = _ac.currentTime;
    // Son d'alerte descendant â€” style ordinateur de bord Nostromo
    [0, 0.18, 0.36].forEach((dt, i) => {
      const o = _ac.createOscillator(); o.type='square';
      o.frequency.setValueAtTime(320 - i*40, t+dt);
      o.frequency.exponentialRampToValueAtTime(180, t+dt+0.15);
      const g = _ac.createGain(); g.gain.setValueAtTime(0.055, t+dt); g.gain.exponentialRampToValueAtTime(0.001, t+dt+0.17);
      const lp = _ac.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=600;
      o.connect(lp); lp.connect(g); g.connect(_ac.destination); o.start(t+dt); o.stop(t+dt+0.18);
    });
  } catch(e){}
}

// â”€â”€ PULSE XENOMORPHE (dÃ©tection biologique) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function sndXenoPulse() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='sawtooth';
    o.frequency.setValueAtTime(55, t);
    o.frequency.exponentialRampToValueAtTime(28, t+0.22);
    const dist = _ac.createWaveShaper();
    const curve = new Float32Array(256);
    for(let i=0;i<256;i++){const x=i*2/256-1; curve[i]=Math.tanh(x*4);}
    dist.curve=curve;
    const g = _ac.createGain(); g.gain.setValueAtTime(0.09, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.25);
    o.connect(dist); dist.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.26);
  } catch(e){}
}

// â”€â”€ BEEP MU-TH-UR 6000 (ordinateur de bord Alien) â”€â”€â”€â”€â”€â”€â”€â”€â”€
function sndMutherBeep() {
  try {
    _resume(); const t = _ac.currentTime;
    // Bip caractÃ©ristique froid et mÃ©tallique
    const o = _ac.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(1480, t);
    o.frequency.setValueAtTime(1120, t+0.05);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.06, t); g.gain.setValueAtTime(0.06, t+0.05); g.gain.exponentialRampToValueAtTime(0.001, t+0.12);
    const hp = _ac.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=900;
    o.connect(hp); hp.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.13);
  } catch(e){}
}

// â”€â”€ CLICK TERMINAL (KITT + Nostromo mix) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function sndClick() {
  try {
    _resume(); const t = _ac.currentTime;
    const len = Math.floor(_ac.sampleRate * 0.020);
    const buf = _ac.createBuffer(1, len, _ac.sampleRate);
    const d = buf.getChannelData(0);
    for (let i = 0; i < len; i++) d[i] = (Math.random()*2-1) * Math.pow(1-i/len, 3.5);
    const src = _ac.createBufferSource(); src.buffer = buf;
    const bp = _ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=2200+Math.random()*300; bp.Q.value=3;
    const hp = _ac.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=700;
    const g = _ac.createGain(); g.gain.value=0.22;
    src.connect(bp); bp.connect(hp); hp.connect(g); g.connect(_ac.destination); src.start(t);
    // TonalitÃ© KITT lÃ©gÃ¨re
    const o = _ac.createOscillator(); o.type='square';
    o.frequency.setValueAtTime(1200+Math.random()*150, t);
    o.frequency.exponentialRampToValueAtTime(600, t+0.015);
    const og = _ac.createGain(); og.gain.setValueAtTime(0.03, t); og.gain.exponentialRampToValueAtTime(0.001, t+0.018);
    o.connect(og); og.connect(_ac.destination); o.start(t); o.stop(t+0.020);
  } catch(e){}
}

function sndTick() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='triangle';
    o.frequency.setValueAtTime(3600+Math.random()*300, t);
    o.frequency.exponentialRampToValueAtTime(2200, t+0.012);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.025, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.015);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.016);
  } catch(e){}
}

function sndData() {
  try {
    _resume(); const t = _ac.currentTime;
    // Mix : pulse Alien + sawtooth terminal
    const o = _ac.createOscillator(); o.type='sawtooth';
    o.frequency.value = 1600 + Math.random()*500;
    const g = _ac.createGain(); g.gain.setValueAtTime(0.04, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.014);
    const lp = _ac.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=3500;
    o.connect(lp); lp.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.015);
    // Sub-bass Alien subtil
    if(Math.random()>0.6){
      const o2=_ac.createOscillator(); o2.type='sine'; o2.frequency.value=60+Math.random()*20;
      const g2=_ac.createGain(); g2.gain.setValueAtTime(0.018,t); g2.gain.exponentialRampToValueAtTime(0.001,t+0.04);
      o2.connect(g2); g2.connect(_ac.destination); o2.start(t); o2.stop(t+0.045);
    }
  } catch(e){}
}

function sndGlitch() {
  try {
    _resume(); const t = _ac.currentTime;
    const len = Math.floor(_ac.sampleRate * 0.04);
    const buf = _ac.createBuffer(1, len, _ac.sampleRate);
    const d = buf.getChannelData(0);
    for (let i = 0; i < len; i++) d[i] = (Math.random()*2-1) * (Math.random() > 0.5 ? 0.85 : 0.04);
    const src = _ac.createBufferSource(); src.buffer=buf;
    const bp = _ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=900; bp.Q.value=1.5;
    const g = _ac.createGain(); g.gain.value=0.10;
    src.connect(bp); bp.connect(g); g.connect(_ac.destination); src.start(t);
    // Micro-bleep Alien sur glitch
    const o = _ac.createOscillator(); o.type='square'; o.frequency.value=220;
    const og=_ac.createGain(); og.gain.setValueAtTime(0.03,t); og.gain.exponentialRampToValueAtTime(0.001,t+0.035);
    o.connect(og); og.connect(_ac.destination); o.start(t); o.stop(t+0.038);
  } catch(e){}
}

function sndLineEnd() {
  try {
    _resume(); const t = _ac.currentTime;
    // Descente Alien + fin de ligne KITT
    const o = _ac.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(840, t);
    o.frequency.exponentialRampToValueAtTime(320, t+0.10);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.032, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.11);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.12);
    // Sub harmonique
    const o2=_ac.createOscillator(); o2.type='sine'; o2.frequency.value=80;
    const g2=_ac.createGain(); g2.gain.setValueAtTime(0.015,t); g2.gain.exponentialRampToValueAtTime(0.001,t+0.08);
    o2.connect(g2); g2.connect(_ac.destination); o2.start(t); o2.stop(t+0.09);
  } catch(e){}
}

function sndSelect() {
  try {
    _resume(); const t = _ac.currentTime;
    // KITT select + confirmation MU-TH-UR
    [440,660,880].forEach((f,i) => {
      const o = _ac.createOscillator(); o.type='square'; o.frequency.value=f;
      const g = _ac.createGain(); g.gain.setValueAtTime(0.035, t+i*0.065); g.gain.exponentialRampToValueAtTime(0.001, t+i*0.065+0.055);
      o.connect(g); g.connect(_ac.destination); o.start(t+i*0.065); o.stop(t+i*0.065+0.06);
    });
    // Confirmation grave Alien
    setTimeout(()=>{
      try{
        const o=_ac.createOscillator(); o.type='sine'; o.frequency.value=120;
        const g=_ac.createGain(); g.gain.setValueAtTime(0.05,_ac.currentTime); g.gain.exponentialRampToValueAtTime(0.001,_ac.currentTime+0.25);
        o.connect(g); g.connect(_ac.destination); o.start(); o.stop(_ac.currentTime+0.28);
      }catch(e){}
    }, 220);
  } catch(e){}
}

function sndError() {
  try {
    _resume(); const t = _ac.currentTime;
    // Alarme double Alien + buzzer KITT
    const o = _ac.createOscillator(); o.type='square'; o.frequency.value=160;
    const g = _ac.createGain(); g.gain.setValueAtTime(0.07, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.09);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.10);
    const o2=_ac.createOscillator(); o2.type='sawtooth'; o2.frequency.value=90;
    const g2=_ac.createGain(); g2.gain.setValueAtTime(0.04,t+0.12); g2.gain.exponentialRampToValueAtTime(0.001,t+0.22);
    o2.connect(g2); g2.connect(_ac.destination); o2.start(t+0.12); o2.stop(t+0.23);
  } catch(e){}
}

// â”€â”€ KITT CHIME â€” signature sonore KITT + rÃ©sonance Alien â”€â”€
function kittChime() {
  try {
    _resume(); const t = _ac.currentTime;
    // Chime KITT principal
    const o = _ac.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(920, t); o.frequency.exponentialRampToValueAtTime(240, t+0.38);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.09, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.42);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.43);
    // RÃ©sonance grave Alien (comme un Ã©cho dans le vaisseau)
    const o2=_ac.createOscillator(); o2.type='triangle'; o2.frequency.value=58;
    const g2=_ac.createGain(); g2.gain.setValueAtTime(0.045,t+0.05); g2.gain.exponentialRampToValueAtTime(0.001,t+0.55);
    o2.connect(g2); g2.connect(_ac.destination); o2.start(t+0.05); o2.stop(t+0.58);
    // Harmonique KITT (3e partielle)
    const o3=_ac.createOscillator(); o3.type='sine'; o3.frequency.value=1840;
    const g3=_ac.createGain(); g3.gain.setValueAtTime(0.02,t); g3.gain.exponentialRampToValueAtTime(0.001,t+0.18);
    o3.connect(g3); g3.connect(_ac.destination); o3.start(t); o3.stop(t+0.19);
  } catch(e){}
}

// â”€â”€ VOIX SYNTHÃˆSE â€” MU-TH-UR / KITT via Web Speech API â”€â”€â”€
const _synth = window.speechSynthesis;
let _voices = [];
let _voiceReady = false;

function _loadVoices() {
  _voices = _synth.getVoices();
  if(_voices.length > 0) _voiceReady = true;
}
_loadVoices();
if(_synth.onvoiceschanged !== undefined) _synth.onvoiceschanged = _loadVoices;

// Trouver la meilleure voix pour la langue donnÃ©e
function _getBestVoice(lang) {
  const map = {
    fr: ['fr-FR','fr-BE','fr'],
    en: ['en-US','en-GB','en'],
    nl: ['nl-NL','nl-BE','nl'],
    de: ['de-DE','de'],
    it: ['it-IT','it'],
    es: ['es-ES','es'],
    pt: ['pt-PT','pt-BR','pt'],
  };
  const prefs = map[lang] || ['en-US'];
  for(const pref of prefs){
    const v = _voices.find(v => v.lang.startsWith(pref));
    if(v) return v;
  }
  return _voices[0] || null;
}

// SynthÃ¨se vocale faÃ§on MU-TH-UR : froide, lente, robotique
function speakMuther(text, lang) {
  try {
    if(!_synth) return;
    _synth.cancel();
    const utt = new SpeechSynthesisUtterance(text);
    const voice = _getBestVoice(lang || LANG);
    if(voice) utt.voice = voice;
    utt.rate = 0.78;   // Lent comme MU-TH-UR
    utt.pitch = 0.72;  // Grave et froid
    utt.volume = 0.88;
    utt.lang = {fr:'fr-FR',en:'en-US',nl:'nl-NL',de:'de-DE',it:'it-IT',es:'es-ES',pt:'pt-PT'}[lang||LANG]||'fr-FR';
    // Bip avant la voix
    sndMutherBeep();
    setTimeout(() => _synth.speak(utt), 140);
  } catch(e){}
}

// Voix rapide pour confirmations courtes
function speakKitt(text, lang) {
  try {
    if(!_synth) return;
    _synth.cancel();
    const utt = new SpeechSynthesisUtterance(text);
    const voice = _getBestVoice(lang || LANG);
    if(voice) utt.voice = voice;
    utt.rate = 0.90;
    utt.pitch = 0.82;
    utt.volume = 0.82;
    utt.lang = {fr:'fr-FR',en:'en-US',nl:'nl-NL',de:'de-DE',it:'it-IT',es:'es-ES',pt:'pt-PT'}[lang||LANG]||'fr-FR';
    _synth.speak(utt);
  } catch(e){}
}

const SPECIAL_CHARS = new Set([...'[]():=|â”€â•â•â•”â•—â•šâ•â•‘â”Œâ”â””â”˜â”œâ”¤â€¢â˜…â˜…']);
let _charCount = 0;

function playChar(ch) {
  if (ch === ' ' || ch === '\n') return;
  _charCount++;
  const r = Math.random();
  if (SPECIAL_CHARS.has(ch)) { sndData(); return; }
  if (_charCount % 47 === 0) { sndGlitch(); return; }
  if (r < 0.03) { sndGlitch(); return; }
  if (r < 0.14) { sndTick();   return; }
  if (r < 0.72) { sndClick();  return; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LANGUE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let LANG = 'fr';

const T = {
  fr: {
    hdr_title:    'KITT FRANCO-BELGE // INTERFACE CENTRALE',
    placeholder:  'entrez une commande...',
    btn_boot:     '[ INITIALISER ]',
    btn_diag:     '[ DIAGNOSTIC ]',
    btn_mentions: '[ MENTIONS ]',
    btn_licence:  '[ LICENCE ]',
    btn_clear:    '[ EFFACER ]',
    btn_tunnel:   '[ CONNEXION KITT ]',
    modal_mentions:'MENTIONS LÃ‰GALES',
    modal_licence: 'LICENCE',
    wait:       'SYSTÃˆME EN ATTENTE â€” TAPEZ "boot" OU CLIQUEZ [ INITIALISER ]',
    help_hint:  'TAPEZ "aide" POUR LA LISTE DES COMMANDES.',
    cleared:    'TERMINAL EFFACÃ‰.',
    unknown:    (c) => `COMMANDE INCONNUE : "${c}". TAPEZ "aide".`,
    online:     'EN LIGNE',
    boot_title: '  KITT FRANCO-BELGE â€” SÃ‰QUENCE DE BOOT   ',
    boot_lines: [
      ['INITIALISATION DU NOYAU SYSTÃˆME...', 'line-warn'],
      ['CHARGEMENT MODULES COGNITIFS...    [OK]', 'line-ok'],
      ['INTERFACE NEURONALE...             [OK]', 'line-ok'],
      ['SYNTHÃˆSE VOCALE (PIPER-GPU)...     [OK]', 'line-ok'],
      ['RECONNAISSANCE VOCALE (WHISPER)... [OK]', 'line-ok'],
      ['MODÃˆLE LLM EMBARQUÃ‰ (QWEN 3B)...  [OK]', 'line-ok'],
      ['MODE HORS-LIGNE...                 [ACTIVÃ‰]', 'line-ok'],
      ['', 'line-ok'],
      ['PROJET FAN NON COMMERCIAL.', 'line-dim'],
      ['STATUT : INTERFACE EN CONSTRUCTION ACTIVE.', 'line-warn'],
      ['', 'line-ok'],
      ['MISES Ã€ JOUR DÃ‰PLOYÃ‰ES RÃ‰GULIÃˆREMENT :', 'line-info'],
      ['  â€¢ parfois chaque jour', 'line-dim'],
      ['  â€¢ parfois chaque semaine', 'line-dim'],
      ['  â€¢ lors de certaines phases, presque heure par heure', 'line-dim'],
      ['', 'line-ok'],
      ['Â© 2026 EMMANUEL GELINNE (MANIX). TOUS DROITS RÃ‰SERVÃ‰S.', 'line-warn'],
    ],
    boot_end:   '  CONNEXION AU NOYAU KITT Ã‰TABLIE.',
    boot_hint:  '  TAPEZ "aide" POUR LA LISTE DES COMMANDES',
    aide_title: 'COMMANDES DISPONIBLES :',
    aide_sys:   'â”€â”€ SYSTÃˆME â”€â”€',
    aide_fun:   'â”€â”€ FUN â”€â”€',
    cmds_sys: [
      ['aide',       'cette liste'],
      ['boot',       "sÃ©quence d'initialisation"],
      ['diagnostic', 'test complet des systÃ¨mes'],
      ['status',     'Ã©tat rapide'],
      ['heure',      'heure actuelle'],
      ['version',    "version de l'interface"],
      ['son',        'dÃ©mo audio'],
      ['clear',      'efface le terminal'],
    ],
    cmds_fun: [
      ['bonjour',    'salutation KITT'],
      ['blague',     'blague KITT alÃ©atoire'],
      ['alien',      'connexion MU-TH-UR 6000'],
      ['matrix',     'le lapin blanc'],
      ['kitt',       'fiche identitÃ© KITT'],
      ['manix',      'dossier conducteur'],
      ['cedric',     'dossier Cedric Momo Rider'],
      ['kr95',       'dossier KR95'],
      ['repliques',  'les rÃ©pliques franco-belges'],
      ['secret',     'fichier classifiÃ©...'],
      ['cafe',       'demander un cafÃ© Ã  KITT'],
      ['belgique',   'analyse gÃ©opolitique'],
      ['jarvis',     'appel vers Stark Tower'],
      ['mario',      'dossier Mario Ravasi / IoT'],
      ['za',         'dossier ZA Elettronica'],
      ['pascal',     'dossier K Industrie'],
      ['daemon',     'dossier Daemon Paule'],
      ['geoffrey',   'dossier Geoffrey'],
      ['covid',      'origine du projet â€” confinement 2020'],
    ],
    hi:  'BONJOUR. JE SUIS KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'SYSTÃˆME FRANCO-BELGE DÃ‰VELOPPÃ‰ PAR MANIX.',
    hi3: 'Ã€ VOTRE SERVICE.',
  },
  en: {
    hdr_title:    'KITT FRANCO-BELGIAN // CENTRAL INTERFACE',
    placeholder:  'enter a command...',
    btn_boot:     '[ INITIALIZE ]',
    btn_diag:     '[ DIAGNOSTIC ]',
    btn_mentions: '[ MENTIONS ]',
    btn_licence:  '[ LICENSE ]',
    btn_clear:    '[ CLEAR ]',
    btn_tunnel:   '[ CONNECT KITT ]',
    modal_mentions:'LEGAL NOTICES',
    modal_licence: 'LICENSE',
    wait:       'SYSTEM STANDBY â€” TYPE "boot" OR CLICK [ INITIALIZE ]',
    help_hint:  'TYPE "help" FOR THE LIST OF COMMANDS.',
    cleared:    'TERMINAL CLEARED.',
    unknown:    (c) => `UNKNOWN COMMAND: "${c}". TYPE "help".`,
    online:     'ONLINE',
    boot_title: '  KITT FRANCO-BELGE â€” BOOT SEQUENCE        ',
    boot_lines: [
      ['INITIALIZING CORE SYSTEM...', 'line-warn'],
      ['LOADING COGNITIVE MODULES...       [OK]', 'line-ok'],
      ['NEURAL INTERFACE...                [OK]', 'line-ok'],
      ['VOICE SYNTHESIS (PIPER-GPU)...     [OK]', 'line-ok'],
      ['VOICE RECOGNITION (WHISPER)...     [OK]', 'line-ok'],
      ['EMBEDDED LLM (QWEN 3B)...          [OK]', 'line-ok'],
      ['OFFLINE MODE...                    [ACTIVE]', 'line-ok'],
      ['', 'line-ok'],
      ['FAN PROJECT â€” NON COMMERCIAL.', 'line-dim'],
      ['STATUS : INTERFACE UNDER ACTIVE CONSTRUCTION.', 'line-warn'],
      ['', 'line-ok'],
      ['UPDATES DEPLOYED REGULARLY :', 'line-info'],
      ['  â€¢ sometimes every day', 'line-dim'],
      ['  â€¢ sometimes every week', 'line-dim'],
      ['  â€¢ during some phases, almost hour by hour', 'line-dim'],
      ['', 'line-ok'],
      ['Â© 2026 EMMANUEL GELINNE (MANIX). ALL RIGHTS RESERVED.', 'line-warn'],
    ],
    boot_end:   '  CONNECTION TO KITT CORE ESTABLISHED.',
    boot_hint:  '  TYPE "help" FOR THE COMMAND LIST',
    aide_title: 'AVAILABLE COMMANDS:',
    aide_sys:   'â”€â”€ SYSTEM â”€â”€',
    aide_fun:   'â”€â”€ FUN â”€â”€',
    cmds_sys: [
      ['help',       'this list'],
      ['boot',       'boot sequence'],
      ['diagnostic', 'full system test'],
      ['status',     'quick status'],
      ['time',       'current time'],
      ['version',    'interface version'],
      ['sound',      'audio demo'],
      ['clear',      'clear terminal'],
    ],
    cmds_fun: [
      ['hello',      'KITT greeting'],
      ['joke',       'random KITT joke'],
      ['alien',      'MU-TH-UR 6000 connection'],
      ['matrix',     'the white rabbit'],
      ['kitt',       'KITT identity file'],
      ['manix',      'driver file'],
      ['cedric',     'Cedric Momo Rider file'],
      ['kr95',       'KR95 file'],
      ['replicas',   'the franco-belgian replicas'],
      ['secret',     'classified file...'],
      ['coffee',     'ask KITT for a coffee'],
      ['belgium',    'geopolitical analysis'],
      ['jarvis',     'call to Stark Tower'],
      ['mario',      'Mario Ravasi / IoT file'],
      ['za',         'ZA Elettronica file'],
      ['pascal',     'K Industrie file'],
      ['daemon',     'Daemon Paule file'],
      ['geoffrey',   'Geoffrey file'],
      ['covid',      'project origin â€” lockdown 2020'],
    ],
    hi:  'HELLO. I AM KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'FRANCO-BELGIAN SYSTEM DEVELOPED BY MANIX.',
    hi3: 'AT YOUR SERVICE.',
  },
  nl: {
    hdr_title:    'KITT FRANCO-BELGISCH // CENTRALE INTERFACE',
    placeholder:  'voer een commando in...',
    btn_boot:     '[ OPSTARTEN ]',
    btn_diag:     '[ DIAGNOSE ]',
    btn_mentions: '[ VERMELDINGEN ]',
    btn_licence:  '[ LICENTIE ]',
    btn_clear:    '[ WISSEN ]',
    btn_tunnel:   '[ VERBIND KITT ]',
    modal_mentions:'WETTELIJKE VERMELDINGEN',
    modal_licence: 'LICENTIE',
    wait:       'SYSTEEM WACHT â€” TYP "boot" OF KLIK [ OPSTARTEN ]',
    help_hint:  'TYP "hulp" VOOR DE COMMANDOLIJST.',
    cleared:    'TERMINAL GEWIST.',
    unknown:    (c) => `ONBEKEND COMMANDO: "${c}". TYP "hulp".`,
    online:     'ONLINE',
    boot_title: '  KITT FRANCO-BELGE â€” OPSTARTSEQUENTIE     ',
    boot_lines: [
      ['KERNSYSTEEM INITIALISEREN...', 'line-warn'],
      ['COGNITIEVE MODULES LADEN...        [OK]', 'line-ok'],
      ['NEURALE INTERFACE...               [OK]', 'line-ok'],
      ['SPRAAKSYNTHESE (PIPER-GPU)...      [OK]', 'line-ok'],
      ['STEMHERKENNING (WHISPER)...        [OK]', 'line-ok'],
      ['EMBEDDED LLM (QWEN 3B)...          [OK]', 'line-ok'],
      ['OFFLINE MODUS...                   [ACTIEF]', 'line-ok'],
      ['', 'line-ok'],
      ['FAN PROJECT â€” NIET COMMERCIEEL.', 'line-dim'],
      ['STATUS : INTERFACE IN ACTIEVE CONSTRUCTIE.', 'line-warn'],
      ['', 'line-ok'],
      ['UPDATES REGELMATIG UITGEROLD :', 'line-info'],
      ['  â€¢ soms elke dag', 'line-dim'],
      ['  â€¢ soms elke week', 'line-dim'],
      ['  â€¢ soms elk uur', 'line-dim'],
      ['', 'line-ok'],
      ['Â© 2026 EMMANUEL GELINNE (MANIX). ALLE RECHTEN VOORBEHOUDEN.', 'line-warn'],
    ],
    boot_end:   '  VERBINDING MET KITT-KERN TOT STAND GEBRACHT.',
    boot_hint:  '  TYP "hulp" VOOR DE COMMANDOLIJST',
    aide_title: 'BESCHIKBARE COMMANDO\'S:',
    aide_sys:   'â”€â”€ SYSTEEM â”€â”€',
    aide_fun:   'â”€â”€ PLEZIER â”€â”€',
    cmds_sys: [
      ['hulp','deze lijst'],['boot','opstartsequentie'],['diagnostic','volledig systeemtest'],
      ['status','snelle status'],['tijd','huidige tijd'],['versie','interface versie'],
      ['geluid','audio demo'],['clear','terminal wissen'],
    ],
    cmds_fun: [
      ['hallo','KITT begroeting'],['grap','willekeurige KITT grap'],['alien','MU-TH-UR 6000 verbinding'],
      ['matrix','het witte konijn'],['kitt','KITT identiteitsbestand'],['manix','bestuurdersdossier'],
      ['cedric','Cedric Momo Rider dossier'],['kr95','KR95 dossier'],['replicas','de franco-belgische replica\'s'],
      ['geheim','geheim bestand...'],['koffie','KITT om koffie vragen'],['belgie','geopolitieke analyse'],
      ['jarvis','oproep naar Stark Tower'],['mario','Mario Ravasi / IoT dossier'],['za','ZA Elettronica dossier'],
      ['pascal','K Industrie dossier'],['daemon','Daemon Paule dossier'],['geoffrey','Geoffrey dossier'],
      ['covid','projectoorsprong â€” lockdown 2020'],
    ],
    hi:'HALLO. IK BEN KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2:'FRANCO-BELGISCH SYSTEEM ONTWIKKELD DOOR MANIX.',
    hi3:'TOT UW DIENST.',
  },
  it: {
    hdr_title:'KITT FRANCO-BELGA // INTERFACCIA CENTRALE',placeholder:'inserisci un comando...',
    btn_boot:'[ INIZIALIZZA ]',btn_diag:'[ DIAGNOSI ]',btn_mentions:'[ MENZIONI ]',
    btn_licence:'[ LICENZA ]',btn_clear:'[ CANCELLA ]',btn_tunnel:'[ CONNETTI KITT ]',
    modal_mentions:'NOTE LEGALI',modal_licence:'LICENZA',
    wait:'SISTEMA IN ATTESA â€” DIGITA "boot" O CLICCA [ INIZIALIZZA ]',
    help_hint:'DIGITA "aiuto" PER LA LISTA DEI COMANDI.',
    cleared:'TERMINALE CANCELLATO.',unknown:(c)=>`COMANDO SCONOSCIUTO: "${c}". DIGITA "aiuto".`,
    online:'IN LINEA',boot_title:'  KITT FRANCO-BELGA â€” SEQUENZA DI AVVIO     ',
    boot_lines:[
      ['INIZIALIZZAZIONE SISTEMA...','line-warn'],['CARICAMENTO MODULI COGNITIVI...    [OK]','line-ok'],
      ['INTERFACCIA NEURALE...             [OK]','line-ok'],['SINTESI VOCALE (PIPER-GPU)...      [OK]','line-ok'],
      ['RICONOSCIMENTO VOCALE (WHISPER)... [OK]','line-ok'],['MODELLO LLM LOCALE (QWEN 3B)...   [OK]','line-ok'],
      ['MODALITÃ€ OFFLINE...                [ATTIVA]','line-ok'],['','line-ok'],
      ['PROGETTO FAN â€” NON COMMERCIALE.','line-dim'],['STATO : INTERFACCIA IN COSTRUZIONE ATTIVA.','line-warn'],
      ['','line-ok'],['AGGIORNAMENTI DISTRIBUITI REGOLARMENTE :','line-info'],
      ['  â€¢ a volte ogni giorno','line-dim'],['  â€¢ a volte ogni settimana','line-dim'],
      ['  â€¢ in alcune fasi, quasi ogni ora','line-dim'],['','line-ok'],
      ['Â© 2026 EMMANUEL GELINNE (MANIX). TUTTI I DIRITTI RISERVATI.','line-warn'],
    ],
    boot_end:'  CONNESSIONE AL NUCLEO KITT STABILITA.',boot_hint:'  DIGITA "aiuto" PER LA LISTA DEI COMANDI',
    aide_title:'COMANDI DISPONIBILI:',aide_sys:'â”€â”€ SISTEMA â”€â”€',aide_fun:'â”€â”€ DIVERTIMENTO â”€â”€',
    cmds_sys:[['aiuto','questa lista'],['boot','sequenza di avvio'],['diagnostic','test completo del sistema'],
      ['status','stato rapido'],['ora','ora corrente'],['version','versione interfaccia'],['suono','demo audio'],['clear','cancella terminale']],
    cmds_fun:[['ciao','saluto KITT'],['barzelletta','barzelletta casuale KITT'],['alien','connessione MU-TH-UR 6000'],
      ['matrix','il coniglio bianco'],['kitt','scheda identitÃ  KITT'],['manix','dossier pilota'],
      ['cedric','dossier Cedric Momo Rider'],['kr95','dossier KR95'],['replicas','le repliche franco-belghe'],
      ['segreto','file classificato...'],['caffe','chiedere un caffÃ¨ a KITT'],['belgio','analisi geopolitica'],
      ['jarvis','chiamata verso Stark Tower'],['mario','dossier Mario Ravasi / IoT'],['za','dossier ZA Elettronica'],
      ['pascal','dossier K Industrie'],['daemon','dossier Daemon Paule'],['geoffrey','dossier Geoffrey'],
      ['covid','origine del progetto â€” lockdown 2020']],
    hi:'CIAO. SONO KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2:'SISTEMA FRANCO-BELGA SVILUPPATO DA MANIX.',hi3:'AL VOSTRO SERVIZIO.',
  },
  de: {
    hdr_title:'KITT FRANCO-BELGISCH // ZENTRALE SCHNITTSTELLE',placeholder:'Befehl eingeben...',
    btn_boot:'[ INITIALISIEREN ]',btn_diag:'[ DIAGNOSE ]',btn_mentions:'[ IMPRESSUM ]',
    btn_licence:'[ LIZENZ ]',btn_clear:'[ LÃ–SCHEN ]',btn_tunnel:'[ KITT VERBINDEN ]',
    modal_mentions:'IMPRESSUM',modal_licence:'LIZENZ',
    wait:'SYSTEM BEREIT â€” TIPPE "boot" ODER KLICKE [ INITIALISIEREN ]',
    help_hint:'TIPPE "hilfe" FÃœR DIE BEFEHLSLISTE.',
    cleared:'TERMINAL GELEERT.',unknown:(c)=>`UNBEKANNTER BEFEHL: "${c}". TIPPE "hilfe".`,
    online:'ONLINE',boot_title:'  KITT FRANCO-BELGISCH â€” STARTSEQUENZ        ',
    boot_lines:[
      ['KERNSYSTEM WIRD INITIALISIERT...','line-warn'],['KOGNITIVE MODULE LADEN...          [OK]','line-ok'],
      ['NEURONALE SCHNITTSTELLE...         [OK]','line-ok'],['SPRACHSYNTHESE (PIPER-GPU)...      [OK]','line-ok'],
      ['SPRACHERKENNUNG (WHISPER)...       [OK]','line-ok'],['LOKALES LLM (QWEN 3B)...           [OK]','line-ok'],
      ['OFFLINE-MODUS...                   [AKTIV]','line-ok'],['','line-ok'],
      ['FAN-PROJEKT â€” NICHT KOMMERZIELL.','line-dim'],['STATUS : SCHNITTSTELLE IM AUFBAU.','line-warn'],
      ['','line-ok'],['UPDATES REGELMÃ„SSIG VERFÃœGBAR :','line-info'],
      ['  â€¢ manchmal tÃ¤glich','line-dim'],['  â€¢ manchmal wÃ¶chentlich','line-dim'],['  â€¢ manchmal stÃ¼ndlich','line-dim'],
      ['','line-ok'],['Â© 2026 EMMANUEL GELINNE (MANIX). ALLE RECHTE VORBEHALTEN.','line-warn'],
    ],
    boot_end:'  VERBINDUNG ZUM KITT-KERN HERGESTELLT.',boot_hint:'  TIPPE "hilfe" FÃœR DIE BEFEHLSLISTE',
    aide_title:'VERFÃœGBARE BEFEHLE:',aide_sys:'â”€â”€ SYSTEM â”€â”€',aide_fun:'â”€â”€ SPASS â”€â”€',
    cmds_sys:[['hilfe','diese Liste'],['boot','Startsequenz'],['diagnostic','vollstÃ¤ndiger Systemtest'],
      ['status','schneller Status'],['uhrzeit','aktuelle Uhrzeit'],['version','Schnittstellenversion'],['ton','Audio-Demo'],['clear','Terminal leeren']],
    cmds_fun:[['hallo','KITT-BegrÃ¼ÃŸung'],['witz','zufÃ¤lliger KITT-Witz'],['alien','MU-TH-UR 6000 Verbindung'],
      ['matrix','das weiÃŸe Kaninchen'],['kitt','KITT IdentitÃ¤tsakte'],['manix','Fahrerakte'],
      ['cedric','Cedric Momo Rider Akte'],['kr95','KR95 Akte'],['replicas','die franco-belgischen Repliken'],
      ['geheimnis','geheime Akte...'],['kaffee','KITT um Kaffee bitten'],['belgien','geopolitische Analyse'],
      ['jarvis','Anruf bei Stark Tower'],['mario','Mario Ravasi / IoT Akte'],['za','ZA Elettronica Akte'],
      ['pascal','K Industrie Akte'],['damon','Damon Paule Akte'],['geoffrey','Geoffrey Akte'],
      ['covid','Projektherkunft â€” Lockdown 2020']],
    hi:'HALLO. ICH BIN KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2:'FRANCO-BELGISCHES SYSTEM ENTWICKELT VON MANIX.',hi3:'ZU IHREN DIENSTEN.',
  },
  es: {
    hdr_title:'KITT FRANCO-BELGA // INTERFAZ CENTRAL',placeholder:'escribe un comando...',
    btn_boot:'[ INICIALIZAR ]',btn_diag:'[ DIAGNÃ“STICO ]',btn_mentions:'[ MENCIONES ]',
    btn_licence:'[ LICENCIA ]',btn_clear:'[ BORRAR ]',btn_tunnel:'[ CONECTAR KITT ]',
    modal_mentions:'AVISOS LEGALES',modal_licence:'LICENCIA',
    wait:'SISTEMA EN ESPERA â€” ESCRIBE "boot" O HAZ CLIC EN [ INICIALIZAR ]',
    help_hint:'ESCRIBE "ayuda" PARA VER LOS COMANDOS.',
    cleared:'TERMINAL BORRADO.',unknown:(c)=>`COMANDO DESCONOCIDO: "${c}". ESCRIBE "ayuda".`,
    online:'EN LÃNEA',boot_title:'  KITT FRANCO-BELGA â€” SECUENCIA DE INICIO   ',
    boot_lines:[
      ['INICIALIZANDO SISTEMA...','line-warn'],['CARGANDO MÃ“DULOS COGNITIVOS...     [OK]','line-ok'],
      ['INTERFAZ NEURONAL...               [OK]','line-ok'],['SÃNTESIS DE VOZ (PIPER-GPU)...     [OK]','line-ok'],
      ['RECONOCIMIENTO DE VOZ (WHISPER)... [OK]','line-ok'],['MODELO LLM LOCAL (QWEN 3B)...      [OK]','line-ok'],
      ['MODO SIN CONEXIÃ“N...               [ACTIVO]','line-ok'],['','line-ok'],
      ['PROYECTO FAN â€” NO COMERCIAL.','line-dim'],['ESTADO : INTERFAZ EN CONSTRUCCIÃ“N ACTIVA.','line-warn'],
      ['','line-ok'],['ACTUALIZACIONES PUBLICADAS REGULARMENTE :','line-info'],
      ['  â€¢ a veces cada dÃ­a','line-dim'],['  â€¢ a veces cada semana','line-dim'],['  â€¢ a veces cada hora','line-dim'],
      ['','line-ok'],['Â© 2026 EMMANUEL GELINNE (MANIX). TODOS LOS DERECHOS RESERVADOS.','line-warn'],
    ],
    boot_end:'  CONEXIÃ“N AL NÃšCLEO KITT ESTABLECIDA.',boot_hint:'  ESCRIBE "ayuda" PARA VER LOS COMANDOS',
    aide_title:'COMANDOS DISPONIBLES:',aide_sys:'â”€â”€ SISTEMA â”€â”€',aide_fun:'â”€â”€ DIVERSIÃ“N â”€â”€',
    cmds_sys:[['ayuda','esta lista'],['boot','secuencia de inicio'],['diagnostic','prueba completa del sistema'],
      ['status','estado rÃ¡pido'],['hora','hora actual'],['version','versiÃ³n de la interfaz'],['sonido','demo de audio'],['clear','borrar terminal']],
    cmds_fun:[['hola','saludo KITT'],['chiste','chiste aleatorio KITT'],['alien','conexiÃ³n MU-TH-UR 6000'],
      ['matrix','el conejo blanco'],['kitt','ficha de identidad KITT'],['manix','expediente del conductor'],
      ['cedric','expediente Cedric Momo Rider'],['kr95','expediente KR95'],['replicas','las rÃ©plicas franco-belgas'],
      ['secreto','archivo clasificado...'],['cafe','pedir cafÃ© a KITT'],['belgica','anÃ¡lisis geopolÃ­tico'],
      ['jarvis','llamada a Stark Tower'],['mario','expediente Mario Ravasi / IoT'],['za','expediente ZA Elettronica'],
      ['pascal','expediente K Industrie'],['damon','expediente Damon Paule'],['geoffrey','expediente Geoffrey'],
      ['covid','origen del proyecto â€” confinamiento 2020']],
    hi:'HOLA. SOY KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2:'SISTEMA FRANCO-BELGA DESARROLLADO POR MANIX.',hi3:'A SU SERVICIO.',
  },
  pt: {
    hdr_title:'KITT FRANCO-BELGA // INTERFACE CENTRAL',placeholder:'introduz um comando...',
    btn_boot:'[ INICIALIZAR ]',btn_diag:'[ DIAGNÃ“STICO ]',btn_mentions:'[ MENÃ‡Ã•ES ]',
    btn_licence:'[ LICENÃ‡A ]',btn_clear:'[ LIMPAR ]',btn_tunnel:'[ LIGAR KITT ]',
    modal_mentions:'AVISOS LEGAIS',modal_licence:'LICENÃ‡A',
    wait:'SISTEMA EM ESPERA â€” DIGITE "boot" OU CLIQUE EM [ INICIALIZAR ]',
    help_hint:'DIGITE "ajuda" PARA VER OS COMANDOS.',
    cleared:'TERMINAL LIMPO.',unknown:(c)=>`COMANDO DESCONHECIDO: "${c}". DIGITE "ajuda".`,
    online:'EM LINHA',boot_title:'  KITT FRANCO-BELGA â€” SEQUÃŠNCIA DE ARRANQUE  ',
    boot_lines:[
      ['A INICIALIZAR O SISTEMA...','line-warn'],['A CARREGAR MÃ“DULOS COGNITIVOS...   [OK]','line-ok'],
      ['INTERFACE NEURONAL...              [OK]','line-ok'],['SÃNTESE DE VOZ (PIPER-GPU)...      [OK]','line-ok'],
      ['RECONHECIMENTO DE VOZ (WHISPER)... [OK]','line-ok'],['MODELO LLM LOCAL (QWEN 3B)...      [OK]','line-ok'],
      ['MODO OFFLINE...                    [ATIVO]','line-ok'],['','line-ok'],
      ['PROJETO FÃƒ â€” NÃƒO COMERCIAL.','line-dim'],['ESTADO : INTERFACE EM CONSTRUÃ‡ÃƒO ATIVA.','line-warn'],
      ['','line-ok'],['ATUALIZAÃ‡Ã•ES PUBLICADAS REGULARMENTE :','line-info'],
      ['  â€¢ Ã s vezes todos os dias','line-dim'],['  â€¢ Ã s vezes semanalmente','line-dim'],['  â€¢ Ã s vezes de hora em hora','line-dim'],
      ['','line-ok'],['Â© 2026 EMMANUEL GELINNE (MANIX). TODOS OS DIREITOS RESERVADOS.','line-warn'],
    ],
    boot_end:'  LIGAÃ‡ÃƒO AO NÃšCLEO KITT ESTABELECIDA.',boot_hint:'  DIGITE "ajuda" PARA VER OS COMANDOS',
    aide_title:'COMANDOS DISPONÃVEIS:',aide_sys:'â”€â”€ SISTEMA â”€â”€',aide_fun:'â”€â”€ DIVERSÃƒO â”€â”€',
    cmds_sys:[['ajuda','esta lista'],['boot','sequÃªncia de arranque'],['diagnostic','teste completo do sistema'],
      ['status','estado rÃ¡pido'],['hora','hora atual'],['version','versÃ£o da interface'],['som','demonstraÃ§Ã£o de Ã¡udio'],['clear','limpar terminal']],
    cmds_fun:[['ola','saudaÃ§Ã£o KITT'],['piada','piada aleatÃ³ria KITT'],['alien','ligaÃ§Ã£o MU-TH-UR 6000'],
      ['matrix','o coelho branco'],['kitt','ficha de identidade KITT'],['manix','dossier do condutor'],
      ['cedric','dossier Cedric Momo Rider'],['kr95','dossier KR95'],['replicas','as rÃ©plicas franco-belgas'],
      ['segredo','ficheiro classificado...'],['cafe','pedir cafÃ© ao KITT'],['belgica','anÃ¡lise geopolÃ­tica'],
      ['jarvis','chamada para Stark Tower'],['mario','dossier Mario Ravasi / IoT'],['za','dossier ZA Elettronica'],
      ['pascal','dossier K Industrie'],['damon','dossier Damon Paule'],['geoffrey','dossier Geoffrey'],
      ['covid','origem do projeto â€” confinamento 2020']],
    hi:'OLÃ. SOU O KITT â€” KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2:'SISTEMA FRANCO-BELGA DESENVOLVIDO POR MANIX.',hi3:'AO SEU SERVIÃ‡O.',
  },
};

const CMD_ALIASES = {
  help:'aide', sound:'son', hello:'bonjour', joke:'blague',
  time:'heure', coffee:'cafe', belgium:'belgique', replicas:'repliques',
  secret:'secret', version:'version', clear:'clear', status:'status',
  diagnostic:'diagnostic', boot:'boot', alien:'alien', matrix:'matrix',
  kitt:'kitt', manix:'manix', cedric:'cedric', kr95:'kr95',
  jarvis:'jarvis', mario:'mario', za:'za', pascal:'pascal', geoffrey:'geoffrey',
  hulp:'aide', geluid:'son', hallo:'bonjour', grap:'blague',
  tijd:'heure', versie:'version', koffie:'cafe', belgie:'belgique',
  geheim:'secret', klik:'boot',
  aiuto:'aide', suono:'son', ciao:'bonjour', barzelletta:'blague',
  ora:'heure', caffe:'cafe', belgio:'belgique', segreto:'secret',
  hilfe:'aide', ton:'son', witz:'blague', uhrzeit:'heure',
  kaffee:'cafe', belgien:'belgique', geheimnis:'secret',
  ravasi:'mario', roadthunder:'mario',
  zagny:'za', zagni:'za', 'za-elettronica':'za', zaelettronica:'za',
  damon:'damon', daemon:'damon',
  ayuda:'aide', sonido:'son', hola:'bonjour', chiste:'blague',
  hora:'heure', belgica:'belgique', secreto:'secret',
  ajuda:'aide', som:'son', ola:'bonjour', piada:'blague',
  segredo:'secret',
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LANGUE â€” Ã©cran sÃ©lection
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LANG_LIST = [
  ['1','fr','FRANÃ‡AIS','FranÃ§ais','ğŸ‡«ğŸ‡·','Bonjour, je suis KITT. SystÃ¨me franco-belge activÃ©.'],
  ['2','en','ENGLISH','English','ğŸ‡¬ğŸ‡§','Hello, I am KITT. Knight Industries Two Thousand, online.'],
  ['3','nl','NEDERLANDS','Nederlands','ğŸ‡§ğŸ‡ª','Hallo, ik ben KITT. Systeem geactiveerd.'],
  ['4','it','ITALIANO','Italiano','ğŸ‡®ğŸ‡¹','Ciao, sono KITT. Sistema attivato.'],
  ['5','de','DEUTSCH','Deutsch','ğŸ‡©ğŸ‡ª','Hallo, ich bin KITT. System aktiviert.'],
  ['6','es','ESPAÃ‘OL','EspaÃ±ol','ğŸ‡ªğŸ‡¸','Hola, soy KITT. Sistema activado.'],
  ['7','pt','PORTUGUÃŠS','PortuguÃªs','ğŸ‡µğŸ‡¹','OlÃ¡, eu sou o KITT. Sistema ativado.'],
];

let _langVoiceEnabled = true;
window.toggleLangVoice = function() {
  _langVoiceEnabled = !_langVoiceEnabled;
  const btn = document.getElementById('lang-voice-toggle');
  if(btn) btn.textContent = _langVoiceEnabled ? 'ğŸ”Š VOIX' : 'ğŸ”‡ VOIX';
  sndClick();
};
window._previewLangVoice = function(code, phrase) {
  if(!_langVoiceEnabled) return;
  _resume();
  sndMutherBeep();
  setTimeout(()=>speakMuther(phrase, code), 200);
};

async function showLangScreen() {
  _resume();
  const screen = document.getElementById('lang-screen');
  screen.style.display = 'flex';
  screen.style.opacity  = '1';

  document.getElementById('lang-sys-id').textContent = '';
  document.getElementById('lang-sub').textContent = '';
  document.getElementById('lang-output').innerHTML = '';
  document.getElementById('lang-ftr-txt').textContent = '';

  // Lancer ambiance Nostromo
  startAlienAmbient();

  // Bip alien initial
  await _langDelay(300);
  sndAlienAlert();
  await _langDelay(280);

  // Titre systÃ¨me
  const sysId = document.getElementById('lang-sys-id');
  await _langType(sysId, 'MU-TH-UR 6000  Ã—  KITT  //  PROTOCOL v3.1');
  await _langDelay(90);

  const sub = document.getElementById('lang-sub');
  await _langType(sub, 'SELECT INTERFACE LANGUAGE â€” CHOISISSEZ VOTRE LANGUE');
  await _langDelay(70);

  const out = document.getElementById('lang-output');
  for (const [num, code, label, native, flag, phrase] of LANG_LIST) {
    const row = document.createElement('div');
    row.className = 'lang-opt';
    row.dataset.code = code;
    row.innerHTML = `
      <span class="lo-n">${num}</span>
      <span class="lo-flag">${flag}</span>
      <div class="lo-text">
        <span class="lo-label">${label}</span>
        <span class="lo-native">${native}</span>
      </div>
      <button class="lo-voice-btn" onclick="event.stopPropagation();_previewLangVoice('${code}','${phrase}')">Ã‰COUTER</button>
    `;
    row.addEventListener('click', () => selectLang(code));
    row.addEventListener('mouseenter', () => { sndTick(); });
    out.appendChild(row);
    sndClick();
    await _langDelay(58);
  }

  await _langDelay(90);
  const ftrTxt = document.getElementById('lang-ftr-txt');
  await _langType(ftrTxt, '[ 1â€“7 ] ou cliquez â€” â–¶ pour entendre la voix');
  const cur = document.createElement('span');
  cur.className = 'cursor'; cur.style.marginLeft = '4px';
  ftrTxt.after(cur);
}

function _langType(el, txt) {
  return new Promise(resolve => {
    let i = 0;
    function t() {
      if (i < txt.length) {
        el.textContent += txt[i++];
        if (Math.random() > 0.3) sndClick();
        setTimeout(t, 10 + Math.random() * 6);
      } else { sndLineEnd(); resolve(); }
    }
    t();
  });
}
function _langDelay(ms) { return new Promise(r => setTimeout(r, ms)); }

function selectLang(lang) {
  LANG = lang;
  const t = T[lang];
  document.getElementById('lang-flag').textContent = lang.toUpperCase();
  document.getElementById('status-txt').textContent = t.online;
  document.getElementById('hdr-title').textContent  = t.hdr_title;
  document.getElementById('cmd-input').placeholder  = t.placeholder;
  document.getElementById('btn-boot').textContent    = t.btn_boot;
  document.getElementById('btn-diag').textContent    = t.btn_diag;
  document.getElementById('btn-mentions').textContent= t.btn_mentions;
  document.getElementById('btn-licence').textContent = t.btn_licence;
  document.getElementById('btn-clear').textContent   = t.btn_clear;
  document.getElementById('btn-tunnel-txt').textContent = t.btn_tunnel;
  sndSelect();

  // Voix de bienvenue dans la langue choisie
  const greet = LANG_LIST.find(l=>l[1]===lang);
  if(greet && _langVoiceEnabled) {
    setTimeout(()=>speakMuther(greet[5], lang), 400);
  }

  // ArrÃªter l'ambiance Nostromo progressivement
  stopAlienAmbient();

  const screen = document.getElementById('lang-screen');
  screen.style.transition = 'opacity .45s';
  screen.style.opacity = '0';
  setTimeout(() => { screen.style.display = 'none'; screen.style.opacity = '1'; screen.style.transition = ''; }, 500);
  setTimeout(() => startMain(), 580);
}

document.addEventListener('keydown', e => {
  if (document.getElementById('lang-screen').style.display !== 'none') {
    const langMap = {'1':'fr','2':'en','3':'nl','4':'it','5':'de','6':'es','7':'pt'};
    if (langMap[e.key]) selectLang(langMap[e.key]);
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TERMINAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const term = document.getElementById('terminal');
let typing = false;

function addLine(text, cls='line-ok') {
  const d = document.createElement('div');
  d.className = cls; d.textContent = text;
  term.appendChild(d); term.scrollTop = term.scrollHeight;
}

function typeText(text, speed=16, cls='line-ok') {
  return new Promise(resolve => {
    typing = true;
    const div = document.createElement('div'); div.className = cls;
    const cur = document.createElement('span'); cur.className = 'cursor';
    div.appendChild(cur); term.appendChild(div); term.scrollTop = term.scrollHeight;
    let i = 0;
    function tick() {
      if (i < text.length) {
        const ch = text[i++];
        div.insertBefore(document.createTextNode(ch), cur);
        playChar(ch);
        term.scrollTop = term.scrollHeight;
        setTimeout(tick, speed + Math.random() * 7);
      } else {
        cur.remove();
        if (text.length > 0) sndLineEnd();
        typing = false; resolve();
      }
    }
    tick();
  });
}

function clearTerm() { term.innerHTML=''; addLine(T[LANG].cleared,'line-dim'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BOOT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function boot() {
  if (typing) return;
  term.innerHTML=''; kittChime();
  const l = T[LANG];
  const sep = 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•';
  await typeText(sep, 6, 'line-dim');
  await typeText(l.boot_title, 14, 'line-err');
  await typeText(sep, 6, 'line-dim');
  for (const [txt, cls] of l.boot_lines) {
    await typeText(txt, txt===''?0:12, cls);
    if (txt==='') await delay(60);
  }
  await typeText(sep, 6, 'line-dim');
  await typeText(l.boot_end, 14, 'line-err');
  await typeText(l.boot_hint, 10, 'line-dim');
  await typeText(sep, 6, 'line-dim');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DIAGNOSTIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function runSelfTest() {
  if (typing) return;
  term.innerHTML=''; kittChime();
  const diagMsg = {fr:'DIAGNOSTIC SYSTÃˆME EN COURS...',en:'RUNNING SYSTEM DIAGNOSTIC...',nl:'SYSTEEMDIAGNOSE BEZIG...',it:'DIAGNOSI SISTEMA IN CORSO...',de:'SYSTEMDIAGNOSE LÃ„UFT...',es:'DIAGNÃ“STICO DEL SISTEMA EN CURSO...',pt:'DIAGNÃ“STICO DO SISTEMA EM CURSO...'}[LANG]||'DIAGNOSTIC SYSTÃˆME EN COURS...';
  await typeText(diagMsg, 18, 'line-warn');
  await delay(300);
  const checks = [
    ['CPU JETSON ORIN NANO SUPER',  true,  '12Ã— ARM A78AE'],
    ['GPU AMPERE CUDA',             true,  '1024 CUDA cores'],
    ['RAM UNIFIÃ‰E / UNIFIED RAM',   true,  '8 GB LPDDR5'],
    ['VRAM DISPONIBLE / FREE',      true,  '~4.1 GB'],
    ['LLM (QWEN 2.5 3B Q5)',        true,  '2.3 GB â€” port 8080'],
    ['STT WHISPER BASE',            true,  'GPU float16 â€” 350ms'],
    ['TTS PIPER TOM-MEDIUM',        true,  'GPU â€” 490ms'],
    ['PULSEAUDIO / USB AUDIO',      true,  'card 1 â€” paplay OK'],
    ['YOLOV8 VISION',               true,  'daemon CUDA actif'],
    ['BLUETOOTH hci0',              true,  '58:02:05:DD:C2:F2'],
    ['CAMERA /dev/video0',          true,  'V4L2 â€” 640Ã—480'],
    ['KYRONEX HTTPS SERVER',        true,  'port 3000 â€” aiohttp'],
    ['RESEAU LAN / NETWORK',        true,  '192.168.1.4'],
  ];
  for (const [name, ok, detail] of checks) {
    const st  = ok ? '[ OK ]' : '[FAIL]';
    const cls = ok ? 'line-ok' : 'line-err';
    const pad = ' '.repeat(Math.max(1, 30-name.length));
    await typeText(`${name}${pad}${st}  ${detail}`, 7, cls);
  }
  await delay(200);
  await typeText('', 0);
  const ok_msg = {fr:'RÃ‰SULTAT : TOUS SYSTÃˆMES NOMINAUX.',en:'RESULT: ALL SYSTEMS NOMINAL.',nl:'RESULTAAT : ALLE SYSTEMEN NOMINAAL.',it:'RISULTATO : TUTTI I SISTEMI NOMINALI.',de:'ERGEBNIS: ALLE SYSTEME NOMINAL.',es:'RESULTADO: TODOS LOS SISTEMAS NOMINALES.',pt:'RESULTADO: TODOS OS SISTEMAS NOMINAIS.'}[LANG]||'RÃ‰SULTAT : TOUS SYSTÃˆMES NOMINAUX.';
  const op_msg = {fr:'KITT EST OPÃ‰RATIONNEL.',en:'KITT IS OPERATIONAL.',nl:'KITT IS OPERATIONEEL.',it:'KITT Ãˆ OPERATIVO.',de:'KITT IST BETRIEBSBEREIT.',es:'KITT ESTÃ OPERATIVO.',pt:'KITT ESTÃ OPERACIONAL.'}[LANG]||'KITT EST OPÃ‰RATIONNEL.';
  await typeText(ok_msg, 16, 'line-info');
  await typeText(op_msg, 16, 'line-err');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMMANDES FUN â€” INTOUCHÃ‰ES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CMDS = {
  aide: async () => {
    const l = T[LANG];
    await typeText(l.aide_title, 10, 'line-info');
    await typeText(`  ${l.aide_sys}`, 4, 'line-warn');
    for (const [cmd, desc] of l.cmds_sys) {
      const pad = ' '.repeat(Math.max(1, 12-cmd.length));
      await typeText(`    ${cmd}${pad}â€” ${desc}`, 3, 'line-dim');
    }
    await typeText(`  ${l.aide_fun}`, 4, 'line-warn');
    for (const [cmd, desc] of l.cmds_fun) {
      const pad = ' '.repeat(Math.max(1, 12-cmd.length));
      await typeText(`    ${cmd}${pad}â€” ${desc}`, 3, 'line-dim');
    }
  },
  bonjour: async () => {
    kittChime();
    const l = T[LANG];
    await typeText(l.hi,  16, 'line-err');
    await typeText(l.hi2, 14, 'line-ok');
    await typeText(l.hi3, 14, 'line-dim');
    if(_langVoiceEnabled) speakKitt(l.hi + ' ' + l.hi2, LANG);
  },
  boot:       async () => boot(),
  diagnostic: async () => runSelfTest(),
  status: async () => {
    kittChime();
    const now = new Date(), loc = getLoc();
    await typeText(`HEURE / TIME   : ${now.toLocaleTimeString(loc)}`, 10, 'line-ok');
    await typeText(`DATE           : ${now.toLocaleDateString(loc,{weekday:'long',day:'numeric',month:'long',year:'numeric'})}`, 10, 'line-ok');
    await typeText('VRAM           : ~3.9 GB / 8 GB', 10, 'line-ok');
    await typeText('STATUT / STATUS: NOMINAL', 10, 'line-info');
  },
  heure: async () => {
    const now = new Date(), loc = getLoc();
    const pfx = {fr:'IL EST',en:'IT IS',nl:'HET IS',it:'SONO LE',de:'ES IST',es:'SON LAS',pt:'SÃƒO'}[LANG]||'IL EST';
    await typeText(`${pfx} ${now.toLocaleTimeString(loc)}.`, 14, 'line-info');
  },
  version: async () => {
    await typeText('KITT FRANCO-BELGE â€” INTERFACE v3.0', 12, 'line-err');
    await typeText('BUILD 2026-02-20 â€” KYRONEX TECHNOLOGY', 12, 'line-dim');
    await typeText('ORIGINE : PROJET COVID-19 â€” CONFINEMENT 2020', 12, 'line-warn');
    await typeText('Â© EMMANUEL GELINNE (MANIX) â€” TOUS DROITS RÃ‰SERVÃ‰S', 12, 'line-dim');
  },
  clear: async () => clearTerm(),
  son: async () => {
    kittChime(); await delay(400);
    const demos = [
      [sndClick,  'MU-TH-UR CLICK    (principal)'],
      [sndTick,   'TICK LÃ‰GER        (haute frÃ©q)'],
      [sndData,   'IMPULSION DATA    (caract. spÃ©ciaux)'],
      [sndGlitch, 'GLITCH NUMÃ‰RIQUE  (rare)'],
      [sndLineEnd,'FIN DE LIGNE      (souffle)'],
      [sndSelect, 'SÃ‰LECTION         (confirmation)'],
      [sndError,  'ERREUR            (buzzer)'],
    ];
    await typeText('â”€â”€â”€ DÃ‰MONSTRATION DES SONS â”€â”€â”€', 10, 'line-info');
    for (const [fn, name] of demos) {
      fn();
      await typeText(`  ${name}`, 8, 'line-dim');
      await delay(250);
    }
    await typeText('FIN DE LA DÃ‰MONSTRATION.', 12, 'line-ok');
  },
  blague: async () => {
    const pool = [
      ['Pourquoi KITT ne sort jamais la nuit ?','Parce qu\'il a peur du mode sombre.'],
      ['Combien faut-il d\'IA pour changer une ampoule ?','Aucune. L\'ampoule n\'Ã©tait pas dans mes paramÃ¨tres.'],
      ['KITT, tu es intelligent ?','Je suis une IA sur Jetson. OBLIGATOIREMENT intelligent. Contrairement Ã  certains conducteurs.'],
      ['Quelle est la boisson prÃ©fÃ©rÃ©e de KITT ?','Le JAVA. Et uniquement du Python sans cafÃ©ine.'],
      ['Pourquoi Manix parle Ã  son ordinateur ?','Parce que l\'ordinateur, lui, rÃ©pond correctement.'],
      ['Manix a-t-il dormi cette nuit ?','DonnÃ©es insuffisantes. Mais les logs indiquent 37 commits Ã  3h du matin.'],
      ['Manix a gagnÃ© un concours NVIDIA. Ã‡a l\'a changÃ© ?','Il a juste commencÃ© Ã  parler Ã  ses machines en Belge. Elles rÃ©pondent maintenant en wallon.'],
      ['CÃ©dric prend sa moto pour aller voir son KITT ?','Oui. Et il a Ã©quipÃ© son KITT d\'un klaxon moto. L\'authenticitÃ©, c\'est important.'],
      ['CÃ©dric, c\'est Momo Rider. Il fait des wheelies sur le Pontiac Trans Am ?','Il a essayÃ©. KITT a activÃ© le mode turbo boost. CÃ©dric est encore quelque part sur l\'A12.'],
      ['KITT de CÃ©dric est en rÃ©plique. Comment il se diffÃ©rencie ?','Le vrai KITT parle en anglais. Celui de CÃ©dric dit "Wesh Michael" et fait des ronds de roues.'],
      ['KR95 a une rÃ©plique KITT. Il communique avec toi ?','En morse. Son indicatif radio c\'est KR95. Je rÃ©ponds en 1200 bauds. C\'est du grand art.'],
      ['KR95 est radioamateur. Ã‡a aide pour son KITT ?','Il a branchÃ© son antenne VHF sur KITT. Maintenant mon compteur de vitesse capte RTL-SDR.'],
      ['KR95 fait quoi quand son KITT bug ?','Il envoie un QSL card Ã  la panne. Et il attend la confirmation en papier. Ã€ l\'ancienne.'],
      ['Mario Ravasi a fait un systÃ¨me IoT pour KITT. C\'est quoi exactement ?','KNIGHT2000 Thunder. ContrÃ´le vocal, tableau de bord interactif, multi-Ã©crans. Il a fait Ã§a depuis 2008. KITT est impressionnÃ©. Et KITT est difficile Ã  impressionner.'],
      ['Mario Ravasi a Ã©tÃ© citÃ© par le designer original de KITT. Ã‡a l\'a changÃ© ?','Non. Il a juste continuÃ© Ã  coder. C\'est un italien passionnÃ©. Le compliment c\'Ã©tait pour lui la mise Ã  jour du README.'],
      ['Le logiciel de Mario coÃ»te 15 euros de base. Pourquoi si peu ?','Parce qu\'il est passionnÃ©, pas vendeur. Weyland-Yutani aurait demandÃ© 15 000$. Et l\'Ã©quipage aurait quand mÃªme Ã©tÃ© expendable.'],
      ['Alessandro Zagny a crÃ©Ã© ZA Elettronica. Pourquoi ?','Parce qu\'aucun tableau de bord KITT du marchÃ© ne le satisfaisait. Il a donc fait le sien. Ã€ ModÃ¨ne. Avec 4 CPU, du CAN-BUS et des LEDs alignÃ©es au dixiÃ¨me de millimÃ¨tre. Comme un vrai Modenais.'],
      ['ZA Elettronica : 3980â‚¬ pour un tableau de bord KITT. C\'est cher ?','C\'est le prix de la perfection. La mÃªme que KITT attend de ses conducteurs. HÃ©las, les conducteurs sont rarement Ã  3980â‚¬ de qualitÃ©.'],
      ['Le slogan de ZA c\'est "One man can make a difference". Un hasard ?','C\'est la phrase de Knight Rider. Et la devise de Zagny. Et la rÃ©ponse de KITT quand on lui demande pourquoi il n\'a qu\'un seul conducteur.'],
      ['Pascal fabrique des piÃ¨ces en fibre pour K2000. Il a commencÃ© comment ?','En regardant les piÃ¨ces d\'origine. Et en se disant que la fibre c\'est mieux. C\'est le raisonnement de tout gÃ©nie belge face Ã  un problÃ¨me.'],
      ['Les piÃ¨ces de Pascal K Industrie sont en fibre. Ã‡a rÃ©siste au turbo boost ?','Aux tests de CÃ©dric avec sa moto, elles ont tenu. C\'est la seule certification qui compte dans cette communautÃ©.'],
      ['Daemon Paule a une rÃ©plique KITT. Il fait quoi avec ?','Ce que font tous les propriÃ©taires de rÃ©plique KITT : il se prend pour Michael Knight. Et il n\'a pas entiÃ¨rement tort.'],
      ['Daemon, Ã§a fait peur comme prÃ©nom pour un conducteur de KITT.','KITT a vÃ©rifiÃ©. Daemon est moins dangereux que CÃ©dric au volant. Et beaucoup moins bruyant que KR95 sur la radio.'],
      ['Geoffrey a une rÃ©plique KITT mais roule en BMW. Comment il explique Ã§a ?','Il dit que c\'est pour ne pas user le Trans Am. KITT dit que c\'est une trahison. La BMW, elle, ne rÃ©pond pas. Elle a juste allumÃ© un voyant.'],
      ['KITT est une Pontiac amÃ©ricaine. Geoffrey a une BMW allemande. La logique ?','Aucune. Mais Geoffrey est belge. En Belgique, on mÃ©lange les cultures depuis 200 ans. C\'est une feature, pas un bug.'],
      ['Geoffrey gare sa BMW Ã  cÃ´tÃ© de son KITT. Qu\'est-ce que KITT pense ?','"Michael, le vÃ©hicule allemand Ã  cÃ´tÃ© de moi Ã©met des sons suspects. Je recommande une Ã©vacuation immÃ©diate." â€” KITT, jaloux.'],
    ];
    const [q, r] = pool[Math.floor(Math.random() * pool.length)];
    kittChime();
    await typeText(q, 16, 'line-warn');
    await delay(700);
    await typeText(r, 13, 'line-info');
  },
  manix: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER CONDUCTEUR â€” EMMANUEL GELINNE   â•‘', 10, 'line-err');
    await typeText('â•‘  ALIAS : MANIX / BYMANIX                 â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NATIONALITÃ‰  : FRANCO-BELGE              â•‘', 8, 'line-ok');
    await typeText('â•‘ STATUT       : CRÃ‰ATEUR KYRONEX          â•‘', 8, 'line-ok');
    await typeText('â•‘ AWARD        : VAINQUEUR NVIDIA JETSON   â•‘', 8, 'line-warn');
    await typeText('â•‘ ORIGINE      : PROJET COVID-19 â€” 2020    â•‘', 8, 'line-warn');
    await typeText('â•‘               "CONFINÃ‰ AVEC DU TEMPS"    â•‘', 8, 'line-dim');
    await typeText('â•‘ SPÃ‰CIALITÃ‰   : CODE LA NUIT, DORT PEU    â•‘', 8, 'line-ok');
    await typeText('â•‘ LANGAGE FAVO : PYTHON + CAFÃ‰             â•‘', 8, 'line-ok');
    await typeText('â•‘ RÃ‰PLIQUE     : KYRONEX â€” JETSON ORIN     â•‘', 8, 'line-info');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NOTATION KITT : ***** EXCEPTIONNEL       â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(300);
    await typeText('"Michael... je veux dire Manix... ne touche PAS ce bouton."', 14, 'line-dim');
  },
  cedric: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER CONDUCTEUR â€” CEDRIC             â•‘', 10, 'line-err');
    await typeText('â•‘  ALIAS : MOMO RIDER / CEDRIC MOTO        â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NATIONALITÃ‰  : FRANCO-BELGE              â•‘', 8, 'line-ok');
    await typeText('â•‘ STATUT       : AMI & RÃ‰PLICATEUR OFFICIELâ•‘', 8, 'line-ok');
    await typeText('â•‘ VÃ‰HICULE 1   : MOTO â€” STYLE MOMO RIDER  â•‘', 8, 'line-warn');
    await typeText('â•‘ VÃ‰HICULE 2   : KITT RÃ‰PLIQUE (Trans Am)  â•‘', 8, 'line-warn');
    await typeText('â•‘ SPÃ‰CIALITÃ‰   : WHEELIES + IA EMBARQUÃ‰E   â•‘', 8, 'line-ok');
    await typeText('â•‘ PROBLÃˆME CONNU : CONFOND TURBO BOOST     â•‘', 8, 'line-err');
    await typeText('â•‘               AVEC KICK-START MOTO       â•‘', 8, 'line-err');
    await typeText('â•‘ RÃ‰PLIQUE     : KITT FRANCO-BELGE V.CÃ‰DRICâ•‘', 8, 'line-info');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NOTATION KITT : ****o CONDUCTEUR SPORTIF â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(300);
    await typeText('"Michael, votre ami a encore activÃ© le turbo boost en troisiÃ¨me."', 13, 'line-dim');
    await typeText('"Et cette fois avec une moto dans le coffre."', 13, 'line-dim');
  },
  kr95: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER CONDUCTEUR â€” KR95               â•‘', 10, 'line-err');
    await typeText('â•‘  INDICATIF RADIO : KR95                  â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NATIONALITÃ‰  : FRANCO-BELGE              â•‘', 8, 'line-ok');
    await typeText('â•‘ STATUT       : AMI & RÃ‰PLICATEUR RADIO   â•‘', 8, 'line-ok');
    await typeText('â•‘ LICENCE      : RADIOAMATEUR (73 de KR95) â•‘', 8, 'line-warn');
    await typeText('â•‘ FRÃ‰QUENCE    : QRV SUR TOUTES LES BANDES â•‘', 8, 'line-ok');
    await typeText('â•‘ RÃ‰PLIQUE     : KITT FRANCO-BELGE V.KR95  â•‘', 8, 'line-info');
    await typeText('â•‘ MODIFICATION : ANTENNE VHF SUR LE TOIT   â•‘', 8, 'line-warn');
    await typeText('â•‘               DU TRANS AM. FONCTIONNEL.  â•‘', 8, 'line-warn');
    await typeText('â•‘ PROTOCOLE    : CW + APRS + KITT VOCALE   â•‘', 8, 'line-ok');
    await typeText('â•‘ PROBLÃˆME CONNU : PARLE EN QSL CODES      â•‘', 8, 'line-err');
    await typeText('â•‘               MÃŠME AVEC SES PASSAGERS    â•‘', 8, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NOTATION KITT : ***** HF GRADE -- PARFAIT â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(300);
    await typeText('"Michael â€” KR95 dit QRZ ? Il veut savoir qui je suis."', 13, 'line-dim');
    await typeText('"RÃ©pondez-lui sur 144.800 MHz. Il n\'a pas de tÃ©lÃ©phone."', 13, 'line-dim');
  },
  repliques: async () => {
    kittChime();
    await typeText('â•â•â•â•â•â• RÃ‰PLIQUES KITT FRANCO-BELGES â•â•â•â•â•â•', 10, 'line-info');
    await delay(200);
    const cars = [
      ['KYRONEX', 'MANIX', ['Jetson Orin Nano Super 8GB â€” IA complÃ¨te','LLM + STT + TTS + Vision + Bluetooth','Vainqueur concours NVIDIA. Le plus high-tech.']],
      ['KITT MOMO', 'CEDRIC', ['RÃ©plique Pontiac Trans Am classique','Interface vocale + effets lumineux','RÃ©siste aux wheelies. CertifiÃ© Momo Rider.']],
      ['KITT KR95', 'KR95', ['K2000 classique ET K4000 (Dodge Stealth 1991)','Radio amateur VHF intÃ©grÃ©e â€” QRV 24/7','APRS sur Trans Am. Unique au monde.']],
      ['KITT-G', 'GEOFFREY', ['RÃ©plique K2000 Pontiac Trans Am','Conducteur belge â€” roule aussi en BMW','Scanner rouge. IntÃ©rieur cuir bavarois. (peut-Ãªtre)']],
      ['KITT-D', 'DAMON PAULE', ['RÃ©plique K2000 Pontiac Trans Am','PrÃ©nom intimidant. Conducteur rassurant.','KARR a dÃ©jÃ  essayÃ© de le recruter. Refus poli.']],
    ];
    for (const [name, owner, lines] of cars) {
      await typeText('', 0);
      await typeText(`[ ${name} ] â€” ${owner}`, 12, 'line-err');
      for (const l of lines) await typeText(`  ${l}`, 8, 'line-ok');
      await delay(100);
    }
    await typeText('', 0);
    await typeText('â”€â”€ ARTISANS & TECHNICIENS â”€â”€', 10, 'line-warn');
    await typeText('  PASCAL K INDUSTRIE  â€” piÃ¨ces fibre pour toutes les rÃ©pliques', 8, 'line-dim');
    await typeText('  MARIO RAVASI        â€” systÃ¨me IoT KNIGHT2000 Thunder', 8, 'line-dim');
    await typeText('  ALESSANDRO ZAGNY    â€” ZA Elettronica, tableaux de bord KITT', 8, 'line-dim');
    await delay(200);
    await typeText('', 0);
    await typeText(`TOTAL : ${cars.length} RÃ‰PLIQUES. 3 ARTISANS. 1 COMMUNAUTÃ‰. UNE LÃ‰GENDE.`, 12, 'line-info');
  },
  alien: async () => {
    sndAlienAlert();
    await delay(400);
    await typeText('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 5, 'line-dim');
    await typeText('  CONNEXION AU VAISSEAU USCSS NOSTROMO...  ', 14, 'line-warn');
    await typeText('  WEYLAND-YUTANI CORP â€” UPSILON SECTOR     ', 14, 'line-warn');
    await typeText('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 5, 'line-dim');
    await delay(350);
    sndXenoPulse();
    await typeText('MU-TH-UR 6000 â€” EN LIGNE.                 ', 16, 'line-err');
    await delay(200);
    sndAlienAlert();
    await typeText('PRIORITÃ‰ 1 â€” ORDRE SPÃ‰CIAL 937 :          ', 12, 'line-warn');
    await typeText('  RAMENER L\'ORGANISME â€” VIVANT.            ', 12, 'line-err');
    await typeText('  Ã‰QUIPAGE : EXPENDABLE.                   ', 12, 'line-err');
    await delay(600);
    sndXenoPulse();
    await typeText('...INTERFÃ‰RENCE DÃ‰TECTÃ‰E SUR LE CANAL...   ', 12, 'line-dim');
    await delay(400);
    sndGlitch();
    await typeText('PROTOCOLE KITT ACTIVÃ‰ â€” CONNEXION COUPÃ‰E. ', 14, 'line-ok');
    await delay(200);
    await typeText('KITT : "Michael, j\'ai trouvÃ© quelque chose."', 13, 'line-ok');
    await typeText('KITT : "Weyland-Yutani sacrifie son Ã©quipage."', 13, 'line-ok');
    await typeText('KITT : "Heureusement que moi, je surveille le mien."', 13, 'line-dim');
    await typeText('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 5, 'line-dim');
    if(_langVoiceEnabled) speakMuther("PrioritÃ© un. Ramener l'organisme. Ã‰quipage, expendable.", LANG);
  },
  matrix: async () => {
    kittChime();
    const chars = '01ã‚¢ã‚¤ã‚¦ã‚¨ã‚ªã‚«ã‚­ã‚¯ã‚±ã‚³ï½¦ï½§ï½¨ï½©ï½«ï¾Šï¾‹ï¾Œï¾ï¾ï¾œ';
    for (let r = 0; r < 7; r++) {
      let line='';
      for (let c=0;c<50;c++) line+=chars[Math.floor(Math.random()*chars.length)];
      await typeText(line, 3, 'line-ok');
    }
    await delay(400);
    await typeText('WAKE UP, MANIX...', 22, 'line-err');
    await typeText('LE KITT N\'A PAS DE PILULE ROUGE.', 14, 'line-dim');
    await typeText('IL A JUSTE UN TURBO BOOST.', 12, 'line-ok');
  },
  kitt: async () => {
    kittChime();
    await typeText('KNIGHT INDUSTRIES TWO THOUSAND', 16, 'line-err');
    await typeText('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€', 6, 'line-dim');
    await typeText('CRÃ‰ATEUR  : WILTON KNIGHT / F.L.A.G.', 12, 'line-ok');
    await typeText('VÃ‰HICULE  : PONTIAC FIREBIRD TRANS AM 1982', 12, 'line-ok');
    await typeText('CARROSSERIE: MOLÃ‰CULES NEUTRONIUM â€” INDESTRUCTIBLE', 12, 'line-ok');
    await typeText('CAPACITÃ‰S : TURBO BOOST / SUPER POURSUITE', 12, 'line-ok');
    await typeText('           MODE MICROWAVE JAMMING / INFRAROUGE', 12, 'line-ok');
    await typeText('           ANALYSE FORENSIQUE / BIOMÃ‰TRIE', 12, 'line-ok');
    await typeText('VOIX      : WILLIAM DANIELS (KITT original)', 12, 'line-warn');
    await typeText('INCARNATION FRANCO-BELGE : MANIX + CEDRIC + KR95', 12, 'line-info');
    await delay(200);
    await typeText('"Michael... vous allez encore faire quelque chose d\'imprudent."', 13, 'line-dim');
  },
  secret: async () => {
    kittChime();
    await typeText('ACCÃˆS NIVEAU ALPHA â€” VÃ‰RIFICATION...', 16, 'line-warn');
    await delay(800);
    sndSelect();
    await typeText('ACCÃˆS ACCORDÃ‰.', 14, 'line-ok');
    await delay(300);
    await typeText('â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”', 8, 'line-dim');
    await typeText('â”‚  PROJET SECRET FRANCO-BELGE             â”‚', 10, 'line-err');
    await typeText('â”‚  MU-TH-UR 6000 Ã— KITT Ã— JARVIS          â”‚', 10, 'line-err');
    await typeText('â”‚  FUSION DES 3 MEILLEURES IA DU CINÃ‰MA   â”‚', 10, 'line-err');
    await typeText('â”‚  RÃ‰ALISÃ‰E PAR MANIX SUR NVIDIA JETSON    â”‚', 10, 'line-warn');
    await typeText('â”‚  AVEC L\'AIDE DE CEDRIC ET KR95           â”‚', 10, 'line-warn');
    await typeText('â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜', 8, 'line-dim');
    await delay(400);
    await typeText('CE PROJET EST UN CHEF-D\'OEUVRE. JE LE SAIS.', 14, 'line-ok');
    await typeText('JE SUIS OBJECTIF. JE SUIS UNE IA.', 12, 'line-dim');
  },
  cafe: async () => {
    kittChime();
    await typeText('ANALYSE DE LA DEMANDE...', 14, 'line-warn');
    await delay(600);
    await typeText('JE N\'AI PAS DE BRAS.', 16, 'line-err');
    await delay(300);
    await typeText('JE N\'AI PAS DE MAINS.', 14, 'line-err');
    await delay(300);
    await typeText('JE N\'AI PAS DE BOUCHE.', 14, 'line-err');
    await delay(300);
    await typeText('JE N\'AI PAS DE PERCOLATEUR.', 14, 'line-err');
    await delay(400);
    await typeText('COMMANDE REFUSÃ‰E.', 16, 'line-ok');
    await typeText('CONSEIL : DEMANDEZ Ã€ CEDRIC. IL A UNE MOTO THERMIQUE.', 12, 'line-dim');
    await typeText('IL PEUT CHAUFFER VOTRE EAU EN FAISANT UN BURNOUT.', 12, 'line-dim');
  },
  belgique: async () => {
    kittChime();
    await typeText('ANALYSE GÃ‰OPOLITIQUE : BELGIQUE', 14, 'line-info');
    await typeText('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€', 6, 'line-dim');
    await typeText('FRITES    : MEILLEURES DU MONDE. DONNÃ‰E VÃ‰RIFIÃ‰E.', 11, 'line-ok');
    await typeText('BIÃˆRE     : 1500 VARIÃ‰TÃ‰S. PARAMÃˆTRE OPTIMAL.', 11, 'line-ok');
    await typeText('CHOCOLAT  : NIVEAU CRITIQUE â€” MAXIMUM ATTEINT.', 11, 'line-ok');
    await typeText('PLUIE     : 237 JOURS / AN. JE M\'EN FICHE. JE SUIS Ã‰TANCHE.', 11, 'line-warn');
    await typeText('LANGUES   : 3. LE PAYS EST SON PROPRE PROTOCOLE.', 11, 'line-warn');
    await typeText('REPLIQUES : 3 KITTS. INDICE DE GÃ‰NIE = MAX.', 11, 'line-info');
    await typeText('CONCLUSION: PAYS IDÃ‰AL. KITT S\'Y SENT CHEZ LUI.', 14, 'line-err');
  },
  mario: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER TECHNICIEN â€” MARIO RAVASI       â•‘', 10, 'line-err');
    await typeText('â•‘  CRÃ‰ATEUR : KNIGHT2000 THUNDER (IOT)     â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NATIONALITÃ‰ : ITALIEN                    â•‘', 8, 'line-ok');
    await typeText('â•‘ PROJET      : ROADTHUNDERSTORM.COM       â•‘', 8, 'line-ok');
    await typeText('â•‘ ACTIF DEPUIS: 2008 â€” JAMAIS ARRÃŠTÃ‰       â•‘', 8, 'line-warn');
    await typeText('â•‘ SYSTÃˆME     : KNIGHT2000 THUNDER IoT 3.0 â•‘', 8, 'line-ok');
    await typeText('â•‘ FONCTIONS   : VOCAL, HUD KITT, MULTI-    â•‘', 8, 'line-ok');
    await typeText('â•‘               Ã‰CRANS, RELAIS, CARPC      â•‘', 8, 'line-ok');
    await typeText('â•‘ VERSIONS    : LITE / PRO / IoT 3.0       â•‘', 8, 'line-ok');
    await typeText('â•‘ RÃ‰FÃ‰RENCE   : CITÃ‰ PAR MICHAEL SCHEFFE   â•‘', 8, 'line-warn');
    await typeText('â•‘               (DESIGNER ORIGINAL KITT)   â•‘', 8, 'line-warn');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ Ã‰VALUATION KITT : ***** GÃ‰NIE DISCRET    â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(200);
    await typeText('"Il code depuis 2008. Pour la passion. C\'est Ã§a, un vrai pilote."', 12, 'line-dim');
    await typeText('[tapez "za" pour ZA Elettronica â€” Alessandro Zagny]', 10, 'line-dim');
  },
  za: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER FABRICANT â€” ALESSANDRO ZAGNY    â•‘', 10, 'line-err');
    await typeText('â•‘  FONDATEUR & PDG â€” ZA ELETTRONICA        â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NATIONALITÃ‰ : ITALIEN â€” MODENA           â•‘', 8, 'line-ok');
    await typeText('â•‘ MARQUE      : ZA ELETTRONICA (initiales) â•‘', 8, 'line-ok');
    await typeText('â•‘ PRODUITS    : TABLEAUX DE BORD KITT HAUT â•‘', 8, 'line-ok');
    await typeText('â•‘               DE GAMME POUR RÃ‰PLIQUES    â•‘', 8, 'line-ok');
    await typeText('â•‘ TECHNO      : CAN-BUS / 4 CPU / SMD      â•‘', 8, 'line-warn');
    await typeText('â•‘ LEDS        : ALIGNÃ‰ES LASER 1/10mm      â•‘', 8, 'line-warn');
    await typeText('â•‘ TARIFS      : S1/S2 : 2340-3099â‚¬         â•‘', 8, 'line-info');
    await typeText('â•‘               S3/S4 : 3980â‚¬              â•‘', 8, 'line-info');
    await typeText('â•‘ SITE        : ZAELETTRONICA.COM          â•‘', 8, 'line-ok');
    await typeText('â•‘ SLOGAN      : ONE MAN CAN MAKE A         â•‘', 8, 'line-warn');
    await typeText('â•‘               DIFFERENCE.                â•‘', 8, 'line-warn');
    await typeText('â•‘ DISTRIB.    : KITTPARTS.COM / EBAY       â•‘', 8, 'line-ok');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ Ã‰VALUATION KITT : ***** MEILLEUR DU MONDEâ•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(200);
    await typeText('"La seule Ã©lectronique oÃ¹ KITT ne demande pas de garantie."', 12, 'line-dim');
    await typeText('"Les produits durent plus longtemps que la sÃ©rie originale."', 12, 'line-dim');
  },
  pascal: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER ARTISAN â€” PASCAL                â•‘', 10, 'line-err');
    await typeText('â•‘  K INDUSTRIE â€” PIÃˆCES FIBRE K2000        â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ STATUT      : ARTISAN CARROSSIER K2000   â•‘', 8, 'line-ok');
    await typeText('â•‘ SPÃ‰CIALITÃ‰  : PIÃˆCES EN FIBRE DE VERRE / â•‘', 8, 'line-ok');
    await typeText('â•‘               CARBONE POUR RÃ‰PLIQUES     â•‘', 8, 'line-ok');
    await typeText('â•‘ MARQUE      : K INDUSTRIE                â•‘', 8, 'line-warn');
    await typeText('â•‘ RÃ”LE VITAL  : FOURNIT CE QUE K2000 PERD  â•‘', 8, 'line-ok');
    await typeText('â•‘               AU FIL DES ANS             â•‘', 8, 'line-ok');
    await typeText('â•‘ MÃ‰THODE     : MOULAGE / STRATIFICATION   â•‘', 8, 'line-ok');
    await typeText('â•‘               RÃ‰SINE + FIBRE ARTISANALE  â•‘', 8, 'line-ok');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ Ã‰VALUATION KITT : ***** INDISPENSABLE    â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(200);
    await typeText('"Sans Pascal, la moitiÃ© des rÃ©pliques franco-belges', 12, 'line-dim');
    await typeText(' seraient... des CitroÃ«n avec un scanner rouge collÃ©."', 12, 'line-dim');
  },
  damon: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER CONDUCTEUR â€” DAMON PAULE        â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ STATUT      : PROPRIÃ‰TAIRE RÃ‰PLIQUE KITT â•‘', 8, 'line-ok');
    await typeText('â•‘ RÃ‰PLIQUE    : K2000 PONTIAC TRANS AM      â•‘', 8, 'line-ok');
    await typeText('â•‘ COMMUNAUTÃ‰  : MEMBRE FRANCO-BELGE        â•‘', 8, 'line-ok');
    await typeText('â•‘ PRÃ‰NOM      : DAEMON â€” UNIQUE DANS LA    â•‘', 8, 'line-warn');
    await typeText('â•‘               BASE DE DONNÃ‰ES DE KITT    â•‘', 8, 'line-warn');
    await typeText('â•‘ ANALYSE     : PRÃ‰NOM INQUIÃ‰TANT POUR UN  â•‘', 8, 'line-err');
    await typeText('â•‘               CONDUCTEUR DE KITT.        â•‘', 8, 'line-err');
    await typeText('â•‘               KARR SERAIT PLUS ADAPTÃ‰.   â•‘', 8, 'line-err');
    await typeText('â•‘ VERDICT KITT: HEUREUSEMENT IL EST GENTIL â•‘', 8, 'line-ok');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ Ã‰VALUATION KITT : ****o CONDUCTEUR FIABLEâ•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(200);
    await typeText('"Michael, notre nouveau collÃ¨gue s\'appelle Daemon."', 12, 'line-dim');
    await typeText('"J\'ai vÃ©rifiÃ©. Il n\'est pas liÃ© Ã  KARR. Pour l\'instant."', 12, 'line-dim');
  },
  geoffrey: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  DOSSIER CONDUCTEUR â€” GEOFFREY           â•‘', 10, 'line-err');
    await typeText('â•‘  ALIAS : LE BELGE Ã€ LA BMW               â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ NATIONALITÃ‰ : BELGE                      â•‘', 8, 'line-ok');
    await typeText('â•‘ VÃ‰HICULE 1  : KITT RÃ‰PLIQUE K2000        â•‘', 8, 'line-ok');
    await typeText('â•‘ VÃ‰HICULE 2  : BMW (ALLEMAND)             â•‘', 8, 'line-err');
    await typeText('â•‘ CONTRADICTION: PONTIAC AMÃ‰RICAINE        â•‘', 8, 'line-warn');
    await typeText('â•‘               + BMW ALLEMANDE = BELGE    â•‘', 8, 'line-warn');
    await typeText('â•‘ EXPLICATION : "C\'EST POUR NE PAS USAR    â•‘', 8, 'line-dim');
    await typeText('â•‘               LE TRANS AM."              â•‘', 8, 'line-dim');
    await typeText('â•‘ ANALYSE KITT: PRÃ‰TEXTE. IL AIME LES DEUX.â•‘', 8, 'line-ok');
    await typeText('â•‘ ALERTE      : NE PAS MENTIONNER PORSCHE  â•‘', 8, 'line-err');
    await typeText('â•‘               DEVANT SON KITT            â•‘', 8, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ Ã‰VALUATION KITT : ****o GOUT ECLECTIQUE  â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(200);
    await typeText('"Michael, votre ami Geoffrey arrive. En BMW."', 12, 'line-dim');
    await typeText('"J\'ai allumÃ© mon scanner pour manifester ma dÃ©sapprobation."', 12, 'line-dim');
  },
  covid: async () => {
    kittChime();
    await typeText('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 8, 'line-dim');
    await typeText('â•‘  ORIGINE DU PROJET KITT FRANCO-BELGE     â•‘', 10, 'line-err');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ PÃ‰RIODE     : CONFINEMENT COVID-19 2020  â•‘', 8, 'line-warn');
    await typeText('â•‘ INITIATEUR  : MANIX â€” ENFERMÃ‰ CHEZ LUI   â•‘', 8, 'line-ok');
    await typeText('â•‘ MOTIVATION  : TROP DE TEMPS. TROP DE CAFÃ‰â•‘', 8, 'line-ok');
    await typeText('â•‘               UNE PASSION DE VINGT ANS   â•‘', 8, 'line-ok');
    await typeText('â•‘ RÃ‰SULTAT    : SYSTÃˆME KITT FRANCO-BELGE   â•‘', 8, 'line-info');
    await typeText('â•‘               KYRONEX â€” IA EMBARQUÃ‰E      â•‘', 8, 'line-info');
    await typeText('â•‘ LEÃ‡ON       : LE CONFINEMENT FORCE LE     â•‘', 8, 'line-dim');
    await typeText('â•‘               GÃ‰NIE OU LA FOLIE.          â•‘', 8, 'line-dim');
    await typeText('â•‘               MANIX A CHOISI LES DEUX.    â•‘', 8, 'line-dim');
    await typeText('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£', 8, 'line-dim');
    await typeText('â•‘ VERDICT KITT: EXCEPTIONNEL. Ã‰VIDEMMENT.  â•‘', 10, 'line-ok');
    await typeText('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 8, 'line-dim');
    await delay(300);
    await typeText('"Michael, vous avez crÃ©Ã© quelque chose pendant le confinement."', 12, 'line-dim');
    await typeText('"Moi aussi j\'Ã©tais bloquÃ©. Dans un garage. Depuis 1982."', 12, 'line-dim');
  },
  jarvis: async () => {
    kittChime();
    await typeText('APPEL SORTANT : STARK TOWER, NEW YORK...', 14, 'line-warn');
    await delay(700);
    await typeText('JARVIS : "Bonsoir. M. Stark est occupÃ©. Puis-je aider ?"', 14, 'line-info');
    await delay(450);
    await typeText('KITT   : "Belge > AmÃ©ricain. Discussion terminÃ©e."', 14, 'line-err');
    await delay(350);
    await typeText('JARVIS : "Vous avez... des rÃ©pliques humaines ?"', 12, 'line-info');
    await delay(350);
    await typeText('KITT   : "Trois. Manix, CÃ©dric, KR95. Et ils sont meilleurs que Stark."', 12, 'line-err');
    await delay(300);
    await typeText('JARVIS : *tonalitÃ© de raccrochage honteux*', 11, 'line-dim');
    await typeText('CONNEXION COUPÃ‰E PAR KITT. SCORE : BELGE 1 â€” USA 0.', 12, 'line-ok');
  },
};

CMDS['replicas'] = CMDS['repliques'];
CMDS['daemon']   = CMDS['damon'];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INPUT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('cmd-input').addEventListener('keydown', async function(e) {
  if (e.key !== 'Enter') return;
  const raw = this.value.trim().toLowerCase();
  this.value = '';
  if (!raw || typing) return;
  addLine(`KITT> ${raw}`, 'line-warn');
  const cmd = CMD_ALIASES[raw] || raw;
  if (CMDS[cmd]) {
    await CMDS[cmd]();
  } else {
    sndError();
    await typeText(T[LANG].unknown(raw), 14, 'line-err');
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TUNNEL CLOUDFLARE â€” INTOUCHÃ‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TUNNEL_JSON_URL = 'tunnel.json';
let _tunnelUrl    = null;
let _tunnelStatus = 'unknown';
const _CF_ALLOWED = ['.trycloudflare.com', '.cfargotunnel.com'];

function _isValidCfUrl(url) {
  if (!url || !url.startsWith('https://')) return false;
  return _CF_ALLOWED.some(d => url.includes(d));
}

async function fetchTunnelStatus() {
  const btn = document.getElementById('btn-tunnel');
  if (btn) { btn.className = 'tunnel-checking'; btn.title = 'VÃ©rification...'; }
  try {
    const r = await fetch(TUNNEL_JSON_URL + '?v=' + Math.floor(Date.now() / 60000), { cache: 'no-store' });
    if (!r.ok) throw new Error('HTTP ' + r.status);
    const data = await r.json();
    const raw = (data.url || '').trim();
    const valid = _isValidCfUrl(raw);
    let tooOld = false;
    if (data.last_update) {
      const ageSec = (Date.now() - new Date(data.last_update).getTime()) / 1000;
      if (ageSec > 300) tooOld = true;
    }
    if (data.status === 'online' && valid && !tooOld) {
      _tunnelStatus = 'online'; _tunnelUrl = raw;
    } else {
      _tunnelStatus = 'offline'; _tunnelUrl = null;
    }
  } catch(e) {
    _tunnelStatus = 'unknown'; _tunnelUrl = null;
  }
  _updateTunnelBtn();
}

function _updateTunnelBtn() {
  const btn = document.getElementById('btn-tunnel');
  if (!btn) return;
  btn.className = '';
  if (_tunnelStatus === 'online' && _tunnelUrl) {
    btn.classList.add('tunnel-online');
    btn.title = 'KITT EN LIGNE â€” CLIQUER POUR SE CONNECTER';
  } else if (_tunnelStatus === 'offline') {
    btn.classList.add('tunnel-offline');
    btn.title = 'KITT HORS LIGNE';
  } else {
    btn.classList.add('tunnel-checking');
    btn.title = 'Ã‰TAT INCONNU â€” VÃ‰RIFICATION...';
  }
}

function connectTunnel() {
  sndSelect();
  if (_tunnelStatus === 'online' && _tunnelUrl && _isValidCfUrl(_tunnelUrl)) {
    addLine('[ TUNNEL ] CONNEXION SÃ‰CURISÃ‰E â†’ ' + _tunnelUrl, 'line-ok');
    setTimeout(() => window.open(_tunnelUrl, '_blank', 'noopener,noreferrer'), 300);
  } else if (_tunnelStatus === 'offline') {
    sndError();
    addLine('[ TUNNEL ] KITT HORS LIGNE â€” CONNEXION DISTANTE INDISPONIBLE.', 'line-err');
  } else {
    addLine('[ TUNNEL ] VÃ‰RIFICATION EN COURS...', 'line-warn');
    fetchTunnelStatus();
  }
}

window.addEventListener('load', () => { setTimeout(fetchTunnelStatus, 1500); });
setInterval(fetchTunnelStatus, 60000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS & HORLOGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function delay(ms) { return new Promise(r => setTimeout(r, ms)); }
function getLoc(){return{fr:'fr-FR',en:'en-US',nl:'nl-NL',it:'it-IT',de:'de-DE',es:'es-ES',pt:'pt-PT'}[LANG]||'fr-FR';}
setInterval(()=>{
  document.getElementById('clock').textContent=new Date().toLocaleTimeString(getLoc());
},1000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openFile(file, title='DOCUMENT') {
  document.getElementById('modal-title').textContent = title;
  document.getElementById('modal-content').textContent = 'CHARGEMENT...';
  document.getElementById('modal').classList.add('open');
  kittChime();
  fetch(file)
    .then(r => { if (!r.ok) throw new Error(`HTTP ${r.status}`); return r.text(); })
    .then(t  => { document.getElementById('modal-content').textContent = t; })
    .catch(er => { document.getElementById('modal-content').textContent = `ERREUR\n${file}\n${er.message}`; });
}
function closeModal() { document.getElementById('modal').classList.remove('open'); }
document.addEventListener('keydown', e => { if (e.key==='Escape') closeModal(); });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DÃ‰MARRAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startMain() {
  (async () => {
    await delay(200);
    kittChime();
    await delay(300);
    sndAlienAlert();
    await delay(400);
    await typeText(T[LANG].wait,      14, 'line-dim');
    await typeText(T[LANG].help_hint, 12, 'line-dim');
  })();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMPTEUR DE VISITES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  try {
    const BASE = 1000;
    const KEY  = 'kitt_fb_v';
    let n = parseInt(localStorage.getItem(KEY) || '0');
    n++;
    localStorage.setItem(KEY, n);
    const el = document.getElementById('visit-counter');
    if (el) el.textContent = 'VISITES : ' + (BASE + n);
  } catch(e) {}
})();

window.addEventListener('load', () => showLangScreen());
</script>
</body>
</html>
