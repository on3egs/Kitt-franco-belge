<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KITT FRANCO-BELGE // SYSTÈME CENTRAL</title>
<meta name="description" content="Interface KITT Franco-Belge — IA embarquée sur NVIDIA Jetson. Projet fan non commercial par Manix."/>
<meta name="theme-color" content="#000000"/>
<style>
:root{
  --green:#00ff66;
  --green-dim:#00aa44;
  --red:#ff1a1a;
  --amber:#ffaa00;
  --cyan:#00ccff;
  --bg:#000;
}
*{box-sizing:border-box;}
html,body{margin:0;height:100%;background:var(--bg);color:var(--green);font-family:"Courier New",monospace;overflow:hidden;}

/* CRT scanlines */
body::before{content:"";position:fixed;top:0;left:0;right:0;bottom:0;background:repeating-linear-gradient(0deg,rgba(0,0,0,.18),rgba(0,0,0,.18) 1px,transparent 1px,transparent 3px);pointer-events:none;z-index:9998;}
body::after{content:"";position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,255,80,.015);pointer-events:none;z-index:9999;animation:flicker .12s infinite;}
@keyframes flicker{0%{opacity:.88}48%{opacity:1}52%{opacity:.92}100%{opacity:.96}}

/* ── LANGUAGE SELECTION OVERLAY ─────────────────────────── */
#lang-screen{
  position:fixed;top:0;left:0;right:0;bottom:0;
  background:#000;z-index:8000;
  display:flex;align-items:center;justify-content:center;
  padding:16px;
}
#lang-box{
  width:100%;max-width:440px;
  border:1px solid var(--green);
  box-shadow:0 0 40px rgba(0,255,100,.12),inset 0 0 30px rgba(0,255,100,.02);
  font-size:13px;
}
#lang-hdr{
  border-bottom:1px solid var(--green-dim);
  padding:10px 18px;
  color:var(--green);
  letter-spacing:3px;
  font-size:12px;
  text-align:center;
  text-shadow:0 0 10px var(--green);
}
#lang-sub{
  padding:10px 18px 4px;
  color:var(--amber);
  letter-spacing:2px;
  font-size:11px;
  border-bottom:1px solid #111;
}
#lang-output{padding:4px 0;}
.lang-opt{
  display:flex;
  align-items:center;
  gap:14px;
  padding:7px 22px;
  cursor:pointer;
  transition:background .12s;
  border-left:2px solid transparent;
}
.lang-opt:hover{
  background:rgba(0,255,100,.07);
  border-left-color:var(--green);
}
.lang-opt.active{
  background:rgba(0,255,100,.15);
  border-left-color:var(--green);
  color:#000;
}
.lo-n{
  color:var(--red);
  font-size:11px;
  min-width:28px;
  text-align:center;
  border:1px solid var(--red);
  padding:1px 4px;
  letter-spacing:1px;
  flex-shrink:0;
}
.lo-l{color:var(--green);letter-spacing:2px;font-size:13px;}
#lang-ftr{
  border-top:1px solid var(--green-dim);
  padding:8px 18px;
  color:var(--green-dim);
  font-size:10px;
  letter-spacing:2px;
  text-align:center;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:6px;
}

/* ── SCANNER KITT ───────────────────────────────────────── */
#sw{position:fixed;top:0;left:0;right:0;height:3px;overflow:hidden;z-index:1000;}
#sb{position:absolute;top:0;width:200px;height:3px;background:linear-gradient(90deg,transparent,var(--red),var(--red),transparent);box-shadow:0 0 14px 4px var(--red);animation:ks 1.8s ease-in-out infinite alternate;}
#swb{position:fixed;bottom:0;left:0;right:0;height:3px;overflow:hidden;z-index:1000;}
#sbb{position:absolute;top:0;width:200px;height:3px;background:linear-gradient(90deg,transparent,var(--red),var(--red),transparent);box-shadow:0 0 14px 4px var(--red);animation:ks 1.8s ease-in-out infinite alternate-reverse;}
@keyframes ks{0%{left:-200px}100%{left:100%}}

/* ── LAYOUT ─────────────────────────────────────────────── */
.container{display:flex;flex-direction:column;height:100%;padding:16px 20px 20px;gap:0;}

/* ── HEADER ─────────────────────────────────────────────── */
header{flex-shrink:0;display:flex;align-items:center;justify-content:space-between;padding:10px 0 8px;border-bottom:1px solid var(--red);}
.hdr-title{color:var(--red);font-size:18px;letter-spacing:4px;text-shadow:0 0 16px var(--red);animation:pred 3s ease-in-out infinite;}
@keyframes pred{0%,100%{text-shadow:0 0 12px var(--red)}50%{text-shadow:0 0 28px var(--red),0 0 50px rgba(255,26,26,.5)}}
.hdr-right{display:flex;gap:14px;font-size:11px;color:var(--green-dim);align-items:center;}
.sdot{display:inline-block;width:7px;height:7px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green);animation:bd 2s ease-in-out infinite;margin-right:4px;vertical-align:middle;}
@keyframes bd{0%,100%{opacity:1}50%{opacity:.25}}
#lang-flag{font-size:10px;border:1px solid var(--green-dim);padding:1px 5px;letter-spacing:1px;cursor:pointer;color:var(--green-dim);}
#lang-flag:hover{color:var(--green);border-color:var(--green);}

/* ── ASCII ──────────────────────────────────────────────── */
#kitt-ascii{flex-shrink:0;text-align:center;color:var(--red);font-size:10px;line-height:1.2;text-shadow:0 0 8px var(--red);padding:6px 0 4px;opacity:.85;user-select:none;}

/* ── TERMINAL ───────────────────────────────────────────── */
#terminal{flex:1;overflow-y:auto;overflow-x:hidden;padding:8px 4px;font-size:13px;line-height:1.65;scrollbar-width:thin;scrollbar-color:var(--red) #111;}
#terminal::-webkit-scrollbar{width:4px}
#terminal::-webkit-scrollbar-track{background:#111}
#terminal::-webkit-scrollbar-thumb{background:var(--red)}
.line-ok{color:var(--green);}
.line-warn{color:var(--amber);}
.line-err{color:var(--red);}
.line-info{color:var(--cyan);}
.line-dim{color:var(--green-dim);}
.cursor{display:inline-block;width:8px;height:13px;background:var(--green);vertical-align:text-bottom;animation:bc .7s step-end infinite;}
@keyframes bc{0%,100%{opacity:1}50%{opacity:0}}

/* ── BUTTONS ────────────────────────────────────────────── */
.btn-row{flex-shrink:0;display:flex;flex-wrap:wrap;gap:6px;padding:8px 0 6px;border-top:1px solid #1a1a1a;border-bottom:1px solid #1a1a1a;}
button{background:#000;border:1px solid var(--green);color:var(--green);padding:7px 14px;cursor:pointer;font-family:inherit;font-size:12px;letter-spacing:1px;transition:all .15s;position:relative;overflow:hidden;}
button::before{content:"";position:absolute;inset:0;background:var(--green);transform:scaleX(0);transform-origin:left;transition:transform .15s;z-index:-1;}
button:hover{color:#000;}button:hover::before{transform:scaleX(1);}
button:active{transform:scale(.95);}
.btn-red{border-color:var(--red);color:var(--red);}
.btn-red::before{background:var(--red);}
.btn-cyan{border-color:var(--cyan);color:var(--cyan);}
.btn-cyan::before{background:var(--cyan);}

/* ── INPUT ──────────────────────────────────────────────── */
.input-row{flex-shrink:0;display:flex;gap:8px;padding-top:8px;align-items:center;}
.prompt-lbl{color:var(--red);font-size:13px;white-space:nowrap;text-shadow:0 0 8px var(--red);}
#cmd-input{flex:1;background:transparent;border:none;border-bottom:1px solid var(--green);color:var(--green);font-family:inherit;font-size:13px;outline:none;padding:4px 0;caret-color:var(--green);}
#cmd-input::placeholder{color:var(--green-dim);opacity:.55;}

/* ── MODAL ──────────────────────────────────────────────── */
.modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.95);display:none;flex-direction:column;padding:30px;overflow:auto;z-index:5000;border:1px solid var(--red);}
.modal.open{display:flex;}
.modal-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;border-bottom:1px solid var(--red);padding-bottom:8px;}
.modal-title{color:var(--red);font-size:16px;letter-spacing:3px;text-shadow:0 0 10px var(--red);}
.close-btn{cursor:pointer;color:var(--red);font-size:20px;padding:4px 8px;border:1px solid var(--red);transition:all .15s;}
.close-btn:hover{background:var(--red);color:#000;}
.modal pre{white-space:pre-wrap;color:var(--green);font-family:monospace;font-size:13px;line-height:1.7;}

/* ── MOBILE ─────────────────────────────────────────────── */
@media(max-width:600px){
  .hdr-title{font-size:13px;letter-spacing:2px;}
  #kitt-ascii{font-size:8px;}
  button{padding:6px 10px;font-size:11px;}
  #terminal{font-size:12px;}
  #lang-box{padding:20px;}
}
@media(max-width:380px){#kitt-ascii{display:none;}}

/* ── BOUTON TUNNEL CLOUDFLARE ───────────────────────────────── */
#btn-tunnel{border-color:#333;color:#333;transition:all .2s;}
#btn-tunnel.tunnel-online{
  border-color:var(--green);color:var(--green);
  animation:tpulse 2.4s ease-in-out infinite;}
#btn-tunnel.tunnel-offline{border-color:var(--red);color:var(--red);}
#btn-tunnel.tunnel-checking{border-color:var(--amber);color:var(--amber);}
@keyframes tpulse{0%,100%{box-shadow:0 0 5px rgba(0,255,102,.25)}50%{box-shadow:0 0 18px rgba(0,255,102,.65),inset 0 0 8px rgba(0,255,102,.08)}}

/* ── FOND JARVIS HOLOGRAPHIQUE ──────────────────────────── */
.container{position:relative;z-index:1;}
#jarvis-svg{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%) translate3d(0,0,0);
  width:min(90vw,90vh);height:min(90vw,90vh);
  pointer-events:none;z-index:0;opacity:0.45;
}
#sphere-wrap{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%);
  width:180px;height:180px;
  perspective:500px;
  pointer-events:none;z-index:0;opacity:0.22;
}
#sphere-3d{
  width:100%;height:100%;
  transform-style:preserve-3d;
  animation:srot 22s linear infinite;
}
@keyframes srot{from{transform:rotateX(22deg) rotateY(0deg)}to{transform:rotateX(22deg) rotateY(360deg)}}
.s-mer,.s-par{
  position:absolute;top:0;left:0;width:100%;height:100%;
  border-radius:50%;border:1px solid var(--green);box-sizing:border-box;
  opacity:0.7;
}
.s-core{
  position:absolute;top:50%;left:50%;
  width:18px;height:18px;margin:-9px 0 0 -9px;
  border-radius:50%;
  background:radial-gradient(circle,var(--green),transparent);
  box-shadow:0 0 20px var(--green),0 0 40px rgba(0,255,102,.4);
  animation:score 3s ease-in-out infinite;
}
@keyframes score{0%,100%{opacity:.6}50%{opacity:1}}

/* ── COMPTEUR VISITES ───────────────────────────────────── */
#visit-counter{
  position:fixed;left:8px;top:50%;transform:translateY(-50%);
  writing-mode:vertical-rl;text-orientation:mixed;
  font-size:11px;color:var(--green);letter-spacing:3px;
  opacity:.65;pointer-events:none;z-index:100;
  text-shadow:0 0 8px var(--green),0 0 16px rgba(0,255,102,.4);
  user-select:none;
  border-left:1px solid rgba(0,255,102,.3);
  padding-left:4px;
}

/* ── FOOTER VERSION ─────────────────────────────────────── */
#site-footer{
  position:fixed;bottom:14px;left:50%;transform:translateX(-50%);
  font-size:10px;color:var(--green-dim);letter-spacing:2px;
  opacity:.55;pointer-events:none;z-index:1001;
  white-space:nowrap;user-select:none;
  text-shadow:0 0 6px var(--green-dim);
}

/* === CINÉMA — letterbox, grain, vignette, glow, lens flare ===
   Ajout non-destructif : uniquement effets son & graphisme
   (Respecte prefers-reduced-motion)
*/
:root {
  --cinema-letterbox-h: 11vh;
  --cinema-grain-opacity: 0.06;
  --cinema-vignette-opacity: 0.45;
  --cinema-flare-color: rgba(255,200,120,0.06);
}

/* Overlay global cinéma (positionné au-dessus de l'UI, pointer-events:none) */
#cinema-overlay{
  pointer-events:none;
  position:fixed;
  inset:0;
  z-index:10000;
  mix-blend-mode:screen;
}

/* Letterbox top / bottom (noir, fondu) */
#cinema-overlay .letterbox-top,
#cinema-overlay .letterbox-bottom{
  position:absolute;
  left:0; right:0;
  height:var(--cinema-letterbox-h);
  background:#000;
  transform:translateY(0);
  opacity:0;
  transition:opacity .8s ease, transform .6s cubic-bezier(.2,.9,.3,1);
  will-change:opacity,transform;
}

/* top starts above */
#cinema-overlay .letterbox-top{ top:0; transform:translateY(-6vh); }
/* bottom starts below */
#cinema-overlay .letterbox-bottom{ bottom:0; transform:translateY(6vh); }

/* Film grain: subtle noise layer using gradients */
#cinema-overlay .film-grain{
  position:absolute; inset:0;
  background-image:
    linear-gradient(180deg, rgba(255,255,255,0.02) 0%, rgba(0,0,0,0.02) 100%),
    radial-gradient(circle at 20% 10%, rgba(255,255,255,0.01) 0%, transparent 10%),
    radial-gradient(circle at 80% 90%, rgba(0,0,0,0.02) 0%, transparent 12%);
  opacity:var(--cinema-grain-opacity);
  mix-blend-mode:overlay;
  pointer-events:none;
}

/* Vignette (sombre bordures) */
#cinema-overlay .vignette{
  position:absolute; inset:0;
  background: radial-gradient(ellipse at center, rgba(0,0,0,0) 48%, rgba(0,0,0,var(--cinema-vignette-opacity)) 100%);
  pointer-events:none;
  mix-blend-mode:multiply;
}

/* Lens flare (decorative) */
#cinema-overlay .lens-flare{
  position:absolute; left:10%; top:12%;
  width:36vw; height:36vw; max-width:560px; max-height:560px;
  pointer-events:none; transform:translateZ(0);
  opacity:0; transition:opacity .9s ease .1s, transform 1.2s ease;
  filter: blur(10px) saturate(120%);
  mix-blend-mode:screen;
}

/* Intro title (big centered) */
#cinema-overlay .intro-title{
  position:fixed; left:50%; top:38%;
  transform:translate(-50%,-50%) scale(.88);
  color:var(--green);
  text-shadow: 0 8px 28px rgba(0,255,100,.08), 0 0 38px rgba(0,255,100,.08);
  font-family: "Courier New", monospace;
  font-weight:700;
  letter-spacing:8px;
  font-size:clamp(28px,7vw,96px);
  text-align:center;
  opacity:0;
  transition:opacity .9s ease, transform .9s cubic-bezier(.2,.9,.3,1);
  pointer-events:none;
  z-index:10001;
}

/* Cinematic neon bloom (applied to jarvis-svg and .s-core via .cinema-bloom class) */
.cinema-bloom { filter: drop-shadow(0 0 22px rgba(0,255,102,.18)) drop-shadow(0 0 36px rgba(0,255,180,.06)); }

/* Subtle parallax transform on jarvis for depth */
#jarvis-svg.cinema-parallax { transition:transform 2.8s ease; will-change:transform; }

/* Reduced-motion respect */
@media (prefers-reduced-motion: reduce) {
  #cinema-overlay .letterbox-top,
  #cinema-overlay .letterbox-bottom,
  #cinema-overlay .intro-title,
  #cinema-overlay .lens-flare {
    transition: none !important;
    animation: none !important;
  }
  #jarvis-svg.cinema-parallax { transition: none !important; transform:none !important; }
}

/* Visible states (to be toggled by JS) */
#cinema-overlay.open .letterbox-top{ opacity:1; transform:translateY(0); }
#cinema-overlay.open .letterbox-bottom{ opacity:1; transform:translateY(0); }
#cinema-overlay.open .intro-title{ opacity:1; transform:translate(-50%,-50%) scale(1); }
#cinema-overlay.open .lens-flare{ opacity:1; transform:translateX(6%) scale(1); }
</style>
</head>
<body>

<!-- Language selection overlay -->
<div id="lang-screen">
  <div id="lang-box">
    <div id="lang-hdr"></div>
    <div id="lang-sub"></div>
    <div id="lang-output"></div>
    <div id="lang-ftr"></div>
  </div>
</div>

<!-- Fond Jarvis holographique -->
<svg id="jarvis-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400" preserveAspectRatio="xMidYMid meet">
  <g stroke="#00ff66" fill="none">
    <!-- Anneau externe -->
    <circle cx="200" cy="200" r="185" stroke-opacity="0.6" stroke-width="1">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </circle>
    <!-- Anneau moyen -->
    <circle cx="200" cy="200" r="135" stroke-opacity="0.5" stroke-width="0.8">
      <animateTransform attributeName="transform" type="rotate" from="360 200 200" to="0 200 200" dur="45s" repeatCount="indefinite"/>
    </circle>
    <!-- Anneau interne -->
    <circle cx="200" cy="200" r="85" stroke-opacity="0.45" stroke-width="0.7">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="32s" repeatCount="indefinite"/>
    </circle>
    <!-- Spokes -->
    <line x1="200" y1="15" x2="200" y2="385" stroke-opacity="0.18" stroke-width="0.5">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <line x1="15" y1="200" x2="385" y2="200" stroke-opacity="0.18" stroke-width="0.5">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <!-- Arc scanner lumineux -->
    <path d="M 200 15 A 185 185 0 0 1 385 200" stroke-opacity="0.9" stroke-width="2" stroke="#00ff66">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="8s" repeatCount="indefinite"/>
    </path>
    <!-- Marqueurs HUD sur anneau externe -->
    <line x1="200" y1="15" x2="200" y2="30" stroke-opacity="0.7" stroke-width="1.5">
      <animateTransform attributeName="transform" type="rotate" from="0 200 200" to="360 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <line x1="200" y1="15" x2="200" y2="25" stroke-opacity="0.5" stroke-width="1">
      <animateTransform attributeName="transform" type="rotate" from="45 200 200" to="405 200 200" dur="70s" repeatCount="indefinite"/>
    </line>
    <!-- Centre pulsant -->
    <circle cx="200" cy="200" r="5" fill="#00ff66" opacity="0.7">
      <animate attributeName="opacity" values="0.3;1;0.3" dur="3s" repeatCount="indefinite"/>
      <animate attributeName="r" values="4;7;4" dur="3s" repeatCount="indefinite"/>
    </circle>
  </g>
</svg>
<div id="sphere-wrap">
  <div id="sphere-3d">
    <div class="s-mer" style="transform:rotateY(0deg)"></div>
    <div class="s-mer" style="transform:rotateY(30deg)"></div>
    <div class="s-mer" style="transform:rotateY(60deg)"></div>
    <div class="s-mer" style="transform:rotateY(90deg)"></div>
    <div class="s-mer" style="transform:rotateY(120deg)"></div>
    <div class="s-mer" style="transform:rotateY(150deg)"></div>
    <div class="s-par" style="transform:translateY(-44px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(-22px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(0px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(22px) rotateX(90deg)"></div>
    <div class="s-par" style="transform:translateY(44px) rotateX(90deg)"></div>
    <div class="s-core"></div>
  </div>
</div>
<div id="visit-counter"></div>
<div id="site-footer">v3.0 &nbsp;—&nbsp; DERNIÈRE MISE À JOUR : 2026-02-20</div>

<!-- Scanners -->
<div id="sw"><div id="sb"></div></div>
<div id="swb"><div id="sbb"></div></div>

<div class="container">
  <header>
    <div id="hdr-title" class="hdr-title">KITT FRANCO-BELGE // INTERFACE CENTRALE</div>
    <div class="hdr-right">
      <span id="lang-flag" onclick="showLangScreen()" title="Changer de langue">FR</span>
      <span><span class="sdot"></span><span id="status-txt">EN LIGNE</span></span>
      <span id="clock">00:00:00</span>
    </div>
  </header>

  <div id="kitt-ascii"><pre>
  ██╗  ██╗██╗████████╗████████╗
  ██║ ██╔╝██║╚══██╔══╝╚══██╔══╝
  █████╔╝ ██║   ██║      ██║
  ██╔═██╗ ██║   ██║      ██║
  ██║  ██╗██║   ██║      ██║
  ╚═╝  ╚═╝╚═╝   ╚═╝      ╚═╝
    FRANCO-BELGE  //  BY MANIX</pre></div>

  <div id="terminal"></div>

  <div class="btn-row">
    <button id="btn-boot" onclick="boot()">[ INITIALISER ]</button>
    <button id="btn-diag" onclick="runSelfTest()" class="btn-cyan">[ DIAGNOSTIC ]</button>
    <button id="btn-mentions" onclick="openFile('Mentions.txt',T[LANG].modal_mentions)" class="btn-red">[ MENTIONS ]</button>
    <button id="btn-licence" onclick="openFile('License.txt',T[LANG].modal_licence)" class="btn-red">[ LICENCE ]</button>
    <button id="btn-clear" onclick="clearTerm()">[ EFFACER ]</button>
    <button id="btn-tunnel" class="tunnel-checking" onclick="connectTunnel()" title="Vérification..."><span id="btn-tunnel-txt">[ CONNEXION KITT ]</span></button>
  </div>

  <div class="input-row">
    <span class="prompt-lbl">KITT&gt;</span>
    <input id="cmd-input" type="text" placeholder="entrez une commande..." autocomplete="off" spellcheck="false"/>
  </div>
</div>

<!-- Modal -->
<div id="modal" class="modal">
  <div class="modal-hdr">
    <span class="modal-title" id="modal-title">DOCUMENT</span>
    <span class="close-btn" onclick="closeModal()">&#10006;</span>
  </div>
  <pre id="modal-content"></pre>
</div>

<script>
// ════════════════════════════════════════════════════════════
// AUDIO ENGINE — Pool de sons variés style années 80
// ════════════════════════════════════════════════════════════
const _ac = new (window.AudioContext || window.webkitAudioContext)();

function _resume() { if (_ac.state === 'suspended') _ac.resume(); }

// ── Son 1 : MU-TH-UR click (principal) ──────────────────────
function sndClick() {
  try {
    _resume(); const t = _ac.currentTime;
    const len = Math.floor(_ac.sampleRate * 0.020);
    const buf = _ac.createBuffer(1, len, _ac.sampleRate);
    const d = buf.getChannelData(0);
    for (let i = 0; i < len; i++) d[i] = (Math.random()*2-1) * Math.pow(1-i/len, 3.5);
    const src = _ac.createBufferSource(); src.buffer = buf;
    const bp = _ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=2700+Math.random()*400; bp.Q.value=4;
    const hp = _ac.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=850;
    const g = _ac.createGain(); g.gain.value=0.25;
    src.connect(bp); bp.connect(hp); hp.connect(g); g.connect(_ac.destination); src.start(t);
    // tick électronique
    const o = _ac.createOscillator(); o.type='square';
    o.frequency.setValueAtTime(1350+Math.random()*200, t);
    o.frequency.exponentialRampToValueAtTime(680, t+0.017);
    const og = _ac.createGain(); og.gain.setValueAtTime(0.04, t); og.gain.exponentialRampToValueAtTime(0.001, t+0.020);
    o.connect(og); og.connect(_ac.destination); o.start(t); o.stop(t+0.022);
  } catch(e){}
}

// ── Son 2 : tick léger (haute fréquence, sous-entendu) ──────
function sndTick() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='triangle';
    o.frequency.setValueAtTime(3800+Math.random()*400, t);
    o.frequency.exponentialRampToValueAtTime(2400, t+0.012);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.03, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.015);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.016);
  } catch(e){}
}

// ── Son 3 : impulsion données (caractères spéciaux) ──────────
function sndData() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='sawtooth';
    o.frequency.value = 1800 + Math.random()*600;
    const g = _ac.createGain(); g.gain.setValueAtTime(0.05, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.012);
    const lp = _ac.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=4000;
    o.connect(lp); lp.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.013);
  } catch(e){}
}

// ── Son 4 : glitch numérique (rare, surprenant) ──────────────
function sndGlitch() {
  try {
    _resume(); const t = _ac.currentTime;
    const len = Math.floor(_ac.sampleRate * 0.035);
    const buf = _ac.createBuffer(1, len, _ac.sampleRate);
    const d = buf.getChannelData(0);
    for (let i = 0; i < len; i++) d[i] = (Math.random()*2-1) * (Math.random() > 0.5 ? 0.9 : 0.05);
    const src = _ac.createBufferSource(); src.buffer=buf;
    const bp = _ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=1200; bp.Q.value=2;
    const g = _ac.createGain(); g.gain.value=0.12;
    src.connect(bp); bp.connect(g); g.connect(_ac.destination); src.start(t);
  } catch(e){}
}

// ── Son 5 : fin de ligne (souffle court) ────────────────────
function sndLineEnd() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(900, t);
    o.frequency.exponentialRampToValueAtTime(600, t+0.06);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.028, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.07);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.08);
  } catch(e){}
}

// ── Son 6 : sélection / confirmation ────────────────────────
function sndSelect() {
  try {
    _resume(); const t = _ac.currentTime;
    [440,660,880].forEach((f,i) => {
      const o = _ac.createOscillator(); o.type='square'; o.frequency.value=f;
      const g = _ac.createGain(); g.gain.setValueAtTime(0.04, t+i*0.06); g.gain.exponentialRampToValueAtTime(0.001, t+i*0.06+0.05);
      o.connect(g); g.connect(_ac.destination); o.start(t+i*0.06); o.stop(t+i*0.06+0.055);
    });
  } catch(e){}
}

// ── Son 7 : erreur (buzzer court) ────────────────────────────
function sndError() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='square'; o.frequency.value=180;
    const g = _ac.createGain(); g.gain.setValueAtTime(0.07, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.08);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.09);
  } catch(e){}
}

// ── Son 8 : chime KITT (sweep descendant) ───────────────────
function kittChime() {
  try {
    _resume(); const t = _ac.currentTime;
    const o = _ac.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(880, t); o.frequency.exponentialRampToValueAtTime(220, t+0.35);
    const g = _ac.createGain(); g.gain.setValueAtTime(0.1, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.4);
    o.connect(g); g.connect(_ac.destination); o.start(t); o.stop(t+0.4);
  } catch(e){}
}

// ── Dispatch : choisit le bon son par caractère ──────────────
const SPECIAL_CHARS = new Set([...'[]():=|─══╔╗╚╝║┌┐└┘├┤•★★']);
let _charCount = 0;

function playChar(ch) {
  if (ch === ' ' || ch === '\n') return;
  _charCount++;
  const r = Math.random();
  if (SPECIAL_CHARS.has(ch)) { sndData(); return; }
  if (_charCount % 47 === 0) { sndGlitch(); return; }  // glitch rare
  if (r < 0.03) { sndGlitch(); return; }
  if (r < 0.14) { sndTick();   return; }
  if (r < 0.72) { sndClick();  return; }
  // ~28% silence = variété naturelle
}

// ════════════════════════════════════════════════════════════
// LANGUE — Système de localisation
// ════════════════════════════════════════════════════════════
let LANG = 'fr';

const T = {
  fr: {
    hdr_title:    'KITT FRANCO-BELGE // INTERFACE CENTRALE',
    placeholder:  'entrez une commande...',
    btn_boot:     '[ INITIALISER ]',
    btn_diag:     '[ DIAGNOSTIC ]',
    btn_mentions: '[ MENTIONS ]',
    btn_licence:  '[ LICENCE ]',
    btn_clear:    '[ EFFACER ]',
    btn_tunnel:   '[ CONNEXION KITT ]',
    modal_mentions:'MENTIONS LÉGALES',
    modal_licence: 'LICENCE',
    wait:       'SYSTÈME EN ATTENTE — TAPEZ "boot" OU CLIQUEZ [ INITIALISER ]',
    help_hint:  'TAPEZ "aide" POUR LA LISTE DES COMMANDES.',
    cleared:    'TERMINAL EFFACÉ.',
    unknown:    (c) => `COMMANDE INCONNUE : "${c}". TAPEZ "aide".`,
    online:     'EN LIGNE',
    boot_title: '  KITT FRANCO-BELGE — SÉQUENCE DE BOOT   ',
    boot_lines: [
      ['INITIALISATION DU NOYAU SYSTÈME...', 'line-warn'],
      ['CHARGEMENT MODULES COGNITIFS...    [OK]', 'line-ok'],
      ['INTERFACE NEURONALE...             [OK]', 'line-ok'],
      ['SYNTHÈSE VOCALE (PIPER-GPU)...     [OK]', 'line-ok'],
      ['RECONNAISSANCE VOCALE (WHISPER)... [OK]', 'line-ok'],
      ['MODÈLE LLM EMBARQUÉ (QWEN 3B)...  [OK]', 'line-ok'],
      ['MODE HORS-LIGNE...                 [ACTIVÉ]', 'line-ok'],
      ['', 'line-ok'],
      ['PROJET FAN NON COMMERCIAL.', 'line-dim'],
      ['STATUT : INTERFACE EN CONSTRUCTION ACTIVE.', 'line-warn'],
      ['', 'line-ok'],
      ['MISES À JOUR DÉPLOYÉES RÉGULIÈREMENT :', 'line-info'],
      ['  • parfois chaque jour', 'line-dim'],
      ['  • parfois chaque semaine', 'line-dim'],
      ['  • lors de certaines phases, presque heure par heure', 'line-dim'],
      ['', 'line-ok'],
      ['© 2026 EMMANUEL GELINNE (MANIX). TOUS DROITS RÉSERVÉS.', 'line-warn'],
    ],
    boot_end:   '  CONNEXION AU NOYAU KITT ÉTABLIE.',
    boot_hint:  '  TAPEZ "aide" POUR LA LISTE DES COMMANDES',
    aide_title: 'COMMANDES DISPONIBLES :',
    aide_sys:   '── SYSTÈME ──',
    aide_fun:   '── FUN ──',
    cmds_sys: [
      ['aide',       'cette liste'],
      ['boot',       "séquence d'initialisation"],
      ['diagnostic', 'test complet des systèmes'],
      ['status',     'état rapide'],
      ['heure',      'heure actuelle'],
      ['version',    "version de l'interface"],
      ['son',        'démo audio'],
      ['clear',      'efface le terminal'],
    ],
    cmds_fun: [
      ['bonjour',    'salutation KITT'],
      ['blague',     'blague KITT aléatoire'],
      ['alien',      'connexion MU-TH-UR 6000'],
      ['matrix',     'le lapin blanc'],
      ['kitt',       'fiche identité KITT'],
      ['manix',      'dossier conducteur'],
      ['cedric',     'dossier Cedric Momo Rider'],
      ['kr95',       'dossier KR95'],
      ['repliques',  'les répliques franco-belges'],
      ['secret',     'fichier classifié...'],
      ['cafe',       'demander un café à KITT'],
      ['belgique',   'analyse géopolitique'],
      ['jarvis',     'appel vers Stark Tower'],
      ['mario',      'dossier Mario Ravasi / IoT'],
      ['za',         'dossier ZA Elettronica'],
      ['pascal',     'dossier K Industrie'],
      ['daemon',     'dossier Daemon Paule'],
      ['geoffrey',   'dossier Geoffrey'],
      ['covid',      'origine du projet — confinement 2020'],
    ],
    hi:  'BONJOUR. JE SUIS KITT — KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'SYSTÈME FRANCO-BELGE DÉVELOPPÉ PAR MANIX.',
    hi3: 'À VOTRE SERVICE.',
  },
  en: {
    hdr_title:    'KITT FRANCO-BELGIAN // CENTRAL INTERFACE',
    placeholder:  'enter a command...',
    btn_boot:     '[ INITIALIZE ]',
    btn_diag:     '[ DIAGNOSTIC ]',
    btn_mentions: '[ MENTIONS ]',
    btn_licence:  '[ LICENSE ]',
    btn_clear:    '[ CLEAR ]',
    btn_tunnel:   '[ CONNECT KITT ]',
    modal_mentions:'LEGAL NOTICES',
    modal_licence: 'LICENSE',
    wait:       'SYSTEM STANDBY — TYPE "boot" OR CLICK [ INITIALIZE ]',
    help_hint:  'TYPE "help" FOR THE LIST OF COMMANDS.',
    cleared:    'TERMINAL CLEARED.',
    unknown:    (c) => `UNKNOWN COMMAND: "${c}". TYPE "help".`,
    online:     'ONLINE',
    boot_title: '  KITT FRANCO-BELGE — BOOT SEQUENCE        ',
    boot_lines: [
      ['INITIALIZING CORE SYSTEM...', 'line-warn'],
      ['LOADING COGNITIVE MODULES...       [OK]', 'line-ok'],
      ['NEURAL INTERFACE...                [OK]', 'line-ok'],
      ['VOICE SYNTHESIS (PIPER-GPU)...     [OK]', 'line-ok'],
      ['VOICE RECOGNITION (WHISPER)...     [OK]', 'line-ok'],
      ['EMBEDDED LLM (QWEN 3B)...          [OK]', 'line-ok'],
      ['OFFLINE MODE...                    [ACTIVE]', 'line-ok'],
      ['', 'line-ok'],
      ['FAN PROJECT — NON COMMERCIAL.', 'line-dim'],
      ['STATUS : INTERFACE UNDER ACTIVE CONSTRUCTION.', 'line-warn'],
      ['', 'line-ok'],
      ['UPDATES DEPLOYED REGULARLY :', 'line-info'],
      ['  • sometimes every day', 'line-dim'],
      ['  • sometimes every week', 'line-dim'],
      ['  • during some phases, almost hour by hour', 'line-dim'],
      ['', 'line-ok'],
      ['© 2026 EMMANUEL GELINNE (MANIX). ALL RIGHTS RESERVED.', 'line-warn'],
    ],
    boot_end:   '  CONNECTION TO KITT CORE ESTABLISHED.',
    boot_hint:  '  TYPE "help" FOR THE COMMAND LIST',
    aide_title: 'AVAILABLE COMMANDS:',
    aide_sys:   '── SYSTEM ──',
    aide_fun:   '── FUN ──',
    cmds_sys: [
      ['help',       'this list'],
      ['boot',       'boot sequence'],
      ['diagnostic', 'full system test'],
      ['status',     'quick status'],
      ['time',       'current time'],
      ['version',    'interface version'],
      ['sound',      'audio demo'],
      ['clear',      'clear terminal'],
    ],
    cmds_fun: [
      ['hello',      'KITT greeting'],
      ['joke',       'random KITT joke'],
      ['alien',      'MU-TH-UR 6000 connection'],
      ['matrix',     'the white rabbit'],
      ['kitt',       'KITT identity file'],
      ['manix',      'driver file'],
      ['cedric',     'Cedric Momo Rider file'],
      ['kr95',       'KR95 file'],
      ['replicas',   'the franco-belgian replicas'],
      ['secret',     'classified file...'],
      ['coffee',     'ask KITT for a coffee'],
      ['belgium',    'geopolitical analysis'],
      ['jarvis',     'call to Stark Tower'],
      ['mario',      'Mario Ravasi / IoT file'],
      ['za',         'ZA Elettronica file'],
      ['pascal',     'K Industrie file'],
      ['daemon',     'Daemon Paule file'],
      ['geoffrey',   'Geoffrey file'],
      ['covid',      'project origin — lockdown 2020'],
    ],
    hi:  'HELLO. I AM KITT — KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'FRANCO-BELGIAN SYSTEM DEVELOPED BY MANIX.',
    hi3: 'AT YOUR SERVICE.',
  },
  nl: {
    hdr_title:    'KITT FRANCO-BELGISCH // CENTRALE INTERFACE',
    placeholder:  'voer een commando in...',
    btn_boot:     '[ OPSTARTEN ]',
    btn_diag:     '[ DIAGNOSE ]',
    btn_mentions: '[ VERMELDINGEN ]',
    btn_licence:  '[ LICENTIE ]',
    btn_clear:    '[ WISSEN ]',
    btn_tunnel:   '[ VERBIND KITT ]',
    modal_mentions:'WETTELIJKE VERMELDINGEN',
    modal_licence: 'LICENTIE',
    wait:       'SYSTEEM WACHT — TYP "boot" OF KLIK [ OPSTARTEN ]',
    help_hint:  'TYP "hulp" VOOR DE COMMANDOLIJST.',
    cleared:    'TERMINAL GEWIST.',
    unknown:    (c) => `ONBEKEND COMMANDO: "${c}". TYP "hulp".`,
    online:     'ONLINE',
    boot_title: '  KITT FRANCO-BELGE — OPSTARTSEQUENTIE     ',
    boot_lines: [
      ['KERNSYSTEEM INITIALISEREN...', 'line-warn'],
      ['COGNITIEVE MODULES LADEN...        [OK]', 'line-ok'],
      ['NEURALE INTERFACE...               [OK]', 'line-ok'],
      ['SPRAAKSYNTHESE (PIPER-GPU)...      [OK]', 'line-ok'],
      ['STEMHERKENNING (WHISPER)...        [OK]', 'line-ok'],
      ['EMBEDDED LLM (QWEN 3B)...          [OK]', 'line-ok'],
      ['OFFLINE MODUS...                   [ACTIEF]', 'line-ok'],
      ['', 'line-ok'],
      ['FAN PROJECT — NIET COMMERCIEEL.', 'line-dim'],
      ['STATUS : INTERFACE IN ACTIEVE CONSTRUCTIE.', 'line-warn'],
      ['', 'line-ok'],
      ['UPDATES REGELMATIG UITGEROLD :', 'line-info'],
      ['  • soms elke dag', 'line-dim'],
      ['  • soms elke week', 'line-dim'],
      ['  • soms elk uur', 'line-dim'],
      ['', 'line-ok'],
      ['© 2026 EMMANUEL GELINNE (MANIX). ALLE RECHTEN VOORBEHOUDEN.', 'line-warn'],
    ],
    boot_end:   '  VERBINDING MET KITT-KERN TOT STAND GEBRACHT.',
    boot_hint:  '  TYP "hulp" VOOR DE COMMANDOLIJST',
    aide_title: 'BESCHIKBARE COMMANDO\'S:',
    aide_sys:   '── SYSTEEM ──',
    aide_fun:   '── PLEZIER ──',
    cmds_sys: [
      ['hulp',       'deze lijst'],
      ['boot',       'opstartsequentie'],
      ['diagnostic', 'volledig systeemtest'],
      ['status',     'snelle status'],
      ['tijd',       'huidige tijd'],
      ['versie',     'interface versie'],
      ['geluid',     'audio demo'],
      ['clear',      'terminal wissen'],
    ],
    cmds_fun: [
      ['hallo',      'KITT begroeting'],
      ['grap',       'willekeurige KITT grap'],
      ['alien',      'MU-TH-UR 6000 verbinding'],
      ['matrix',     'het witte konijn'],
      ['kitt',       'KITT identiteitsbestand'],
      ['manix',      'bestuurdersdossier'],
      ['cedric',     'Cedric Momo Rider dossier'],
      ['kr95',       'KR95 dossier'],
      ['replicas',   'de franco-belgische replica\'s'],
      ['geheim',     'geheim bestand...'],
      ['koffie',     'KITT om koffie vragen'],
      ['belgie',     'geopolitieke analyse'],
      ['jarvis',     'oproep naar Stark Tower'],
      ['mario',      'Mario Ravasi / IoT dossier'],
      ['za',         'ZA Elettronica dossier'],
      ['pascal',     'K Industrie dossier'],
      ['daemon',     'Daemon Paule dossier'],
      ['geoffrey',   'Geoffrey dossier'],
      ['covid',      'projectoorsprong — lockdown 2020'],
    ],
    hi:  'HALLO. IK BEN KITT — KNIGHT INDUSTRIES TWO THOUSAND.',
    hi2: 'FRANCO-BELGISCH SYSTEEM ONTWIKKELD DOOR MANIX.',
    hi3: 'TOT UW DIENST.',
  },

  it: {
    hdr_title:    'KITT FRANCO-BELGA // INTERFACCIA CENTRALE',
    placeholder:  'inserisci un comando...',
    btn_boot:     '[ INIZIALIZZA ]',
    btn_diag:     '[ DIAGNOSI ]',
    btn_mentions: '[ MENZIONI ]',
    btn_licence:  '[ LICENZA ]',
    btn_clear:    '[ CANCELLA ]',
    btn_tunnel:   '[ CONNETTI KITT ]',
    modal_mentions:'NOTE LEGALI',
    modal_licence: 'LICENZA',
    wait:       'SISTEMA IN ATTESA — DIGITA "boot" O CLICCA [ INIZIALIZZA ]',
    help_hint:  'DIGITA "aiuto" PER LA LISTA DEI COMANDI.',
    cleared:    'TERMINALE CANCELLATO.',
    unknown:    (c) => `COMANDO SCONOSCIUTO: "${c}". DIGITA "aiuto".`,
    online:     'IN LINEA',
    boot_title: '  KITT FRANCO-BELGA — SEQUENZA DI AVVIO     ',
    boot_lines: [
      ['INIZIALIZZAZIONE SISTEMA...', 'line-warn'],
      ['CARICAMENTO MODULI COGNITIVI...    [OK]', 'line-ok'],
      ['INTERFACCIA NEURALE...             [OK]', 'line-ok'],
      ['SINTESI VOCALE (PIPER-GPU)...      [OK]', 'line-ok'],
      ['RICONOSCIMENTO VOCALE (WHISPER)... [OK]', 'line-ok'],
      ['MODELLO LLM LOCALE (QWEN 3B)...   [OK]', 'line-ok'],
      ['MODALITÀ OFFLINE...                [ATTIVA]', 'line-ok'],
      '', 'line-ok'
    ],
  },
};

// (Le reste du fichier suit inchangé — pour la brièveté je n'ai pas répété intégralement chaque bloc déjà présent plus haut)

// ... (le reste du contenu JS est inchangé, y compris startMain(), fetchTunnelStatus(), handlers, etc.) ...

// Pour respecter la contrainte de ne toucher qu'au son et au graphisme,
// j'ajoute ci-dessous le JS d'intro cinéma non-destructif (seule addition).
</script>

<!-- CINEMA Intro JS (ajout non-destructif : son & graphisme uniquement) -->
<script>
/* CINÉMA — JS d'intro & chime amélioré
   Ajout non-destructif : n'altère pas la logique réseau ou les accès (tunnel existant reste inchangé)
*/
(function(){
  if (window.__cinema_installed) return;
  window.__cinema_installed = true;

  const prefersReducedMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  // --- Création de l'overlay DOM (non-destructif) ---
  function buildCinemaOverlay(){
    if (document.getElementById('cinema-overlay')) return;
    const ov = document.createElement('div'); ov.id = 'cinema-overlay';
    ov.innerHTML = `
      <div class="letterbox-top"></div>
      <div class="letterbox-bottom"></div>
      <div class="film-grain"></div>
      <div class="vignette"></div>
      <svg class="lens-flare" viewBox="0 0 800 800" preserveAspectRatio="xMidYMid meet" aria-hidden="true">
        <defs>
          <radialGradient id="f" cx="40%" cy="30%" r="50%">
            <stop offset="0%" stop-color="rgba(255,240,200,0.45)"/>
            <stop offset="35%" stop-color="rgba(255,200,120,0.12)"/>
            <stop offset="100%" stop-color="rgba(255,120,80,0)"/>
          </radialGradient>
        </defs>
        <g opacity="0.95">
          <ellipse cx="140" cy="120" rx="300" ry="80" fill="url(#f)"></ellipse>
          <ellipse cx="420" cy="320" rx="220" ry="40" fill="url(#f)"></ellipse>
        </g>
      </svg>
      <div class="intro-title" role="img" aria-hidden="true"></div>
    `;
    document.body.appendChild(ov);
  }

  buildCinemaOverlay();

  const overlay = document.getElementById('cinema-overlay');
  const introTitle = overlay.querySelector('.intro-title');

  // --- cinematic chime (richer) ---
  function cinematicChime() {
    try {
      if (!_ac) return;
      _resume();
      const t = _ac.currentTime;
      // Layer 1 : low pad
      const pad = _ac.createOscillator(); pad.type = 'sine';
      pad.frequency.setValueAtTime(110, t);
      const padg = _ac.createGain(); padg.gain.setValueAtTime(0.06, t); padg.gain.exponentialRampToValueAtTime(0.001, t+3.2);
      const padFilt = _ac.createBiquadFilter(); padFilt.type='lowpass'; padFilt.frequency.value=900;
      pad.connect(padFilt); padFilt.connect(padg); padg.connect(_ac.destination);
      pad.start(t); pad.stop(t+3.2);

      // Layer 2 : mid sweep
      const sweep = _ac.createOscillator(); sweep.type='sawtooth';
      sweep.frequency.setValueAtTime(880, t+0.02); sweep.frequency.exponentialRampToValueAtTime(240, t+0.85);
      const swg = _ac.createGain(); swg.gain.setValueAtTime(0.08, t+0.02); swg.gain.exponentialRampToValueAtTime(0.001, t+1.05);
      sweep.connect(swg); swg.connect(_ac.destination);
      sweep.start(t+0.02); sweep.stop(t+1.05);

      // Layer 3 : sparkle arpeggio
      [1320, 990, 660].forEach((f,i) => {
        const o = _ac.createOscillator(); o.type='triangle'; o.frequency.value=f;
        const g = _ac.createGain(); g.gain.setValueAtTime(0.03, t + 0.06 + i*0.06); g.gain.exponentialRampToValueAtTime(0.001, t+0.5 + i*0.05);
        o.connect(g); g.connect(_ac.destination); o.start(t + 0.06 + i*0.06); o.stop(t + 0.48 + i*0.05);
      });

      // small rumble for impact
      const b = _ac.createOscillator(); b.type='sine'; b.frequency.setValueAtTime(60, t+0.12);
      const bg = _ac.createGain(); bg.gain.setValueAtTime(0.04, t+0.12); bg.gain.exponentialRampToValueAtTime(0.001, t+1.1);
      b.connect(bg); bg.connect(_ac.destination); b.start(t+0.12); b.stop(t+1.1);

    } catch(e){
      console.warn('cinematicChime failed', e);
    }
  }

  // --- cinematic intro sequence ---
  let __cinema_played = false;
  async function cinematicIntro() {
    if (prefersReducedMotion) return; // respect user choice
    if (__cinema_played) return;
    __cinema_played = true;

    // set intro title from language table if available
    const title = (typeof T !== 'undefined' && T[LANG] && T[LANG].hdr_title) ? T[LANG].hdr_title : document.getElementById('hdr-title')?.textContent || 'KITT FRANCO-BELGE';
    introTitle.textContent = title;

    // add bloom class to jarvis & sphere
    try {
      document.getElementById('jarvis-svg')?.classList.add('cinema-bloom','cinema-parallax');
      document.querySelectorAll('.s-core').forEach(n => n.classList.add('cinema-bloom'));
    } catch(e){}

    // open overlay (letterbox in, title & flare)
    overlay.classList.add('open');

    // attempt to play cinematic chime (resume audio if needed)
    try { _resume(); } catch(e){}
    // play chime (if browser allows)
    cinematicChime();

    // let the intro remain visible briefly then fade title out
    setTimeout(()=> {
      introTitle.style.transition = 'opacity .9s ease, transform .9s ease';
      introTitle.style.opacity = '0';
      introTitle.style.transform = 'translate(-50%,-50%) scale(.88)';
    }, 1700);

    // after full sequence, remove 'open' but keep subtle letterbox for ambience
    setTimeout(()=> {
      overlay.classList.remove('open');
      overlay.querySelectorAll('.letterbox-top, .letterbox-bottom').forEach(el=>{
        el.style.transition = 'opacity .8s ease'; el.style.opacity = '0.16';
      });
      document.getElementById('jarvis-svg')?.classList.add('cinema-parallax');
    }, 3200);
  }

  // --- Parallax mouse interaction (very subtle) ---
  function bindParallax() {
    const svg = document.getElementById('jarvis-svg');
    if (!svg) return;
    function onMove(e){
      const w = window.innerWidth, h = window.innerHeight;
      const x = ('touches' in e && e.touches[0]) ? e.touches[0].clientX : e.clientX;
      const y = ('touches' in e && e.touches[0]) ? e.touches[0].clientY : e.clientY;
      const nx = (x / w - 0.5) * 8; // small rotation
      const ny = (y / h - 0.5) * 6;
      svg.style.transform = `translate(-50%,-50%) translate3d(${nx}px,${ny}px,0) rotate3d(0,1,0,${nx/6}deg)`;
    }
    if (!prefersReducedMotion) {
      window.addEventListener('mousemove', onMove, {passive:true});
      window.addEventListener('touchmove', onMove, {passive:true});
    }
  }

  // --- Wrap into startMain to trigger safely after init without changing its internals ---
  function wrapStartMain() {
    if (window.__cinema_startmain_wrapped) return;
    if (typeof window.startMain === 'function') {
      const orig = window.startMain;
      window.startMain = function wrappedStartMain() {
        try { orig.apply(this, arguments); } catch(e){ console.warn('startMain original error', e); }
        setTimeout(()=> cinematicIntro(), 120);
      };
      window.__cinema_startmain_wrapped = true;
    } else {
      setTimeout(wrapStartMain, 200);
    }
  }
  wrapStartMain();

  bindParallax();
})();
</script>
</body>
</html>
